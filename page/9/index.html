<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <link rel="dns-prefetch" href="http://yoursite.com">
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://yoursite.com/page/9/index.html">
<meta property="og:site_name" content="Hexo">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hexo">
  
    <link rel="alternative" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" type="text/css" href="/./main.f6a68c.css">
  <style type="text/css">
  
    #container.show {
      background: linear-gradient(200deg,#a0cfe4,#e8c37e);
    }
  </style>
  

  

</head>

<body>
  <div id="container" q-class="show:isCtnShow">
    <canvas id="anm-canvas" class="anm-canvas"></canvas>
    <div class="left-col" q-class="show:isShow">
      
<div class="overlay" style="background: #4d4d4d"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			<img src="/images/avatar.png" class="js-avatar">
		</a>
		<hgroup>
		  <h1 class="header-author"><a href="/">Jack_zhou</a></h1>
		</hgroup>
		

		<nav class="header-menu">
			<ul>
			
				<li><a href="/">主页</a></li>
	        
				<li><a href="/tags/随笔/">随笔</a></li>
	        
			</ul>
		</nav>
		<nav class="header-smart-menu">
    		
    			
    			<a q-on="click: openSlider(e, 'innerArchive')" href="javascript:void(0)">所有文章</a>
    			
            
    			
    			<a q-on="click: openSlider(e, 'friends')" href="javascript:void(0)">友链</a>
    			
            
    			
    			<a q-on="click: openSlider(e, 'aboutme')" href="javascript:void(0)">关于我</a>
    			
            
		</nav>
		<nav class="header-nav">
			<div class="social">
				
					<a class="github" target="_blank" href="#" title="github"><i class="icon-github"></i></a>
		        
					<a class="weibo" target="_blank" href="#" title="weibo"><i class="icon-weibo"></i></a>
		        
					<a class="rss" target="_blank" href="#" title="rss"><i class="icon-rss"></i></a>
		        
					<a class="zhihu" target="_blank" href="#" title="zhihu"><i class="icon-zhihu"></i></a>
		        
			</div>
		</nav>
	</header>		
</div>

    </div>
    <div class="mid-col" q-class="show:isShow,hide:isShow|isFalse">
      
<nav id="mobile-nav">
  	<div class="overlay js-overlay" style="background: #4d4d4d"></div>
	<div class="btnctn js-mobile-btnctn">
  		<div class="slider-trigger list" q-on="click: openSlider(e)"><i class="icon icon-sort"></i></div>
	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img src="/images/avatar.png" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author js-header-author">Jack_zhou</h1>
			</hgroup>
			
			
			
				
			
				
			
			
			
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="#" title="github"><i class="icon-github"></i></a>
			        
						<a class="weibo" target="_blank" href="#" title="weibo"><i class="icon-weibo"></i></a>
			        
						<a class="rss" target="_blank" href="#" title="rss"><i class="icon-rss"></i></a>
			        
						<a class="zhihu" target="_blank" href="#" title="zhihu"><i class="icon-zhihu"></i></a>
			        
				</div>
			</nav>

			<nav class="header-menu js-header-menu">
				<ul style="width: 50%">
				
				
					<li style="width: 50%"><a href="/">主页</a></li>
		        
					<li style="width: 50%"><a href="/tags/随笔/">随笔</a></li>
		        
				</ul>
			</nav>
		</header>				
	</div>
	<div class="mobile-mask" style="display:none" q-show="isShow"></div>
</nav>

      <div id="wrapper" class="body-wrap">
        <div class="menu-l">
          <div class="canvas-wrap">
            <canvas data-colors="#eaeaea" data-sectionHeight="100" data-contentId="js-content" id="myCanvas1" class="anm-canvas"></canvas>
          </div>
          <div id="js-content" class="content-ll">
            
  
    <article id="post-dns原理详解" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/07/21/dns原理详解/">DNS原理详解</a>
    </h1>
  

        
        <a href="/2017/07/21/dns原理详解/" class="archive-article-date">
  	<time datetime="2017-07-21T13:30:22.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2017-07-21</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><p>&ensp;&ensp;&ensp;&ensp;DNS（Domain Name System，域名系统），因特网上作为域名和IP地址相互映射的一个分布式数据库，能够使用户更方便的访问互联网，而不用去记住能够被机器直接读取的IP地址。通过主机名，最终得到该主机名对应的IP地址的过程叫做域名解析（或主机名解析）。DNS协议运行在UDP协议之上，使用端口号53。<br>★ 相关知识<br>◆Sockets：在互联网上基于套接字协议的通信一般都遵循C/S法则；<br>&ensp;&ensp;&ensp;&ensp;Client：客户端，发起应用请求的程序；<br>&ensp;&ensp;&ensp;&ensp;Server：响应请求（提供服务）的程序；<br>&ensp;&ensp;&ensp;&ensp;LISTEN：Socket（ip：port）<br>◆传输层协议：TCP,UDP,SCTP<br>&ensp;&ensp;&ensp;&ensp;TCP：面向连接的协议，双方通信之前需要建立虚连接；<br>&ensp;&ensp;&ensp;&ensp;UDP：无连接的协议，双方无需通信之前事先建立虚连接；</p>
<h3 id="DNS服务"><a href="#DNS服务" class="headerlink" title="DNS服务"></a>DNS服务</h3><h4 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h4><p>★ DNS：Domain Name Service 域名系统，是一个应用层协议。<br>&ensp;&ensp;&ensp;&ensp;C/S架构，监听在 53/udp(解析时使用), 53/tcp(区域传送时使用)（DNS服务在启动的时候会同时开启tcp和udp的53号端口）<br>★ DNS作用：<br>&ensp;&ensp;&ensp;&ensp;将主机名解析成IP地址的过程;<br>&ensp;&ensp;&ensp;&ensp;解决了从域名（FQDN）到主机识别的IP地址之间的转换.<br>★ 本地名称配置解析文件：/etc/hosts<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[root@node1 ~]<span class="comment"># cat /etc/hosts</span></div><div class="line">127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4</div><div class="line">::1         localhost localhost.localdomain localhost6 localhost6.localdomain6</div><div class="line">192.168.2.143 node1.jack.com node1</div><div class="line">192.168.2.144 node2.jack.com node2</div><div class="line">192.168.2.145 node3.jack.com node3</div></pre></td></tr></table></figure></p>
<p>◆缺点：<br>&ensp;&ensp;&ensp;&ensp;只能作用于本主机，而不能同步更新所有的主机使用，并且当hosts文件很庞大时很难管理，因此就必须有一个统一的组织去记录管理域名和ip的对应关系<br>★ DNS结构<br>&ensp;&ensp;&ensp;&ensp;DNS是一个分布式、分层次的主机名管理架构，通过配置DNS服务器地址，主机不需要知道对应的ip地址就能通过主机名的形式访问互联网；<br>&ensp;&ensp;&ensp;&ensp;DNS利用类似倒状树的目录结构将主机名的管理分配在不同层级的DNS服务器当中，经过分层管理，每一级DNS服务器负责部分域名信息，这也就减轻了DNS服务器的负载，同时也方便记录的更新同步。<br>★ FQDN（Full Qualified Domain Name）:完整主机名<br>&ensp;&ensp;&ensp;&ensp;完整主机名由主机名和域名构成。比如，www.taobao.com当中，www就是web网站服务器的主机名，taobao.com就是域名；<br>&ensp;&ensp;&ensp;&ensp;主机名和域名之间用实心的点号来表示；</p>
<h4 id="DNS域名"><a href="#DNS域名" class="headerlink" title="DNS域名"></a>DNS域名</h4><p>★ 域名划分：<br>◆根域：<br>◆一级域名：Top Level Domain: tld（顶级域）<br>&ensp;&ensp;&ensp;&ensp;组织域：com, edu, mil, gov, net, org, int，<br>&ensp;&ensp;&ensp;&ensp;国家域：.cn, .ca, .hk, .tw…<br>&ensp;&ensp;&ensp;&ensp;反向域：<br>◆二级域名：<br>&ensp;&ensp;&ensp;&ensp;如：.magedu.com、taobao.com<br>◆三级域名：<br>&ensp;&ensp;&ensp;&ensp;如：.dns.magedu.com<br>★ 说明：<br>&ensp;&ensp;&ensp;&ensp;每一级只负责对应下级的域的管理，其中根节点是有分布在世界各地的13台服务器组成，其中10台位于美国，另外3台设置于英国、瑞典和日本。<br>&ensp;&ensp;&ensp;&ensp;ICANN（The Internet Corporation for Assigned Names and Numbers）互联网名称与数字地址分配机构，负责在全球范围内对互联网通用顶级域名（gTLD）以及国家和地区顶级域名（ccTLD）系统的管理、以及根服务器系统的管理。<br>◆域名层级结构图：<br><img src="\images\dns域划分.png" alt="DNS域划分"><br>◆按其功能命名空间中用来描述 DNS 域名称的五个类别的介绍详见下表中，以及与每个名称类型的示例：<br><img src="\images\dns域说明.jpg" alt="DNS域说明"></p>
<h4 id="DNS解析"><a href="#DNS解析" class="headerlink" title="DNS解析"></a>DNS解析</h4><p>★解析流程：<br>     1.在浏览器中输入www.qq.com域名，操作系统会先检查自己本地的hosts文件是否有这个网址映射关系，如果有，就先调用这个IP地址映射，完成域名解析。<br>     2.如果hosts里没有这个域名的映射，则查找本地DNS解析器缓存（每次通过TCP/IP指向的DNS服务器查询到的记录返回结果都会在本地数据库中缓存一份，是这种加速机制，有生存周期TTL），是否有这个网址映射关系，如果有，直接返回，完成域名解析。<br>     3.如果hosts与本地DNS解析器缓存都没有相应的网址映射关系，首先会找TCP/IP参数中设置的首选DNS服务器，此服务器收到查询时，如果要查询的域名，包含在本地配置区域资源中，则返回解析结果给客户机，完成域名解析，此解析具有权威性。<br>     4.如果要查询的域名，不由本地DNS服务器区域解析，但该服务器已缓存了此网址映射关系，则调用这个IP地址映射，完成域名解析，此解析不具有权威性。<br>     5.如果本地DNS服务器本地区域文件与缓存解析都失效，则根据本地DNS服务器的设置（是否设置转发器）进行查询，如果未用转发模式，本地DNS就把请求发至13台根DNS，根DNS服务器收到请求后会判断这个域名(.com)是谁来授权管理，并会返回一个负责该顶级域名服务器的一个IP。本地DNS服务器收到IP信息后，将会联系负责.com域的这台服务器。这台负责.com域的服务器收到请求后，如果自己无法解析，它就会找一个管理.com域的下一级DNS服务器地址(qq.com)给本地DNS服务器。当本地DNS服务器收到这个地址后，就会找qq.com域服务器，重复上面的动作，进行查询，直至找到www.qq.com主机。<br>     6.如果用的是转发模式，此DNS服务器就会把请求转发至上一级DNS服务器，由上一级服务器进行解析，上一级服务器如果不能解析，或找根DNS或把转请求转至上上级，以此循环。不管是本地DNS服务器用是是转发，还是根提示，最后都是把结果返回给本地DNS服务器，由此DNS服务器再返回给客户机。<br>◆说明：<br>    从客户端到本地DNS服务器是属于递归查询，而DNS服务器之间就是的交互查询就是迭代查询。<br>◆解析流程图如下：<br><img src="\images\dns解析流程图.jpg" alt="DNS解析流程图"></p>
<h4 id="DNS类型，解析方式"><a href="#DNS类型，解析方式" class="headerlink" title="DNS类型，解析方式"></a>DNS类型，解析方式</h4><p>★ DNS查询类型<br>◆递归查询：<br>&ensp;&ensp;&ensp;&ensp;客户机和本地DNS服务器之间的查询<br>◆迭代查询：<br>&ensp;&ensp;&ensp;&ensp;DNS服务器与DNS服务器之间的交互查询<br>★ DNS名称解析方式：<br>&ensp;&ensp;&ensp;&ensp;名称—&gt;IP :  正向解析<br>&ensp;&ensp;&ensp;&ensp;IP —&gt;名称：反向解析<br>注意：<br>&ensp;&ensp;&ensp;&ensp;正反向解析是两个不同的名称空间，是两棵不同的解析树，因此也不是同一个解析库。<br>★ 域名购买<br>&ensp;&ensp;&ensp;&ensp;通常我们申请注册的域名是顶级域下的一个二级域（.com），申请成功之后（如：magedu.com），域名商会免费给我们提供DNS解析服务（群租的一个DNS服务器），我们只需要通过其提供的接口（如：web页面）在管理后台添加主机记录即可。然而免费的东西和付费的服务总是不一样的，免费提供的服务不保证服务的可靠性，因此企业里面要想架设自己的DNS服务器，来提供更可靠、更丰富的功能，就需要向上级提出授权认证，更改DNS服务器的指向，从原来的群租转到自己的DNS服务器上，自己管理。但一般的小公司如果自己架设DNS服务器的话成本较高，所以一般都是代理商提供的。<br>★ DNS服务器的类型：<br>◆负责解析至少一个域：<br>&ensp;&ensp;&ensp;&ensp;主DNS服务器：<br>&ensp;&ensp;&ensp;&ensp;辅助DNS服务器：<br>◆不负责域解析：<br>&ensp;&ensp;&ensp;&ensp;缓存DNS服务器：转发器<br>★ 一次完整地解析请求经历的过程：<br>Client–&gt;hosts文件–&gt;Dns Local Cache–&gt;DNS Server(recursion递归)–&gt;<br>&ensp;&ensp;&ensp;&ensp;自己负责解析的域：直接查询数据库并返回答案；<br>&ensp;&ensp;&ensp;&ensp;不是自己负责的解析域：Server Cache–&gt;iteration(迭代)–&gt; 根–&gt; 顶级域DNS–&gt;二级域名DNS…<br>★ 解析答案：<br>&ensp;&ensp;&ensp;&ensp;肯定答案：<br>&ensp;&ensp;&ensp;&ensp;否定答案：请求的条目不存在等原因导致无法返回结果；<br>&ensp;&ensp;&ensp;&ensp;权威答案：由直接负责的DNS服务器返回的答案；<br>&ensp;&ensp;&ensp;&ensp;非权威答案：<br>★ 主-从DNS服务器：<br>◆主DNS服务器：<br>&ensp;&ensp;&ensp;&ensp;维护所负责解析的域数据库的那台服务器；读写操作均可进行；<br>◆从DNS服务器：<br>&ensp;&ensp;&ensp;&ensp;从主DNS服务器那里或其他的从DNS服务器那里“复制”解析库；但只能进行读操作(只能接受查询，不能接受修改)；<br>◆复制操作的实施方式（主从同步的属性）：<br>&ensp;&ensp;&ensp;&ensp;序列号：解析库版本号，主服务器解析库变化时，其序列号递增；<br>&ensp;&ensp;&ensp;&ensp;刷新时间间隔：从服务器每隔多久到主服务器检查序列号更新情况；<br>&ensp;&ensp;&ensp;&ensp;重试时间间隔：从服务器请求同步失败时，再次发起尝试请求时间间隔；<br>&ensp;&ensp;&ensp;&ensp;过期时长：从服务器联系不到主服务器时，多久后停止服务；<br>&ensp;&ensp;&ensp;&ensp;否定答案的缓存时长（TTL）：快取时间<br>“通知”机制：主服务器解析库发生变化时，会主动通知从服务器；<br>★ 区域传送：<br>&ensp;&ensp;&ensp;&ensp;全量传送：axfr，传递整个解析库；<br>&ensp;&ensp;&ensp;&ensp;增量传送：ixfr，传递解析库变化的数据；<br>★ 区域（zone）和域（domain）<br>◆baidu.com域：<br>&ensp;&ensp;&ensp;&ensp;FQDN–&gt;IP：正向解析库；(正向区域：正向解析库和正向解析的功能的组合);<br>&ensp;&ensp;&ensp;&ensp;IP —&gt;FQDN：反向解析库，反向区域<br>注意：<br>&ensp;&ensp;&ensp;&ensp;一般来说一个域由正向区域和反向区域组成，但并不是域就一定大于区域，如：父域的区域可能会比子域要大；<br>区域是物理概念，而域是逻辑概念。<br>★ DNS端口<br>&ensp;&ensp;&ensp;&ensp;DNS是一个网络服务，因此就有对应的端口，其端口是53号，通常DNS在查询的时候是以udp这个快速的数据传输协议来查询的，但是一旦没有办法查询到完整的信息时就会再次以TCP协议来进行重新查询，因此DNS服务在启动的时候会同时开启 tcp的53号端口 和 udp的53号端口。</p>
<h3 id="区域数据库文件"><a href="#区域数据库文件" class="headerlink" title="区域数据库文件"></a>区域数据库文件</h3><h4 id="资源记录（Resource-Record）简称RR"><a href="#资源记录（Resource-Record）简称RR" class="headerlink" title="资源记录（Resource Record）简称RR"></a>资源记录（Resource Record）简称RR</h4><p>★ 区域解析库：由众多RR组成：<br>记录类型：A, AAAA, PTR, SOA, NS, CNAME, MX<br>◆SOA：(Start Of Authority)<br>&ensp;&ensp;&ensp;&ensp;起始授权记录；一个区域解析库有且仅能有一个SOA记录，必须为解析库的第一条记录；<br>◆A：（internet Address）<br>&ensp;&ensp;&ensp;&ensp;作用：FQDN –&gt; IPv4；<br>◆AAAA：地址记录<br>&ensp;&ensp;&ensp;&ensp;作用：FQDN –&gt; IPv6；<br>◆PTR：（PoinTeR）<br>&ensp;&ensp;&ensp;&ensp;作用：IP –&gt; FQDN；反解到的主机名；<br>◆NS：（Name Server）<br>&ensp;&ensp;&ensp;&ensp;专用于标明当前区域的DNS服务器，一个区域解析库可以有多个NS记录(主从DNS服务器等)；<br>◆CNAME：（Canonical Name）<br>&ensp;&ensp;&ensp;&ensp;别名记录，一个主机可以有多个别名，但IP地址是一样的；<br>◆MX：<br>&ensp;&ensp;&ensp;&ensp;Mail exchanger，邮件交换器，有优先级，0-99，数字越小优先级越高；</p>
<h4 id="资源记录的格式及各资源类型详解"><a href="#资源记录的格式及各资源类型详解" class="headerlink" title="资源记录的格式及各资源类型详解"></a>资源记录的格式及各资源类型详解</h4><p>★ 资源记录的定义格式：<br>◆语法：<br>name    [TTL]   IN    RR_TYPE   value<br>每一种资源类型的定义方式如下：<br>★ SOA记录<br>起始授权记录；一个区域解析库有且仅能有一个SOA记录，必须为解析库的第一条记录；<br>◆name：<br>当前区域的名字。例如“magedu.com.”或者“2.3.4.in-addr.arpa.”<br>◆value：有多部分组成<br>&ensp;&ensp;&ensp;&ensp;1）当前区域的区域名称（也可以是主DNS服务器的FQDN）；<br>&ensp;&ensp;&ensp;&ensp;2）当前区域管理员的邮箱地址；但地址中不能使用@符号，一般用.替换，例如linuxedu.magedu.com<br>&ensp;&ensp;&ensp;&ensp;3）主从服务协调属性的定义以及否定的答案的统一的TTL<br>示例：<br><img src="\images\dns-soa记录.png" alt="DNS SOA记录"><br>★ NS记录<br>专用于标明当前区域的DNS服务器，一个区域解析库可以有多个NS记录(主从DNS服务器等)；<br>◆name：当前区域的名字<br>◆value：当前区域的某DNS服务器的名字，例如 ns.magedu.com.；<br>示例：<br><img src="\images\dns-ns记录.png" alt="DNS NS记录"><br>注意：<br>&ensp;&ensp;&ensp;&ensp;相邻的两个资源记录的name相同时，后续的可省略；<br>对NS记录而言，任何一个ns记录后面的服务器名字，都应该在后续有一个A记录<br>★ MX记录<br>邮件交换器，有优先级，0-99，数字越小优先级越高；<br>◆name：当前区域的名字<br>◆value：当前区域的某邮件服务器(smtp服务器)的主机名<br>注意：<br>&ensp;&ensp;&ensp;&ensp;一个区域内，MX记录可有多个；但每个记录的value之前应该有一个数字(0-99)，表示此服务器的优先级；数字越小优先级越高；<br>&ensp;&ensp;&ensp;&ensp;对MX记录而言，任何一个MX记录后面的服务器名字，都应该在后续有一个A记录<br>示例：<br><img src="\images\dns-mx记录.png" alt="DNS MX记录"><br>★ A记录<br>作用：FQDN –&gt; IPv4；<br>◆name：某主机的FQDN，例如www.magedu.com.<br>◆value：主机名对应主机的IPv4地址；<br>例如：<br>&ensp;&ensp;&ensp;&ensp;www.magedu.com.  IN  A   1.1.1.1<br>&ensp;&ensp;&ensp;&ensp;www.magedu.com.  IN  A   1.1.1.2<br>&ensp;&ensp;&ensp;&ensp;mx1.magedu.com.   IN  A   1.1.1.1<br>&ensp;&ensp;&ensp;&ensp;mx2.magedu.com.   IN  A   1.1.1.2<br>注意：<br>&ensp;&ensp;&ensp;&ensp;*.magedu.com.  IN  A  5.5.5.5<br>&ensp;&ensp;&ensp;&ensp;  magedu.com.  IN  A  5.5.5.5<br>避免用户写错名称时给错误答案，可通过泛域名解析进行解析至某特定地址。<br>★ AAAA记录<br>作用：FQDN –&gt; IPv6；<br>◆name：FQDN<br>◆value：IPv6<br>★ PTR记录<br>◆name：IP<br>&ensp;&ensp;&ensp;&ensp;有特定格式，把IP地址反过来写  如：1.2.3.4，要写作4.3.2.1；<br>&ensp;&ensp;&ensp;&ensp;有特定后缀：in-addr.arpa.  如：完整写法为：4.3.2.1.in-addra.arpa.<br>◆value：FQDN<br>例如：<br>&ensp;&ensp;&ensp;&ensp;4.3.2.1.in-addr.arpa. IN  PTR  www.magedu.com<br>&ensp;&ensp;&ensp;&ensp;简写成：如1.2.3为网络地址，可省<br>&ensp;&ensp;&ensp;&ensp;4 IN  PTR  www.magedu.com.<br> 注意：网络地址及后缀可省略；主机地址依然需要反着写<br>★ CNAME记录<br>别名记录，一个主机可以有多个别名，但IP地址是一样的；<br>◆name：FQDN格式的别名<br>◆value：FQDN格式的正式名字；<br>例如：<br>&ensp;&ensp;&ensp;&ensp;web.magedu.com.    IN      CNAME   www.magedu.com.<br>&ensp;&ensp;&ensp;&ensp;（表示www的这个主机的别名为web）<br>★ 注意：<br>&ensp;&ensp;&ensp;&ensp;TTL就是time to live，表示该记录被其他dns服务器保留到对方服务器上的缓存当中，并保持多少秒（即客户端可以缓存多长时间），可从全局继承；<br>&ensp;&ensp;&ensp;&ensp;IN：为关键字 ；<br>&ensp;&ensp;&ensp;&ensp;@ ：可用于引用当前区域的名字；<br>&ensp;&ensp;&ensp;&ensp;相邻的两条记录其name相同时，后面的可以省略；<br>&ensp;&ensp;&ensp;&ensp;同一个名字可以通过多条记录定义多个不同的值（即一个主机名有多个IP地址）；此时DNS服务器会以轮询方式响应可以实现负载均衡；<br>&ensp;&ensp;&ensp;&ensp;同一个值也可能有多个不同的定义名字（即一个IP地址多个主机名）；通过多个不同的名字指向同一个值进行定义；此仅表示通过多个不同的名字可以找到同一个主机而已；<br>&ensp;&ensp;&ensp;&ensp;对于正向区域来说，各MX、NS等类型的记录的value为一个FQDN，此FQDN应该有一个A记录。</p>
<h3 id="安装部署DNS服务"><a href="#安装部署DNS服务" class="headerlink" title="安装部署DNS服务"></a>安装部署DNS服务</h3><h4 id="bind的安装配置"><a href="#bind的安装配置" class="headerlink" title="bind的安装配置"></a>bind的安装配置</h4><p>★ BIND：Berkeley Internet Name Domain,ISC.org<br>&ensp;&ensp;&ensp;&ensp;dns：协议；<br>&ensp;&ensp;&ensp;&ensp;bind：dns协议的一种实现；<br>&ensp;&ensp;&ensp;&ensp;named：bind程序的运行的进程名；<br>★ 相关程序包：<br>查询方式：yum list all bind*<br>&ensp;&ensp;&ensp;&ensp;bind-libs：被bind和bind-utils包中的程序共同用到的库文件；<br>&ensp;&ensp;&ensp;&ensp;bind-utils：bind客户端程序集（工具组件），例如dig，host，nslookup等；<br>&ensp;&ensp;&ensp;&ensp;bind：提供的dns server程序、以及几个常用的测试程序；<br>&ensp;&ensp;&ensp;&ensp;bind-chroot：选装，让named运行于jall模式下；/var/named/chroot<br>★ bind服务器配置文件<br>◆主配置文件：/etc/named.conf<br> 或包含进来其他文件：<br> &ensp;&ensp;&ensp;&ensp;/etc/named.iscdlv.key<br> &ensp;&ensp;&ensp;&ensp;/etc/named.rfc1912.zones<br> &ensp;&ensp;&ensp;&ensp;/etc/named.root.key<br>★ 解析库文件：<br>◆/var/named：<br>&ensp;&ensp;&ensp;&ensp;该目录为DNS数据库文件存放目录，每一个域文件都存放在这里；<br>&ensp;&ensp;&ensp;&ensp;一般名字为：/var/named/ZONE_NAME.ZONE<br>注意：<br>&ensp;&ensp;&ensp;&ensp;1）一台DNS服务器可同时为多个区域提供解析；<br>&ensp;&ensp;&ensp;&ensp;2）必须要有根区域解析库文件：named.ca；<br>&ensp;&ensp;&ensp;&ensp;3）还应该有两个区域解析库文件：localhost 和 127.0.0.1 的正反向解析库；<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;正向：named.localhost<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;反向：named.loopbask<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 解析库文件</span></div><div class="line">[root@node1 ~]<span class="comment"># ls -l /usr/lib/sys</span></div><div class="line">sysctl.d/ systemd/  </div><div class="line">[root@node1 ~]<span class="comment"># ls /var/named/</span></div><div class="line">data  dynamic  named.ca  named.empty  named.localhost  named.loopback  slaves</div><div class="line"><span class="comment"># 本地正向解析库文件</span></div><div class="line">[root@node1 ~]<span class="comment"># cat /var/named/named.localhost </span></div><div class="line"><span class="variable">$TTL</span> 1D</div><div class="line">@	IN SOA	@ rname.invalid. (</div><div class="line">					0	; serial</div><div class="line">					1D	; refresh</div><div class="line">					1H	; retry</div><div class="line">					1W	; expire</div><div class="line">					3H )	; minimum</div><div class="line">	NS	@</div><div class="line">	A	127.0.0.1</div><div class="line">	AAAA	::1</div><div class="line"><span class="comment"># 本地反向解析库文件</span></div><div class="line">[root@node1 ~]<span class="comment"># cat /var/named/named.loopback </span></div><div class="line"><span class="variable">$TTL</span> 1D</div><div class="line">@	IN SOA	@ rname.invalid. (</div><div class="line">					0	; serial</div><div class="line">					1D	; refresh</div><div class="line">					1H	; retry</div><div class="line">					1W	; expire</div><div class="line">					3H )	; minimum</div><div class="line">	NS	@</div><div class="line">	A	127.0.0.1</div><div class="line">	AAAA	::1</div><div class="line">	PTR	localhost.</div></pre></td></tr></table></figure></p>
<p>★ rndc：remote name domain controller<br>&ensp;&ensp;&ensp;&ensp;默认与bind安装在同一主机，且只能通过127.0.0.1连接named进程，因此仅允许本地使用；<br>&ensp;&ensp;&ensp;&ensp;提供辅助性的管理功能；953/tcp（监听在953端口）<br>★ 启动服务<br>bind程序安装完成之后，默认既可作为缓存名称服务器使用，如果没有专门负责解析的区域，直接即可启动服务；<br>&ensp;&ensp;&ensp;&ensp;CentOS 6：service named start<br>&ensp;&ensp;&ensp;&ensp;CentOS 7：systemctl start named.service<br>演示：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">[root@node1 ~]<span class="comment"># yum info bind</span></div><div class="line">Loaded plugins: fastestmirror</div><div class="line">Loading mirror speeds from cached hostfile</div><div class="line"> * base: mirrors.163.com</div><div class="line"> * extras: mirrors.aliyun.com</div><div class="line"> * updates: mirrors.njupt.edu.cn</div><div class="line">Installed Packages</div><div class="line">Name        : <span class="built_in">bind</span></div><div class="line">Arch        : x86_64</div><div class="line">Epoch       : 32</div><div class="line">Version     : 9.9.4</div><div class="line">Release     : 50.el7_3.1</div><div class="line">Size        : 4.3 M</div><div class="line">Repo        : installed</div><div class="line">From repo   : updates</div><div class="line">Summary     : The Berkeley Internet Name Domain (BIND) DNS (Domain Name System) server</div><div class="line">URL         : http://www.isc.org/products/BIND/</div><div class="line">License     : ISC</div><div class="line">Description : BIND (Berkeley Internet Name Domain) is an implementation of the DNS</div><div class="line">            : (Domain Name System) protocols. BIND includes a DNS server (named),</div><div class="line">            : <span class="built_in">which</span> resolves host names to IP addresses; a resolver library</div><div class="line">            : (routines <span class="keyword">for</span> applications to use when interfacing with DNS); and</div><div class="line">            : tools <span class="keyword">for</span> verifying that the DNS server is operating properly.</div></pre></td></tr></table></figure></p>
<h4 id="主配置文件格式"><a href="#主配置文件格式" class="headerlink" title="主配置文件格式"></a>主配置文件格式</h4><p>★ 主配置文件：<br>◆全局配置段：<br>&ensp;&ensp;&ensp;&ensp;options {…}；<br>◆日志配置段：<br>&ensp;&ensp;&ensp;&ensp;logging {…}；<br>◆区域配置段：本机能够为哪些zone进行解析，就要定义哪些zone；<br>&ensp;&ensp;&ensp;&ensp;zone {…}；<br>注意：<br>&ensp;&ensp;&ensp;&ensp;任何服务程序如果期望其能够通过网络被其它主机访问，至少应该监听在一个能与外部主机通信的IP地址上；<br>每个配置语句必须以分号结尾，否则语法错误；<br>★ 缓存名称服务器的配置（初始化配置）：<br>◆监听能与外部主机通信的地址；<br>☉listen-on port 53 { any; };<br>&ensp;&ensp;&ensp;&ensp;监听的端口，即哪些主机可以进行访问解析，这里表示监听所有地址，后面有分号 ，花括号两边有空格；<br>☉listen-on port 53 { 192.168.16.104; };<br>&ensp;&ensp;&ensp;&ensp;表示监听某一特定的地址；<br>◆学习使用时建议关闭dnssec<br>&ensp;&ensp;&ensp;&ensp;dnssec-enable  no;<br>&ensp;&ensp;&ensp;&ensp;dnssec-validation no；<br>&ensp;&ensp;&ensp;&ensp;dnssec-lookaside no；<br>◆关闭仅允许本地查询<br>&ensp;&ensp;&ensp;&ensp;// allow-query     { localhost; };<br>★ 配置文件语法检查<br>&ensp;&ensp;&ensp;&ensp;named-checkconf [/etc/named.conf]</p>
<h4 id="演示："><a href="#演示：" class="headerlink" title="演示："></a>演示：</h4><p>★ bind 安装、初始化设置及启动<br>◆主配置文件初始化设置<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div></pre></td><td class="code"><pre><div class="line">[root@node1 ~]<span class="comment"># yum install bind -y        # 安装 bind</span></div><div class="line">[root@node1 ~]<span class="comment"># cat /etc/named.conf        # 查看主配置文件</span></div><div class="line">//</div><div class="line">// named.conf</div><div class="line">//</div><div class="line">// Provided by Red Hat <span class="built_in">bind</span> package to configure the ISC BIND named(8) DNS</div><div class="line">// server as a caching only nameserver (as a localhost DNS resolver only).</div><div class="line">//</div><div class="line">// See /usr/share/doc/<span class="built_in">bind</span>*/sample/ <span class="keyword">for</span> example named configuration files.</div><div class="line">//</div><div class="line">// See the BIND Administrator<span class="string">'s Reference Manual (ARM) for details about the</span></div><div class="line">// configuration located in /usr/share/doc/bind-&#123;version&#125;/Bv9ARM.html</div><div class="line"></div><div class="line"># 全局配置段</div><div class="line">options &#123;</div><div class="line">	listen-on port 53 &#123; any; &#125;;   # 修改为监听本地的所有地址，注意以分号结尾，花括号两边有空格</div><div class="line">	listen-on-v6 port 53 &#123; ::1; &#125;;</div><div class="line">	directory 	"/var/named";</div><div class="line">	dump-file 	"/var/named/data/cache_dump.db";</div><div class="line">	statistics-file "/var/named/data/named_stats.txt";</div><div class="line">	memstatistics-file "/var/named/data/named_mem_stats.txt";</div><div class="line">	// allow-query     &#123; localhost; &#125;;     # 单行注释,关闭仅允许本地查询</div><div class="line"></div><div class="line">	/* </div><div class="line">	 - If you are building an AUTHORITATIVE DNS server, do NOT enable recursion.</div><div class="line">	 - If you are building a RECURSIVE (caching) DNS server, you need to enable </div><div class="line">	   recursion. </div><div class="line">	 - If your recursive DNS server has a public IP address, you MUST enable access </div><div class="line">	   control to limit queries to your legitimate users. Failing to do so will</div><div class="line">	   cause your server to become part of large scale DNS amplification </div><div class="line">	   attacks. Implementing BCP38 within your network would greatly</div><div class="line">	   reduce such attack surface </div><div class="line">	*/   # 以上为多行注释</div><div class="line">	recursion yes;</div><div class="line"></div><div class="line">	dnssec-enable no;        # 学习使用时建议关闭dnssec</div><div class="line">	dnssec-validation no;    # 学习使用时建议关闭dnssec</div><div class="line"></div><div class="line">	/* Path to ISC DLV key */      # 单行注释</div><div class="line">	bindkeys-file "/etc/named.iscdlv.key";</div><div class="line"></div><div class="line">	managed-keys-directory "/var/named/dynamic";</div><div class="line"></div><div class="line">	pid-file "/run/named/named.pid";</div><div class="line">	session-keyfile "/run/named/session.key";</div><div class="line">&#125;;</div><div class="line"></div><div class="line"># 日志配置段</div><div class="line">logging &#123;</div><div class="line">        channel default_debug &#123;</div><div class="line">                file "data/named.run";</div><div class="line">                severity dynamic;</div><div class="line">        &#125;;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"># 区域配置段</div><div class="line">zone "." IN &#123;</div><div class="line">	type hint;</div><div class="line">	file "named.ca";</div><div class="line">&#125;;</div><div class="line"></div><div class="line"># 包含的其他文件</div><div class="line">include "/etc/named.rfc1912.zones";</div><div class="line">include "/etc/named.root.key";</div></pre></td></tr></table></figure></p>
<p>◆检查语法错误，启动服务，并查看状态<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">[root@node1 ~]<span class="comment"># named-checkconf                       # 检查语法错误</span></div><div class="line">[root@node1 ~]<span class="comment"># systemctl start named.service         # 开启服务</span></div><div class="line">[root@node1 ~]<span class="comment"># systemctl status named.service        # 查看服务状态</span></div><div class="line">?.named.service - Berkeley Internet Name Domain (DNS)</div><div class="line">   Loaded: loaded (/usr/lib/systemd/system/named.service; disabled; vendor preset: disabled)</div><div class="line">   Active: active (running) since Sat 2017-07-22 22:35:41 CST; 13s ago</div><div class="line">  Process: 2035 ExecStart=/usr/sbin/named -u named <span class="variable">$OPTIONS</span> (code=exited, status=0/SUCCESS)</div><div class="line">  Process: 2033 ExecStartPre=/bin/bash -c <span class="keyword">if</span> [ ! <span class="string">"<span class="variable">$DISABLE_ZONE_CHECKING</span>"</span> == <span class="string">"yes"</span> ]; <span class="keyword">then</span> /usr/sbin/named-checkconf -z /etc/named.conf; <span class="keyword">else</span> <span class="built_in">echo</span> <span class="string">"Checking of zone files is disabled"</span>; <span class="keyword">fi</span> (code=exited, status=0/SUCCESS)</div><div class="line"> Main PID: 2038 (named)</div><div class="line">   CGroup: /system.slice/named.service</div><div class="line">           ?..2038 /usr/sbin/named -u named</div><div class="line"></div><div class="line">Jul 22 22:35:41 node1.jack.com named[2038]: <span class="built_in">command</span> channel listening on ::1<span class="comment">#953</span></div><div class="line">Jul 22 22:35:41 node1.jack.com named[2038]: managed-keys-zone: loaded serial 0</div><div class="line">Jul 22 22:35:41 node1.jack.com named[2038]: zone 0.in-addr.arpa/IN: loaded serial 0</div><div class="line">Jul 22 22:35:41 node1.jack.com named[2038]: zone 1.0.0.127.in-addr.arpa/IN: loade... 0</div><div class="line">Jul 22 22:35:41 node1.jack.com named[2038]: zone localhost.localdomain/IN: loaded... 0</div><div class="line">Jul 22 22:35:41 node1.jack.com named[2038]: zone localhost/IN: loaded serial 0</div><div class="line">Jul 22 22:35:41 node1.jack.com named[2038]: zone 1.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.... 0</div><div class="line">Jul 22 22:35:41 node1.jack.com named[2038]: all zones loaded</div><div class="line">Jul 22 22:35:41 node1.jack.com named[2038]: running</div><div class="line">Jul 22 22:35:41 node1.jack.com systemd[1]: Started Berkeley Internet Name Domain ...).</div><div class="line">Hint: Some lines were ellipsized, use <span class="_">-l</span> to show <span class="keyword">in</span> full.</div></pre></td></tr></table></figure></p>
<p>◆查看监听状态<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">[root@node1 ~]<span class="comment"># ss -tunlp|column -t</span></div><div class="line">Netid  State   Recv-Q  Send-Q  Local          Address:Port  Peer                                 Address:Port</div><div class="line">udp    UNCONN  0       0       *:24991        *:*           users:((<span class="string">"dhclient"</span>,pid=1674,fd=20))</div><div class="line">udp    UNCONN  0       0       127.0.0.1:53   *:*           users:((<span class="string">"named"</span>,pid=2038,fd=512))</div><div class="line">udp    UNCONN  0       0       *:68           *:*           users:((<span class="string">"dhclient"</span>,pid=1674,fd=6))</div><div class="line">udp    UNCONN  0       0       :::31945       :::*          users:((<span class="string">"dhclient"</span>,pid=1674,fd=21))</div><div class="line">udp    UNCONN  0       0       ::1:53         :::*          users:((<span class="string">"named"</span>,pid=2038,fd=513))</div><div class="line">tcp    LISTEN  0       10      127.0.0.1:53   *:*           users:((<span class="string">"named"</span>,pid=2038,fd=21))</div><div class="line">tcp    LISTEN  0       128     *:22           *:*           users:((<span class="string">"sshd"</span>,pid=1863,fd=3))</div><div class="line">tcp    LISTEN  0       128     127.0.0.1:953  *:*           users:((<span class="string">"named"</span>,pid=2038,fd=23))</div><div class="line">tcp    LISTEN  0       100     127.0.0.1:25   *:*           users:((<span class="string">"master"</span>,pid=1963,fd=13))</div><div class="line">tcp    LISTEN  0       10      ::1:53         :::*          users:((<span class="string">"named"</span>,pid=2038,fd=22))</div><div class="line">tcp    LISTEN  0       128     :::22          :::*          users:((<span class="string">"sshd"</span>,pid=1863,fd=4))</div><div class="line">tcp    LISTEN  0       128     ::1:953        :::*          users:((<span class="string">"named"</span>,pid=2038,fd=24))</div><div class="line">tcp    LISTEN  0       100     ::1:25         :::*          users:((<span class="string">"master"</span>,pid=1963,fd=14))</div></pre></td></tr></table></figure></p>
<p>◆此时，我们可以把/etc/resolv.conf 配置文件中的DNS指向为本机的地址，即自己把自己当做DNS服务器，也可以在另一个客户端主机中配置DNS指向这台服务器，也可以正常访问<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@node1 ~]<span class="comment"># vi /etc/resolv.conf </span></div><div class="line"><span class="comment"># Generated by NetworkManager</span></div><div class="line">nameserver 192.168.2.143</div></pre></td></tr></table></figure></p>
<h3 id="测试DNS工具：dig，host，nslookup"><a href="#测试DNS工具：dig，host，nslookup" class="headerlink" title="测试DNS工具：dig，host，nslookup"></a>测试DNS工具：dig，host，nslookup</h3><p>★ dig命令<br>◆语法：<br>&ensp;&ensp;&ensp;&ensp;dig [-t RR_TYPE] name [@SERVER] [query options]<br> 注意：<br>&ensp;&ensp;&ensp;&ensp;dig只用于测试dns系统，不会查询hosts文件进行解析<br>&ensp;&ensp;&ensp;&ensp;@：表示通过哪个DNS服务器，不写表示为通过本机<br>◆选项：<br>&ensp;&ensp;&ensp;&ensp;+[no]trace：跟踪解析过程<br>&ensp;&ensp;&ensp;&ensp;+[no]recurse：进行递归解析<br>◆测试反向解析：<br>&ensp;&ensp;&ensp;&ensp;dig -x IP @SERVER<br>◆模拟完全区域传送：<br>&ensp;&ensp;&ensp;&ensp;dig -t axfr ZONE_NAME @SERVER<br>示例：<br>&ensp;&ensp;&ensp;&ensp;dig -t axfr magedu.com @172.16.100.11<br>&ensp;&ensp;&ensp;&ensp;dig –t axfr 100.16.172.in-addr.arpa @172.16.1.1<br>★ host命令<br>◆语法：<br>&ensp;&ensp;&ensp;&ensp;host [-t type] name [SERVER_IP]<br>示例：<br>&ensp;&ensp;&ensp;&ensp;host –t NS magedu.com @172.16.0.1<br>★ nslookup命令：<br>◆语法：<br>&ensp;&ensp;&ensp;&ensp;nslookup [-option] [name | -] [server]<br>◆交互式模式：<br>&ensp;&ensp;&ensp;&ensp;nslookup&gt;<br>&ensp;&ensp;&ensp;&ensp;server IP：指明使用哪个DNS server进行查询；默认为/etc/resolv.conf中的<br>&ensp;&ensp;&ensp;&ensp;set q=RR_TYPE：指明查询的资源记录类型<br>&ensp;&ensp;&ensp;&ensp;NAME：要查询的名称</p>
<h4 id="dig命令演示"><a href="#dig命令演示" class="headerlink" title="dig命令演示"></a>dig命令演示</h4><p>◆测试本机DNS能否正常查询<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 测试能否解析 </span></div><div class="line">[root@centos7 ~]<span class="comment"># dig -t A www.baidu.com  </span></div><div class="line"> </div><div class="line">; &lt;&lt;&gt;&gt; DiG 9.9.4-RedHat-9.9.4-29.el7 &lt;&lt;&gt;&gt; -t A www.baidu.com</div><div class="line">;; global options: +cmd</div><div class="line">;; Got answer:</div><div class="line">;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 28923</div><div class="line">;; flags: qr rd ra; QUERY: 1, ANSWER: 3, AUTHORITY: 5, ADDITIONAL: 6</div><div class="line"> </div><div class="line">;; OPT PSEUDOSECTION:</div><div class="line">; EDNS: version: 0, flags:; udp: 4096</div><div class="line">;; QUESTION SECTION:  <span class="comment"># 问题区段</span></div><div class="line">;www.baidu.com.         IN  A</div><div class="line"> </div><div class="line">;; ANSWER SECTION: <span class="comment"># 答案选项</span></div><div class="line">www.baidu.com.      901 IN  CNAME   www.a.shifen.com.  <span class="comment"># 一个别名</span></div><div class="line">www.a.shifen.com.   300 IN  A   220.181.112.244</div><div class="line">www.a.shifen.com.   300 IN  A   220.181.111.188</div><div class="line"> </div><div class="line">;; AUTHORITY SECTION: <span class="comment"># 权威选项 ，这个别名对应了5台DNS服务器</span></div><div class="line">a.shifen.com.       1200    IN  NS  ns1.a.shifen.com.</div><div class="line">a.shifen.com.       1200    IN  NS  ns2.a.shifen.com.</div><div class="line">a.shifen.com.       1200    IN  NS  ns5.a.shifen.com.</div><div class="line">a.shifen.com.       1200    IN  NS  ns4.a.shifen.com.</div><div class="line">a.shifen.com.       1200    IN  NS  ns3.a.shifen.com.</div><div class="line"> </div><div class="line">;; ADDITIONAL SECTION:  <span class="comment">#附加选项 ，显示着5台服务器分别对应的地址</span></div><div class="line">ns1.a.shifen.com.   1200    IN  A   61.135.165.224</div><div class="line">ns2.a.shifen.com.   1200    IN  A   180.149.133.241</div><div class="line">ns3.a.shifen.com.   1200    IN  A   61.135.162.215</div><div class="line">ns4.a.shifen.com.   1200    IN  A   115.239.210.176</div><div class="line">ns5.a.shifen.com.   1200    IN  A   119.75.222.17</div><div class="line"> </div><div class="line">;; Query time: 89 msec  <span class="comment"># 查询指令时长，为89毫秒</span></div><div class="line">;; SERVER: 192.168.2.2<span class="comment">#53(192.168.2.2)  # 由哪个DNS服务器进行解析的，这里是由本机进行迭代的方式查询的</span></div><div class="line">;; WHEN: Sat Jul 22 23:13:20 CST 2017</div><div class="line">;; MSG SIZE  rcvd: 271</div></pre></td></tr></table></figure></p>
<p>◆dig跟踪查询命令<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line">[root@node1 ~]<span class="comment"># dig +trace -t A www.baidu.com</span></div><div class="line"></div><div class="line">; &lt;&lt;&gt;&gt; DiG 9.9.4-RedHat-9.9.4-50.el7_3.1 &lt;&lt;&gt;&gt; +trace -t A www.baidu.com       <span class="comment"># 首先查找根节点服务器</span></div><div class="line">;; global options: +cmd</div><div class="line">.			5	IN	NS	c.root-servers.net.</div><div class="line">.			5	IN	NS	i.root-servers.net.</div><div class="line">.			5	IN	NS	g.root-servers.net.</div><div class="line">.			5	IN	NS	j.root-servers.net.</div><div class="line">.			5	IN	NS	e.root-servers.net.</div><div class="line">.			5	IN	NS	d.root-servers.net.</div><div class="line">.			5	IN	NS	h.root-servers.net.</div><div class="line">.			5	IN	NS	m.root-servers.net.</div><div class="line">.			5	IN	NS	f.root-servers.net.</div><div class="line">.			5	IN	NS	k.root-servers.net.</div><div class="line">.			5	IN	NS	a.root-servers.net.</div><div class="line">.			5	IN	NS	b.root-servers.net.</div><div class="line">.			5	IN	NS	l.root-servers.net.</div><div class="line">;; Received 228 bytes from 192.168.2.2<span class="comment">#53(192.168.2.2) in 991 ms</span></div><div class="line"></div><div class="line">com.			172800	IN	NS	a.gtld-servers.net.                          <span class="comment"># 其次查找顶级域名</span></div><div class="line">com.			172800	IN	NS	b.gtld-servers.net.</div><div class="line">com.			172800	IN	NS	c.gtld-servers.net.</div><div class="line">com.			172800	IN	NS	d.gtld-servers.net.</div><div class="line">com.			172800	IN	NS	e.gtld-servers.net.</div><div class="line">com.			172800	IN	NS	f.gtld-servers.net.</div><div class="line">com.			172800	IN	NS	g.gtld-servers.net.</div><div class="line">com.			172800	IN	NS	h.gtld-servers.net.</div><div class="line">com.			172800	IN	NS	i.gtld-servers.net.</div><div class="line">com.			172800	IN	NS	j.gtld-servers.net.</div><div class="line">com.			172800	IN	NS	k.gtld-servers.net.</div><div class="line">com.			172800	IN	NS	l.gtld-servers.net.</div><div class="line">com.			172800	IN	NS	m.gtld-servers.net.</div><div class="line">com.			86400	IN	DS	30909 8 2 E2D3C916F6DEEAC73294E8268FB5885044A833FC5459588F4A9184CF C41A5766</div><div class="line">com.			86400	IN	RRSIG	DS 8 1 86400 20170804050000 20170722040000 15768 . hmKipA6XwVN3NxUfSQQh1wyj0BKzSLGJq7pOCY/b3ikAWde4wOqiPIHa ewT8cWV4BOv5mfBng3SXhzxLpQxvOu/MgBQw+0MErD0X4iw/eQjFW43d JUdEAN5VKF80RITdEIZNDFYeFlYLQzt7jRBaSdhC0Ba7UCtYxUel9LO2 2knqizDt8fDnmUQutruzZDUgrDeimyl1OmJnhAU/nHFNzuvs7HHrCFhY wRq+99CL69AVkecC8NOU3VyME3tRS98nTk7FsU21S/VPeH7wDMAEtdiR gftLVTS4i8Qbq/RN6l2lrYwJ1dRdlqp+rb1ZdanRr9JEUcA+gv3SLDGR 6D7jdQ==</div><div class="line">;; Received 1173 bytes from 198.97.190.53<span class="comment">#53(h.root-servers.net) in 1634 ms</span></div><div class="line"></div><div class="line">baidu.com.		172800	IN	NS	dns.baidu.com.                          <span class="comment"># 再查找子域</span></div><div class="line">baidu.com.		172800	IN	NS	ns2.baidu.com.</div><div class="line">baidu.com.		172800	IN	NS	ns3.baidu.com.</div><div class="line">baidu.com.		172800	IN	NS	ns4.baidu.com.</div><div class="line">baidu.com.		172800	IN	NS	ns7.baidu.com.</div><div class="line">CK0POJMG874LJREF7EFN8430QVIT8BSM.com. 86400 IN NSEC3 1 1 0 - CK0Q1GIN43N1ARRC9OSM6QPQR81H5M9A NS SOA RRSIG DNSKEY NSEC3PARAM</div><div class="line">CK0POJMG874LJREF7EFN8430QVIT8BSM.com. 86400 IN RRSIG NSEC3 8 2 86400 20170728044707 20170721033707 5528 com. bfXkJHN13mddUk3DnV1jB1UAs3bs4oFkG3YDNfFbSGNNydEcQur8FaL8 u00oG8VRWj44b6D0WbZl8ALgD4F0HXvy0pc4EV3kU5ZI5zI9xUXqkYJ+ xPqrj54Pv6s6WbraJkloxRBg4ksDGvjpaqzuu1MAkYItX242ysr3+F57 Z1Q=</div><div class="line">HPVV2B5N85O7HJJRB7690IB5UVF9O9UA.com. 86400 IN NSEC3 1 1 0 - HQ01I3PFSK4TG3Q31LT3RIMHGBFQU42T NS DS RRSIG</div><div class="line">HPVV2B5N85O7HJJRB7690IB5UVF9O9UA.com. 86400 IN RRSIG NSEC3 8 2 86400 20170726044717 20170719033717 5528 com. ld+oxNAmzP+XhPtws5HNcyMXVCwHF0Wef79XUdv6TBL0ugJv0pRrcVwD W7U9DHC06XZTm/CnYkbL1l3+UjOOkFMS9t9I0sJ+UE2BrxVNWhJf1m5P fpmAIcrnbOHavY9rC/oO8CXWhi5prs/gQuXOXRnDymY419FQQTiSG5+u lx4=</div><div class="line">;; Received 697 bytes from 192.52.178.30<span class="comment">#53(k.gtld-servers.net) in 230 ms</span></div><div class="line"></div><div class="line">www.baidu.com.		1200	IN	CNAME	www.a.shifen.com.                      <span class="comment"># 查找的主机</span></div><div class="line">a.shifen.com.		1200	IN	NS	ns5.a.shifen.com.</div><div class="line">a.shifen.com.		1200	IN	NS	ns3.a.shifen.com.</div><div class="line">a.shifen.com.		1200	IN	NS	ns1.a.shifen.com.</div><div class="line">a.shifen.com.		1200	IN	NS	ns4.a.shifen.com.</div><div class="line">a.shifen.com.		1200	IN	NS	ns2.a.shifen.com.</div><div class="line">;; Received 239 bytes from 220.181.38.10<span class="comment">#53(ns4.baidu.com) in 48 ms</span></div></pre></td></tr></table></figure></p>
<h4 id="host命令演示"><a href="#host命令演示" class="headerlink" title="host命令演示"></a>host命令演示</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 查询IPv4地址资源记录</span></div><div class="line">[root@node1 ~]<span class="comment"># host -t A www.baidu.com</span></div><div class="line">www.baidu.com is an <span class="built_in">alias</span> <span class="keyword">for</span> www.a.shifen.com.</div><div class="line">www.a.shifen.com has address 111.13.100.92</div><div class="line">www.a.shifen.com has address 111.13.100.91</div><div class="line"><span class="comment"># 查询域名服务器名资源记录</span></div><div class="line">[root@node1 ~]<span class="comment"># host -t NS baidu.com</span></div><div class="line">baidu.com name server ns2.baidu.com.</div><div class="line">baidu.com name server dns.baidu.com.</div><div class="line">baidu.com name server ns3.baidu.com.</div><div class="line">baidu.com name server ns7.baidu.com.</div><div class="line">baidu.com name server ns4.baidu.com.</div><div class="line"><span class="comment"># 查询邮件服务器资源记录</span></div><div class="line">[root@node1 ~]<span class="comment"># host -t MX baidu.com</span></div><div class="line">baidu.com mail is handled by 10 mx.n.shifen.com.</div><div class="line">baidu.com mail is handled by 20 mx50.baidu.com.</div><div class="line">baidu.com mail is handled by 20 mx1.baidu.com.</div><div class="line">baidu.com mail is handled by 20 jpmx.baidu.com.</div></pre></td></tr></table></figure>
<h4 id="nslookup命令演示"><a href="#nslookup命令演示" class="headerlink" title="nslookup命令演示"></a>nslookup命令演示</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">[root@node1 ~]<span class="comment"># nslookup</span></div><div class="line">&gt; server 192.168.2.2            <span class="comment"># 直接写server默认为本机DNS</span></div><div class="line">Default server: 192.168.2.2</div><div class="line">Address: 192.168.2.2<span class="comment">#53</span></div><div class="line">&gt; <span class="built_in">set</span> q=A                        <span class="comment"># 查询A记录</span></div><div class="line">&gt; www.baidu.com</div><div class="line">Server:		192.168.2.2</div><div class="line">Address:	192.168.2.2<span class="comment">#53</span></div><div class="line"></div><div class="line">Non-authoritative answer:</div><div class="line">www.baidu.com	canonical name = www.a.shifen.com.</div><div class="line">Name:	www.a.shifen.com</div><div class="line">Address: 111.13.100.91</div><div class="line">Name:	www.a.shifen.com</div><div class="line">Address: 111.13.100.92</div><div class="line">&gt; <span class="built_in">set</span> q=NS                       <span class="comment"># 查询NS资源记录</span></div><div class="line">&gt; baidu.com</div><div class="line">Server:		192.168.2.2</div><div class="line">Address:	192.168.2.2<span class="comment">#53</span></div><div class="line"></div><div class="line">Non-authoritative answer:</div><div class="line">baidu.com	nameserver = ns2.baidu.com.</div><div class="line">baidu.com	nameserver = dns.baidu.com.</div><div class="line">baidu.com	nameserver = ns3.baidu.com.</div><div class="line">baidu.com	nameserver = ns7.baidu.com.</div><div class="line">baidu.com	nameserver = ns4.baidu.com.</div><div class="line"></div><div class="line">Authoritative answers can be found from:</div><div class="line">&gt; <span class="built_in">exit</span></div></pre></td></tr></table></figure>
<h4 id="rndc命令：named服务控制命令"><a href="#rndc命令：named服务控制命令" class="headerlink" title="rndc命令：named服务控制命令"></a>rndc命令：named服务控制命令</h4><p>★ rndc：named 服务控制命令<br>&ensp;&ensp;&ensp;&ensp;rndc–&gt; rndc(953/tcp) 监听端口<br>&ensp;&ensp;&ensp;&ensp;rndc COMMAND<br>★ COMMAND:<br>&ensp;&ensp;&ensp;&ensp;reload：重载主配置文件和区域解析库文件<br>&ensp;&ensp;&ensp;&ensp;reload zone：重载区域解析库文件<br>&ensp;&ensp;&ensp;&ensp;retransfer zone：手动启动区域传送过程，而不管序列号是否增加<br>&ensp;&ensp;&ensp;&ensp;notify zone：重新对区域传送发通知<br>&ensp;&ensp;&ensp;&ensp;reconfig：重载主配置文件<br>&ensp;&ensp;&ensp;&ensp;querylog：开启或关闭查询日志文件/var/log/message<br>&ensp;&ensp;&ensp;&ensp;trace：递增debug一个级别<br>&ensp;&ensp;&ensp;&ensp;trace LEVEL：指定使用的级别<br>&ensp;&ensp;&ensp;&ensp;notrace：将调试级别设置为0<br>&ensp;&ensp;&ensp;&ensp;flush：清空DNS服务器的所有缓存记录<br>&ensp;&ensp;&ensp;&ensp;status：状态查询<br>演示:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">[root@node1 ~]<span class="comment"># rndc status</span></div><div class="line">version: 9.9.4-RedHat-9.9.4-50.el7_3.1 &lt;id:8f9657aa&gt;</div><div class="line">CPUs found: 1</div><div class="line">worker threads: 1</div><div class="line">UDP listeners per interface: 1</div><div class="line">number of zones: 101</div><div class="line">debug level: 0</div><div class="line">xfers running: 0</div><div class="line">xfers deferred: 0</div><div class="line">soa queries <span class="keyword">in</span> progress: 0</div><div class="line">query logging is OFF</div><div class="line">recursive clients: 0/0/1000</div><div class="line">tcp clients: 0/100</div><div class="line">server is up and running</div></pre></td></tr></table></figure></p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color3">linux服务</a>
        		</li>
      		
		</ul>
	</div>

      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/2017/07/21/dns原理详解/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>





  
    <article id="post-加密-解密-数字签名-SSL-CA" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/07/15/加密-解密-数字签名-SSL-CA/">加密解密、数字签名、SSL、CA技术</a>
    </h1>
  

        
        <a href="/2017/07/15/加密-解密-数字签名-SSL-CA/" class="archive-article-date">
  	<time datetime="2017-07-15T13:30:22.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2017-07-15</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="内容介绍："><a href="#内容介绍：" class="headerlink" title="内容介绍："></a>内容介绍：</h3><p>&ensp;&ensp;&ensp;&ensp;◆ 安全机制<br>&ensp;&ensp;&ensp;&ensp;◆ 对称加密<br>&ensp;&ensp;&ensp;&ensp;◆ 不对称加密<br>&ensp;&ensp;&ensp;&ensp;◆ 散列算法<br>&ensp;&ensp;&ensp;&ensp;◆ PKI和CA</p>
<h3 id="相关知识介绍："><a href="#相关知识介绍：" class="headerlink" title="相关知识介绍："></a>相关知识介绍：</h3><p>★ 传输层协议：<br>◆ TCP（面向连接）,UDP（面向无连接）,SCTP（流控协议）<br>◆ port（端口）：传输层协议都会提供端口，<br>&ensp;&ensp;&ensp;&ensp;端口（port）是标记进程的地址,进程向内核注册才能使用某端口（独占）<br>&ensp;&ensp;&ensp;&ensp;任何一个进程占领某个端口之后，其他进程进不能使用了；<br>◆ 同一主机上的进程间通信：<br>&ensp;&ensp;&ensp;&ensp;IPC<br>&ensp;&ensp;&ensp;&ensp;message queue（消息队列）<br>&ensp;&ensp;&ensp;&ensp;shm（共享内存）<br>&ensp;&ensp;&ensp;&ensp;semerphor<br>◆ 不同主机间的进程通信：<br>&ensp;&ensp;&ensp;&ensp;通过套接字方式来实现（socket）<br>&ensp;&ensp;&ensp;&ensp;cip:port&lt;– –&gt;sip:port (客户端ip和端口到服务端ip和端口)<br>◆ 监听模式：LINTEN（ip：port），<br>&ensp;&ensp;&ensp;&ensp;无论有没有人访问，它都要打开自己的进程，并监听在某个ip:port上，随时等待客户端请求；<br>&ensp;&ensp;&ensp;&ensp;为某些众所周知的应用，事先分配好一个固定的端口（比如http的80端口）<br>◆ SSL ：Secure Socket Layer<br>&ensp;&ensp;&ensp;&ensp;http–&gt;ssl–&gt;https<br>&ensp;&ensp;&ensp;&ensp;http协议一但调用了ssl就变成了https，从而能够完成安全通信</p>
<h3 id="SSL介绍"><a href="#SSL介绍" class="headerlink" title="SSL介绍"></a>SSL介绍</h3><p>★ SSL简介：<br>&ensp;&ensp;&ensp;&ensp;SSL也就是Secure Socket Layer 叫做安全套接字协议，是一种应用层协议，主要用于数据传输的加密。OpeenSSL是SSL协议开源形式，是广泛使用的商业及SSL工具，同时OpeenSSL也是一种命令行工具；<br>★ 跨主机间的通信过程<br>&ensp;&ensp;&ensp;&ensp;在计算机网络中，我们知道跨主机之间的进程通信是通过套接字方式实现的，服务器监听在某个TCP Socket之上（IP:Port），客户端在本地打开一个随机的Socket，然后通过TCP/IP协议，将请求通过交换机、路由器层层转发到目标服务器上，然后服务器可以判断出客户端请求的资源，进而转交到应用层相关服务上，服务端应用进程从磁盘上获得相应的资源信息，然后封装成相应的网络数据包格式以同样的方式层层传输给客户端对应的端口上。<br>&ensp;&ensp;&ensp;&ensp;无论数据从应用层向下传输还是从下层到应用层传输，每个层次中的协议都仅仅是对数据进行封装解封装，而里面的数据本身并没有发生变化，所以，数据在发送过程当中是什么还是什么，也就是明文发送的，没有加密，任何人只要获取到了相关的数据包就能通过其他方法获知其中的铭文内容；因此就需要有一种加密机制能够保护互联网数据在传输过程中的隐秘性了<br>★ NIST(美国国家标准与技术研究院)定义的安全属性:<br>&ensp;&ensp;&ensp;&ensp;保密性：数据保密性，隐私性<br>&ensp;&ensp;&ensp;&ensp;完整性（不可篡改）：数据完整性，系统完整性<br>&ensp;&ensp;&ensp;&ensp;可用性<br>★ 攻击类型：<br>&ensp;&ensp;&ensp;&ensp;威胁保密性的攻击：窃听、通信量分析 ；<br>&ensp;&ensp;&ensp;&ensp;威胁完整性攻击：篡改，伪装，重放，否认；<br>&ensp;&ensp;&ensp;&ensp;威胁可用性的攻击：拒绝服务（Dos）<br>★ 解决方案：<br>☉安全机制：<br>&ensp;&ensp;&ensp;&ensp;加密解密；<br>&ensp;&ensp;&ensp;&ensp;数字签名；<br>&ensp;&ensp;&ensp;&ensp;访问控制；<br>&ensp;&ensp;&ensp;&ensp;数据完整性；<br>&ensp;&ensp;&ensp;&ensp;认证交换；<br>&ensp;&ensp;&ensp;&ensp;流量填充；<br>&ensp;&ensp;&ensp;&ensp;路由控制；<br>&ensp;&ensp;&ensp;&ensp;公证<br>☉安全服务：用于抵御攻击的服务<br>&ensp;&ensp;&ensp;&ensp;认证服务；<br>&ensp;&ensp;&ensp;&ensp;访问控制服务；<br>&ensp;&ensp;&ensp;&ensp;数据保密性服务：连接保密性、无连接保密性、选择域保密性、流量保密性<br>&ensp;&ensp;&ensp;&ensp;数据完整性服务；<br>&ensp;&ensp;&ensp;&ensp;不可否认性服务；<br>★ 设计原则：<br>&ensp;&ensp;&ensp;&ensp;使用成熟的安全系统；<br>&ensp;&ensp;&ensp;&ensp;以小人之心度输入数据；<br>&ensp;&ensp;&ensp;&ensp;外部系统是不安全的；<br>&ensp;&ensp;&ensp;&ensp;最小授权；<br>&ensp;&ensp;&ensp;&ensp;减少外部接口；<br>&ensp;&ensp;&ensp;&ensp;缺省使用安全模式；<br>&ensp;&ensp;&ensp;&ensp;安全不是似是而非；<br>&ensp;&ensp;&ensp;&ensp;从STRIDE思考；<br>&ensp;&ensp;&ensp;&ensp;在入口处检查；<br>&ensp;&ensp;&ensp;&ensp;从管理上保护好你的系统；<br>★ 安全算法<br>☉常用安全技术<br>&ensp;&ensp;&ensp;&ensp;认证<br>&ensp;&ensp;&ensp;&ensp;授权<br>&ensp;&ensp;&ensp;&ensp;安全通信<br>&ensp;&ensp;&ensp;&ensp;审计<br>☉密码算法和协议：<br>&ensp;&ensp;&ensp;&ensp;对称加密：数据加密（保密性）（算法：3DES，AES）<br>&ensp;&ensp;&ensp;&ensp;公钥加密：身份认证，密钥交换，数据加密 （RSA,DSA）<br>&ensp;&ensp;&ensp;&ensp;单向加密：数据完整性（MD5，SHA1…）<br>&ensp;&ensp;&ensp;&ensp;密钥交换：RSA、DH、ECDH(椭圆曲线DH)，ECDHE（临时椭圆曲线DH）<br>&ensp;&ensp;&ensp;&ensp;认证协议<br>★ Linux系统：<br>&ensp;&ensp;&ensp;&ensp;OpenSSL，gpg(pgp协议的实现)</p>
<h3 id="常见的加密算法和协议"><a href="#常见的加密算法和协议" class="headerlink" title="常见的加密算法和协议"></a>常见的加密算法和协议</h3><h4 id="★-对称加密"><a href="#★-对称加密" class="headerlink" title="★ 对称加密"></a>★ 对称加密</h4><p>◆ 对称加密：加密和解密使用同一个密钥<br>&ensp;&ensp;&ensp;&ensp;DES：Data Encryption Standard，56bits<br>&ensp;&ensp;&ensp;&ensp;3DES：<br>&ensp;&ensp;&ensp;&ensp;AES：Advanced (128, 192, 256bits)<br>&ensp;&ensp;&ensp;&ensp;Blowfish，Twofish<br>&ensp;&ensp;&ensp;&ensp;IDEA，RC6，CAST5<br>◆ 特性：<br>&ensp;&ensp;&ensp;&ensp;加密、解密使用同一个密钥，效率高；<br>&ensp;&ensp;&ensp;&ensp;将原始数据分割成固定大小的块，逐个进行加密；<br>◆ 缺陷：<br>&ensp;&ensp;&ensp;&ensp;密钥过多；<br>&ensp;&ensp;&ensp;&ensp;密钥分发；<br>&ensp;&ensp;&ensp;&ensp;数据来源无法确认</p>
<h4 id="★-非对称加密（公钥加密）"><a href="#★-非对称加密（公钥加密）" class="headerlink" title="★ 非对称加密（公钥加密）"></a>★ 非对称加密（公钥加密）</h4><p>◆ 非对称加密<br>&ensp;&ensp;&ensp;&ensp;采用公钥加密，同时还需要另一个秘钥来解密，也就是私钥；两者统称为密钥对。<br>&ensp;&ensp;&ensp;&ensp;公钥：从私钥中提取产生，公开给所有人；public key<br>&ensp;&ensp;&ensp;&ensp;私钥：通过工具创建，使用者自己留存，必须保证其私密性；secret key<br>&ensp;&ensp;&ensp;&ensp;一般拿对方公钥加密来保证数据安全性，拿自己的私钥加密来证明数据来源的身份<br>◆ 特点：<br>&ensp;&ensp;&ensp;&ensp;用公钥加密数据，只能使用与之配对的私钥解密；反之亦然<br>◆ 功能：<br>☉身份认证：<br>&ensp;&ensp;&ensp;&ensp;私钥拥有者用自己的私钥加密的数据，只要用其公钥能解密，即可认证其身份；私钥加密的这个过程为数字签名。<br>☉密钥交换：<br>&ensp;&ensp;&ensp;&ensp;与被通信方之前，首先获取到对方的公钥，自己生成一个加密密码，用对方的公钥加密，并发送给对方；<br>☉数据加密：<br>&ensp;&ensp;&ensp;&ensp;适合加密较小数据（不常用，比对称加密要慢3个数量级）<br>◆ 缺点：<br>&ensp;&ensp;&ensp;&ensp;密钥长，加密解密效率低下<br>◆ 算法：<br>&ensp;&ensp;&ensp;&ensp;RSA（加密，数字签名）,<br>&ensp;&ensp;&ensp;&ensp;DSA（数字签名）,<br>&ensp;&ensp;&ensp;&ensp;ELGamal<br>◆ 基于一对公钥/私钥对<br>&ensp;&ensp;&ensp;&ensp;用密钥对中的一个加密，另一个解密<br>◆ 实现加密过程：<br>☉接收者<br>&ensp;&ensp;&ensp;&ensp;生成公钥P和私钥S<br>&ensp;&ensp;&ensp;&ensp;公开公钥P，保密私钥S<br>☉发送者<br>&ensp;&ensp;&ensp;&ensp;使用接收者的公钥P来加密消息M<br>&ensp;&ensp;&ensp;&ensp;将P(M)发送给接收者<br>☉接收者<br>&ensp;&ensp;&ensp;&ensp;使用私钥S来解密：M=S(P(M))<br>◆ 实现数字签名：<br>☉发送者<br>&ensp;&ensp;&ensp;&ensp;生成公钥/私钥对：P和S<br>&ensp;&ensp;&ensp;&ensp;公开公钥P，保密密钥S<br>&ensp;&ensp;&ensp;&ensp;使用私钥S来加密消息M<br>&ensp;&ensp;&ensp;&ensp;发送给接收者S(M)<br>☉接收者<br>&ensp;&ensp;&ensp;&ensp;使用发送者的公钥来解密M=P(S(M))<br>&ensp;&ensp;&ensp;&ensp;结合签名和加密<br>&ensp;&ensp;&ensp;&ensp;分离签名   </p>
<h4 id="★-单向加密"><a href="#★-单向加密" class="headerlink" title="★ 单向加密"></a>★ 单向加密</h4><p>◆ 单向加密<br>&ensp;&ensp;&ensp;&ensp;只能加密，不能解密，因为解密过程是一个二次加密的过程；主要是提取数据的特征码来保证数据的完整性和一致性，即“数据指纹”，具有雪崩效应，任何一点数据的改变，生成的校验码值变化非常大<br>◆ 特性：<br>&ensp;&ensp;&ensp;&ensp;任意长度输入<br>&ensp;&ensp;&ensp;&ensp;固定长度输出<br>&ensp;&ensp;&ensp;&ensp;若修改数据，指纹也会改变（“不会产生冲突”）<br>&ensp;&ensp;&ensp;&ensp;无法从指纹中重新生成数据（“单向”）<br>◆ 功能：<br>&ensp;&ensp;&ensp;&ensp;数据完整性（完整性校验）<br>&ensp;&ensp;&ensp;&ensp;系统账号密码校验<br>◆ 算法：<br>&ensp;&ensp;&ensp;&ensp;md5：Message Digest 5（消息摘要）,128bits；<br>&ensp;&ensp;&ensp;&ensp;sha1：Secure Hash Algorithm 1(安全哈希算法) ,160bits<br>&ensp;&ensp;&ensp;&ensp;sha224,sha256,sha384,sha512</p>
<h4 id="★-密钥交换"><a href="#★-密钥交换" class="headerlink" title="★ 密钥交换"></a>★ 密钥交换</h4><p>★ 密钥交换（IKE）：<br>&ensp;&ensp;&ensp;&ensp;双方通过交换密钥来实现数据加密解密；密钥交换有两种<br>◆ 公钥交换：<br>&ensp;&ensp;&ensp;&ensp;将公钥加密后通过网络传输到对方进行解密，这种方式很有可能别截获破解，不常用；<br>◆ DH：<br>&ensp;&ensp;&ensp;&ensp;双方共有一些参数，共同协商加密算法，除此之外双方还有属于自己的私有参数，通过共有参数、私有参数和算法信息来进行加密，然后双方将计算后的结果进行交换，交换完成后再和属于自己私有的参数进行特殊算法，经过双反计算后的结果是相同的，而这个结果就是密钥。<br>◆ 举例：<br><img src="\images\DH加密算法.png" alt="DH加密算法"><br>◆ 注意：<br>&ensp;&ensp;&ensp;&ensp;整个过程中对于第三方人员来说只能获取p，g两个值，AB双方交换的是经过计算后的值，因此这种加密算法是很安全的。</p>
<h4 id="★-一次加密通信过程："><a href="#★-一次加密通信过程：" class="headerlink" title="★ 一次加密通信过程："></a>★ 一次加密通信过程：</h4><p>★ 发送者：<br>&ensp;&ensp;&ensp;&ensp;1.使用单向加密算法提取生成数据的特征码；  （单向加密技术）<br>&ensp;&ensp;&ensp;&ensp;2.使用自己的私钥加密特征码附在数据的后面；（公钥加密技术）<br>&ensp;&ensp;&ensp;&ensp;3.生成用于对称加密的临时密钥；<br>&ensp;&ensp;&ensp;&ensp;4.用此临时密钥加密数据和已经使用私钥加密后的特征码；（对称加密技术）<br>&ensp;&ensp;&ensp;&ensp;5.使用接收方的公钥加密此临时密钥，附在对称加密后的数据的后方；（密钥交换技术）<br>★ 接收者：<br>&ensp;&ensp;&ensp;&ensp;1.使用自己的私钥解密加密的临时密钥，从而获取对称密钥；<br>&ensp;&ensp;&ensp;&ensp;2.使用对称密钥解密对称加密的数据和私钥加密的特征码密文； 从而获取数据和特征码密文；<br>&ensp;&ensp;&ensp;&ensp;3.使用发送方的公钥解密特征码密文，从而获取计算生成的特征码；<br>&ensp;&ensp;&ensp;&ensp;4.使用与对方同样的单向加密算法计算数据的特征码，并与解密而来的特征码进行比较。</p>
<h4 id="★-CA和证书"><a href="#★-CA和证书" class="headerlink" title="★ CA和证书"></a>★ CA和证书</h4><p>★ 为什么需要CA<br>&ensp;&ensp;&ensp;&ensp;在双方通信过程中，数据的加密解密依赖于对方的公钥，因此就需要一种可靠的机制能够保证公钥数据的安全性，这种机制就是CA，CA是一个证书颁发机构，这个机构负责证书的颁发，谁需要就去CA购买，买完之后去验证CA就可以了。<br>★ PKI: Public Key Infrastructure<br>CA只是PKI的一个组成部分，PKI（公钥基础设施：）包括<br>&ensp;&ensp;&ensp;&ensp;签证机构：CA（Certificate Authority）<br>&ensp;&ensp;&ensp;&ensp;注册机构：RA<br>&ensp;&ensp;&ensp;&ensp;证书吊销列表：CRL<br>&ensp;&ensp;&ensp;&ensp;证书存取库：<br>★ X.509：定义了证书的结构以及认证协议标准<br>&ensp;&ensp;&ensp;&ensp;版本号：version<br>&ensp;&ensp;&ensp;&ensp;序列号：serial number CA用于唯一标识此证书；<br>&ensp;&ensp;&ensp;&ensp;签名算法标志：<br>&ensp;&ensp;&ensp;&ensp;颁发者：即CA自己的名称；<br>&ensp;&ensp;&ensp;&ensp;有效期限：两个日期，起始日期和终止日期<br>&ensp;&ensp;&ensp;&ensp;主体名称：证书拥有者自己的名字<br>&ensp;&ensp;&ensp;&ensp;主体公钥：证书拥有者自己的公钥信息<br>&ensp;&ensp;&ensp;&ensp;发行者的唯一标识：<br>&ensp;&ensp;&ensp;&ensp;证书主体的唯一标识<br>&ensp;&ensp;&ensp;&ensp;CRL分发点：<br>&ensp;&ensp;&ensp;&ensp;扩展信息<br>&ensp;&ensp;&ensp;&ensp;发行者签名：CA对此证书的数字签名<br>★ 验证证书过程：<br>&ensp;&ensp;&ensp;&ensp;用CA的公钥去解密CA的全名，能解密说明证书来源可靠；<br>&ensp;&ensp;&ensp;&ensp;用同样的加密算法去加密证书取得特征码，与解密出的特征码相比较，如果二者相同，说明证书完整性可靠；<br>&ensp;&ensp;&ensp;&ensp;检查证书的有效期限在不在当前合理的有效范围内;<br>&ensp;&ensp;&ensp;&ensp;验证主体名称和期望通信的对方是否一致;<br>&ensp;&ensp;&ensp;&ensp;检查证书是否被吊销。<br>★ 证书类型：<br>&ensp;&ensp;&ensp;&ensp;证书授权机构的证书<br>&ensp;&ensp;&ensp;&ensp;服务器<br>&ensp;&ensp;&ensp;&ensp;用户证书<br>★ 获取证书两种方法：<br>☉使用证书授权机构；<br>&ensp;&ensp;&ensp;&ensp;生成签名请求（csr）<br>&ensp;&ensp;&ensp;&ensp;将csr发送给CA<br>&ensp;&ensp;&ensp;&ensp;从CA处接收签名<br>☉自签名的证书；<br>&ensp;&ensp;&ensp;&ensp;自已签发自己的公钥</p>
<h3 id="SSL-TSL"><a href="#SSL-TSL" class="headerlink" title="SSL/TSL"></a>SSL/TSL</h3><h4 id="★-介绍"><a href="#★-介绍" class="headerlink" title="★ 介绍"></a>★ 介绍</h4><p>★ SSL: Secure Socket Layer<br>&ensp;&ensp;&ensp;&ensp;安全套接层，是为网络通信提供安全及数据完整性的一种安全协议；<br>&ensp;&ensp;&ensp;&ensp;SSL为Netscape在1994年所研发，用以保障在Internet上数据传输之安全，利用数据加密（Encryption）技术，可确保数据在网络之上传输过程中不会被截取及窃听；<br>★ TLS（传输层安全）:<br>&ensp;&ensp;&ensp;&ensp;Transport Layer Security（SSL的继承版本）与SSL在传输层对网络连接进行加密；<br>☉发展历程：<br>&ensp;&ensp;&ensp;&ensp;1995：SSL 2.0 Netscape研发<br>&ensp;&ensp;&ensp;&ensp;1996: SSL 3.0<br>&ensp;&ensp;&ensp;&ensp;1999: TLS 1.0 IETE研发<br>&ensp;&ensp;&ensp;&ensp;2006: TLS 1.1 RFC（Request For Comments ）4346<br>&ensp;&ensp;&ensp;&ensp;2008：TLS 1.2 当前使用<br>&ensp;&ensp;&ensp;&ensp;2015: TLS 1.3<br>★ 功能：<br>&ensp;&ensp;&ensp;&ensp;机密性，认证，完整性，重放保护；<br>★ 分层设计：<br>&ensp;&ensp;&ensp;&ensp;最底层：基础算法原理的实现；<br>&ensp;&ensp;&ensp;&ensp;向上一层：各种算法的实现；<br>&ensp;&ensp;&ensp;&ensp;再向上一层：组合算法实现的半成品；<br>&ensp;&ensp;&ensp;&ensp;用各种组件拼装而成的各种成品密码及协议软件<br>★ 两阶段协议，分为握手阶段和应用阶段<br>☉握手阶段(协商阶段):<br>&ensp;&ensp;&ensp;&ensp;客户端和服务器端认证对方身份（依赖于PKI体系，利用数字证书进行身份认证），并协商通信中使用的安全参数、密码套件以及主密钥。后续通信使用的所有密钥都是通过MasterSecret生成。<br>☉应用阶段:<br>&ensp;&ensp;&ensp;&ensp;在握手阶段完成后进入，在应用阶段通信双方使用握手阶段协商好的密钥进行安全通信。<br>如图：<br><img src="\images\SSL-TLS Protocol.png" alt="SSL-TLS"></p>
<h4 id="★-相关协议"><a href="#★-相关协议" class="headerlink" title="★ 相关协议"></a>★ 相关协议</h4><p>★ 相关协议<br>☉Handshake协议：<br>&ensp;&ensp;&ensp;&ensp;包括协商安全参数和密码套件、服务器身份认证（客户端身份认证可选）、密钥交换<br>☉ChangeCipherSpec 协议：<br>&ensp;&ensp;&ensp;&ensp;一条消息表明握手协议已经完成<br>☉Alert 协议：<br>&ensp;&ensp;&ensp;&ensp;对握手协议中一些异常的错误提醒，分为fatal和warning两个级别，fatal类型错误会直接中断SSL链接，而warning级别的错误SSL链接仍可继续，只是会给出错误警告<br>☉Record 协议：<br>&ensp;&ensp;&ensp;&ensp;包括对消息的分段、压缩、消息认证和完整性保护、加密等<br>☉HTTPS 协议：<br>&ensp;&ensp;&ensp;&ensp;就是“HTTP 协议”和“SSL/TLS 协议”的组合。HTTP over SSL”或“HTTP over TLS”，对http协议的文本数据进行加密处理后，成为二进制形式传输</p>
<h4 id="★-SSL会话主要三步"><a href="#★-SSL会话主要三步" class="headerlink" title="★ SSL会话主要三步"></a>★ SSL会话主要三步</h4><p>★ SSL会话主要三步<br>&ensp;&ensp;&ensp;&ensp;客户端向服务器端索要并验证证书；<br>&ensp;&ensp;&ensp;&ensp;双方协商生成“会话密钥”<br>&ensp;&ensp;&ensp;&ensp;双方采用“会话密钥”进行加密通信<br>※ 详细过程如下：<br>☉第一阶段：ClintHello（客户端发送加密通信请求）<br>&ensp;&ensp;&ensp;&ensp;支持的协议版本，比如tls1.2<br>&ensp;&ensp;&ensp;&ensp;客户端生成一个随机数，稍后用户生成“会话密钥”<br>&ensp;&ensp;&ensp;&ensp;支持的加密算法：比如AES、RSA<br>&ensp;&ensp;&ensp;&ensp;支持的压缩算法<br>☉第二阶段：ServerHello（服务器端回应）<br>&ensp;&ensp;&ensp;&ensp;确认使用的加密通信版本，比如tls1.2；<br>&ensp;&ensp;&ensp;&ensp;服务器端生成一个随机数，稍后用于生成“会话密钥”；<br>&ensp;&ensp;&ensp;&ensp;确认使用的加密算法；<br>&ensp;&ensp;&ensp;&ensp;发送服务器证书；<br>☉第三阶段：<br>&ensp;&ensp;&ensp;&ensp;验证服务器证书，在确认无误后取其公钥；（发证机构、证书完整性、证书的持有者、证书有效期、吊销列表）；<br>&ensp;&ensp;&ensp;&ensp;发送以下信息给服务器：<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;一个随机数；<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;编码变更通知，表示随后的信息都将用双方商定的加密方法和；<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;客户端握手结束通知；<br>☉第四阶段：<br>&ensp;&ensp;&ensp;&ensp;收到客户端发来的第三个随机数pre-master-key后，计算生成本次会话所用到的“会话密钥”<br>★ 工作原理图：<br><img src="\images\ssl会话.png" alt="SSL会话"></p>
<h3 id="Openssl"><a href="#Openssl" class="headerlink" title="Openssl"></a>Openssl</h3><h4 id="★-介绍-1"><a href="#★-介绍-1" class="headerlink" title="★ 介绍"></a>★ 介绍</h4><p>★ OpenSSL：是ssl的开源项目，有三部分组成：<br>&ensp;&ensp;&ensp;&ensp;openssl: 多用途的命令行工具，每种功能都使专用的子命令来实现；<br>&ensp;&ensp;&ensp;&ensp;libcrypto: 加密，解密库文件；<br>&ensp;&ensp;&ensp;&ensp;libssl：加密模块应用库，实现了ssl及tls；<br>★ Openssl命令：<br>☉两种运行模式：<br>&ensp;&ensp;&ensp;&ensp;交互模式；<br>&ensp;&ensp;&ensp;&ensp;批处理模式；<br>☉opensslversion：程序版本号<br>☉子命令分类：<br>&ensp;&ensp;&ensp;&ensp;标准命令：enc, ca, req, …<br>&ensp;&ensp;&ensp;&ensp;消息摘要命令（dgst命令）<br>&ensp;&ensp;&ensp;&ensp;加密命令（enc子命令）<br>★ 演示<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#获取openssl 版本号</span></div><div class="line">[root@centos7 ~]<span class="comment"># openssl version</span></div><div class="line">OpenSSL 1.0.1e-fips 11 Feb 2013</div><div class="line">[root@centos7 ~]<span class="comment"># openssl d</span></div><div class="line">openssl:Error: <span class="string">'d'</span> is an invalid command.</div><div class="line"></div><div class="line">Standard commands            <span class="comment">#标准命令</span></div><div class="line">asn1parse         ca                ciphers           cms               </div><div class="line">crl               crl2pkcs7         dgst              dh                </div><div class="line">dhparam           dsa               dsaparam          ec                </div><div class="line">ecparam           enc               engine            errstr            </div><div class="line">gendh             gendsa            genpkey           genrsa            </div><div class="line">nseq              ocsp              passwd            pkcs12            </div><div class="line">pkcs7             pkcs8             pkey              pkeyparam         </div><div class="line">pkeyutl           prime             rand              req               </div><div class="line">rsa               rsautl            s_client          s_server          </div><div class="line">s_time            sess_id           smime             speed             </div><div class="line">spkac             ts                verify            version           </div><div class="line">x509              </div><div class="line"></div><div class="line">Message Digest commands (see the `dgst<span class="string">' command for more details)   #信息摘要命令</span></div><div class="line">md2               md4               md5               rmd160            </div><div class="line">sha               sha1              </div><div class="line"></div><div class="line">Cipher commands (see the `enc' <span class="built_in">command</span> <span class="keyword">for</span> more details)      <span class="comment">#加密解密相关命令</span></div><div class="line">aes-128-cbc       aes-128-ecb       aes-192-cbc       aes-192-ecb       </div><div class="line">aes-256-cbc       aes-256-ecb       base64            bf                </div><div class="line">bf-cbc            bf-cfb            bf-ecb            bf-ofb            </div><div class="line">camellia-128-cbc  camellia-128-ecb  camellia-192-cbc  camellia-192-ecb  </div><div class="line">camellia-256-cbc  camellia-256-ecb  cast              cast-cbc          </div><div class="line">cast5-cbc         cast5-cfb         cast5-ecb         cast5-ofb         </div><div class="line">des               des-cbc           des-cfb           des-ecb           </div><div class="line">des-ede           des-ede-cbc       des-ede-cfb       des-ede-ofb       </div><div class="line">des-ede3          des-ede3-cbc      des-ede3-cfb      des-ede3-ofb      </div><div class="line">des-ofb           des3              desx              idea              </div><div class="line">idea-cbc          idea-cfb          idea-ecb          idea-ofb          </div><div class="line">rc2               rc2-40-cbc        rc2-64-cbc        rc2-cbc           </div><div class="line">rc2-cfb           rc2-ecb           rc2-ofb           rc4               </div><div class="line">rc4-40            seed              seed-cbc          seed-cfb          </div><div class="line">seed-ecb          seed-ofb          zlib</div></pre></td></tr></table></figure></p>
<h4 id="★-Openssl命令"><a href="#★-Openssl命令" class="headerlink" title="★ Openssl命令"></a>★ Openssl命令</h4><h5 id="★-对称加密："><a href="#★-对称加密：" class="headerlink" title="★ 对称加密："></a>★ 对称加密：</h5><p>◆ 工具：<br>&ensp;&ensp;&ensp;&ensp;openssl enc;<br>&ensp;&ensp;&ensp;&ensp;gpg<br>◆ 算法：<br>&ensp;&ensp;&ensp;&ensp;3des;<br>&ensp;&ensp;&ensp;&ensp;aes;<br>&ensp;&ensp;&ensp;&ensp;blowfish;<br>&ensp;&ensp;&ensp;&ensp;twofish;<br>◆ enc命令：man enc<br>☉加密：<br>&ensp;&ensp;&ensp;&ensp;openssl enc -e -des3 -a -salt -in testfile -out testfile.cipher<br>☉解密：<br>&ensp;&ensp;&ensp;&ensp;openssl enc -d -des3 -a -salt -out testfile.cipher -in testfile<br>◆ 选项解析：<br>&ensp;&ensp;&ensp;&ensp;其中，des3 为算法，in 后面的testfile 表示要加密和解密的文件，out后面的testfile.copher表示加密和解密后输出的文件名<br>★ openssl enc命令演示:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line">[root@centos7 ~]<span class="comment"># cp /etc/fstab ./fstab</span></div><div class="line">[root@centos7 ~]<span class="comment"># ls -l fstab</span></div><div class="line">-rw-r--r-- 1 root root 483 Jul 15 23:12 fstab</div><div class="line"><span class="comment">#对文件fstab采用des3算法，加盐进行加密后生成fstab.ciphertext文件</span></div><div class="line">[root@centos7 ~]<span class="comment"># openssl enc -e -des3 -a -salt -in fstab -out fstab.ciphertext</span></div><div class="line">enter des-ede3-cbc encryption password:</div><div class="line">Verifying - enter des-ede3-cbc encryption password:</div><div class="line">[root@centos7 ~]<span class="comment"># ls -l fstab*</span></div><div class="line">-rw-r--r-- 1 root root 483 Jul 15 23:12 fstab</div><div class="line">-rw-r--r-- 1 root root 683 Jul 15 23:13 fstab.ciphertext      <span class="comment">#加密后生层的文件</span></div><div class="line">[root@centos7 ~]<span class="comment"># cat fstab.ciphertext </span></div><div class="line">U2FsdGVkX19JG//SvyTloOF8eHZdB8ojXgVkX9a38KzKlAF3/whnonC3UGEiNrHD</div><div class="line">/PZ0sXl61FdTuLD04lirPaHCOOBye4rjpc/HJGyUUzCHzG29fr4B0ZwhXoK4wZga</div><div class="line">qEeN/B29dNr8KXEnAtMlqrPbEbCZOxVc6q1x5hkk2F9SuRsvJ67VNJDKWMrglxLr</div><div class="line">n7l6/P6aGmLWy+VAAgGs3P+oejolECRhrBmz8586CgBKqTvvdupqJZg7<span class="built_in">bg</span>+dJ9nI</div><div class="line">WjNf+fu8dtSCer4yzz1nBr2/sY+upL2+YZq3lJWUoFO9ovHtKntdff64fP8+qEi2</div><div class="line">/KyZ8Kg/UWXc75xop1cOCoXLFzjksIu9OH+QDEsM/2FvXc0Wa20M2hOVFkvdU4L6</div><div class="line">GQrnUw5zbEITp6AMXNW7n//jhoy5w4XxEaW1rPdWkdPizw2g5/o8rVP3pWRVUgLV</div><div class="line">L6wqBgPjmFhuvsgwzOa+xE98Q7+Ry+lkAhCwcD0BWF8UqETCdGxMOgfmyin/fh0+</div><div class="line">t0RcHhkt45XurcvSXs2EmAKvzsCYGejhAQDxjUyCwf0II+JJ15k9ccZuer2XNwjF</div><div class="line">mD6voKel9DQb6svh6aOkJGCbH9+Ps5OPha9oI+swwXuCMaAgWHol+TjhCitrGjBL</div><div class="line">tF+s+JyWBq0+d0mRecBfPD0<span class="keyword">if</span>6R3J05z</div><div class="line"></div><div class="line"><span class="comment">#对生成的加密文件进行解密后生成fstab.plaintext文件</span></div><div class="line">[root@centos7 ~]<span class="comment"># openssl enc -d -des3 -a -salt -out fstab.plaintext -in fstab.ciphertext </span></div><div class="line">enter des-ede3-cbc decryption password:</div><div class="line">[root@centos7 ~]<span class="comment"># ls -l fstab*</span></div><div class="line">-rw-r--r-- 1 root root 483 Jul 15 23:12 fstab</div><div class="line">-rw-r--r-- 1 root root 683 Jul 15 23:13 fstab.ciphertext</div><div class="line">-rw-r--r-- 1 root root 483 Jul 15 23:17 fstab.plaintext</div><div class="line">[root@centos7 ~]<span class="comment"># cat fstab.plaintext </span></div><div class="line"></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># /etc/fstab</span></div><div class="line"><span class="comment"># Created by anaconda on Wed Apr 26 10:31:47 2017</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Accessible filesystems, by reference, are maintained under '/dev/disk'</span></div><div class="line"><span class="comment"># See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info</span></div><div class="line"><span class="comment">#</span></div><div class="line">/dev/mapper/vgos-root   /                       xfs     defaults        0 0</div><div class="line">UUID=224a4923<span class="_">-a</span>78d-4bde-b962-aa921a15db50 /boot                   xfs     defaults        0 0</div><div class="line">UUID=3f6338ab-2c10-422c-9a5c-6a783c5795e8 swap                    swap    defaults        0 0</div></pre></td></tr></table></figure></p>
<h5 id="★-单向加密："><a href="#★-单向加密：" class="headerlink" title="★ 单向加密："></a>★ 单向加密：</h5><p>◆ 工具：<br>&ensp;&ensp;&ensp;&ensp;openssl dgst;<br>&ensp;&ensp;&ensp;&ensp;md5sum;<br>&ensp;&ensp;&ensp;&ensp;sha1sum;<br>&ensp;&ensp;&ensp;&ensp;sha224sum;<br>&ensp;&ensp;&ensp;&ensp;sha256sum…<br>◆ dgst命令：man dgst<br>&ensp;&ensp;&ensp;&ensp;openssl dgst -md5 [-hex默认] /PATH/SOMEFILE<br>&ensp;&ensp;&ensp;&ensp;md5sum /PATH/TO/SOMEFILE<br>◆ 生成用户密码（passwd、openssl passwd）<br>&ensp;&ensp;&ensp;&ensp;passwd命令：man sslpasswd<br>&ensp;&ensp;&ensp;&ensp;openssl passwd -1 -salt SALT(最多8位) （-1表示md5加密算法）<br>◆ MAC: Message Authentication Code，<br>单向加密的一种延伸应用，用于实现网络通信中保证所传输数据的完整性机制<br>&ensp;&ensp;&ensp;&ensp;CBC-MAC<br>&ensp;&ensp;&ensp;&ensp;HMAC：使用md5或sha1算法<br>◆ 生成随机数：man sslrand<br>&ensp;&ensp;&ensp;&ensp;openssl rand -base64|-hex NUM<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;NUM: 表示字节数；-hex时，每个字符4位，出现的字符数为NUM*<br>★ 命令演示<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">[root@centos7 ~]<span class="comment"># md5sum fstab       #用md5sum工具单向加密</span></div><div class="line">2732e3332ec1646c97257b9da04d61e7  fstab</div><div class="line">[root@centos7 ~]<span class="comment"># openssl dgst -md5 fstab    #用openssl dgst工具加密，指明算法</span></div><div class="line">MD5(fstab)= 2732e3332ec1646c97257b9da04d61e7</div><div class="line"><span class="comment"># 可以看到虽然两种加密的工具不一样，但算法相同，所以生成的特征码也相同</span></div><div class="line"></div><div class="line">生成用户密码命令：（说明：生成用户密码，salt最好用随机数）</div><div class="line">[root@centos7 ~]<span class="comment"># openssl passwd -1 -salt 123</span></div><div class="line">Password: </div><div class="line"><span class="variable">$1</span><span class="variable">$123</span><span class="variable">$yFsA3JppCdCGU4efNyHmT0</span></div><div class="line">[root@centos7 ~]<span class="comment"># openssl passwd -1 -salt 1234</span></div><div class="line">Password: </div><div class="line"><span class="variable">$1</span><span class="variable">$1234</span><span class="variable">$PQv8OEhWWJlOQxOewo1Gi</span>/</div><div class="line"><span class="comment"># 可以看出密码相同但-salt指定的不同，生成的加密密码有很大的不同</span></div><div class="line"></div><div class="line">生成随机数命令演示：</div><div class="line">[root@centos7 ~]<span class="comment"># openssl rand -base64 10</span></div><div class="line">RKRW3RJndEMKcg==</div><div class="line">[root@centos7 ~]<span class="comment"># openssl rand -base64 10</span></div><div class="line">BwJ+Qy6yCVvEUA==</div><div class="line">[root@centos7 ~]<span class="comment"># openssl rand -hex 10</span></div><div class="line">096a4a6809e927c7a37f</div><div class="line">[root@centos7 ~]<span class="comment"># openssl rand -hex 10</span></div><div class="line">70a779a130f13cdacaa3</div><div class="line"><span class="comment"># 命令替换生成随机数</span></div><div class="line">[root@centos7 ~]<span class="comment"># openssl passwd -1 -salt `openssl rand -hex 4`</span></div><div class="line">Password: </div><div class="line"><span class="variable">$1</span><span class="variable">$4a20d9d1</span><span class="variable">$twFgRJPyQUr1sSl</span>/U6s1W1</div><div class="line">[root@centos7 ~]<span class="comment"># openssl passwd -1 -salt $(openssl rand -hex 4)</span></div><div class="line">Password: </div><div class="line"><span class="variable">$1</span><span class="variable">$75ccd786</span><span class="variable">$QuRyYHorNN6aJLmeGvBf6</span>.</div><div class="line"><span class="comment"># 只要随机数不变，则生成的密码就不变</span></div></pre></td></tr></table></figure></p>
<h5 id="★-公钥加密："><a href="#★-公钥加密：" class="headerlink" title="★ 公钥加密："></a>★ 公钥加密：</h5><p>◆ 加密解密<br>&ensp;&ensp;&ensp;&ensp;算法：RSA, ELGamal<br>&ensp;&ensp;&ensp;&ensp;工具：gpg, openssl rsautl（man rsautl）<br>◆ 数字签名<br>&ensp;&ensp;&ensp;&ensp;算法：RSA, DSA, ELGamal<br>&ensp;&ensp;&ensp;&ensp;工具同上<br>◆ 密钥交换<br>&ensp;&ensp;&ensp;&ensp;算法：DH<br>&ensp;&ensp;&ensp;&ensp;DSA: Digital Signature Algorithm<br>&ensp;&ensp;&ensp;&ensp;DSS：Digital Signature Standard<br>&ensp;&ensp;&ensp;&ensp;RSA<br>◆ 生成密钥对（man genrsa）<br>☉生成私钥：<br>&ensp;&ensp;&ensp;&ensp;openssl genrsa -out /PATH/TO/PRIVATEKEY.FILE NUM_BITS 生成的的私钥不安全<br>&ensp;&ensp;&ensp;&ensp;(umask 077; openssl genrsa -out key.pri–des 2048)<br>&ensp;&ensp;&ensp;&ensp;私钥仅自己能读能写，使用括号是启用了一个子shell，仅对子shell有效，对父shell不受影响；<br>☉从私钥中提取公钥：<br>&ensp;&ensp;&ensp;&ensp;openssl rsa -in /PATH/TO/SOMEFILE –pubout<br>◆ 随机数生成器（伪随机数字）<br>☉熵池：<br>&ensp;&ensp;&ensp;&ensp;在操作系统上有一个叫做熵池的地方，他是用来保存硬件中断产生的随机数（每一次硬件中断都会产生一个随机数）<br>☉/dev/random:<br>&ensp;&ensp;&ensp;&ensp;仅从熵池中返回随机数，随机数耗尽时，取随机数的进程将会被阻塞；<br>☉/dev/unrandom：<br>&ensp;&ensp;&ensp;&ensp;仅从熵池中取随机数，随机数耗尽时，就通过伪随机数生成器生成伪随机数；（伪随机数不安全）<br>☉熵池中随机数的来源<br>&ensp;&ensp;&ensp;&ensp;硬盘IO中断时间间隔<br>&ensp;&ensp;&ensp;&ensp;键盘IO中断时间间隔<br>★ 演示：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div></pre></td><td class="code"><pre><div class="line">生成私钥：</div><div class="line">[root@centos7 ~]<span class="comment"># openssl genrsa 1024</span></div><div class="line">Generating RSA private key, 1024 bit long modulus</div><div class="line">...............................................................................++++++</div><div class="line">..............++++++</div><div class="line">e is 65537 (0x10001)</div><div class="line">-----BEGIN RSA PRIVATE KEY-----</div><div class="line">MIICXgIBAAKBgQC0TUoj6Xq5rB2+wnk0XaWc962/CFNO4oKj2RxYeATXfQbT2Dzv</div><div class="line">Bd/aJ7ZHzUkHzbV7mlOC5bQONcUMc3bm1vJye4+ui+EEwBzlMr+kTCe32wKLd7Jv</div><div class="line">pr7aqPPu4av0pcoc97B+gkLxG7F/bKmHy1mYI7QNVw6lKP4sErv+gvKAmQIDAQAB</div><div class="line">AoGAO//waSz8Qydsqptq3CtBvo+JiSXLG1gzYzUPwr0F13PqvrqZ5GzPBnjqptBA</div><div class="line">ulERULWVjtzD42qvTSprafwjp7eGgEEgq6bt3KJq12ao98NBtadSZ0cMF31cTsr7</div><div class="line">Ibttn8IUsKEEDlOZQjLlIrCA1zI0kmodL6Agy6+7o9muFvUCQQDuTCbywh1u6zQ3</div><div class="line">tFlV9Rl0JOu+un8Tw3ltiMLroqWkRXFrCfAhhdNbEjaPnJF/3bJRbh4AhAdVja/s</div><div class="line">p7As4VZnAkEAwbIzYWBk3NmcyZvRCshG2uqehl045mzM6ekTG5aF/kA112sL6RIb</div><div class="line">6eAYEM//lYXU8/P4lGspNtiMAz9++dEQ/wJBAOPBqSAw48zVxMzQ9OmxHyjg+OkM</div><div class="line">etS66d4E7rgkdkixjpuNnhOMQtwyZi+Qp4gcroghxU8c4Z2llFWOWFYs8VUCQQCs</div><div class="line">vQ1RVDPfOTq4GXuN0BpQdVg2n8B0zqbYHAHsYorQudbKbC7NBldadX1A0R4v7JCD</div><div class="line">lxoi0oaI4QnMg73rcGVlAkEAnjLJ8DMHmwtw+Fg9QheJpO1oWpzC3Gl3w+tfDFM7</div><div class="line">W5tAurvZ/Bn2pV0/yF2zSmvSb9zPXSyhC4rKJvNl8/T9TA==</div><div class="line">-----END RSA PRIVATE KEY-----</div><div class="line"><span class="comment">#可以使用重定向到指定文件当中</span></div><div class="line">[root@centos7 ~]<span class="comment"># openssl genrsa 1024 &gt;/tmp/mykey.private</span></div><div class="line">Generating RSA private key, 1024 bit long modulus</div><div class="line">.................++++++</div><div class="line">.........++++++</div><div class="line">e is 65537 (0x10001)</div><div class="line"><span class="comment"># out指定输出的文件，和重定向作用相同</span></div><div class="line">[root@centos7 ~]<span class="comment"># openssl genrsa -out /tmp/mykey1.private 1024</span></div><div class="line">Generating RSA private key, 1024 bit long modulus</div><div class="line">.......++++++</div><div class="line">...++++++</div><div class="line">e is 65537 (0x10001)</div><div class="line"><span class="comment">#但是生成的私钥放在文件当中是不安全的，因此要设置权限尽量自己可以看</span></div><div class="line">[root@centos7 ~]<span class="comment"># (umask 077;openssl genrsa -out /tmp/mykey2.private 2048)</span></div><div class="line">Generating RSA private key, 2048 bit long modulus</div><div class="line">....+++</div><div class="line">...............................................+++</div><div class="line">e is 65537 (0x10001)</div><div class="line">[root@centos7 ~]<span class="comment"># ls -l /tmp/mykey*</span></div><div class="line">-rw-r--r-- 1 root root  887 Jul 15 23:46 /tmp/mykey1.private    <span class="comment"># 属组和其他用户也有读权限，不安全</span></div><div class="line">-rw------- 1 root root 1679 Jul 15 23:47 /tmp/mykey2.private    <span class="comment"># 属主有读写权限</span></div><div class="line">-rw-r--r-- 1 root root  891 Jul 15 23:46 /tmp/mykey.private     <span class="comment"># 属组和其他用户也有读权限，不安全</span></div><div class="line"></div><div class="line">从私钥中提取公钥命令：</div><div class="line">[root@centos7 ~]<span class="comment"># openssl rsa -in /tmp/mykey2.private -pubout   </span></div><div class="line">writing RSA key</div><div class="line">-----BEGIN PUBLIC KEY-----</div><div class="line">MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEApmNrzbB1WNNINYL5OD3Z</div><div class="line">3M9Hmowf1ODIbaYC86dyxZE9XcUc8haPf0WU3yHX+o9oPhzDMiYXoTtYcqpJG4ez</div><div class="line">yCw45+euzH+N9OCOmHUSW5kSGKgj9K3r+SD90WDpKeV3dpuRjgIf7mIPJp0GaBm4</div><div class="line">NIECUkcB8vm6P4GQ1xsppeaVvz9ns5jL5f+w/Gn8VqHYwKwMb0tQGXXutCAq5fnR</div><div class="line">lgaXC6H0MOpmwVf/wuuE8vJpG/Qm6cIv+HGjPoDDZzp1GdDF8O/24fnlYHAZu6J+</div><div class="line">0HwPGqqXvMY+bXrI0PgsTRU34c/tKOmTvDDrUsifW+0f/2pbzvFulaAIZKVRIe1I</div><div class="line">0QIDAQAB</div><div class="line">-----END PUBLIC KEY-----</div></pre></td></tr></table></figure></p>
<h3 id="Openssl-创建CA和申请证书"><a href="#Openssl-创建CA和申请证书" class="headerlink" title="Openssl 创建CA和申请证书"></a>Openssl 创建CA和申请证书</h3><h4 id="★-创建CA"><a href="#★-创建CA" class="headerlink" title="★ 创建CA"></a>★ 创建CA</h4><p>◆ 数字证书的获取有两种方法：<br>☉向RA注册申请即公共信任的CA；<br>☉自己创建私有CA<br>&ensp;&ensp;&ensp;&ensp;openssl<br>&ensp;&ensp;&ensp;&ensp;OpenCA<br>◆ 使用OpenSSL创建私有CA的步骤：<br> 在确定配置为CA的服务上生成一个自签证书，并为CA提供所需要的目录及文件即可；<br> ①生成私钥；<br>&ensp;&ensp;&ensp;&ensp;私钥用于签发证书时，向证书添加数字签名使用；<br> ②生成自签署证书；<br>&ensp;&ensp;&ensp;&ensp;证书：每个通信方都导入此证书至“受信任的证书颁发机构”<br>◆ openssl配置文件：<br>&ensp;&ensp;&ensp;&ensp;/etc/pki/tls/openssl.cnf<br>☉工作目录：<br>&ensp;&ensp;&ensp;&ensp;/etc/pki/CA<br>◆ 具体步骤：<br>☉生成私钥文件/etc/pki/CA/private/cakey.pem<br>&ensp;&ensp;&ensp;&ensp;(umask 077;openssl genrsa -out /etc/pki/CA/private/cakey.pem 4096)<br>☉生成自签证书；<br>&ensp;&ensp;&ensp;&ensp;openssl req -new -x509 -key /etc/pki/CA/private/cakey.pem -out /etc/pki/CA/cacert.pem -days 3650<br>其中：<br>&ensp;&ensp;&ensp;&ensp;-new：生成新证书签署请求；<br>&ensp;&ensp;&ensp;&ensp;-x509：生成自签格式证书，专用于创建私有CA时；<br>&ensp;&ensp;&ensp;&ensp;-key：生成请求时用到的私有文件路径；<br>&ensp;&ensp;&ensp;&ensp;-days n：证书的有效时间，单位是day；<br>&ensp;&ensp;&ensp;&ensp;-out /PATH/TO/SOMECERTFILE：生成的请求证书路径；如果自签操作将直接生成签署过得证书<br>☉为CA提供所需的目录及文件<br>&ensp;&ensp;&ensp;&ensp;mkdir /etc/pki/CA/{certs,crl,newcerts} (存在的话就不用创建了)<br>&ensp;&ensp;&ensp;&ensp;touch /etc/pkl/CA/index.txt （数据库文件）<br>&ensp;&ensp;&ensp;&ensp;echo 01 &gt; /etc/pki/CA/serial （序列号文件并给明第一个证书的序列号码）</p>
<h4 id="★-给节点颁发证书"><a href="#★-给节点颁发证书" class="headerlink" title="★ 给节点颁发证书"></a>★ 给节点颁发证书</h4><p>◆ 给节点颁发证书<br>☉要用到证书进行安全通信的服务器，需要向CA请求签署证书；<br>☉在证书申请的主机上进行如下步骤：<br>&ensp;&ensp;&ensp;&ensp;生成私钥；<br>&ensp;&ensp;&ensp;&ensp;生成证书签署请求； （注意：默认国家，省，公司名称必须和CA一致）<br>&ensp;&ensp;&ensp;&ensp;将请求通过可靠方式发送给CA主机<br>☉在CA主机上签发证书<br>&ensp;&ensp;&ensp;&ensp;验证请求者信息；<br>&ensp;&ensp;&ensp;&ensp;签署证书;<br>&ensp;&ensp;&ensp;&ensp;把签署好的证书发还给请求者</p>
<h4 id="★-吊销证书"><a href="#★-吊销证书" class="headerlink" title="★ 吊销证书"></a>★ 吊销证书</h4><p>◆ 吊销证书<br>☉在客户端获取要吊销的证书的序列号serial；<br>&ensp;&ensp;&ensp;&ensp;openssl x509 -in httpd.crt -noout -serial -subject<br>☉在CA上，根据客户提交的serial与subject信息，对比检验是否与index.txt文件中的信息一致；<br>☉吊销证书；<br>&ensp;&ensp;&ensp;&ensp;openssl ca -revoke /etc/pki/CA/newcerts/SERIAL.pem<br>其中SERIAL要替换成证书真正的序列号<br>☉生成吊销证书的编号(第一次吊销证书时才需要执行)；<br>&ensp;&ensp;&ensp;&ensp;echo 01 &gt; /etc/pki/CA/crlnumber<br>☉更新证书吊销列表<br>&ensp;&ensp;&ensp;&ensp;openssl crl -gencrl -out THISCA.crl</p>
<h3 id="实验：创建私有CA并给节点颁发证书"><a href="#实验：创建私有CA并给节点颁发证书" class="headerlink" title="实验：创建私有CA并给节点颁发证书"></a>实验：创建私有CA并给节点颁发证书</h3><p>★ 创建私有CA步骤演示：<br>◆ 生成私钥文件/etc/pki/CA/private/cakey.pem<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">[root@centos7 ~]<span class="comment"># ls /etc/pki/CA/private/ -l</span></div><div class="line">total 0</div><div class="line">[root@centos7 ~]<span class="comment"># (umask 077;openssl genrsa -out /etc/pki/CA/private/cakey.pem 4096)    #生成私钥文件</span></div><div class="line">Generating RSA private key, 4096 bit long modulus</div><div class="line">............................................................................................................................................................................++</div><div class="line">.............++</div><div class="line">e is 65537 (0x10001)</div><div class="line">[root@centos7 ~]<span class="comment"># ls /etc/pki/CA/private/ -l</span></div><div class="line">total 4</div><div class="line">-rw------- 1 root root 3243 Jul 16 12:55 cakey.pem</div></pre></td></tr></table></figure></p>
<p>◆ 生成自签证书<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 生成自签证书指明私钥文件，证书保存路径，有效期限等</span></div><div class="line">[root@centos7 ~]<span class="comment"># openssl req -new -x509 -key /etc/pki/CA/private/cakey.pem -out /etc/pki/CA/cacert.pem -days 3650</span></div><div class="line">You are about to be asked to enter information that will be incorporated</div><div class="line">into your certificate request.</div><div class="line">What you are about to enter is what is called a Distinguished Name or a DN.</div><div class="line">There are quite a few fields but you can leave some blank</div><div class="line">For some fields there will be a default value,</div><div class="line">If you enter <span class="string">'.'</span>, the field will be left blank.</div><div class="line">-----</div><div class="line">Country Name (2 letter code) [XX]:CN     <span class="comment"># 所在国家</span></div><div class="line">State or Province Name (full name) []:Beijing     <span class="comment"># 所在省</span></div><div class="line">Locality Name (eg, city) [Default City]:Beijing   <span class="comment"># 所在城市</span></div><div class="line">Organization Name (eg, company) [Default Company Ltd]:Magedu    <span class="comment"># 组织（公司）名称</span></div><div class="line">Organizational Unit Name (eg, section) []:Ops    <span class="comment"># 所在岗位</span></div><div class="line">Common Name (eg, your name or your server<span class="string">'s hostname) []:ca.magedu.com     # 证书持有者姓名或请求证书服务器的主机名</span></div><div class="line">Email Address []:caadmin@magedu.com   # 邮件地址</div><div class="line"></div><div class="line">[root@centos7 ~]# ls /etc/pki/CA/ -l</div><div class="line">total 4</div><div class="line">-rw-rw----  1 root root 2114 Jul 16 13:01 cacert.pem         # 生成的自签证书</div><div class="line">drwxr-xr-x. 2 root root    6 Jun 29  2015 certs</div><div class="line">drwxr-xr-x. 2 root root    6 Jun 29  2015 crl</div><div class="line">drwxr-xr-x. 2 root root    6 Jun 29  2015 newcerts</div><div class="line">drwx------. 2 root root   22 Jul 16 12:55 private</div></pre></td></tr></table></figure></p>
<p>◆ 为CA提供所需的目录和文件<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 创建数据库文件</span></div><div class="line">[root@centos7 ~]<span class="comment"># touch /etc/pki/CA/index.txt</span></div><div class="line"><span class="comment"># 创建序列号文件并给明第一个证书的序列号码</span></div><div class="line">[root@centos7 ~]<span class="comment"># echo 01 &gt;/etc/pki/CA/serial</span></div><div class="line">[root@centos7 ~]<span class="comment"># ls /etc/pki/CA/</span></div><div class="line">cacert.pem  certs  crl  index.txt  newcerts  private  serial</div></pre></td></tr></table></figure></p>
<p>★ 给节点颁发证书步骤演示<br>假设CentOS 6为一个web服务器，要向客户端提供https服务就需要证书文件，并把请求发送给CA进行签署<br>◆ 在证书申请的主机上生成私钥<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">[root@centos6-lab ~]<span class="comment"># rpm -q httpd    # 这里以http服务为例</span></div><div class="line">httpd-2.2.15-39.el6.centos.x86_64</div><div class="line">[root@centos6-lab ~]<span class="comment"># cd /etc/httpd</span></div><div class="line">[root@centos6-lab httpd]<span class="comment"># ls</span></div><div class="line">conf  conf.d  logs  modules  run</div><div class="line">[root@centos6-lab httpd]<span class="comment"># mkdir ssl    # 在文件中创建ssl目录</span></div><div class="line">[root@centos6-lab httpd]<span class="comment"># cd ssl       # 在此目录中生成私钥</span></div><div class="line"><span class="comment"># 注意这里不是在 /etc/pki/CA下创建，只有作为CA时才在其下进行创建</span></div><div class="line">[root@centos6-lab ssl]<span class="comment"># (umask 077;openssl genrsa -out httpd.key 2048) </span></div><div class="line">Generating RSA private key, 2048 bit long modulus</div><div class="line">............+++</div><div class="line">...................................................+++</div><div class="line">e is 65537 (0x10001)</div><div class="line">[root@centos6-lab ssl]<span class="comment"># ll</span></div><div class="line">total 4</div><div class="line">-rw-------. 1 root root 1679 Jul 15 21:47 httpd.key      <span class="comment"># 生成的私钥文件</span></div></pre></td></tr></table></figure></p>
<p>◆ 生成证书签署请求<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">[root@centos6-lab ssl]<span class="comment"># openssl req -new -key httpd.key -out httpd.csr -days 365</span></div><div class="line">You are about to be asked to enter information that will be incorporated</div><div class="line">into your certificate request.</div><div class="line">What you are about to enter is what is called a Distinguished Name or a DN.</div><div class="line">There are quite a few fields but you can leave some blank</div><div class="line">For some fields there will be a default value,</div><div class="line">If you enter <span class="string">'.'</span>, the field will be left blank.</div><div class="line">-----</div><div class="line">Country Name (2 letter code) [XX]:CN</div><div class="line">State or Province Name (full name) []:Beijing</div><div class="line">Locality Name (eg, city) [Default City]:Beijing</div><div class="line">Organization Name (eg, company) [Default Company Ltd]:Magedu</div><div class="line">Organizational Unit Name (eg, section) []:Ops</div><div class="line">Common Name (eg, your name or your server<span class="string">'s hostname) []:CentOS.magedu.com</span></div><div class="line">Email Address []:webmaster@magedu.com</div><div class="line"></div><div class="line">Please enter the following 'extra<span class="string">' attributes</span></div><div class="line">to be sent with your certificate request</div><div class="line">A challenge password []:jack</div><div class="line">An optional company name []:jack</div></pre></td></tr></table></figure></p>
<p>◆ 把请求发送给CA<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 这里使用scp 远程复制命令</span></div><div class="line">[root@centos6-lab ssl]<span class="comment"># scp httpd.csr root@192.168.2.140:/tmp</span></div><div class="line">The authenticity of host <span class="string">'192.168.2.140 (192.168.2.140)'</span> can<span class="string">'t be established.</span></div><div class="line">RSA key fingerprint is 2c:c7:3a:51:f6:2f:f4:57:c3:a2:14:ad:0f:34:e3:01.</div><div class="line">Are you sure you want to continue connecting (yes/no)? yes</div><div class="line">Warning: Permanently added '192.168.2.140<span class="string">' (RSA) to the list of known hosts.</span></div><div class="line">root@192.168.2.140's password: </div><div class="line">httpd.csr                                                         100% 1119     1.1KB/s   00:00</div><div class="line">[root@centos7 ~]<span class="comment"># ls /tmp -l</span></div><div class="line">total 2044</div><div class="line">-rw-r--r--  1 root root     188 Jul  9 23:17 fstab.new</div><div class="line">-rw-r--r--  1 root root    1119 Jul 16 13:17 httpd.csr           <span class="comment"># 申请主机发送过来的文件</span></div><div class="line">-rw-r--r--. 1 root root 2068080 Jul 16 12:59 meminfo.txt</div><div class="line">-rw-r--r--  1 root root     887 Jul 15 23:46 mykey1.private</div><div class="line">-rw-------  1 root root    1679 Jul 15 23:47 mykey2.private</div><div class="line">-rw-r--r--  1 root root     891 Jul 15 23:46 mykey.private</div></pre></td></tr></table></figure></p>
<p>◆ CA签发证书<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 签发证书，-in指明要签的证书文件位置，-out指明签好后输出的文件位置，必须放在certs下，指明期限</span></div><div class="line">[root@centos7 ~]<span class="comment"># openssl ca -in /tmp/httpd.csr -out /etc/pki/CA/certs/http.crt -days 365</span></div><div class="line">Using configuration from /etc/pki/tls/openssl.cnf</div><div class="line">Check that the request matches the signature</div><div class="line">Signature ok</div><div class="line">Certificate Details:</div><div class="line">        Serial Number: 1 (0x1)</div><div class="line">        Validity</div><div class="line">            Not Before: Jul 16 05:21:20 2017 GMT</div><div class="line">            Not After : Jul 16 05:21:20 2018 GMT</div><div class="line">        Subject:</div><div class="line">            countryName               = CN</div><div class="line">            stateOrProvinceName       = Beijing</div><div class="line">            organizationName          = Magedu</div><div class="line">            organizationalUnitName    = Ops</div><div class="line">            commonName                = CentOS.magedu.com</div><div class="line">            emailAddress              = webmaster@magedu.com</div><div class="line">        X509v3 extensions:</div><div class="line">            X509v3 Basic Constraints: </div><div class="line">                CA:FALSE</div><div class="line">            Netscape Comment: </div><div class="line">                OpenSSL Generated Certificate</div><div class="line">            X509v3 Subject Key Identifier: </div><div class="line">                E7:A3:63:D3:3B:6F:C5:5D:82:EC:19:56:DC:75:7E:34:CC:D9:74:E3</div><div class="line">            X509v3 Authority Key Identifier: </div><div class="line">                keyid:5D:DC:87:F9:83:8A:34:66:56:64:69:D1:9E:74:FB:27:33:63:B4:35</div><div class="line"></div><div class="line">Certificate is to be certified until Jul 16 05:21:20 2018 GMT (365 days)</div><div class="line">Sign the certificate? [y/n]:y</div><div class="line"></div><div class="line"></div><div class="line">1 out of 1 certificate requests certified, commit? [y/n]y</div><div class="line">Write out database with 1 new entries</div><div class="line">Data Base Updated</div><div class="line"></div><div class="line">[root@centos7 ~]<span class="comment"># cd /etc/pki/CA/</span></div><div class="line">[root@centos7 CA]<span class="comment"># ls</span></div><div class="line">cacert.pem  crl        index.txt.attr  newcerts  serial</div><div class="line">certs       index.txt  index.txt.old   private   serial.old</div><div class="line">[root@centos7 CA]<span class="comment"># cat index.txt  # 可以看到第一个签署的证书编号为01</span></div><div class="line">V	180716052120Z		01	unknown	/C=CN/ST=Beijing/O=Magedu/OU=Ops/CN=CentOS.magedu.com/emailAddress=webmaster@magedu.com</div></pre></td></tr></table></figure></p>
<p>◆ 把签署好的证书发还给请求者<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[root@centos7 CA]<span class="comment"># scp certs/http.crt root@192.168.2.142:/etc/httpd/ssl</span></div><div class="line">The authenticity of host <span class="string">'192.168.2.142 (192.168.2.142)'</span> can<span class="string">'t be established.</span></div><div class="line">RSA key fingerprint is 29:55:bf:ba:36:a6:89:2e:47:45:5e:3c:32:30:43:4d.</div><div class="line">Are you sure you want to continue connecting (yes/no)? yes</div><div class="line">Warning: Permanently added '192.168.2.142<span class="string">' (RSA) to the list of known hosts.</span></div><div class="line">root@192.168.2.142's password: </div><div class="line">http.crt                                                          100% 5886     5.8KB/s   00:00</div></pre></td></tr></table></figure></p>
<p>◆ 请求者查看证书<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 请求者收到后查看</span></div><div class="line">[root@centos6-lab ssl]<span class="comment"># ls -l</span></div><div class="line">total 16</div><div class="line">-rw-r-----. 1 root root 5886 Jul 15 22:02 http.crt</div><div class="line">-rw-r--r--. 1 root root 1119 Jul 15 21:51 httpd.csr</div><div class="line">-rw-------. 1 root root 1679 Jul 15 21:47 httpd.key</div><div class="line">[root@centos6-lab ssl]<span class="comment"># rm -rf httpd.csr    # 没用的文件就可以删除了</span></div><div class="line">[root@centos6-lab ssl]<span class="comment"># openssl x509 -in http.crt -noout -serial -subject    # 查看序列号和主题</span></div><div class="line">serial=01</div><div class="line">subject= /C=CN/ST=Beijing/O=Magedu/OU=Ops/CN=CentOS.magedu.com/emailAddress=webmaster@magedu.com</div></pre></td></tr></table></figure></p>
<h3 id="CA总结："><a href="#CA总结：" class="headerlink" title="CA总结："></a>CA总结：</h3><p><img src="\images\CA.png" alt="CA"></p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color2">加密解密、数字签名、SSL、CA</a>
        		</li>
      		
		</ul>
	</div>

      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/2017/07/15/加密-解密-数字签名-SSL-CA/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>





  
    <article id="post-linux文本处理工具三剑客之awk" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/07/10/linux文本处理工具三剑客之awk/">Linux三剑客之gawk</a>
    </h1>
  

        
        <a href="/2017/07/10/linux文本处理工具三剑客之awk/" class="archive-article-date">
  	<time datetime="2017-07-10T02:50:22.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2017-07-10</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="本章内容："><a href="#本章内容：" class="headerlink" title="本章内容："></a>本章内容：</h3><p>◆ awk介绍<br>◆ awk基本用法<br>◆ awk变量<br>◆ awk格式化<br>◆ awk操作符<br>◆ awk条件判断<br>◆ awk循环<br>◆ awk数组<br>◆ awk函数<br>◆ 调用系统命令</p>
<h3 id="AWK介绍"><a href="#AWK介绍" class="headerlink" title="AWK介绍"></a>AWK介绍</h3><p>★ Linux 文本处理工具三剑客:<br>grep、sed、awk。其中grep是一种文本过滤工具；sed是文本行编辑器，而awk是一种报表生成器，就是对文件进行格式化处理的，但这里的格式化不是文件系统的格式化，而是对文件内容进行各种“排版”，进而格式化显示；<br>&ensp;&ensp;&ensp;&ensp;◆grep，egrep，fgrep：文本过滤工具：partten<br>&ensp;&ensp;&ensp;&ensp;◆sed：行编辑器；模式空间、保持空间<br>&ensp;&ensp;&ensp;&ensp;◆awk：报告生成器，格式化文本输出；</p>
<p>★ Linux之上GUN awk:<br>GNU awk 简称gawk，并且gawk就是awk的链接文件，因此系统上使用的awk和gawk是一样的。我们通过man<br>gawk可以获得gawk的相关功能说明—gawk-pattern scanning and processing language（模式扫描及处理语言），gawk是一种过程式编程语言。gawk还支持条件判断、数组、循环等编程语言中所有可以使用的功能，因此还可以把gawk称为一种脚本语言解释器。<br>&ensp;&ensp;&ensp;&ensp;◆AWK(Aho, Weinberger, Kernighan)三个人名字首字母缩写，报告生成器，格式化文本输出;<br>&ensp;&ensp;&ensp;&ensp;◆有多种版本：New awk（nawk），GNU awk（gawk）;<br>&ensp;&ensp;&ensp;&ensp;◆gawk：模式扫描和处理语言;</p>
<h3 id="AWK基本用法"><a href="#AWK基本用法" class="headerlink" title="AWK基本用法"></a>AWK基本用法</h3><p>★ 用法格式：<br>&ensp;&ensp;&ensp;&ensp;awk [options] ‘program’ var=value file…<br>&ensp;&ensp;&ensp;&ensp;awk [options] -f programfile var=value file…<br>&ensp;&ensp;&ensp;&ensp;awk [options] ‘BEGIN{ action;… } pattern{ action;… } END{ action;… }’ file …<br>◆ awk程序组成：<br>&ensp;&ensp;&ensp;&ensp;awk程序通常由：BEGIN语句块、能够使用模式匹配的通用语句块、END语句块，共3部分组成</p>
<p>★ 用法说明：<br>◆ 基本格式：awk [options] ‘program’ file…<br>◆ program（编程语言）：PATTERN{ACTION STATEMENT;..}，通常是在单引号和双引号中；<br>&ensp;&ensp;&ensp;&ensp;PARTTERN： 模式；部分决定动作语句何时触发及触发事件（BEGIN,END）<br>&ensp;&ensp;&ensp;&ensp;ACTION STATEMENT：动作语句，可以由多个语句组成，各语句之间使用分号分隔：如print，printf<br>◆ options（选项）：<br>&ensp;&ensp;&ensp;&ensp;-F：指明输入时用到的字段分隔符；<br>&ensp;&ensp;&ensp;&ensp;-v var=value: 自定义变量<br>◆ 分割符、域和记录<br>&ensp;&ensp;&ensp;&ensp;awk执行时，由分隔符分隔的字段（域）；标记$1,$2..$n称为域标识。$0为所有域，注意：和shell中变量$符含义不同<br>&ensp;&ensp;&ensp;&ensp;文件的每一行称为记录<br>&ensp;&ensp;&ensp;&ensp;省略action，则默认执行print $0 的操作。</p>
<p>★ awk工作原理<br>&ensp;&ensp;&ensp;&ensp;awk在处理文本时也是一次读取一行文本，然后根据输入分隔符（默认为空格字符）进行切片，切成n个片段，然后将每一片都赋予awk内部的一个变量当中进行保存，这些变量名为$1,$2,$3…等等一直到最后一个，awk就可以对这些片段进行单独处理，比如显示某一段，特定段，甚至可以对某些片段进行额外的的加工处理，比如计数、运算等。<br>◆ 具体工作原理如下：<br>&ensp;&ensp;&ensp;&ensp;第一步：执行BEGIN{action;… }语句块中的语句；<br>&ensp;&ensp;&ensp;&ensp;第二步：从文件或标准输入(stdin)读取一行，然后执行pattern{ action;… };语句块，它逐行扫描文件，从第一行到最后一行重复这个过程，直到文件全部被读取完毕。<br>&ensp;&ensp;&ensp;&ensp;第三步：当读至输入流末尾时，执行END{action;…}语句块<br>&ensp;&ensp;&ensp;&ensp;BEGIN语句块在awk开始从输入流中读取行之前被执行，这是一个可选的语句块，比如变量初始化、打印输出表格的表头等语句通常可以写在BEGIN语句块中<br>&ensp;&ensp;&ensp;&ensp;END语句块在awk从输入流中读取完所有的行之后即被执行，比如打印所有行的分析结果这类信息汇总都是在END语句块中完成，它也是一个可选语句块<br>&ensp;&ensp;&ensp;&ensp;pattern语句块中的通用命令是最重要的部分，也是可选的。如果没有提供pattern语句块，则默认执行{ print }，即打印每一个读取到的行，awk读取的每一行都会执行该语句块。</p>
<p>★ 演示：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">[root@centos7 ~]<span class="comment"># tail -2 /etc/fstab</span></div><div class="line">UUID=224a4923<span class="_">-a</span>78d-4bde-b962-aa921a15db50 /boot                   xfs     defaults        0 0</div><div class="line">UUID=3f6338ab-2c10-422c-9a5c-6a783c5795e8 swap                    swap    defaults        0 0</div><div class="line">[root@centos7 ~]<span class="comment"># tail -2 /etc/fstab|awk '&#123;print $2,$3&#125;'</span></div><div class="line">/boot xfs</div><div class="line">swap swap</div><div class="line">[root@centos7 ~]<span class="comment"># tail -2 /etc/fstab|awk '&#123;print "Hello",$2,$3&#125;'</span></div><div class="line">Hello /boot xfs</div><div class="line">Hello swap swap</div></pre></td></tr></table></figure></p>
<p>★ 输出命令：print<br>◆ print格式：print item1, item2, …<br>☉ 要点：<br>&ensp;&ensp;&ensp;&ensp;逗号(,)分隔符；<br>&ensp;&ensp;&ensp;&ensp;输出的各item可以是字符串，也可以是数值、当前记录的字段、变量或awk的表达式；<br>&ensp;&ensp;&ensp;&ensp;如省略item，相当于print $0 </p>
<p>★ 演示：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line">[root@centos7 ~]<span class="comment"># awk '&#123;print "Hello,awk"&#125;'  #不管你输出什么只打印</span></div><div class="line">adgg</div><div class="line">Hello,awk</div><div class="line">agaj</div><div class="line">Hello,awk</div><div class="line">ljlj</div><div class="line">Hello,awk</div><div class="line"></div><div class="line">[root@centos7 ~]<span class="comment"># awk '&#123;print&#125;' /etc/passwd  #打印出/etc/passwd中每一行</span></div><div class="line">root:x:0:0:root:/root:/bin/bash</div><div class="line">bin:x:1:1:bin:/bin:/sbin/nologin</div><div class="line">daemon:x:2:2:daemon:/sbin:/sbin/nologin</div><div class="line">adm:x:3:4:adm:/var/adm:/sbin/nologin</div><div class="line">lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin</div><div class="line">sync:x:5:0:sync:/sbin:/bin/sync</div><div class="line"></div><div class="line">[root@centos7 ~]<span class="comment"># awk -F: '&#123;print "jack"&#125;' /etc/passwd #/etc/passwd中每一行输入进行后都打印成jack</span></div><div class="line">jack</div><div class="line">jack</div><div class="line">jack</div><div class="line">jack</div><div class="line"></div><div class="line">[root@centos7 ~]<span class="comment"># awk -F: '&#123;print $1&#125;' /etc/passwd #以:为分隔符，打印每一行的第一个字段</span></div><div class="line">root</div><div class="line">bin</div><div class="line">daemon</div><div class="line">adm</div><div class="line"></div><div class="line">[root@centos7 ~]<span class="comment"># awk -F: '&#123;print "Hello",$1&#125;' /etc/passwd #自己加一个字段，且打印出每一个字段</span></div><div class="line">Hello root</div><div class="line">Hello bin</div><div class="line">Hello daemon</div><div class="line">Hello adm</div><div class="line"></div><div class="line">[root@centos7 ~]<span class="comment"># awk -F: '&#123;print $1"\t"$3&#125;' /etc/passwd  #可以用其它分隔符显示，但指定的分隔符要要双引号</span></div><div class="line">root	0</div><div class="line">bin	1</div><div class="line">daemon	2</div><div class="line">adm	3</div><div class="line">lp	4</div><div class="line">sync	5</div></pre></td></tr></table></figure></p>
<h3 id="awk变量"><a href="#awk变量" class="headerlink" title="awk变量"></a>awk变量</h3><p>★ 内置和自定义变量<br>★ 内置变量<br> ◆FS：输入字段分隔符，默认为空白字符<br>&ensp;&ensp;&ensp;&ensp;awk -v FS=’:’  ‘{print $1,$3,$7}’ /etc/passwd<br>&ensp;&ensp;&ensp;&ensp;awk –F: ‘{print $1,$3,$7}’ /etc/passwd<br> ◆OFS：输出字段分隔符，默认为空白字符<br>&ensp;&ensp;&ensp;&ensp;awk -v FS=’:’ -v OFS=’:’ ‘{print $1,$2,$3}’ /etc/passwd<br> ◆RS：输入记录分隔符，指定输入时的换行符，原换行符仍有效<br>&ensp;&ensp;&ensp;&ensp;awk -v RS=’ ‘ ‘{print }’ /etc/passwd<br> ◆ORS：输出记录分隔符，输出时用指定符号代替换行符<br>&ensp;&ensp;&ensp;&ensp;awk-v RS=’ ‘ -v ORS=’###’‘{print }’ /etc/passwd<br> ◆NF：字段数量<br>&ensp;&ensp;&ensp;&ensp;awk -F：‘{print NF}’ /etc/fstab, 引用内置变量不用$<br>&ensp;&ensp;&ensp;&ensp;awk -F: ‘{print $(NF-1)}’ /etc/passwd<br> ◆NR：行号<br>&ensp;&ensp;&ensp;&ensp;awk ‘{print NR}’ /etc/fstab; awk END’{print NR}’ /etc/fstab<br> ◆FNR：各文件分别计数,行号<br>&ensp;&ensp;&ensp;&ensp;awk ‘{print FNR}’ /etc/fstab /etc/inittab<br> ◆FILENAME：当前文件名<br>&ensp;&ensp;&ensp;&ensp;awk ‘{print FILENAME}’ /etc/fstab<br> ◆ARGC：命令行参数的个数<br>&ensp;&ensp;&ensp;&ensp;awk ‘{print ARGC}’ /etc/fstab /etc/inittab<br>&ensp;&ensp;&ensp;&ensp;awk ‘BEGIN {print ARGC}’ /etc/fstab /etc/inittab<br> ◆ARGV：数组，保存的是命令行所给定的各参数<br>&ensp;&ensp;&ensp;&ensp;awk ‘BEGIN {print ARGV[0]}’ /etc/fstab /etc/inittab<br>&ensp;&ensp;&ensp;&ensp;awk ‘BEGIN {print ARGV[1]}’ /etc/fstab /etc/inittab<br>★ 自定义变量<br>◆-v var=value<br>变量名区分字符大小写<br>◆在program中直接定义<br>&ensp;&ensp;&ensp;&ensp;awk -v test=’hello gawk’ ‘{print test}’ /etc/fstab<br>&ensp;&ensp;&ensp;&ensp;awk -v test=’hello gawk’ ‘BEGIN{print test}’<br>&ensp;&ensp;&ensp;&ensp;awk’BEGIN{test=”hello,gawk”;print test}’</p>
<p>★ 演示：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div></pre></td><td class="code"><pre><div class="line">[root@centos7 ~]<span class="comment"># awk -F: -v OFS='=&gt;' '&#123;print $1,$3,$7&#125;' /etc/passwd  #指明输入，输出分隔符</span></div><div class="line">root=&gt;0=&gt;/bin/bash</div><div class="line">bin=&gt;1=&gt;/sbin/nologin</div><div class="line">daemon=&gt;2=&gt;/sbin/nologin</div><div class="line">adm=&gt;3=&gt;/sbin/nologin</div><div class="line"></div><div class="line">[root@centos7 ~]<span class="comment"># awk -v ORS='@@' '&#123;print&#125;' /etc/passwd  #指明输出时的换行符</span></div><div class="line">root:x:0:0:root:/root:/bin/bash@@bin:x:1:1:bin:/bin:/sbin/nologin@@daemon:x:2:2:daemon:/sbin:</div><div class="line"></div><div class="line">[root@centos7 ~]<span class="comment"># awk -F: '&#123;print NF&#125;' /etc/passwd  #以：为分隔符，打印每一行的字段数量</span></div><div class="line">7</div><div class="line">7</div><div class="line">7</div><div class="line"></div><div class="line">[root@centos7 ~]<span class="comment"># awk -F: '&#123;print $NF&#125;' /etc/passwd #这里的$NF表示最后一个字段，所以打印出最后一个字段</span></div><div class="line">/bin/bash</div><div class="line">/sbin/nologin</div><div class="line">/sbin/nologin</div><div class="line">/sbin/nologin</div><div class="line"></div><div class="line">[root@centos7 ~]<span class="comment"># awk '&#123;print NR&#125;' /etc/passwd  #显示/etc/passwd文件内容的行号</span></div><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line"></div><div class="line">[root@centos7 ~]<span class="comment"># awk '&#123;print FNR&#125;' /etc/fstab /etc/issue  #如果后面跟多个文件的话，要想显示每个文件的行数，变量为FNR，如果不加F，则行号累加</span></div><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line"></div><div class="line">[root@centos7 ~]<span class="comment"># awk END'&#123;print NR&#125;' /etc/fstab    #显示最后一行的行号</span></div><div class="line">11</div><div class="line">[root@centos7 ~]<span class="comment"># awk END'&#123;print FNR&#125;' /etc/fstab /etc/issue</span></div><div class="line">3</div><div class="line">[root@centos7 ~]<span class="comment"># awk END'&#123;print NR&#125;' /etc/fstab /etc/issue   #显示两个文件行累加最后一行的行号</span></div><div class="line">14</div><div class="line">[root@centos7 ~]<span class="comment"># awk 'END &#123;print NR&#125;' /etc/fstab /etc/issue</span></div><div class="line">14</div><div class="line"></div><div class="line">[root@centos7 ~]<span class="comment"># awk '&#123;print FILENAME&#125;' /etc/passwd  #显示当前文件名</span></div><div class="line">/etc/passwd</div><div class="line">/etc/passwd</div><div class="line">/etc/passwd</div><div class="line"></div><div class="line">[root@centos7 ~]<span class="comment"># awk '&#123;print ARGC&#125;' /etc/fstab    #显示命令行参数个数，但会输入的每行都会显示一遍</span></div><div class="line">2</div><div class="line">2</div><div class="line">2</div><div class="line">[root@centos7 ~]<span class="comment"># awk '&#123;print ARGC&#125;' /etc/fstab /etc/issue</span></div><div class="line">3</div><div class="line">3</div><div class="line">3</div><div class="line">[root@centos7 ~]<span class="comment"># awk BEGIN'&#123;print ARGC&#125;' /etc/fstab /etc/issue   #只显示一次命令行参数个数</span></div><div class="line">3</div><div class="line">[root@centos7 ~]<span class="comment"># awk 'BEGIN&#123;print ARGC&#125;' /etc/fstab /etc/issue</span></div><div class="line">3</div><div class="line"></div><div class="line">[root@centos7 ~]<span class="comment"># awk 'BEGIN&#123;print ARGV[0]&#125;' /etc/fstab /etc/issue   #数组，显示的是命令行的第几个参数</span></div><div class="line">awk</div><div class="line">[root@centos7 ~]<span class="comment"># awk 'BEGIN&#123;print ARGV[1]&#125;' /etc/fstab /etc/issue</span></div><div class="line">/etc/fstab</div><div class="line">[root@centos7 ~]<span class="comment"># awk 'BEGIN&#123;print ARGV[2]&#125;' /etc/fstab /etc/issue</span></div><div class="line">/etc/issue</div></pre></td></tr></table></figure></p>
<p>★ 自定义变量演示：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">[root@centos7 ~]<span class="comment"># awk -v test='Hello,awk' '&#123;print test&#125;' /etc/issue</span></div><div class="line">Hello,awk</div><div class="line">Hello,awk</div><div class="line">Hello,awk</div><div class="line">[root@centos7 ~]<span class="comment"># awk -v test='Hello,awk' 'BEGIN&#123;print test&#125;' /etc/issue</span></div><div class="line">Hello,awk</div><div class="line">[root@centos7 ~]<span class="comment"># awk 'BEGIN&#123;test="Hello,awk";print test&#125;'</span></div><div class="line">Hello,awk</div></pre></td></tr></table></figure></p>
<p>★ 输出命令：printf<br>◆ 格式化输出：printf“FORMAT”, item1, item2, …<br>&ensp;&ensp;&ensp;&ensp;必须指定FORMAT；<br>&ensp;&ensp;&ensp;&ensp;不会自动换行，需要显式给出换行控制符，\n；<br>&ensp;&ensp;&ensp;&ensp;FORMAT中需要分别为后面每个item指定格式符；<br>◆ 格式符：与item一一对应<br>&ensp;&ensp;&ensp;&ensp;%c：显示字符的ASCII码；<br>&ensp;&ensp;&ensp;&ensp;%d, %i：显示十进制整数；<br>&ensp;&ensp;&ensp;&ensp;%e, %E：科学计数法数值显示；<br>&ensp;&ensp;&ensp;&ensp;%f：显示为浮点数；<br>&ensp;&ensp;&ensp;&ensp;%g, %G：以科学计数法或浮点形式显示数值；<br>&ensp;&ensp;&ensp;&ensp;%s：显示字符串；<br>&ensp;&ensp;&ensp;&ensp;%u：无符号整数；<br>&ensp;&ensp;&ensp;&ensp;%%： 显示%自身；<br>◆ 修饰符：<br>&ensp;&ensp;&ensp;&ensp;#[.#]：第一个数字控制显示的宽度；第二个#表示小数点后精度，%3.1f<br>&ensp;&ensp;&ensp;&ensp;-：左对齐（默认右对齐）%-15s<br>&ensp;&ensp;&ensp;&ensp;+：显示数值的正负符号%+d</p>
<p>★ 演示：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">%s%s%s%[root@centos7 ~]<span class="comment"># awk -F: '&#123;printf "%s",$1&#125;' /etc/passwd  #把第一个字段的内容以字符串的形式成行显示出来</span></div><div class="line">rootbindaemonadmlpsyncshutdownhaltmailoperatorgamesftpnobodyavahi-autoipdsystemd-bus-proxysystemd-networkdbuspolkitdabrttsspostfixsshdgentoouser1user2jackzmjtcpdumpuseruser100user101user102user103user104user105user106user107user108user109user110abc1abc2abc3abc4abc5abc6abc7abc8ab2</div><div class="line"></div><div class="line">[root@centos7 ~]<span class="comment"># awk -F: '&#123;printf "%s\n",$1&#125;' /etc/passwd  #以换行的方式显示</span></div><div class="line">root</div><div class="line">bin</div><div class="line">daemon</div><div class="line"></div><div class="line">[root@centos7 ~]<span class="comment"># awk -F: '&#123;printf "Username: %s\n",$1&#125;' /etc/passwd  #添加字符串显示</span></div><div class="line">Username: root</div><div class="line">Username: bin</div><div class="line">Username: daemon</div><div class="line"></div><div class="line"><span class="comment">#格式和条目片段是对应的，每个片段会套在其对应的格式上</span></div><div class="line">[root@centos7 ~]<span class="comment"># awk -F: '&#123;printf "Username:%s UID:%d\n",$1,$3&#125;' /etc/passwd  </span></div><div class="line">Username:root UID:0</div><div class="line">Username:bin UID:1</div><div class="line">Username:daemon UID:2</div><div class="line"></div><div class="line"><span class="comment"># 添加修饰符，显示宽度为15字符，默认为右对齐</span></div><div class="line">[root@centos7 ~]<span class="comment"># awk -F: '&#123;printf "Username:%15s UID:%d\n",$1,$3&#125;' /etc/passwd</span></div><div class="line">Username:           root UID:0</div><div class="line">Username:            bin UID:1</div><div class="line">Username:         daemon UID:2</div><div class="line"></div><div class="line"><span class="comment"># 左对齐方式显示</span></div><div class="line">[root@centos7 ~]<span class="comment"># awk -F: '&#123;printf "Username:%-15s UID:%d\n",$1,$3&#125;' /etc/passwd</span></div><div class="line">Username:root            UID:0</div><div class="line">Username:bin             UID:1</div><div class="line">Username:daemon          UID:2</div></pre></td></tr></table></figure></p>
<h3 id="操作符"><a href="#操作符" class="headerlink" title="操作符"></a>操作符</h3><p>★ 算数操作符：<br>&ensp;&ensp;&ensp;&ensp;x+y, x-y, x<em>y, x/y, x^y（x的y次方）, x%y<br>&ensp;&ensp;&ensp;&ensp;-x：转换为负数；<br>&ensp;&ensp;&ensp;&ensp;+x：转换为数值；<br>★ 字符串操作符：<br>&ensp;&ensp;&ensp;&ensp;没有符号的操作符，字符串连接；<br>★ 赋值操作符：<br>&ensp;&ensp;&ensp;&ensp;=, +=, -=, </em>=, /=, %=, ^=<br>&ensp;&ensp;&ensp;&ensp;++, –<br>★ 比较操作符：<br>&ensp;&ensp;&ensp;&ensp;&gt;, &gt;=, &lt;, &lt;=, !=, ==<br>★ 模式匹配符：<br>&ensp;&ensp;&ensp;&ensp;~：左边是否和右边匹配包含<br>&ensp;&ensp;&ensp;&ensp;!~：是否不匹配<br>◆ 示例：<br>&ensp;&ensp;&ensp;&ensp;cat /etc/passwd |awk ‘$0 ~ /root/‘ |wc -l<br>&ensp;&ensp;&ensp;&ensp;cat /etc/passwd |awk ‘$0 !~ /root/‘ |wc -l<br>★ 逻辑操作符：<br>&ensp;&ensp;&ensp;&ensp;&amp;&amp;，||，!<br>◆ 示例：<br>&ensp;&ensp;&ensp;&ensp;awk –F: ‘$3&gt;=0 &amp;&amp; $3&lt;=1000 {print $1}’ /etc/passwd<br>&ensp;&ensp;&ensp;&ensp;awk -F: ‘$3 ==0 || $3&gt;=1000 {print $1}’ /etc/passwd<br>&ensp;&ensp;&ensp;&ensp;awk -F: ‘!($3==0){print $1}’ /etc/passwd<br>&ensp;&ensp;&ensp;&ensp;awk -F: ‘!($3&gt;=500) {print $3}}’ /etc/passwd<br>★ 函数调用：<br>&ensp;&ensp;&ensp;&ensp;function_name(argu1, argu2, …)<br>★ 条件表达式：<br>&ensp;&ensp;&ensp;&ensp;selector?if-true-expression:if-false-expression</p>
<p>★ 演示：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 显示用户的UID如果大等于1000则为普通用户，否则为管理员或系统用户，并定义格式输出</span></div><div class="line">[root@centos7 ~]<span class="comment"># awk -F: '&#123;$3&gt;=1000?usertype="Common User":usertype="Sysadmin or SysUser";printf"%15s:%-s\n",$1,usertype&#125;' /etc/passwd</span></div><div class="line">           root:Sysadmin or SysUser</div><div class="line">            bin:Sysadmin or SysUser</div><div class="line">         daemon:Sysadmin or SysUser</div><div class="line">            adm:Sysadmin or SysUser</div><div class="line">             lp:Sysadmin or SysUser</div><div class="line">           sync:Sysadmin or SysUser</div><div class="line">       shutdown:Sysadmin or SysUser</div><div class="line">           halt:Sysadmin or SysUser</div><div class="line">           mail:Sysadmin or SysUser</div><div class="line">       operator:Sysadmin or SysUser</div><div class="line">          games:Sysadmin or SysUser</div><div class="line">            ftp:Sysadmin or SysUser</div><div class="line">         nobody:Sysadmin or SysUser</div><div class="line">  avahi-autoipd:Sysadmin or SysUser</div><div class="line">systemd-bus-proxy:Sysadmin or SysUser</div><div class="line">systemd-network:Sysadmin or SysUser</div><div class="line">           dbus:Sysadmin or SysUser</div><div class="line">        polkitd:Sysadmin or SysUser</div><div class="line">           abrt:Sysadmin or SysUser</div><div class="line">            tss:Sysadmin or SysUser</div><div class="line">        postfix:Sysadmin or SysUser</div><div class="line">           sshd:Sysadmin or SysUser</div><div class="line">         gentoo:Common User</div><div class="line">          user1:Common User</div><div class="line">          user2:Common User</div><div class="line">           jack:Common User</div><div class="line">            zmj:Common User</div></pre></td></tr></table></figure></p>
<h3 id="模式：pattern"><a href="#模式：pattern" class="headerlink" title="模式：pattern"></a>模式：pattern</h3><p>PATTERN:根据pattern条件，过滤匹配的行，再做处理<br>★ 如果未指定：<br>&ensp;&ensp;&ensp;&ensp;空模式，匹配每一行<br>★ /regular expression/：仅处理能够模式匹配到的行，需要用/ /括起来；<br>&ensp;&ensp;&ensp;&ensp;awk ‘/^UUID/{print $1}’ /etc/fstab<br>&ensp;&ensp;&ensp;&ensp;awk ‘!/^UUID/{print $1}’ /etc/fstab<br>★ relational expression: 关系表达式；<br>结果有“真”有“假”；结果为“真”才会被处理；<br>&ensp;&ensp;&ensp;&ensp;真：结果为非0值，非空字符串；<br>&ensp;&ensp;&ensp;&ensp;假：结果为空字符串；<br>★ line ranges：行范围<br>startline,endline：/pat1/,/pat2/不支持直接给出数字格式<br>&ensp;&ensp;&ensp;&ensp;awk -F: ‘/^root/,/^nobody/{print $1}’ /etc/passwd<br>&ensp;&ensp;&ensp;&ensp;awk -F: ‘(NR&gt;=2&amp;&amp;NR&lt;=10){print $1}’ /etc/passwd<br>★ BEGIN/END 模式<br>&ensp;&ensp;&ensp;&ensp;BEGIN{}: 仅在开始处理文件中的文本之前执行一次<br>&ensp;&ensp;&ensp;&ensp;END{}：仅在文本处理完成之后执行一次<br>★ 演示：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 处理模式匹配到的内容</span></div><div class="line">[root@centos7 ~]<span class="comment"># awk '/^UUID/&#123;print $1&#125;' /etc/fstab</span></div><div class="line">UUID=224a4923<span class="_">-a</span>78d-4bde-b962-aa921a15db50</div><div class="line">UUID=3f6338ab-2c10-422c-9a5c-6a783c5795e8</div><div class="line"></div><div class="line"><span class="comment"># 对匹配到的模式取反</span></div><div class="line">[root@centos7 ~]<span class="comment"># awk '!/^UUID/&#123;print $1&#125;' /etc/fstab</span></div><div class="line"></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment">#</span></div><div class="line">/dev/mapper/vgos-root</div><div class="line"></div><div class="line"><span class="comment"># 如果UID大于等于1000，则打印用户名和UID</span></div><div class="line">[root@centos7 ~]<span class="comment"># awk -F: '$3&gt;=1000&#123;print $1,$3&#125;' /etc/passwd</span></div><div class="line">gentoo 1000</div><div class="line">user1 1001</div><div class="line">user2 1002</div><div class="line">jack 1003</div><div class="line"></div><div class="line"><span class="comment"># 表示最后一个片段等于/bin/bash，然后符合的打印出用户名和UID及对应shell</span></div><div class="line">[root@centos7 ~]<span class="comment"># awk -F: '$NF=="/bin/bash"&#123;print $1,$3,$NF&#125;' /etc/passwd</span></div><div class="line">root 0 /bin/bash</div><div class="line">gentoo 1000 /bin/bash</div><div class="line">user1 1001 /bin/bash</div><div class="line">user2 1002 /bin/bash</div><div class="line"></div><div class="line"><span class="comment"># 表示左边的值能够被右边的模式所匹配</span></div><div class="line">[root@centos7 ~]<span class="comment"># awk -F: '$NF~/bash/&#123;print $1,$NF&#125;' /etc/passwd</span></div><div class="line">root /bin/bash</div><div class="line">gentoo /bin/bash</div><div class="line">user1 /bin/bash</div><div class="line"></div><div class="line"><span class="comment"># 打印1-10之间的奇数</span></div><div class="line">[root@centos7 ~]<span class="comment"># seq 1 2 10</span></div><div class="line">1</div><div class="line">3</div><div class="line">5</div><div class="line">7</div><div class="line">9</div><div class="line">[root@centos7 ~]<span class="comment"># seq 10|awk 'i=!i'</span></div><div class="line">1</div><div class="line">3</div><div class="line">5</div><div class="line">7</div><div class="line">9</div><div class="line">[root@centos7 ~]<span class="comment"># seq 10|sed -n '1~2p'</span></div><div class="line">1</div><div class="line">3</div><div class="line">5</div><div class="line">7</div><div class="line">9</div><div class="line"></div><div class="line"><span class="comment"># 打印出第一次被/^root/模式匹配到的行开始，到第一次被/^nobody/模式匹配到的行结束</span></div><div class="line">[root@centos7 ~]<span class="comment"># awk -F: '/^root/,/^nobody/&#123;print $1&#125;' /etc/passwd</span></div><div class="line">root</div><div class="line">bin</div><div class="line">daemon</div><div class="line">adm</div><div class="line">lp</div><div class="line">sync</div><div class="line">shutdown</div><div class="line">halt</div><div class="line">mail</div><div class="line">operator</div><div class="line">games</div><div class="line">ftp</div><div class="line">nobody</div><div class="line"></div><div class="line"><span class="comment"># 打印出第二行到第十行之间的用户名</span></div><div class="line">[root@centos7 ~]<span class="comment"># awk -F: '(NR&gt;=2&amp;&amp;NR&lt;=10)&#123;print $1&#125;' /etc/passwd</span></div><div class="line">bin</div><div class="line">daemon</div><div class="line">adm</div><div class="line">lp</div><div class="line">sync</div><div class="line">shutdown</div><div class="line">halt</div><div class="line">mail</div><div class="line">operator</div><div class="line"></div><div class="line"><span class="comment"># 打印表头</span></div><div class="line">[root@centos7 ~]<span class="comment"># awk -F: 'BEGIN&#123;print "   username   uid   \n----------------------"&#125;'</span></div><div class="line">   username   uid   </div><div class="line">----------------------</div><div class="line"></div><div class="line"></div><div class="line">[root@centos7 ~]<span class="comment">#  awk -F: 'BEGIN&#123;print "           username   uid   \n--------------------------"&#125;&#123;printf "%18s %5d\n",$1,$3&#125;' /etc/passwd</span></div><div class="line">           username   uid   </div><div class="line">--------------------------</div><div class="line">              root     0</div><div class="line">               bin     1</div><div class="line">            daemon     2</div><div class="line">               adm     3</div><div class="line">                lp     4</div><div class="line">              sync     5</div><div class="line"></div><div class="line">[root@centos7 ~]<span class="comment">#  awk -F: 'BEGIN&#123;print "           username   uid   \n--------------------------"&#125;&#123;printf "%18s %5d\n",$1,$3&#125;END&#123;print "-------------------------\n        END"&#125;' /etc/passwd</span></div><div class="line">           username   uid   </div><div class="line">--------------------------</div><div class="line">              root     0</div><div class="line">               bin     1</div><div class="line">            daemon     2</div><div class="line">               adm     3</div><div class="line">                lp     4</div><div class="line">              sync     5</div><div class="line">          shutdown     6</div><div class="line">-------------------------</div><div class="line">             END</div></pre></td></tr></table></figure></p>
<h3 id="常用的action："><a href="#常用的action：" class="headerlink" title="常用的action："></a>常用的action：</h3><p>◆ Expressions：算术，比较表达式等<br>◆ Control statements： 控制语句 if, while等<br>◆ Compound statements： 组合语句<br>◆ input statements：输入语句<br>◆ output statements： 输出语句 print等</p>
<h3 id="awk控制语句："><a href="#awk控制语句：" class="headerlink" title="awk控制语句："></a>awk控制语句：</h3><p>◆ { statements;… } 组合语句<br>◆ if(condition) {statements;…}<br>◆ if(condition) {statements;…} else {statements;…}<br>◆ while(conditon) {statments;…}<br>◆ do {statements;…} while(condition)<br>◆ for(expr1;expr2;expr3) {statements;…}<br>◆ break<br>◆ continue<br>◆ delete array[index]<br>◆ delete array<br>◆ exit</p>
<p>★ awk控制语句：if-else<br>◆ 语法：<br>&ensp;&ensp;&ensp;&ensp;if(condition) statement [else statement]<br>&ensp;&ensp;&ensp;&ensp;if(condition1){statement1} else if(condition2){statement 2} else{statement3}<br>◆ 使用场景：<br>&ensp;&ensp;&ensp;&ensp;对awk取得的整行或某个字段做条件判断<br>★ 演示：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div></pre></td><td class="code"><pre><div class="line">单分支语句：</div><div class="line">[root@centos7 ~]<span class="comment"># awk -F: '&#123;if($3&gt;=1000)print $1,$3&#125;' /etc/passwd</span></div><div class="line">gentoo 1000</div><div class="line">user1 1001</div><div class="line">user2 1002</div><div class="line">jack 1003</div><div class="line"></div><div class="line">双分支语句，一定注意语法书写格式！！！</div><div class="line">[root@centos7 ~]<span class="comment"># awk -F: '&#123;if($3&gt;=1000)&#123;printf "Common user: %s\n",$1&#125;else&#123;printf "root or sysuser: %s\n",$1&#125;&#125;' /etc/passwd</span></div><div class="line">root or sysuser: root</div><div class="line">root or sysuser: bin</div><div class="line">root or sysuser: daemon</div><div class="line">root or sysuser: adm</div><div class="line">Common user: gentoo</div><div class="line">Common user: user1</div><div class="line"></div><div class="line">对某个字段做条件判断</div><div class="line">[root@centos7 ~]<span class="comment"># awk -F: '&#123;if($NF=="/bin/bash") print $1&#125;' /etc/passwd</span></div><div class="line">root</div><div class="line">gentoo</div><div class="line">user1</div><div class="line">user2</div><div class="line"></div><div class="line">以空格为分隔符，取字段大于5的所有行</div><div class="line">[root@centos7 ~]<span class="comment"># awk '&#123;if(NF&gt;5)print $0&#125;' /etc/fstab</span></div><div class="line"><span class="comment"># Created by anaconda on Wed Apr 26 10:31:47 2017</span></div><div class="line"><span class="comment"># Accessible filesystems, by reference, are maintained under '/dev/disk'</span></div><div class="line"><span class="comment"># See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info</span></div><div class="line">/dev/mapper/vgos-root   /                       xfs     defaults        0 0</div><div class="line">UUID=224a4923<span class="_">-a</span>78d-4bde-b962-aa921a15db50 /boot                   xfs     defaults        0 0</div><div class="line">UUID=3f6338ab-2c10-422c-9a5c-6a783c5795e8 swap                    swap    defaults        0 0</div><div class="line"></div><div class="line">取磁盘利用率：</div><div class="line">[root@centos7 ~]<span class="comment"># df -h</span></div><div class="line">Filesystem             Size  Used Avail Use% Mounted on</div><div class="line">/dev/mapper/vgos-root   20G  1.7G   19G   9% /</div><div class="line">devtmpfs               479M     0  479M   0% /dev</div><div class="line">tmpfs                  489M     0  489M   0% /dev/shm</div><div class="line">tmpfs                  489M  6.7M  483M   2% /run</div><div class="line">tmpfs                  489M     0  489M   0% /sys/fs/cgroup</div><div class="line">/dev/sda1              497M  108M  390M  22% /boot</div><div class="line">tmpfs                   98M     0   98M   0% /run/user/0</div><div class="line">[root@centos7 ~]<span class="comment"># df -h|awk -F"%" '&#123;print $1&#125;'</span></div><div class="line">Filesystem             Size  Used Avail Use</div><div class="line">/dev/mapper/vgos-root   20G  1.7G   19G   9</div><div class="line">devtmpfs               479M     0  479M   0</div><div class="line">tmpfs                  489M     0  489M   0</div><div class="line">tmpfs                  489M  6.7M  483M   2</div><div class="line">tmpfs                  489M     0  489M   0</div><div class="line">/dev/sda1              497M  108M  390M  22</div><div class="line">tmpfs                   98M     0   98M   0</div><div class="line">[root@centos7 ~]<span class="comment"># df -h|awk -F[%] '&#123;print $1&#125;'</span></div><div class="line">Filesystem             Size  Used Avail Use</div><div class="line">/dev/mapper/vgos-root   20G  1.7G   19G   9</div><div class="line">devtmpfs               479M     0  479M   0</div><div class="line">tmpfs                  489M     0  489M   0</div><div class="line">tmpfs                  489M  6.7M  483M   2</div><div class="line">tmpfs                  489M     0  489M   0</div><div class="line">/dev/sda1              497M  108M  390M  22</div><div class="line">tmpfs                   98M     0   98M   0</div><div class="line"></div><div class="line">模式匹配，匹配 以/dev开头的行，注意这里要对/ 转义，模式匹配一定要写在 “/ /”中</div><div class="line">[root@centos7 ~]<span class="comment"># df -h|awk -F"%" '/^\/dev/&#123;print $1&#125;'|awk '&#123;print $1,$NF&#125;'</span></div><div class="line">/dev/mapper/vgos-root 9</div><div class="line">/dev/sda1 22</div><div class="line"></div><div class="line">如果利用率大于等于20，就打印第一字段</div><div class="line">[root@centos7 ~]<span class="comment"># df -h|awk -F"%" '/^\/dev/&#123;print $1&#125;'|awk '&#123;if($NF&gt;20)print $1&#125;'</span></div><div class="line">/dev/sda1</div></pre></td></tr></table></figure></p>
<p>★ awk控制语句：while循环<br>◆ 语法：<br>&ensp;&ensp;&ensp;&ensp;while(condition) statement<br>◆ 条件“真”，进入循环；条件“假”，退出循环；<br>◆ 使用场景：<br>&ensp;&ensp;&ensp;&ensp;对一行内的多个字段逐一类似处理时使用；<br>&ensp;&ensp;&ensp;&ensp;对数组中的各元素逐一处理时使用；<br>★ 演示：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line">取文件模式所匹配的行</div><div class="line">[root@centos7 ~]<span class="comment"># awk '/[[:space:]]*linux16/&#123;print&#125;' /etc/grub2.cfg</span></div><div class="line">	linux16 /vmlinuz-3.10.0-327.el7.x86_64 root=/dev/mapper/vgos-root ro rd.lvm.lv=vgos/root rhgb quiet LANG=en_US.UTF-8</div><div class="line">	linux16 /vmlinuz-0-rescue-15e65d64f8<span class="built_in">cd</span>44aba7ea49bae9f5aa74 root=/dev/mapper/vgos-root ro rd.lvm.lv=vgos/root rhgb quiet</div><div class="line"></div><div class="line">取所匹配行的字段数量</div><div class="line">[root@centos7 ~]<span class="comment">#  awk '/[[:space:]]*linux16/&#123;print NF&#125;' /etc/grub2.cfg</span></div><div class="line">8</div><div class="line">7</div><div class="line"></div><div class="line">对每一行字段中包含的字符长度做统计</div><div class="line">[root@centos7 ~]<span class="comment"># awk '/[[:space:]]*linux16/&#123;i=1;while(i&lt;=NF) &#123;print $i,length($i);i++ &#125;&#125;' /etc/grub2.cfg</span></div><div class="line">linux16 7</div><div class="line">/vmlinuz-3.10.0-327.el7.x86_64 30</div><div class="line">root=/dev/mapper/vgos-root 26</div><div class="line">ro 2</div><div class="line">rd.lvm.lv=vgos/root 19</div><div class="line">rhgb 4</div><div class="line">quiet 5</div><div class="line">LANG=en_US.UTF-8 16</div><div class="line">linux16 7</div><div class="line">/vmlinuz-0-rescue-15e65d64f8<span class="built_in">cd</span>44aba7ea49bae9f5aa74 50</div><div class="line">root=/dev/mapper/vgos-root 26</div><div class="line">ro 2</div><div class="line">rd.lvm.lv=vgos/root 19</div><div class="line">rhgb 4</div><div class="line">quiet 5</div><div class="line"></div><div class="line">只打印字段字符长度大于7的字符长度</div><div class="line">[root@centos7 ~]<span class="comment"># awk '/[[:space:]]*linux16/&#123;i=1;while(i&lt;=NF) &#123;if(length($i)&gt;=7) &#123;print $i,length($i)&#125;;i++&#125;&#125;' /etc/grub2.cfg</span></div><div class="line">linux16 7</div><div class="line">/vmlinuz-3.10.0-327.el7.x86_64 30</div><div class="line">root=/dev/mapper/vgos-root 26</div><div class="line">rd.lvm.lv=vgos/root 19</div><div class="line">LANG=en_US.UTF-8 16</div><div class="line">linux16 7</div><div class="line">/vmlinuz-0-rescue-15e65d64f8<span class="built_in">cd</span>44aba7ea49bae9f5aa74 50</div><div class="line">root=/dev/mapper/vgos-root 26</div><div class="line">rd.lvm.lv=vgos/root 19</div></pre></td></tr></table></figure></p>
<p>★ awk控制语句：do-while循环<br>◆ 语法：<br>&ensp;&ensp;&ensp;&ensp;do statement while(condition)<br>◆ 意义：<br>&ensp;&ensp;&ensp;&ensp;无论真假，至少执行一次循环体<br>★ 演示：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">计算100以内所有数之和：</div><div class="line">[root@centos7 ~]<span class="comment"># awk 'BEGIN&#123; total=0;i=0;do&#123;total+=i;i++;&#125;while(i&lt;=100);print total&#125;'</span></div><div class="line">5050</div></pre></td></tr></table></figure></p>
<p>★ awk控制语句：for循环<br>◆ 语法：for(expr1;expr2;expr3) statement<br>&ensp;&ensp;&ensp;&ensp;for(variable assignment;condition;iterationprocess) {for-body}<br>◆ 特殊用法：能够遍历数组中的元素；<br>&ensp;&ensp;&ensp;&ensp;语法：for(varin array) {for-body}<br>★ 演示：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">对每一行字段中包含的字符长度做统计</div><div class="line">[root@centos7 ~]<span class="comment"># awk '/[[:space:]]*linux16/&#123;for(i=1;i&lt;=NF;i++) &#123;print $i,length($i)&#125;&#125;' /etc/grub2.cfg</span></div><div class="line">linux16 7</div><div class="line">/vmlinuz-3.10.0-327.el7.x86_64 30</div><div class="line">root=/dev/mapper/vgos-root 26</div><div class="line">ro 2</div><div class="line">rd.lvm.lv=vgos/root 19</div><div class="line">rhgb 4</div><div class="line">quiet 5</div><div class="line">LANG=en_US.UTF-8 16</div><div class="line">linux16 7</div><div class="line">/vmlinuz-0-rescue-15e65d64f8<span class="built_in">cd</span>44aba7ea49bae9f5aa74 50</div><div class="line">root=/dev/mapper/vgos-root 26</div><div class="line">ro 2</div><div class="line">rd.lvm.lv=vgos/root 19</div><div class="line">rhgb 4</div><div class="line">quiet 5</div><div class="line"></div><div class="line">只打印字段字符长度大于7的字符长度</div><div class="line">[root@centos7 ~]<span class="comment"># awk '/[[:space:]]*linux16/ &#123;for(i=1;i&lt;=NF;i++) &#123;if(length($i)&gt;=7) print $i,length($i)&#125;&#125;' /etc/grub2.cfg</span></div><div class="line">linux16 7</div><div class="line">/vmlinuz-3.10.0-327.el7.x86_64 30</div><div class="line">root=/dev/mapper/vgos-root 26</div><div class="line">rd.lvm.lv=vgos/root 19</div><div class="line">LANG=en_US.UTF-8 16</div><div class="line">linux16 7</div><div class="line">/vmlinuz-0-rescue-15e65d64f8<span class="built_in">cd</span>44aba7ea49bae9f5aa74 50</div><div class="line">root=/dev/mapper/vgos-root 26</div><div class="line">rd.lvm.lv=vgos/root 19</div></pre></td></tr></table></figure></p>
<p>★ awk控制语句：switch语句<br>◆ 语法：<br>&ensp;&ensp;&ensp;&ensp;switch(expression) {case VALUE1 or /REGEXP/: statement; case VALUE2 or /REGEXP2/: statement; …; default: statement}</p>
<p>★ awk控制语句：break和continue<br>&ensp;&ensp;&ensp;&ensp;break [n]<br>&ensp;&ensp;&ensp;&ensp;continue [n]</p>
<p>★ awk控制语句：next<br>◆ 提前结束对本行处理而直接进入下一行处理（awk自身循环）<br>★ 演示：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">表示用户的ID号如果不为偶数，就提前终止这一行，直接进入下一行处理</div><div class="line">[root@centos7 ~]<span class="comment"># awk -F: '&#123;if($3%2!=0) next; print $1,$3&#125;' /etc/passwd</span></div><div class="line">root 0</div><div class="line">daemon 2</div><div class="line">lp 4</div><div class="line">shutdown 6</div><div class="line">mail 8</div><div class="line">games 12</div><div class="line">和上面表示的结果是相同的，但方法和意义不同</div><div class="line">[root@centos7 ~]<span class="comment"># awk -F: '&#123;if($3%2==0) print $1,$3&#125;' /etc/passwd</span></div><div class="line">root 0</div><div class="line">daemon 2</div><div class="line">lp 4</div><div class="line">shutdown 6</div><div class="line">mail 8</div><div class="line">games 12</div></pre></td></tr></table></figure></p>
<h3 id="awk数组"><a href="#awk数组" class="headerlink" title="awk数组"></a>awk数组</h3><p>★ 关联数组：<br>&ensp;&ensp;&ensp;&ensp;array [index-expression]<br>◆ index-expression:<br>&ensp;&ensp;&ensp;&ensp;可使用任意字符串；字符串要使用双引号括起来<br>&ensp;&ensp;&ensp;&ensp;如果某数组元素事先不存在，在引用时，awk会自动创建此元素，并将其值初始化为“空串”<br>◆ 若要判断数组中是否存在某元素，要使用“index in array”格式进行遍历<br>◆ 若要遍历数组中的每个元素，要使用for循环<br>&ensp;&ensp;&ensp;&ensp;for(varin array) {for-body}<br>◆ 注意：var会遍历array的每个索引<br>◆ 示例：<br>&ensp;&ensp;&ensp;&ensp;awk’{ip[$1]++}END{for(i in ip) {print i,ip[i]}}’ /var/log/httpd/access_log<br>★ 演示：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">[root@centos7 ~]<span class="comment"># awk 'BEGIN&#123;weekdays["mon"]="Monday";weekdays["tue"]="Tuesday";print weekdays["mon"]&#125;'</span></div><div class="line">Monday</div><div class="line">[root@centos7 ~]<span class="comment"># awk 'BEGIN&#123;weekdays["mon"]="Monday";weekdays["tue"]="Tuesday";print weekdays["tue"]&#125;'</span></div><div class="line">Tuesday</div><div class="line">遍历数组中的每个元素：<span class="keyword">for</span></div><div class="line">[root@centos7 ~]<span class="comment"># awk 'BEGIN&#123;weekdays["mon"]="Monday";weekdays["tue"]="Tuesday";for(i in weekdays) &#123;print i,weekdays[i]&#125;&#125;'</span></div><div class="line">tue Tuesday</div><div class="line">mon Monday</div><div class="line"></div><div class="line">第二种情况，数组元素事先不存在，在引用时，awk会自动创建此元素，其初始值为“空串”也就是0。题目中，<span class="variable">$NF</span></div><div class="line">变量作为数组的索引下标，其个数，出现一次就自加，自加的结果为数组元素的值；定义的<span class="keyword">for</span>循环中的变量i为数组中的索引下标，state[i]才是数组中元素的值，最后打印数组中的索引下标和数组元素</div><div class="line">[root@centos7 ~]<span class="comment"># netstat -tan|awk '/^tcp\&gt;/&#123;print&#125;'</span></div><div class="line">tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN     </div><div class="line">tcp        0      0 127.0.0.1:25            0.0.0.0:*               LISTEN     </div><div class="line">tcp        0     52 192.168.2.140:22        192.168.2.1:64020       ESTABLISHED</div><div class="line">[root@centos7 ~]<span class="comment"># netstat -tan|awk '/^tcp\&gt;/&#123;state[$NF]++&#125;END&#123;for (i in state)&#123;print i,state[i]&#125;&#125;'</span></div><div class="line">LISTEN 2</div><div class="line">ESTABLISHED 1</div></pre></td></tr></table></figure></p>
<p>★ 练习：<br>统计/etc/fstab文件中每个文件系统类型出现的次数<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[root@centos7 ~]<span class="comment"># awk '/^UUID/&#123;print&#125;' /etc/fstab</span></div><div class="line">UUID=224a4923<span class="_">-a</span>78d-4bde-b962-aa921a15db50 /boot                   xfs     defaults        0 0</div><div class="line">UUID=3f6338ab-2c10-422c-9a5c-6a783c5795e8 swap                    swap    defaults        0 0</div><div class="line">[root@centos7 ~]<span class="comment"># awk '/^UUID/&#123;fs[$3]++&#125;END&#123;for(i in fs)&#123;print i,fs[i]&#125;&#125;' /etc/fstab</span></div><div class="line">swap 1</div><div class="line">xfs 1</div></pre></td></tr></table></figure></p>
<p>统计指定文件中每个单词出现的次数（行内字段遍历）<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line">[root@centos7 ~]<span class="comment"># awk '&#123;for(i=1;i&lt;=NF;i++)&#123;count[$i]++&#125;&#125;END&#123;for(i in count)&#123;print i,count[i]&#125;&#125;' /etc/fstab</span></div><div class="line">swap 2</div><div class="line">fstab(5), 1</div><div class="line">filesystems, 1</div><div class="line">26 1</div><div class="line">on 1</div><div class="line">/etc/fstab 1</div><div class="line">UUID=3f6338ab-2c10-422c-9a5c-6a783c5795e8 1</div><div class="line">/boot 1</div><div class="line">UUID=224a4923<span class="_">-a</span>78d-4bde-b962-aa921a15db50 1</div><div class="line">more 1</div><div class="line">mount(8) 1</div><div class="line">pages 1</div><div class="line"><span class="string">'/dev/disk'</span> 1</div><div class="line">10:31:47 1</div><div class="line">Apr 1</div><div class="line">blkid(8) 1</div><div class="line">See 1</div><div class="line">/dev/mapper/vgos-root 1</div><div class="line"><span class="keyword">for</span> 1</div><div class="line">and/or 1</div><div class="line">anaconda 1</div><div class="line">/ 1</div><div class="line">findfs(8), 1</div><div class="line">under 1</div><div class="line">Created 1</div><div class="line">0 6</div><div class="line">info 1</div><div class="line">Accessible 1</div><div class="line"><span class="comment"># 7</span></div><div class="line">defaults 3</div><div class="line">xfs 2</div><div class="line">man 1</div><div class="line">are 1</div><div class="line">reference, 1</div><div class="line">by 2</div><div class="line">maintained 1</div><div class="line">2017 1</div><div class="line">Wed 1</div></pre></td></tr></table></figure></p>
<h3 id="awk函数"><a href="#awk函数" class="headerlink" title="awk函数"></a>awk函数</h3><p>★ 数值处理：<br>&ensp;&ensp;&ensp;&ensp;rand()：返回0和1之间一个随机数<br>★ 字符串处理：<br>&ensp;&ensp;&ensp;&ensp;length([s])：返回指定字符串的长度<br>&ensp;&ensp;&ensp;&ensp;sub(r,s,[t])：在t字符串搜索能够被r表示的模式所匹配的内容，并将第一个匹配的内容替换为s；<br>&ensp;&ensp;&ensp;&ensp;gsub(r,s,[t])：对t字符串进行搜索r表示的模式匹配的内容，并全部替换为s所表示的内容<br>&ensp;&ensp;&ensp;&ensp;split(s,array,[r])：以r为分隔符切割字符s，并将切割后的结果保存至array所表示的数组中<br>★ 演示：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">[root@centos7 ~]<span class="comment"># awk 'BEGIN&#123;print rand()&#125;'</span></div><div class="line">0.237788</div><div class="line"></div><div class="line">[root@centos7 ~]<span class="comment"># awk 'BEGIN&#123;srand(); for (i=1;i&lt;=10;i++)print int(rand()*100) &#125;'</span></div><div class="line">98</div><div class="line">10</div><div class="line">85</div><div class="line">68</div><div class="line">44</div><div class="line">33</div><div class="line">55</div><div class="line">78</div><div class="line">20</div><div class="line">32</div><div class="line"><span class="comment">#把第一个字段（2008:08:08）中第一次查找到的 ：替换为“”空，</span></div><div class="line">[root@centos7 ~]<span class="comment"># echo "2008:08:08 08:08:08" | awk 'sub(/:/,"",$1)'</span></div><div class="line">200808:08 08:08:08</div><div class="line"><span class="comment">#把第一个字段中所有的 ：替换为空</span></div><div class="line">[root@centos7 ~]<span class="comment"># echo "2008:08:08 08:08:08" | awk 'gsub(/:/,"",$1)'</span></div><div class="line">20080808 08:08:08</div><div class="line"></div><div class="line">[root@centos7 ~]<span class="comment"># netstat -tan|awk '/^tcp\&gt;/'</span></div><div class="line">tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN     </div><div class="line">tcp        0      0 127.0.0.1:25            0.0.0.0:*               LISTEN     </div><div class="line">tcp        0     52 192.168.2.140:22        192.168.2.1:53207       ESTABLISHED</div><div class="line"><span class="comment">#split说明:以":"为分隔符切割$5,把切割结果放到数组ip里</span></div><div class="line">[root@centos7 ~]<span class="comment"># netstat -tan|awk '/^tcp\&gt;/&#123;split($5,ip,":");print ip[1]&#125;'</span></div><div class="line">0.0.0.0</div><div class="line">0.0.0.0</div><div class="line">192.168.2.1</div><div class="line"><span class="comment">#对输出的结果做统计</span></div><div class="line">[root@centos7 ~]<span class="comment"># netstat -tan|awk '/^tcp\&gt;/&#123;split($5,ip,":");count[ip[1]]++&#125;END&#123;for(i in count)&#123;print i,count[i]&#125;&#125;'</span></div><div class="line">0.0.0.0 2</div><div class="line">192.168.2.1 1</div></pre></td></tr></table></figure></p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color3">linux中文本处理工具</a>
        		</li>
      		
		</ul>
	</div>

      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/2017/07/10/linux文本处理工具三剑客之awk/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>





  
    <article id="post-linux系统管理之systemd" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/07/08/linux系统管理之systemd/">Systemd</a>
    </h1>
  

        
        <a href="/2017/07/08/linux系统管理之systemd/" class="archive-article-date">
  	<time datetime="2017-07-08T06:50:22.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2017-07-08</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><p>★ CentOS 6和之前版本采用SysVinit的系统启动进程管理体系，一般用户都可通过在/etc/inittab文件的配置，来个性化自己的系统启动序列。但也经常会由于特殊环境的硬件等关系问题，造成其串行的启动进程控制流，因为可能任务的阻塞而影响启动过程。<br>★ CentOS 7开始使用Systemd,所以我们必须要了解Systemd.本章将从CentOS 7 的启动流程、Unit、服务管理，启动排错，破解口令以及修复grub2 等方面来介绍Systemd的相关内容。</p>
<h3 id="systemd介绍"><a href="#systemd介绍" class="headerlink" title="systemd介绍"></a>systemd介绍</h3><p>★ 启动流程<br>POST –&gt; Boot Sequence –&gt; Bootloader –&gt; kernel + initramfs(initrd) –&gt; rootfs（根切换）–&gt; /sbin/init<br>◆ init：<br>&ensp;&ensp;&ensp;&ensp;☉ CentOS 5: SysVinit；<br>&ensp;&ensp;&ensp;&ensp;☉ CentOS 6: Upstart；<br>&ensp;&ensp;&ensp;&ensp;☉ CentOS 7: Systemd；<br>★ Systemd：<br>系统启动和服务器守护进程管理器，负责在系统启动或运行时，激活系统资源，服务器进程和其它进程；<br>◆ Systemd新特性<br>&ensp;&ensp;&ensp;&ensp;☉ 系统引导时实现服务并行启动；<br>&ensp;&ensp;&ensp;&ensp;☉ 按需启动守护进程；<br>&ensp;&ensp;&ensp;&ensp;☉ 自动化的服务依赖关系管理；<br>&ensp;&ensp;&ensp;&ensp;☉ 同时采用socket式与D-Bus总线式激活服务；<br>&ensp;&ensp;&ensp;&ensp;☉ 系统状态快照。</p>
<h3 id="核心概念：Unit"><a href="#核心概念：Unit" class="headerlink" title="核心概念：Unit"></a>核心概念：Unit</h3><p>◆ unit表示不同类型的systemd对象，通过配置文件进行标识和配置；<br>◆ 文件中主要包含了系统服务、监听socket、保存的系统快照以及其它与init相关的信息；</p>
<h3 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h3><p>★ /usr/lib/systemd/system：<br>&ensp;&ensp;&ensp;&ensp;每个服务最主要的启动脚本设置，类似于之前的/etc/init.d/<br>★ /run/systemd/system：<br>&ensp;&ensp;&ensp;&ensp;系统执行过程中所产生的服务脚本，比上面目录优先运行<br>★ /etc/systemd/system：<br>&ensp;&ensp;&ensp;&ensp;管理员建立的执行脚本，类似于/etc/rc.d/rcN.d/Sxx类的功能，比上面目录优先运行<br>★ 例如：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">[root@centos7 ~]<span class="comment"># cd /usr/lib/systemd/system</span></div><div class="line">[root@centos7 system]<span class="comment"># ls</span></div><div class="line">abrt-ccpp.service                       remote-fs-pre.target</div><div class="line">abrtd.service                           remote-fs.target</div><div class="line">abrt-oops.service                       rescue.service</div><div class="line">abrt-pstoreoops.service                 rescue.target</div><div class="line">abrt-vmcore.service                     rescue.target.wants</div><div class="line">abrt-xorg.service                       rhel-autorelabel-mark.service</div><div class="line">arp-ethers.service                      rhel-autorelabel.service</div><div class="line">auditd.service                          rhel-configure.service</div><div class="line">autovt@.service                         rhel-dmesg.service</div><div class="line">basic.target                            rhel-domainname.service</div><div class="line"></div><div class="line">[root@centos7 system]<span class="comment"># cd /run/systemd/system</span></div><div class="line">[root@centos7 system]<span class="comment"># ls</span></div><div class="line">session-3.scope  session-3.scope.d</div><div class="line"></div><div class="line">[root@centos7 ~]<span class="comment"># cd /etc/systemd/system</span></div><div class="line">[root@centos7 system]<span class="comment"># ls</span></div><div class="line">basic.target.wants                           default.target.wants     sysinit.target.wants</div><div class="line">dbus-org.freedesktop.NetworkManager.service  getty.target.wants       system-update.target.wants</div><div class="line">dbus-org.freedesktop.nm-dispatcher.service   multi-user.target.wants</div><div class="line">default.target                               sockets.target.wants</div></pre></td></tr></table></figure></p>
<h3 id="Unit-类型"><a href="#Unit-类型" class="headerlink" title="Unit 类型"></a>Unit 类型</h3><p>◆ systemctl –t help：查看unit类型；<br>◆ Service unit：文件扩展名为.service, 用于定义系统服务；<br>◆ Target unit：文件扩展名为.target，用于模拟实现“运行级别”；<br>◆ Device unit：.device, 用于定义内核识别的设备；<br>◆ Mount unit：.mount, 定义文件系统挂载点；<br>◆ Socket unit：.socket, 用于标识进程间通信用的socket文件，也可在系统启动时，延迟启动服务，实现按需启动；<br>◆ Snapshot unit：.snapshot, 管理系统快照；<br>◆ Swap unit：.swap, 用于标识swap设备；<br>◆ Automount unit：.automount，文件系统的自动挂载点；<br>◆ Path unit：.path，用于定义文件系统中的一个文件或目录使用,常用于当文件系统变化时，延迟激活服务，如：spool 目录<br>★ 例如：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">[root@centos7 ~]<span class="comment"># systemctl -t help</span></div><div class="line">Available unit types:</div><div class="line">service</div><div class="line">socket</div><div class="line">busname</div><div class="line">target</div><div class="line">snapshot</div><div class="line">device</div><div class="line">mount</div><div class="line">automount</div><div class="line">swap</div><div class="line">timer</div><div class="line">path</div><div class="line">slice</div><div class="line">scope</div></pre></td></tr></table></figure></p>
<h3 id="特性"><a href="#特性" class="headerlink" title="特性"></a>特性</h3><p>★ 关键特性：<br>&ensp;&ensp;&ensp;&ensp;◆ 基于socket的激活机制：socket与服务程序分离<br>&ensp;&ensp;&ensp;&ensp;◆ 基于d-bus的激活机制：<br>&ensp;&ensp;&ensp;&ensp;◆ 基于device的激活机制：<br>&ensp;&ensp;&ensp;&ensp;◆ 基于path的激活机制：<br>&ensp;&ensp;&ensp;&ensp;◆ 系统快照：保存各unit的当前状态信息于持久存储设备中<br>&ensp;&ensp;&ensp;&ensp;◆ 向后兼容sysvinit脚本<br>★ 不兼容<br>&ensp;&ensp;&ensp;&ensp;◆ systemctl命令固定不变，不可扩展<br>&ensp;&ensp;&ensp;&ensp;◆ 非由systemd启动的服务，systemctl无法与之通信和控制</p>
<h3 id="管理服务（重点）"><a href="#管理服务（重点）" class="headerlink" title="管理服务（重点）"></a>管理服务（重点）</h3><p>★ 管理系统服务<br>&ensp;&ensp;&ensp;&ensp;centos 7：service 类型的 unit 文件<br>&ensp;&ensp;&ensp;&ensp;注意：能兼容早期的服务脚本<br>命令格式：<br>&ensp;&ensp;&ensp;&ensp;systemctl COMMAND name.service<br>用法如下：<br>◆ 启动：<br>&ensp;&ensp;&ensp;&ensp;service name start    ==&gt; systemctl start name.service<br>◆ 停止：<br>&ensp;&ensp;&ensp;&ensp;service name stop     ==&gt; systemctl stop name.service<br>◆ 重启：<br>&ensp;&ensp;&ensp;&ensp;service name restart ==&gt; systemctl restart name.service<br>◆ 状态：<br>&ensp;&ensp;&ensp;&ensp;service name status   ==&gt; systemctl status name.service<br>◆ 条件式重启：已启动才重启，否则不做操作<br>&ensp;&ensp;&ensp;&ensp;service name condrestart==&gt; systemctl try-restart name.service<br>◆ 重载或重启服务：先加载，再启动<br>&ensp;&ensp;&ensp;&ensp;systemctl reload-or-restart name.service<br>◆ 重载或条件式重启服务：<br>&ensp;&ensp;&ensp;&ensp;systemctl reload-or-try-restart name.service<br>◆ 禁止某服务设定开机自启：<br>&ensp;&ensp;&ensp;&ensp;systemctl mask name.service<br>◆ 取消如上禁止：<br>&ensp;&ensp;&ensp;&ensp;systemctl unmask name.service<br>◆ 演示<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">[root@centos6-lab yum.repos.d]<span class="comment"># service httpd status</span></div><div class="line">httpd is stopped</div><div class="line"></div><div class="line">[root@centos7 ~]<span class="comment"># systemctl status httpd.service</span></div><div class="line">?.httpd.service - The Apache HTTP Server</div><div class="line">   Loaded: loaded (/usr/lib/systemd/system/httpd.service; disabled; vendor preset: disabled)</div><div class="line">   Active: active (running) since Wed 2017-07-12 22:50:29 CST; 2s ago</div><div class="line">     Docs: man:httpd(8)</div><div class="line">           man:apachectl(8)</div><div class="line"> Main PID: 1853 (httpd)</div><div class="line">   Status: <span class="string">"Processing requests..."</span></div><div class="line">   CGroup: /system.slice/httpd.service</div><div class="line">           ?..1853 /usr/sbin/httpd -DFOREGROUND</div><div class="line">           ?..1854 /usr/sbin/httpd -DFOREGROUND</div><div class="line">           ?..1855 /usr/sbin/httpd -DFOREGROUND</div><div class="line">           ?..1856 /usr/sbin/httpd -DFOREGROUND</div><div class="line">           ?..1857 /usr/sbin/httpd -DFOREGROUND</div><div class="line">           ?..1858 /usr/sbin/httpd -DFOREGROUND</div><div class="line"></div><div class="line">Jul 12 22:50:29 centos7 systemd[1]: Starting The Apache HTTP Server...</div><div class="line">Jul 12 22:50:29 centos7 httpd[1853]: AH00558: httpd: Could not reliably determine the server<span class="string">'...sage</span></div><div class="line">Jul 12 22:50:29 centos7 systemd[1]: Started The Apache HTTP Server.</div><div class="line">Hint: Some lines were ellipsized, use -l to show in full.</div></pre></td></tr></table></figure></p>
<p>★ 服务查看<br>◆ 查看某服务当前激活与否的状态<br>&ensp;&ensp;&ensp;&ensp;systemctl is-active name.service<br>◆ 查看所有已经激活的服务：<br>&ensp;&ensp;&ensp;&ensp;systemctl list-units –type|-t service<br>◆ 查看所有服务（已激活及未激活）：<br>&ensp;&ensp;&ensp;&ensp;systemctl list-units –type|-t service –all|-a<br>◆ 演示<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#查看某服务当前激活与否的状态</span></div><div class="line">[root@centos7 ~]<span class="comment"># systemctl is-active httpd.service</span></div><div class="line">active</div><div class="line">[root@centos7 ~]<span class="comment"># systemctl stop httpd.service</span></div><div class="line">[root@centos7 ~]<span class="comment"># systemctl is-active httpd.service</span></div><div class="line">unknown</div><div class="line"><span class="comment">#查看所有已激活的服务</span></div><div class="line">[root@centos7 ~]<span class="comment"># systemctl list-units -t service   #(-t|--type)</span></div><div class="line">UNIT                               LOAD   ACTIVE SUB     DESCRIPTION</div><div class="line">abrt-ccpp.service                  loaded active exited  Install ABRT coredump hook</div><div class="line">abrt-oops.service                  loaded active running ABRT kernel <span class="built_in">log</span> watcher</div><div class="line">abrtd.service                      loaded active running ABRT Automated Bug Reporting Tool</div><div class="line">auditd.service                     loaded active running Security Auditing Service</div><div class="line">crond.service                      loaded active running Command Scheduler</div><div class="line"><span class="comment">#查看所有服务状态</span></div><div class="line">[root@centos7 ~]<span class="comment"># systemctl list-units -t service -all</span></div><div class="line">  UNIT                                   LOAD      ACTIVE   SUB     DESCRIPTION</div><div class="line">  abrt-ccpp.service                      loaded    active   exited  Install ABRT coredump hook</div><div class="line">  abrt-oops.service                      loaded    active   running ABRT kernel <span class="built_in">log</span> watcher</div><div class="line">  abrt-vmcore.service                    loaded    inactive dead    Harvest vmcores <span class="keyword">for</span> ABRT</div><div class="line">  abrt-xorg.service                      loaded    inactive dead    ABRT Xorg <span class="built_in">log</span> watcher</div><div class="line">  abrtd.service                          loaded    active   running ABRT Automated Bug Reporting Too</div><div class="line">  auditd.service                         loaded    active   running Security Auditing Service</div></pre></td></tr></table></figure></p>
<p>★ 服务状态<br>◆ systemctl list-units –type service –all显示状态<br>&ensp;&ensp;&ensp;&ensp;loaded：Unit配置文件已处理<br>&ensp;&ensp;&ensp;&ensp;active(running)：一次或多次持续处理的运行<br>&ensp;&ensp;&ensp;&ensp;active(exited)：成功完成一次性的配置<br>&ensp;&ensp;&ensp;&ensp;active(waiting)：运行中，等待一个事件<br>&ensp;&ensp;&ensp;&ensp;inactive：不运行<br>&ensp;&ensp;&ensp;&ensp;enabled：开机启动<br>&ensp;&ensp;&ensp;&ensp;disabled：开机不启动<br>&ensp;&ensp;&ensp;&ensp;static：开机不启动，但可被另一个启用的服务激活<br>★ 开机自启<br>◆ 设定某服务开机自启：<br> &ensp;&ensp;&ensp;&ensp;chkconfig name on ==&gt; systemctl enable name.service<br>◆ 设定某服务开机禁止启动：<br>&ensp;&ensp;&ensp;&ensp;chkconfig name off ==&gt; systemctl disable name.service<br>◆ 查看所有服务的开机自启状态：<br>&ensp;&ensp;&ensp;&ensp;chkconfig –list ==&gt; systemctl list-unit-files –type service<br>◆ 用来列出该服务在哪些运行级别下启用和禁用<br>&ensp;&ensp;&ensp;&ensp;chkconfig sshd –list==&gt; ls /etc/systemd/system/*.wants/sshd.service<br>◆ 查看服务能否开机自启：<br>&ensp;&ensp;&ensp;&ensp;chkconfig –list name ==&gt; systemctl is-enabled name.service<br>◆ 查看服务的依赖关系：<br>&ensp;&ensp;&ensp;&ensp;systemctll ist-dependencies name.service<br>◆ 杀掉进程：<br>&ensp;&ensp;&ensp;&ensp;systemctl kill 进程名<br>◆ 演示<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#查看某服务能否开机自启</span></div><div class="line">[root@centos7 ~]<span class="comment"># systemctl is-enabled httpd</span></div><div class="line">disabled</div><div class="line">[root@centos7 ~]<span class="comment"># systemctl is-enabled sshd</span></div><div class="line">enabled</div><div class="line"><span class="comment">#查看所有服务的开机自启状态</span></div><div class="line">[root@centos7 ~]<span class="comment"># systemctl list-unit-files --type service</span></div><div class="line">UNIT FILE                                   STATE   </div><div class="line">abrt-ccpp.service                           enabled </div><div class="line">abrt-oops.service                           enabled </div><div class="line">abrt-pstoreoops.service                     disabled</div><div class="line">abrt-vmcore.service                         enabled </div><div class="line">abrt-xorg.service                           enabled </div><div class="line">abrtd.service                               enabled </div><div class="line">arp-ethers.service                          disabled</div><div class="line">auditd.service                              enabled</div></pre></td></tr></table></figure></p>
<h3 id="运行级别（管理target-unit）"><a href="#运行级别（管理target-unit）" class="headerlink" title="运行级别（管理target unit）"></a>运行级别（管理target unit）</h3><p>★ target units：<br>◆ unit配置文件：.target<br>&ensp;&ensp;&ensp;&ensp;ls /usr/lib/systemd/system/<em>.target<br>&ensp;&ensp;&ensp;&ensp;systemctl list-unit-files –type target –all<br>★ 运行级别：<br>&ensp;&ensp;&ensp;&ensp;0 ==&gt; runlevel0.target, poweroff.target<br>&ensp;&ensp;&ensp;&ensp;1 ==&gt; runlevel1.target, rescue.target     单用户模式或者救援模式<br>&ensp;&ensp;&ensp;&ensp;2 ==&gt; runlevel2.target, multi-user.target<br>&ensp;&ensp;&ensp;&ensp;3 ==&gt; runlevel3.target, multi-user.target  正常级别，字符型界面<br>&ensp;&ensp;&ensp;&ensp;4 ==&gt; runlevel4.target, multi-user.target<br>&ensp;&ensp;&ensp;&ensp;5 ==&gt; runlevel5.target, graphical.target  图形模式<br>&ensp;&ensp;&ensp;&ensp;6 ==&gt; runlevel6.target, reboot.target      重启<br>★ 查看依赖性：<br>&ensp;&ensp;&ensp;&ensp;systemctl list-dependencies graphical.target<br>★ 级别切换：<br>&ensp;&ensp;&ensp;&ensp;init N ==&gt; systemctl isolate name.target<br>&ensp;&ensp;&ensp;&ensp;如：systemctl isolate multi-user.target # 切换到级别3<br>注意：<br>&ensp;&ensp;&ensp;&ensp;只有/lib/systemd/system/</em>.target文件中AllowIsolate=yes 才能切换(修改文件需执行systemctl daemon-reload才能生效)<br>★ 查看级别：<br>&ensp;&ensp;&ensp;&ensp;runlevel，who -r ==&gt; systemctl list-units –type target<br>★ 获取默认运行级别：<br>&ensp;&ensp;&ensp;&ensp;/etc/inittab ==&gt; systemctl get-default<br>★ 修改默认级别：<br>&ensp;&ensp;&ensp;&ensp;/etc/inittab==&gt; systemctl set-default name.target<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;如：<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;systemctl set-default multi-user.target  //修改为3级别<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;ls –l /etc/systemd/system/default.target<br>◆ 演示<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#显示的所有级别</span></div><div class="line">[root@centos7 ~]<span class="comment"># ls /usr/lib/systemd/system/*.target</span></div><div class="line">/usr/lib/systemd/system/basic.target               /usr/lib/systemd/system/poweroff.target</div><div class="line">/usr/lib/systemd/system/bluetooth.target           /usr/lib/systemd/system/printer.target</div><div class="line">/usr/lib/systemd/system/cryptsetup-pre.target      /usr/lib/systemd/system/reboot.target</div><div class="line">/usr/lib/systemd/system/cryptsetup.target          /usr/lib/systemd/system/remote-fs-pre.target</div><div class="line">/usr/lib/systemd/system/ctrl-alt-del.target        /usr/lib/systemd/system/remote-fs.target</div><div class="line">/usr/lib/systemd/system/default.target             /usr/lib/systemd/system/rescue.target</div><div class="line">/usr/lib/systemd/system/emergency.target           /usr/lib/systemd/system/rpcbind.target</div><div class="line">/usr/lib/systemd/system/final.target               /usr/lib/systemd/system/runlevel0.target</div><div class="line">/usr/lib/systemd/system/getty.target               /usr/lib/systemd/system/runlevel1.target</div><div class="line">/usr/lib/systemd/system/graphical.target           /usr/lib/systemd/system/runlevel2.target</div><div class="line">/usr/lib/systemd/system/halt.target                /usr/lib/systemd/system/runlevel3.target</div><div class="line">/usr/lib/systemd/system/hibernate.target           /usr/lib/systemd/system/runlevel4.target</div><div class="line">/usr/lib/systemd/system/hybrid-sleep.target        /usr/lib/systemd/system/runlevel5.target</div><div class="line">/usr/lib/systemd/system/initrd-fs.target           /usr/lib/systemd/system/runlevel6.target</div><div class="line">/usr/lib/systemd/system/initrd-root-fs.target      /usr/lib/systemd/system/shutdown.target</div><div class="line">/usr/lib/systemd/system/initrd-switch-root.target  /usr/lib/systemd/system/sigpwr.target</div><div class="line">/usr/lib/systemd/system/initrd.target              /usr/lib/systemd/system/sleep.target</div><div class="line">/usr/lib/systemd/system/iprutils.target            /usr/lib/systemd/system/slices.target</div><div class="line">/usr/lib/systemd/system/kexec.target               /usr/lib/systemd/system/smartcard.target</div><div class="line">/usr/lib/systemd/system/<span class="built_in">local</span>-fs-pre.target        /usr/lib/systemd/system/sockets.target</div><div class="line">/usr/lib/systemd/system/<span class="built_in">local</span>-fs.target            /usr/lib/systemd/system/sound.target</div><div class="line">/usr/lib/systemd/system/machines.target            /usr/lib/systemd/system/suspend.target</div><div class="line">/usr/lib/systemd/system/multi-user.target          /usr/lib/systemd/system/swap.target</div><div class="line">/usr/lib/systemd/system/network-online.target      /usr/lib/systemd/system/sysinit.target</div><div class="line">/usr/lib/systemd/system/network-pre.target         /usr/lib/systemd/system/system-update.target</div><div class="line">/usr/lib/systemd/system/network.target             /usr/lib/systemd/system/timers.target</div><div class="line">/usr/lib/systemd/system/nss-lookup.target          /usr/lib/systemd/system/time-sync.target</div><div class="line">/usr/lib/systemd/system/nss-user-lookup.target     /usr/lib/systemd/system/umount.target</div><div class="line">/usr/lib/systemd/system/paths.target</div><div class="line"><span class="comment">#查看级别依赖性</span></div><div class="line">[root@centos7 ~]<span class="comment"># systemctl list-dependencies graphical.target</span></div><div class="line">graphical.target</div><div class="line">* |-display-manager.service</div><div class="line">* |-network.service</div><div class="line">* |-systemd-update-utmp-runlevel.service</div><div class="line">* `-multi-user.target</div><div class="line">*   |-abrt-ccpp.service</div><div class="line">*   |-abrt-oops.service</div><div class="line">*   |-abrt-vmcore.service</div><div class="line">*   |-abrt-xorg.service</div><div class="line">*   |-abrtd.service</div><div class="line">*   |-auditd.service</div><div class="line">*   |-brandbot.path</div><div class="line">*   |-crond.service</div><div class="line">*   |-dbus.service</div><div class="line">*   |-irqbalance.service</div><div class="line">*   |-network.service</div><div class="line">*   |-NetworkManager.service</div><div class="line"><span class="comment">#查看当前运行级别</span></div><div class="line">[root@centos7 ~]<span class="comment"># who -r</span></div><div class="line">         run-level 3  Jul 12 22:30</div><div class="line">[root@centos7 ~]<span class="comment"># runlevel</span></div><div class="line">N 3</div><div class="line"><span class="comment">#查看运行级别</span></div><div class="line">[root@centos7 ~]<span class="comment"># systemctl list-units -t target</span></div><div class="line">UNIT                  LOAD   ACTIVE SUB    DESCRIPTION</div><div class="line">basic.target          loaded active active Basic System</div><div class="line">cryptsetup.target     loaded active active Encrypted Volumes</div><div class="line">getty.target          loaded active active Login Prompts</div><div class="line"><span class="built_in">local</span>-fs-pre.target   loaded active active Local File Systems (Pre)</div><div class="line"><span class="built_in">local</span>-fs.target       loaded active active Local File Systems</div><div class="line">multi-user.target     loaded active active Multi-User System</div><div class="line">network-online.target loaded active active Network is Online</div><div class="line">network.target        loaded active active Network</div><div class="line">paths.target          loaded active active Paths</div><div class="line">remote-fs.target      loaded active active Remote File Systems</div><div class="line">slices.target         loaded active active Slices</div><div class="line">sockets.target        loaded active active Sockets</div><div class="line">sound.target          loaded active active Sound Card</div><div class="line">swap.target           loaded active active Swap</div><div class="line">sysinit.target        loaded active active System Initialization</div><div class="line">timers.target         loaded active active Timers</div><div class="line"></div><div class="line">LOAD   = Reflects whether the unit definition was properly loaded.</div><div class="line">ACTIVE = The high-level unit activation state, i.e. generalization of SUB.</div><div class="line">SUB    = The low-level unit activation state, values depend on unit type.</div><div class="line"></div><div class="line">16 loaded units listed. Pass --all to see loaded but inactive units, too.</div><div class="line">To show all installed unit files use <span class="string">'systemctl list-unit-files'</span>.</div><div class="line"><span class="comment">#获取默认运行级别</span></div><div class="line">[root@centos7 ~]<span class="comment"># systemctl get-default</span></div><div class="line">multi-user.target</div><div class="line"><span class="comment">#切换到5级别</span></div><div class="line">[root@centos7 ~]<span class="comment"># systemctl isolate graphical.target</span></div><div class="line">PolicyKit daemon disconnected from the bus.</div></pre></td></tr></table></figure></p>
<h3 id="开关机及相关命令"><a href="#开关机及相关命令" class="headerlink" title="开关机及相关命令"></a>开关机及相关命令</h3><p>◆ 切换至紧急救援模式：<br>&ensp;&ensp;&ensp;&ensp;systemctl rescue<br>◆ 切换至emergency(紧急)模式：<br>&ensp;&ensp;&ensp;&ensp;systemctlemergency<br>◆ 其它常用命令：<br>  传统命令 init，poweroff，halt，reboot都成为systemctl的软链接<br>&ensp;&ensp;&ensp;&ensp;关机：systemctl halt 或者 systemctl poweroff<br>&ensp;&ensp;&ensp;&ensp;重启：systemctl reboot<br>&ensp;&ensp;&ensp;&ensp;挂起：systemctl suspend<br>&ensp;&ensp;&ensp;&ensp;快照（休眠）：systemctl hibernate<br>&ensp;&ensp;&ensp;&ensp;快照并挂起：systemctl hybrid-sleep</p>
<h3 id="service-unit-文件格式"><a href="#service-unit-文件格式" class="headerlink" title="service unit 文件格式"></a>service unit 文件格式</h3><p>★ 文件及格式：<br>◆ 文件位置及使用<br>&ensp;&ensp;&ensp;&ensp;/etc/systemd/system：系统管理员和用户使用；<br>&ensp;&ensp;&ensp;&ensp;/usr/lib/systemd/system：发行版打包者使用；<br>◆ 说明：<br>&ensp;&ensp;&ensp;&ensp;☉以“#” 开头的行后面的内容会被认为是注释；<br>&ensp;&ensp;&ensp;&ensp;☉相关布尔值，1、yes、on、true 都是开启，0、no、off、false 都是关闭；<br>&ensp;&ensp;&ensp;&ensp;☉时间单位默认是秒，所以要用毫秒（ms）分钟（m）等请显式说明；<br>★ service unit file文件通常由三部分组成：<br>◆ [Unit]：<br>&ensp;&ensp;&ensp;&ensp;定义与Unit类型无关的通用选项；用于提供unit的描述信息、unit行为及依赖关系等;<br>◆ [Service]：<br>&ensp;&ensp;&ensp;&ensp;与特定类型相关的专用选项；此处为Service类型；<br>◆ [Install]：<br>&ensp;&ensp;&ensp;&ensp;定义由“systemctl enable”以及”systemctl disable“命令在实现服务启用或禁用时用到的一些选项。<br>★ 文件格式如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">[root@centos7 ~]<span class="comment"># cd /usr/lib/systemd/system</span></div><div class="line">[root@centos7 system]<span class="comment"># cat httpd.service </span></div><div class="line">[Unit]</div><div class="line">Description=The Apache HTTP Server</div><div class="line">After=network.target remote-fs.target nss-lookup.target   <span class="comment">#定义启动顺序</span></div><div class="line">Documentation=man:httpd(8)</div><div class="line">Documentation=man:apachectl(8)</div><div class="line"></div><div class="line">[Service]</div><div class="line">Type=notify</div><div class="line">EnvironmentFile=/etc/sysconfig/httpd</div><div class="line">ExecStart=/usr/sbin/httpd <span class="variable">$OPTIONS</span> -DFOREGROUND</div><div class="line">ExecReload=/usr/sbin/httpd <span class="variable">$OPTIONS</span> -k graceful</div><div class="line">ExecStop=/bin/<span class="built_in">kill</span> -WINCH <span class="variable">$&#123;MAINPID&#125;</span></div><div class="line"><span class="comment"># We want systemd to give httpd some time to finish gracefully, but still want</span></div><div class="line"><span class="comment"># it to kill httpd after TimeoutStopSec if something went wrong during the</span></div><div class="line"><span class="comment"># graceful stop. Normally, Systemd sends SIGTERM signal right after the</span></div><div class="line"><span class="comment"># ExecStop, which would kill httpd. We are sending useless SIGCONT here to give</span></div><div class="line"><span class="comment"># httpd time to finish.</span></div><div class="line">KillSignal=SIGCONT</div><div class="line">PrivateTmp=<span class="literal">true</span></div><div class="line"></div><div class="line">[Install]</div><div class="line">WantedBy=multi-user.target</div></pre></td></tr></table></figure></p>
<p>★ Unit段的常用选项意义：<br>&ensp;&ensp;&ensp;&ensp;☉ Description：描述信息，意义性描述；<br>&ensp;&ensp;&ensp;&ensp;☉ After：定义unit的启动次序，表示当前unit应该晚于哪些unit启动，其功能与Before相反<br>&ensp;&ensp;&ensp;&ensp;☉ Requires：依赖到的其它units，强依赖，被依赖的units无法激活时，当前unit即无法激活<br>&ensp;&ensp;&ensp;&ensp;☉ Wants：依赖到的其它units，弱依赖；<br>&ensp;&ensp;&ensp;&ensp;☉ Conflicts：定义units间的冲突关系<br>★ Service段的常用选项意义：<br>◆ Type：定义影响ExecStart及相关参数的功能的unit进程启动类型:<br>&ensp;&ensp;&ensp;&ensp;☉ simple：默认值，这个daemon主要由ExecStart接的指令串来启动，启动后常驻于内存中<br>&ensp;&ensp;&ensp;&ensp;☉ forking：由ExecStart启动的程序透过spawns延伸出其他子程序来作为此daemon的主要服务。原生父程序在启动结束后就会终止<br>&ensp;&ensp;&ensp;&ensp;☉ oneshot：与simple类似，不过这个程序在工作完毕后就结束了，不会常驻在内存中<br>&ensp;&ensp;&ensp;&ensp;☉ dbus：与simple类似，但这个daemon必须要在取得一个D-Bus的名称后，才会继续运作.因此通常也要同时设定BusNname= 才行<br>&ensp;&ensp;&ensp;&ensp;☉ notify：在启动完成后会发送一个通知消息。还需要配合NotifyAccess 来让Systemd 接收消息<br>&ensp;&ensp;&ensp;&ensp;☉ idle：与simple类似，要执行这个daemon必须要所有的工作都顺利执行完毕后才会执行。这类的daemon通常是开机到最后才执行即可的服务<br>◆ EnvironmentFile：环境配置文件；<br>◆ ExecStart：指明启动unit要运行命令或脚本的绝对路径；<br>◆ ExecStartPre：ExecStart前运行；<br>◆ ExecStartPost：ExecStart后运行；<br>◆ ExecStop：指明停止unit要运行的命令或脚本；<br>◆ Restart：当设定Restart=1 时，则当次daemon服务意外终止后，会再次自动启动此服务<br>★ Install段的常用选项意义：<br>&ensp;&ensp;&ensp;&ensp;☉ Alias：别名，可使用systemctl command Alias.service<br>&ensp;&ensp;&ensp;&ensp;☉ RequiredBy：被哪些units所依赖，强依赖<br>&ensp;&ensp;&ensp;&ensp;☉ WantedBy：被哪些units所依赖，弱依赖<br>&ensp;&ensp;&ensp;&ensp;☉ Also：安装本服务的时候还要安装别的相关服务<br>★ 注意：<br>对于新创建的unit文件，或者修改了的unit文件，要通知systemd重载此配置文件,而后可以选择重启<br>&ensp;&ensp;&ensp;&ensp;systemctl daemon-reload</p>
<h3 id="服务Unit文件示例"><a href="#服务Unit文件示例" class="headerlink" title="服务Unit文件示例:"></a>服务Unit文件示例:</h3><p>★ 创建一个脚本，用于被创建的服务调用<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[root@centos7 scripts]<span class="comment"># cat backup_etc.sh </span></div><div class="line"><span class="comment">#/bin/bash</span></div><div class="line"><span class="comment">#</span></div><div class="line">cp <span class="_">-a</span> /etc /backups</div><div class="line"><span class="built_in">cd</span> /backups</div><div class="line">tar -Jcf etc-$(date +%Y-%m-%d-%H).tar.xz etc</div><div class="line">rm -rf etc</div></pre></td></tr></table></figure></p>
<p>★ 给compress.sh脚本添加执行权限<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@centos7 backups]<span class="comment"># chmod u+x /root/scripts/backup_etc.sh</span></div></pre></td></tr></table></figure></p>
<p>★ 创建backup.service服务<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">[root@centos7 ~]<span class="comment"># vim /etc/systemd/system/backup.service </span></div><div class="line">[Unit]</div><div class="line">Description=backup etc directory and archive</div><div class="line"></div><div class="line">[Service]</div><div class="line">Type=simple</div><div class="line">ExecStart=/bin/bash /root/scripts/backup_etc.sh</div><div class="line"></div><div class="line">[Install]</div><div class="line">WantedBy=multi-user.target</div></pre></td></tr></table></figure></p>
<p>★ 启用服务<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@centos7 ~]<span class="comment"># systemctl daemon-reload</span></div><div class="line">[root@centos7 ~]<span class="comment"># systemctl start backup.service</span></div></pre></td></tr></table></figure></p>
<p>★ 验证：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">[root@centos7 backups]<span class="comment"># systemctl status backup.service</span></div><div class="line">?.backup.service - backup etc directory and archive</div><div class="line">   Loaded: loaded (/etc/systemd/system/backup.service; disabled; vendor preset: disabled)</div><div class="line">   Active: active (running) since Thu 2017-07-13 23:12:05 CST; 7s ago</div><div class="line"> Main PID: 2307 (bash)</div><div class="line">   CGroup: /system.slice/backup.service</div><div class="line">           ?..2307 /bin/bash /root/scripts/backup_etc.sh</div><div class="line">           ?..2310 tar -Jcf etc-2017-07-13-23.tar.xz etc</div><div class="line">           ?..2311 xz</div><div class="line"></div><div class="line">Jul 13 23:12:05 centos7 systemd[1]: Started backup etc directory and archive.</div><div class="line">Jul 13 23:12:05 centos7 systemd[1]: Starting backup etc directory and archive...</div><div class="line">[root@centos7 backups]<span class="comment"># cd /backups</span></div><div class="line">[root@centos7 backups]<span class="comment"># ls</span></div><div class="line">etc-2017-07-13-23.tar.xz</div></pre></td></tr></table></figure></p>
<h3 id="CentOS-7-引导顺序"><a href="#CentOS-7-引导顺序" class="headerlink" title="CentOS 7 引导顺序"></a>CentOS 7 引导顺序</h3><p>◆ UEFi或BIOS初始化，运行POST开机自检<br>◆ 选择启动设备<br>◆ 引导装载程序, centos7是grub2<br>◆ 加载装载程序的配置文件：/etc/grub.d/ /etc/default/grub /boot/grub2/grub.cfg<br>◆ 加载initramfs驱动模块<br>◆ 加载内核选项<br>◆ 内核初始化，centos7使用systemd代替init<br>◆ 执行initrd.target所有单元，包括挂载/etc/fstab<br>◆ 从initramfs根文件系统切换到磁盘根目录<br>◆ systemd执行默认target配置，配置文件/etc/systemd/default.target /etc/systemd/system/<br>◆ systemd执行sysinit.target初始化系统及basic.target准备操作系统<br>◆ systemd启动multi-user.target下的本机与服务器服务<br>◆ systemd执行multi-user.target下的/etc/rc.d/rc.local<br>◆ Systemd执行multi-user.target下的getty.target及登入服务<br>◆ systemd执行graphical需要的服务</p>
<p>★ 设置内核参数：<br>◆ 设置内核参数，只影响当次启动<br>◆ 启动时，在linux16行后添加<br>&ensp;&ensp;&ensp;&ensp;systemd.unit=desired.target<br>&ensp;&ensp;&ensp;&ensp;systemd.unit=emergency.target<br>&ensp;&ensp;&ensp;&ensp;systemd.unit=recure.target<br>&ensp;&ensp;&ensp;&ensp;recure.target 比emergency 支持更多的功能，例如日志等</p>
<p>★ 启动排错：<br>◆ 文件系统损坏<br>&ensp;&ensp;&ensp;&ensp;先尝试自动修复，失败则进入emergency shell，提示用户修复<br>◆ 在/etc/fstab不存在对应的设备和UUID<br>&ensp;&ensp;&ensp;&ensp;等一段时间，如不可用，进入emergency shell<br>◆ 在/etc/fstab不存在对应挂载点<br>&ensp;&ensp;&ensp;&ensp;systemd尝试创建挂载点，否则提示进入emergency shell.<br>★在/etc/fstab不正确的挂载选项<br>&ensp;&ensp;&ensp;&ensp;提示进入emergency shell</p>
<p>★ 破解root口令：<br>&ensp;&ensp;&ensp;&ensp;☉ 启动时任意键暂停启动<br>&ensp;&ensp;&ensp;&ensp;☉ 按e键进入编辑模式<br>&ensp;&ensp;&ensp;&ensp;☉ 将光标移动linux16开始的行，添加内核参数rd.break<br>&ensp;&ensp;&ensp;&ensp;☉ 按ctrl+X启动<br>&ensp;&ensp;&ensp;&ensp;☉ mount -o remount,rw /sysroot     #因为是只读挂载，所以要重新挂载成写的<br>&ensp;&ensp;&ensp;&ensp;☉ chroot /sysroot    #切换成真正文件系统的根<br>&ensp;&ensp;&ensp;&ensp;☉ passwd root<br>&ensp;&ensp;&ensp;&ensp;☉ touch /.autorelabel    #要重新打标签，触发selinux策略</p>
<p>★ 修复grub2<br>◆ grub “the Grand Unified Bootloader”<br>&ensp;&ensp;&ensp;&ensp;引导提示时可以使用命令行界面<br>&ensp;&ensp;&ensp;&ensp;可从文件系统引导<br>◆ 主要配置文件<br>&ensp;&ensp;&ensp;&ensp;/boot/grub2/grub.cfg<br>◆ 修复配置文件<br>&ensp;&ensp;&ensp;&ensp;grub2-mkconfig &gt; /boot/grub2/grub.cfg<br>◆ 修复grub<br>&ensp;&ensp;&ensp;&ensp;grub2-install /dev/sda    #BIOS环境<br>&ensp;&ensp;&ensp;&ensp;grub2-install     #UEFI环境</p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color1">system系统管理</a>
        		</li>
      		
		</ul>
	</div>

      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/2017/07/08/linux系统管理之systemd/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>





  
    <article id="post-linux之shell脚本编程之数组和字符串处理" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/07/06/linux之shell脚本编程之数组和字符串处理/">linux之shell脚本编程之数组和字符串处理</a>
    </h1>
  

        
        <a href="/2017/07/06/linux之shell脚本编程之数组和字符串处理/" class="archive-article-date">
  	<time datetime="2017-07-06T09:50:22.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2017-07-06</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h3><h4 id="1-数组的定义及声明"><a href="#1-数组的定义及声明" class="headerlink" title="1.数组的定义及声明"></a>1.数组的定义及声明</h4><p>★定义：<br>☉变量：<br>&ensp;&ensp;&ensp;&ensp;存储单个元素的内存空间；<br>☉数组：<br>&ensp;&ensp;&ensp;&ensp;存储多个元素的连续的内存空间，相当于多个变量的集合；<br>☉数组名和索引：<br>&ensp;&ensp;&ensp;&ensp;数组名：整个数组只有一个名字；<br>&ensp;&ensp;&ensp;&ensp;索引：编号从0开始，属于数值索引；<br>&ensp;&ensp;&ensp;&ensp;bash的数组支持稀疏格式（索引不连续）<br>◆格式：<br>&ensp;&ensp;&ensp;&ensp;数组名[索引]<br>&ensp;&ensp;&ensp;&ensp;${ARRAY_NAME[INDEX]}  必需加花括号 { }<br>注意：<br>&ensp;&ensp;&ensp;&ensp;索引可支持使用自定义的索引格式，而不仅是数值格式（0,1,2…），即为关联数组，bash4.0版本之后开始支持。<br>★声明数组：<br>&ensp;&ensp;&ensp;&ensp;declare -a ARRAY_NAME：声明一个索引数组<br>&ensp;&ensp;&ensp;&ensp;declare -A ARRAY_NAME：声明一个关联数组 (必须先声明再使用)<br>版本查询<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[root@localhost lab]<span class="comment"># bash --version</span></div><div class="line">GNU bash, version 4.2.46(1)-release (x86_64-redhat-linux-gnu)</div><div class="line">Copyright (C) 2011 Free Software Foundation, Inc.</div><div class="line">License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;</div><div class="line"></div><div class="line">This is free software; you are free to change and redistribute it.</div><div class="line">There is NO WARRANTY, to the extent permitted by law.</div></pre></td></tr></table></figure></p>
<h4 id="2-数组元素的赋值"><a href="#2-数组元素的赋值" class="headerlink" title="2.数组元素的赋值"></a>2.数组元素的赋值</h4><p>★一次只赋值一个元素：<br>☉格式：<br>&ensp;&ensp;&ensp;&ensp;ARRAY_NAME[INDEX]=VALUE<br>示例：<br>&ensp;&ensp;&ensp;&ensp;weekdays[0]=”Sunday”<br>&ensp;&ensp;&ensp;&ensp;weekdays[4]=”Thursday”<br>★一次只赋值全部元素：<br>☉格式：<br>&ensp;&ensp;&ensp;&ensp;ARRAY_NAME=(“VAL1” “VAL2” “VAL3” …)<br> 注意：可以使用 命令引用，glob 通配等方法赋值<br>★一次只赋值特定元素<br>☉格式：<br>&ensp;&ensp;&ensp;&ensp;ARRAY_NAME=([0]=”VAL1” [3]=”VAL2” …)<br>&ensp;&ensp;&ensp;&ensp;支持稀疏格式的数组<br>★使用read 交互式数组赋值<br>☉格式：<br>&ensp;&ensp;&ensp;&ensp;read -a ARRAY</p>
<h4 id="演示："><a href="#演示：" class="headerlink" title="演示："></a>演示：</h4><p>1.一次只赋值一个元素：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">[root@localhost lab]<span class="comment"># declare -a animals          # 使用前最好先声明数组，当然不声明也可以</span></div><div class="line"></div><div class="line"><span class="comment"># 一次赋值一个元素</span></div><div class="line">[root@localhost lab]<span class="comment"># animals[0]=rat</span></div><div class="line">[root@localhost lab]<span class="comment"># animals[1]=ox</span></div><div class="line"></div><div class="line"><span class="comment"># 查看赋值，一定要注意书写格式，一定要加 &#123;&#125;</span></div><div class="line">[root@localhost lab]<span class="comment"># echo $animals</span></div><div class="line">rat</div><div class="line">[root@localhost lab]<span class="comment"># echo $animals[0]    # 错误写法，把其看做两部分 $animals 替换为 pig，[0]随后</span></div><div class="line">rat[0]</div><div class="line">[root@localhost lab]<span class="comment"># echo $&#123;animals[0]&#125;</span></div><div class="line">rat</div><div class="line">[root@localhost lab]<span class="comment"># echo $&#123;animals[1]&#125;</span></div><div class="line">ox</div><div class="line">[root@localhost lab]<span class="comment"># echo $&#123;animals[*]&#125;   # 查看数组所有赋值</span></div><div class="line">rat ox</div></pre></td></tr></table></figure></p>
<p>2.一次只赋值全部元素：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">[root@localhost lab]<span class="comment"># calender=(rat ox tigger rabbit dragon snake horse ram monkey rooster dog pig)</span></div><div class="line">[root@localhost lab]<span class="comment"># echo $&#123;calender[3]&#125;</span></div><div class="line">rabbit</div><div class="line">[root@localhost lab]<span class="comment"># echo $&#123;calender[0]&#125;</span></div><div class="line">rat</div><div class="line"></div><div class="line"><span class="comment"># 下面的赋值方法也可以</span></div><div class="line">[root@localhost lab]<span class="comment"># number=(&#123;1..9&#125;)</span></div><div class="line">[root@localhost lab]<span class="comment"># echo $&#123;number[*]&#125;</span></div><div class="line">1 2 3 4 5 6 7 8 9</div><div class="line"></div><div class="line">[root@localhost lab]<span class="comment"># file=(/home/*)</span></div><div class="line">[root@localhost lab]<span class="comment"># echo $&#123;file[*]&#125;</span></div><div class="line">/home/jack /home/zmj</div><div class="line"></div><div class="line">[root@localhost lab]<span class="comment"># files=($(ls /home))</span></div><div class="line">[root@localhost lab]<span class="comment"># echo $&#123;files[*]&#125;</span></div><div class="line">jack zmj</div><div class="line"></div><div class="line">[root@localhost lab]<span class="comment"># files=(&#123;1,2&#125;&#123;a,b&#125;)</span></div><div class="line">[root@localhost lab]<span class="comment"># echo $&#123;files[*]&#125;</span></div><div class="line">1a 1b 2a 2b</div></pre></td></tr></table></figure></p>
<p>3.只赋值特定元素，稀疏格式的数组<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">[root@localhost lab]<span class="comment"># num=([0]=100 [2]=50 [3]=20)</span></div><div class="line">[root@localhost lab]<span class="comment"># echo $&#123;num[0]&#125;</span></div><div class="line">100</div><div class="line">[root@localhost lab]<span class="comment"># echo $&#123;num[1]&#125;</span></div><div class="line"></div><div class="line">[root@localhost lab]<span class="comment"># echo $&#123;num[2]&#125;</span></div><div class="line">50</div><div class="line">[root@localhost lab]<span class="comment"># echo $&#123;num[3]&#125;</span></div><div class="line">20</div><div class="line">[root@localhost lab]<span class="comment"># echo $&#123;num[*]&#125;</span></div><div class="line">100 50 20</div></pre></td></tr></table></figure></p>
<p>4.使用read交互式数组赋值<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">[root@localhost lab]<span class="comment"># read -a num</span></div><div class="line">1 2 3 4 5 6 7 8      </div><div class="line">[root@localhost lab]<span class="comment"># echo $&#123;num[0]&#125;</span></div><div class="line">1</div><div class="line">[root@localhost lab]<span class="comment"># echo $&#123;num[4]&#125;</span></div><div class="line">5</div><div class="line">[root@localhost lab]<span class="comment"># echo $&#123;num[*]&#125;</span></div><div class="line">1 2 3 4 5 6 7 8</div></pre></td></tr></table></figure></p>
<p>5.关联数组赋值<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 使用自定义的索引格式，即关联数组，如果不事先声明，会出现如下错误，索引总是显示最后一个元素</span></div><div class="line">[root@localhost lab]<span class="comment"># username[F]=zhou</span></div><div class="line">[root@localhost lab]<span class="comment"># username[M]=ming</span></div><div class="line">[root@localhost lab]<span class="comment"># username[J]=jie</span></div><div class="line">[root@localhost lab]<span class="comment"># echo $&#123;username[F]&#125;</span></div><div class="line">jie</div><div class="line">[root@localhost lab]<span class="comment"># echo $&#123;username[M]&#125;</span></div><div class="line">jie</div><div class="line">[root@localhost lab]<span class="comment"># echo $&#123;username[J]&#125;</span></div><div class="line">jie</div><div class="line">[root@localhost lab]<span class="comment"># echo $&#123;username[*]&#125;</span></div><div class="line">jie</div><div class="line"></div><div class="line"><span class="comment"># 已经为索引数组就不能再次声明为关联数组了</span></div><div class="line">[root@localhost lab]<span class="comment"># declare -A username</span></div><div class="line">-bash: <span class="built_in">declare</span>: username: cannot convert indexed to associative array</div><div class="line"></div><div class="line"><span class="comment"># 声明一个关联数组，并赋值</span></div><div class="line">[root@localhost lab]<span class="comment"># declare -A jack</span></div><div class="line">[root@localhost lab]<span class="comment"># jack[A]=zhou</span></div><div class="line">[root@localhost lab]<span class="comment"># jack[B]=ming</span></div><div class="line">[root@localhost lab]<span class="comment"># jack[C]=jie</span></div><div class="line">[root@localhost lab]<span class="comment"># echo "$&#123;jack[A]&#125;"</span></div><div class="line">zhou</div><div class="line">[root@localhost lab]<span class="comment"># echo $&#123;jack[B]&#125;</span></div><div class="line">ming</div><div class="line">[root@localhost lab]<span class="comment"># echo $&#123;jack[C]&#125;</span></div><div class="line">jie</div><div class="line">[root@localhost lab]<span class="comment"># echo $&#123;jack[*]&#125;</span></div><div class="line">zhou ming jie</div></pre></td></tr></table></figure></p>
<h4 id="3-引用数组元素"><a href="#3-引用数组元素" class="headerlink" title="3.引用数组元素"></a>3.引用数组元素</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">★引用数组中的元素：</div><div class="line">☉格式：</div><div class="line"><span class="variable">$&#123;ARRAY_NAME[INDEX]&#125;</span></div><div class="line">注意：</div><div class="line">省略[INDEX]表示引用下标为0的元素；</div><div class="line">索引数组是从0开始缩印的，如果数组元素个数为n，那么索引数为 n-1</div><div class="line">★数组的长度（数组中元素的个数）：</div><div class="line"><span class="variable">$&#123;#ARRAY_NAME[*]&#125;</span></div><div class="line"><span class="variable">$&#123;#ARRAY_NAME[@]&#125;</span></div><div class="line">★引用数组中的所有元素</div><div class="line"><span class="variable">$&#123;ARRAY_NAME[*]&#125;</span></div><div class="line"><span class="variable">$&#123;ARRAY_NAME[@]&#125;</span></div></pre></td></tr></table></figure>
<p>演示：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">[root@localhost lab]<span class="comment"># num=(&#123;1..9&#125;)</span></div><div class="line">[root@localhost lab]<span class="comment"># echo $&#123;#num[*]&#125;</span></div><div class="line">9</div><div class="line">[root@localhost lab]<span class="comment"># echo $&#123;num[*]&#125;</span></div><div class="line">1 2 3 4 5 6 7 8 9</div><div class="line">[root@localhost lab]<span class="comment"># echo $&#123;num[@]&#125;</span></div><div class="line">1 2 3 4 5 6 7 8 9</div><div class="line">[root@localhost lab]<span class="comment"># var=(zhou ming jie)</span></div><div class="line">[root@localhost lab]<span class="comment"># echo $&#123;#var[*]&#125;</span></div><div class="line">3</div><div class="line">[root@localhost lab]<span class="comment"># echo $&#123;var[*]&#125;</span></div><div class="line">zhou ming jie</div><div class="line"></div><div class="line"><span class="comment"># &#123;&#125;里面是一个变量，$&#123;#VAR&#125;就表示变量的长度，而之前的 $#,表示传递给脚本的参数个数，注意区别</span></div><div class="line">[root@localhost lab]<span class="comment"># echo $&#123;#var&#125;</span></div><div class="line">4</div><div class="line">[root@localhost lab]<span class="comment"># echo $&#123;#var[2]&#125;</span></div><div class="line">3</div><div class="line">[root@localhost lab]<span class="comment"># echo $&#123;#var[1]&#125;</span></div><div class="line">4</div></pre></td></tr></table></figure></p>
<h4 id="4-数组元素切片"><a href="#4-数组元素切片" class="headerlink" title="4.数组元素切片"></a>4.数组元素切片</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">★格式：</div><div class="line">  <span class="variable">$&#123;ARRAY_NAME[@]:offest:number&#125;</span></div><div class="line">      offest：要跳过的元素个数，即偏移量；</div><div class="line">      number：要取出的元素个数；省略number时，表示取偏移量之后的所有元素；</div></pre></td></tr></table></figure>
<p>演示：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 一次赋值数组全部元素</span></div><div class="line">[root@localhost lab]<span class="comment"># ls -d /etc/[Pp]*</span></div><div class="line">/etc/pam.d    /etc/pkcs11    /etc/pm        /etc/postfix         /etc/printcap   /etc/protocols</div><div class="line">/etc/passwd   /etc/pki       /etc/polkit-1  /etc/ppp             /etc/profile    /etc/python</div><div class="line">/etc/passwd-  /etc/plymouth  /etc/popt.d    /etc/prelink.conf.d  /etc/profile.d</div><div class="line">[root@localhost lab]<span class="comment"># files=(/etc/[Pp]*)</span></div><div class="line">[root@localhost lab]<span class="comment"># echo $&#123;files[*]&#125;</span></div><div class="line">/etc/pam.d /etc/passwd /etc/passwd- /etc/pkcs11 /etc/pki /etc/plymouth /etc/pm /etc/polkit-1 /etc/popt.d /etc/postfix /etc/ppp /etc/prelink.conf.d /etc/printcap /etc/profile /etc/profile.d /etc/protocols /etc/python</div><div class="line">[root@localhost lab]<span class="comment"># echo $&#123;#files[*]&#125;</span></div><div class="line">17</div><div class="line"></div><div class="line"><span class="comment"># 跳过前两个元素，取后面的三个元素</span></div><div class="line">[root@localhost lab]<span class="comment"># echo $&#123;files[@]:2:3&#125;</span></div><div class="line">/etc/passwd- /etc/pkcs11 /etc/pki</div><div class="line"></div><div class="line"><span class="comment"># 跳过前20个元素，取后面的所有元素</span></div><div class="line">[root@localhost lab]<span class="comment"># echo $&#123;files[@]:15&#125;</span></div><div class="line">/etc/protocols /etc/python</div></pre></td></tr></table></figure></p>
<h4 id="5-数组的其他用法"><a href="#5-数组的其他用法" class="headerlink" title="5.数组的其他用法"></a>5.数组的其他用法</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">★向非稀疏格式数组中追加元素</div><div class="line">ARRAY_NAEM[<span class="variable">$&#123;#ARRAY_NAME[*]&#125;</span>]=</div><div class="line">★删除数组中的某元素</div><div class="line"><span class="built_in">unset</span> ARRAY[INDEX]</div><div class="line">★关联数组</div><div class="line">☉首先一定要声明数组</div><div class="line"><span class="built_in">declare</span> -A ARRAY_NAME</div><div class="line">☉赋值</div><div class="line">ARRAY_NAME=([index_name1]=<span class="string">"value1"</span> [index_name2]=<span class="string">"value2"</span>...)</div></pre></td></tr></table></figure>
<p>练习：<br>1.生成10个随机数保存于数组中，并找出其最大值和最小值<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">[root@localhost lab]<span class="comment"># cat rand.sh </span></div><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="built_in">declare</span> <span class="_">-a</span> rand</div><div class="line"><span class="built_in">declare</span> -i max=0</div><div class="line"><span class="built_in">declare</span> -i min=0</div><div class="line"></div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;0..9&#125;;<span class="keyword">do</span></div><div class="line">    rand[<span class="variable">$i</span>]=<span class="variable">$RANDOM</span></div><div class="line">    <span class="built_in">echo</span> <span class="string">"<span class="variable">$&#123;rand[$i]&#125;</span>"</span></div><div class="line">    <span class="keyword">if</span> [ <span class="variable">$i</span> <span class="_">-eq</span> 0 ];<span class="keyword">then</span></div><div class="line">       max=<span class="variable">$&#123;rand[$i]&#125;</span></div><div class="line">       min=<span class="variable">$&#123;rand[$i]&#125;</span></div><div class="line">    <span class="keyword">elif</span> [ <span class="variable">$&#123;rand[$i]&#125;</span> <span class="_">-gt</span> <span class="variable">$max</span> ];<span class="keyword">then</span></div><div class="line">       max=<span class="variable">$&#123;rand[$i]&#125;</span></div><div class="line">    <span class="keyword">elif</span> [ <span class="variable">$&#123;rand[$i]&#125;</span> <span class="_">-lt</span> <span class="variable">$min</span> ];<span class="keyword">then</span></div><div class="line">       min=<span class="variable">$&#123;rand[$i]&#125;</span></div><div class="line">    <span class="keyword">fi</span></div><div class="line"><span class="keyword">done</span></div><div class="line"></div><div class="line"><span class="built_in">echo</span> <span class="string">"MAX=<span class="variable">$max</span>"</span></div><div class="line"><span class="built_in">echo</span> <span class="string">"MIN=<span class="variable">$min</span>"</span></div></pre></td></tr></table></figure></p>
<p>执行结果如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">[root@localhost lab]<span class="comment"># bash rand.sh </span></div><div class="line">12873</div><div class="line">32179</div><div class="line">31617</div><div class="line">1561</div><div class="line">221</div><div class="line">11944</div><div class="line">11914</div><div class="line">737</div><div class="line">585</div><div class="line">2168</div><div class="line">MAX=32179</div><div class="line">MIN=221</div></pre></td></tr></table></figure></p>
<p>2.写一个脚本，定义一个数组，数组中的元素是/var/log目录下所有以.log结尾的文件；要统计其下标为偶数的文件中的行数之和。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">[root@localhost lab]<span class="comment"># cat file_row.sh</span></div><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="built_in">declare</span> <span class="_">-a</span> files</div><div class="line">files=(/var/<span class="built_in">log</span>/*.log)</div><div class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$&#123;files[*]&#125;</span>"</span></div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> $(seq 0 $[<span class="variable">$&#123;#files[*]&#125;</span>-1]);<span class="keyword">do</span></div><div class="line">    <span class="keyword">if</span> [ $[<span class="variable">$i</span>%2] <span class="_">-eq</span> 0 ];<span class="keyword">then</span></div><div class="line">       lines=`wc <span class="_">-l</span> <span class="variable">$&#123;files[$i]&#125;</span>|cut <span class="_">-d</span><span class="string">" "</span> <span class="_">-f</span>1`</div><div class="line">       sumlines=$[<span class="variable">$sumlins</span>+<span class="variable">$lines</span>]</div><div class="line">    <span class="keyword">fi</span></div><div class="line"><span class="keyword">done</span></div><div class="line"></div><div class="line"><span class="built_in">echo</span> <span class="string">"Sumlines:<span class="variable">$sumlines</span>"</span></div></pre></td></tr></table></figure></p>
<h3 id="bash的内置字符串处理工具"><a href="#bash的内置字符串处理工具" class="headerlink" title="bash的内置字符串处理工具"></a>bash的内置字符串处理工具</h3><h4 id="1-字符串切片"><a href="#1-字符串切片" class="headerlink" title="1.字符串切片"></a>1.字符串切片</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">★用法：</div><div class="line">☉<span class="variable">$&#123;#var&#125;</span>：</div><div class="line">返回字符串变量var的长度；</div><div class="line">☉<span class="variable">$&#123;var:offset&#125;</span>：</div><div class="line">返回字符串变量var中从第offset个字符后（不包括第offset个字符）的字符开始，到最后的部分，offset的取值在0 到<span class="variable">$&#123;#var&#125;</span>-1 之间；</div><div class="line">☉<span class="variable">$&#123;var:offset:number&#125;</span>：</div><div class="line">返回字符串变量var中从第offset个字符后（不包括第offset个字符）的字符开始，长度为number的部分；</div><div class="line">☉<span class="variable">$&#123;var: -lengh&#125;</span>：</div><div class="line">取字符串的最右侧几个字符：注意：冒号后必须有一空白字符</div></pre></td></tr></table></figure>
<p>演示：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">[root@localhost lab]<span class="comment"># name=zhoumingjie</span></div><div class="line"></div><div class="line"><span class="comment"># 查看字符串变量的长度</span></div><div class="line">[root@localhost lab]<span class="comment"># echo $&#123;name&#125;</span></div><div class="line">zhoumingjie</div><div class="line"></div><div class="line"><span class="comment"># 跳过指定的偏移量，取后面的所有字符</span></div><div class="line">[root@localhost lab]<span class="comment"># echo $&#123;name:2&#125;</span></div><div class="line">oumingjie</div><div class="line">[root@localhost lab]<span class="comment"># echo $&#123;name:4&#125;</span></div><div class="line">mingjie</div><div class="line"></div><div class="line"><span class="comment"># 跳过指定的偏移量，取指定长度的字符</span></div><div class="line">[root@localhost lab]<span class="comment"># echo $&#123;name:4:3&#125;</span></div><div class="line">min</div><div class="line">[root@localhost lab]<span class="comment"># echo $&#123;name:4:4&#125;</span></div><div class="line">ming</div><div class="line"></div><div class="line"><span class="comment">#取字符串最右侧的指定长度字符</span></div><div class="line">[root@localhost lab]<span class="comment"># echo $&#123;name: -4&#125;</span></div><div class="line">gjie</div><div class="line">[root@localhost lab]<span class="comment"># echo $&#123;name: -3&#125;</span></div><div class="line">jie</div></pre></td></tr></table></figure></p>
<h4 id="2-基于模式取子串"><a href="#2-基于模式取子串" class="headerlink" title="2.基于模式取子串"></a>2.基于模式取子串</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">★用法：</div><div class="line">☉<span class="variable">$&#123;var#*word&#125;</span>：其中word可以是指定的任意字符</div><div class="line">功能：</div><div class="line">自左而右，查找var变量所存储的字符串中，第一次出现的word, 删除字符串开头至第一次出现word字符之间的所有字符，包括word；</div><div class="line">☉<span class="variable">$&#123;var##*word&#125;</span>：</div><div class="line">功能：</div><div class="line">同上，不同的是，删除的是字符串开头至最后一次由word指定的字符之间的所有内容；</div><div class="line">☉<span class="variable">$&#123;var%word*&#125;</span>：</div><div class="line">功能：</div><div class="line">自右而左，查找var变量所存储的字符串中，第一次出现的word, 删除字符串最后一个字符向左至第一次出现word字符之间的所有字符；</div><div class="line">☉<span class="variable">$&#123;var%%word*&#125;</span>：</div><div class="line">功能：</div><div class="line">同上，只不过删除字符串最右侧的字符向左至最后一次出现word字符之间的所有字符；</div></pre></td></tr></table></figure>
<p>演示：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line">[root@localhost lab]<span class="comment"># mypath="/etc/init.d/functions"</span></div><div class="line">[root@localhost lab]<span class="comment"># echo $&#123;mypath&#125;</span></div><div class="line">/etc/init.d/<span class="built_in">functions</span></div><div class="line"><span class="comment"># 自左而右查找指定的任意字符，并删除</span></div><div class="line">[root@localhost lab]<span class="comment"># echo $&#123;mypath#*/&#125;</span></div><div class="line">etc/init.d/<span class="built_in">functions</span></div><div class="line">[root@localhost lab]<span class="comment"># echo $&#123;mypath##*/&#125;</span></div><div class="line"><span class="built_in">functions</span></div><div class="line"></div><div class="line"><span class="comment"># 自右而左查找指定的任意字符，并删除</span></div><div class="line">[root@localhost lab]<span class="comment"># echo $&#123;mypath%/*&#125;</span></div><div class="line">/etc/init.d</div><div class="line">[root@localhost lab]<span class="comment"># echo $&#123;mypath%%/*&#125;  # 因为最有一个为 路径首部的 / 所以全都删除了</span></div><div class="line"></div><div class="line">[root@localhost lab]<span class="comment"># url=http://www.jack.com:80</span></div><div class="line">[root@localhost lab]<span class="comment"># echo $&#123;url&#125;</span></div><div class="line">http://www.jack.com:80</div><div class="line">[root@localhost lab]<span class="comment"># echo $&#123;url##*/&#125;     # 自左而右查找最后一次出现“/”的字符，并删除之间所有的</span></div><div class="line">www.jack.com:80</div><div class="line"></div><div class="line">[root@localhost lab]<span class="comment"># echo $&#123;url%%:*&#125;     # 自右而左查找最后一次出现“:”的字符，并删除之间所有的</span></div><div class="line">http</div><div class="line"></div><div class="line">[root@localhost lab]<span class="comment"># echo $&#123;url##*:&#125;     # 自左而右查找最后一次出现“:”的字符，并删除之间所有的，实为取端口号</span></div><div class="line">80</div><div class="line">``</div><div class="line"><span class="comment">#### 3.字符串查找替换</span></div><div class="line">```bash</div><div class="line">★用法：</div><div class="line">☉<span class="variable">$&#123;var/pattern/substi&#125;</span>：</div><div class="line">查找var所表示的字符串中，第一次被pattern所匹配到的字符串，以substi替换之；</div><div class="line">☉<span class="variable">$&#123;var//pattern/substi&#125;</span>: </div><div class="line">查找var所表示的字符串中，所有能被pattern所匹配到的字符串，以substi替换之；</div><div class="line">☉<span class="variable">$&#123;var/#pattern/substi&#125;</span>：</div><div class="line">查找var所表示的字符串中，行首被pattern所匹配到的字符串，以substi替换之；</div><div class="line">☉<span class="variable">$&#123;var/%pattern/substi&#125;</span>：</div><div class="line">查找var所表示的字符串中，行尾被pattern所匹配到的字符串，以substi替换之；</div><div class="line">注意：</div><div class="line">pattern 中使用 glob 风格的通配符</div></pre></td></tr></table></figure></p>
<p>演示：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">[root@localhost lab]<span class="comment"># userinfo="root:x:0:0:root:/root admin:/root:/bin/chroot" </span></div><div class="line">[root@localhost lab]<span class="comment"># echo $&#123;userinfo/root/ROOT&#125;</span></div><div class="line">ROOT:x:0:0:root:/root admin:/root:/bin/chroot</div><div class="line"></div><div class="line">[root@localhost lab]<span class="comment"># echo $&#123;userinfo/r..t/ROOT&#125;    # 不支持使用正则表达式的模式匹配</span></div><div class="line">root:x:0:0:root:/root admin:/root:/bin/chroot</div><div class="line"></div><div class="line">[root@localhost lab]<span class="comment"># echo $&#123;userinfo/r??t/ROOT&#125;    # 支持 glob 风格的模式匹配</span></div><div class="line">ROOT:x:0:0:root:/root admin:/root:/bin/chroot</div><div class="line"></div><div class="line">[root@localhost lab]<span class="comment"># echo $&#123;userinfo//root/ROOT&#125;   #查找所有能够被root匹配到的字符串，并替换为ROOT</span></div><div class="line">ROOT:x:0:0:ROOT:/ROOT admin:/ROOT:/bin/chROOT</div><div class="line"></div><div class="line">[root@localhost lab]<span class="comment"># echo $&#123;userinfo//r??t/ROOT&#125;</span></div><div class="line">ROOT:x:0:0:ROOT:/ROOT admin:/ROOT:/bin/chROOT</div><div class="line"></div><div class="line">[root@localhost lab]<span class="comment"># echo $&#123;userinfo/#r??t/ROOT&#125;   # 查找行首能够被r??t匹配到的字符串，并替换为ROOT</span></div><div class="line">ROOT:x:0:0:root:/root admin:/root:/bin/chroot</div><div class="line"></div><div class="line">[root@localhost lab]<span class="comment"># echo $&#123;userinfo/%r??t/ROOT&#125;   # 查找行尾能够被r??t匹配到的字符串，并替换为ROOT</span></div><div class="line">root:x:0:0:root:/root admin:/root:/bin/chROOT</div></pre></td></tr></table></figure></p>
<h4 id="4-字符串查找并删除"><a href="#4-字符串查找并删除" class="headerlink" title="4.字符串查找并删除"></a>4.字符串查找并删除</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">★用法：</div><div class="line">☉<span class="variable">$&#123;var/pattern&#125;</span>：</div><div class="line">查找var所表示的字符串中，删除第一次被pattern所匹配到的字符串；</div><div class="line">☉<span class="variable">$&#123;var//pattern&#125;</span>：</div><div class="line">查找var所表示的字符串中，删除所有被pattern所匹配到的字符串；</div><div class="line">☉<span class="variable">$&#123;var/#pattern&#125;</span>：</div><div class="line">查找var所表示的字符串中，删除行首被pattern所匹配到的字符串；</div><div class="line">☉<span class="variable">$&#123;var/%pattern&#125;</span>：</div><div class="line">查找var所表示的字符串中，删除行尾被pattern所匹配到的字符串；</div></pre></td></tr></table></figure>
<p>演示：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">[root@localhost lab]<span class="comment"># echo $&#123;userinfo&#125;</span></div><div class="line">root:x:0:0:root:/root admin:/root:/bin/chroot</div><div class="line"></div><div class="line">[root@localhost lab]<span class="comment"># echo $&#123;userinfo/r??t&#125;       # 删除第一次被pattern所匹配到的字符串</span></div><div class="line">:x:0:0:root:/root admin:/root:/bin/chroot</div><div class="line"></div><div class="line">[root@localhost lab]<span class="comment"># echo $&#123;userinfo//r??t&#125;      # 删除所有被pattern所匹配到的字符串；</span></div><div class="line">:x:0:0::/ admin:/:/bin/ch</div><div class="line"></div><div class="line">[root@localhost lab]<span class="comment"># echo $&#123;userinfo/#r??t&#125;      # 删除行首被pattern所匹配到的字符串；</span></div><div class="line">:x:0:0:root:/root admin:/root:/bin/chroot</div><div class="line"></div><div class="line">[root@localhost lab]<span class="comment"># echo $&#123;userinfo/%r??t&#125;      # 删除行尾被pattern所匹配到的字符串；</span></div><div class="line">root:x:0:0:root:/root admin:/root:/bin/ch</div></pre></td></tr></table></figure></p>
<h4 id="5-字符大小写转换"><a href="#5-字符大小写转换" class="headerlink" title="5.字符大小写转换"></a>5.字符大小写转换</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">★用法：</div><div class="line"><span class="variable">$&#123;var^^&#125;</span>：把var中的所有小写字母转换为大写</div><div class="line"><span class="variable">$&#123;var,,&#125;</span>：把var中的所有大写字母转换为小写</div></pre></td></tr></table></figure>
<p>演示：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">[root@localhost lab]<span class="comment"># echo $url</span></div><div class="line">http://www.jack.com:80</div><div class="line">[root@localhost lab]<span class="comment"># echo $&#123;url^^&#125;        # 小写转换为大写</span></div><div class="line">HTTP://WWW.JACK.COM:80</div><div class="line">[root@localhost lab]<span class="comment"># myurl=$&#123;url^^&#125;</span></div><div class="line">[root@localhost lab]<span class="comment"># echo myurl</span></div><div class="line">myurl</div><div class="line">[root@localhost lab]<span class="comment"># echo $&#123;myurl,,&#125;      # 大写转换为小写</span></div><div class="line">http://www.jack.com:80</div></pre></td></tr></table></figure></p>
<h4 id="6-变量赋值"><a href="#6-变量赋值" class="headerlink" title="6.变量赋值"></a>6.变量赋值</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">★用法：</div><div class="line"><span class="variable">$&#123;var:-value&#125;</span>：如果var为空或未设置，那么返回value；否则，则返回var的值；</div><div class="line"><span class="variable">$&#123;var:=value&#125;</span>：如果var为空或未设置，那么返回value，并将value赋值给var；否则，则返回var的值；</div><div class="line"><span class="variable">$&#123;var:+value&#125;</span>：如果var不空，则返回value；</div><div class="line"><span class="variable">$&#123;var:?error_info&#125;</span>：如果var为空或未设置，那么返回error_info（错误信息提示）；否则，则返回var的值；</div></pre></td></tr></table></figure>
<p>演示：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">[root@localhost lab]<span class="comment"># echo $hi               # 变量 hi 为空</span></div><div class="line"></div><div class="line">[root@localhost lab]<span class="comment"># echo $&#123;hi:-world&#125;      # 如果为空或未设置，那么返回word</span></div><div class="line">world</div><div class="line">[root@localhost lab]<span class="comment"># echo $&#123;hi&#125;             # 但是并没有赋值给变量 hi</span></div><div class="line"></div><div class="line">[root@localhost lab]<span class="comment"># echo $&#123;hi:=world&#125;      #为空或未设置，那么返回world，并将world赋值给hi</span></div><div class="line">world</div><div class="line">[root@localhost lab]<span class="comment"># echo $&#123;hi&#125;</span></div><div class="line">world</div><div class="line"></div><div class="line">[root@localhost lab]<span class="comment"># hi=china               # 现在赋值给变量 hi</span></div><div class="line">[root@localhost lab]<span class="comment"># echo $&#123;hi:-world&#125;      # 有值，则返回hi的变量值</span></div><div class="line">china</div></pre></td></tr></table></figure></p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color5">shell脚本编程</a>
        		</li>
      		
		</ul>
	</div>

      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/2017/07/06/linux之shell脚本编程之数组和字符串处理/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>





  
    <article id="post-linux之shell脚本编程之函数" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/07/05/linux之shell脚本编程之函数/">linux之shell脚本编程之函数</a>
    </h1>
  

        
        <a href="/2017/07/05/linux之shell脚本编程之函数/" class="archive-article-date">
  	<time datetime="2017-07-05T05:50:22.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2017-07-05</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-shell脚本编程之函数"><a href="#ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-shell脚本编程之函数" class="headerlink" title="&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp; &ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp; shell脚本编程之函数"></a>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp; &ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp; shell脚本编程之函数</h3><h3 id="函数：function"><a href="#函数：function" class="headerlink" title="函数：function"></a>函数：function</h3><h4 id="函数介绍"><a href="#函数介绍" class="headerlink" title="函数介绍"></a>函数介绍</h4><p>★ 函数：<br>☉定义：<br>&ensp;&ensp;&ensp;&ensp;把一段独立功能的的代码当做一个整体，并为之一个名字，命名的代码段，此即为函数；<br>☉功能：<br>&ensp;&ensp;&ensp;&ensp;函数function是由若干条shell命令组成的语句块，实现代码重用和模块化编程。<br>注意：<br>&ensp;&ensp;&ensp;&ensp;定义函数的代码段不会自动执行，在调用时执行；所谓函数调用，就在代码中给定函数名称即可；<br>&ensp;&ensp;&ensp;&ensp;函数名出现的任何位置，在代码执行时，都会被自动替换为函数代码；<br>☉函数和shell程序比较相似，区别在于：<br>&ensp;&ensp;&ensp;&ensp;Shell程序在子Shell中运行；<br>&ensp;&ensp;&ensp;&ensp;而Shell函数在当前Shell中运行。因此在当前Shell中，函数可以对shell中变量进行修改；<br>&ensp;&ensp;&ensp;&ensp;它与shell程序形式上是相似的，不同的是它不是一个单独的进程，不能独立运行，而是shell程序的一部分。</p>
<h4 id="函数语法，定义和使用"><a href="#函数语法，定义和使用" class="headerlink" title="函数语法，定义和使用"></a>函数语法，定义和使用</h4><p>★语法：<br>&ensp;&ensp;&ensp;&ensp;函数由两部分组成：函数名和函数体。<br>☉语法一：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">function</span> f_name &#123;</div><div class="line">        ...函数体...</div><div class="line"> &#125;</div></pre></td></tr></table></figure></p>
<p>☉语法二：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="title">f_name</span></span>() &#123;</div><div class="line">        ...函数体...</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>★函数的定义和使用：<br>☉可在交互式环境下定义函数：<br>&ensp;&ensp;&ensp;&ensp;可将函数放在脚本文件中作为它的一部分(自己定义自己用)<br>&ensp;&ensp;&ensp;&ensp;可放在只包含函数的单独文件中<br>☉调用：函数只有被调用才会执行；<br>&ensp;&ensp;&ensp;&ensp;调用方法：在代码中给定函数名称，函数名出现的地方，会被自动替换为函数代码；<br>☉函数的生命周期：<br>&ensp;&ensp;&ensp;&ensp;被调用时创建，返回时终止；</p>
<h4 id="函数有两种返回值"><a href="#函数有两种返回值" class="headerlink" title="函数有两种返回值"></a>函数有两种返回值</h4><p>★函数的执行结果返回值：<br>&ensp;&ensp;&ensp;&ensp;使用echo或printf命令进行输出；<br>&ensp;&ensp;&ensp;&ensp;函数体中调用命令的输出结果；<br>★函数的退出状态码：<br>其状态返回结果为函数中执行的最后一条命令的状态结果；<br>☉自定义退出状态码：return<br>&ensp;&ensp;&ensp;&ensp;return [0-255] ：从函数中返回，用最后状态命令决定返回值；<br>&ensp;&ensp;&ensp;&ensp;0：成功，无错误返回<br>&ensp;&ensp;&ensp;&ensp;1-255：失败，有错误返回</p>
<h4 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h4><p>1.给定一个用户名，显示其用户名，id和默认的shell<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">[root@localhost lab]<span class="comment"># vim userinfo.sh</span></div><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="function"><span class="title">userinfo</span></span>() &#123;</div><div class="line">    <span class="keyword">if</span> id <span class="variable">$Username</span> &amp;&gt;/dev/null;<span class="keyword">then</span></div><div class="line">       getent passwd <span class="variable">$Username</span> | cut <span class="_">-d</span><span class="string">":"</span> <span class="_">-f</span>1,3,7</div><div class="line">    <span class="keyword">else</span></div><div class="line">       <span class="built_in">echo</span> <span class="string">"No such <span class="variable">$Username</span>!"</span></div><div class="line">    <span class="keyword">fi</span></div><div class="line">&#125;</div><div class="line"></div><div class="line">[ <span class="variable">$#</span> <span class="_">-lt</span> 1 ] &amp;&amp; <span class="built_in">echo</span> <span class="string">"At least one user."</span> &amp;&amp; <span class="built_in">exit</span> 2</div><div class="line"></div><div class="line">Username=<span class="variable">$1</span></div><div class="line">userinfo</div><div class="line"></div><div class="line"><span class="comment">#Username=$2</span></div><div class="line"><span class="comment">#userinfo</span></div></pre></td></tr></table></figure></p>
<p>2.以函数的方式改写服务框架脚本<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div></pre></td><td class="code"><pre><div class="line">[root@localhost lab]<span class="comment"># vim testservice</span></div><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment">#chkconfig: - 50 50</span></div><div class="line"><span class="comment">#description: test service scipt</span></div><div class="line"><span class="comment">#</span></div><div class="line"> </div><div class="line">prong=$(basename <span class="variable">$0</span>)</div><div class="line">lockfile=/var/lock/subsys/<span class="variable">$prong</span></div><div class="line"> </div><div class="line"><span class="function"><span class="title">start</span></span>() &#123;</div><div class="line">    <span class="keyword">if</span> [ <span class="_">-f</span> <span class="variable">$lockfile</span> ];<span class="keyword">then</span></div><div class="line">        <span class="built_in">echo</span> <span class="string">"<span class="variable">$prong</span> is running yet."</span></div><div class="line">    <span class="keyword">else</span></div><div class="line">        touch <span class="variable">$lockfile</span></div><div class="line">        [ $? <span class="_">-eq</span> 0 ] &amp;&amp; <span class="built_in">echo</span> <span class="string">"start <span class="variable">$prong</span> finished."</span></div><div class="line">    <span class="keyword">fi</span></div><div class="line">&#125;</div><div class="line"><span class="function"><span class="title">stop</span></span>() &#123;</div><div class="line">    <span class="keyword">if</span> [ <span class="_">-f</span> <span class="variable">$lockfile</span> ];<span class="keyword">then</span></div><div class="line">        rm <span class="_">-f</span> <span class="variable">$lockfile</span></div><div class="line">        [ $? <span class="_">-eq</span> 0 ] &amp;&amp; <span class="built_in">echo</span> <span class="string">"stop <span class="variable">$prong</span> finished."</span></div><div class="line">    <span class="keyword">else</span></div><div class="line">        <span class="built_in">echo</span> <span class="string">"<span class="variable">$prong</span> is not running."</span></div><div class="line">    <span class="keyword">fi</span></div><div class="line">&#125;</div><div class="line"><span class="function"><span class="title">status</span></span>() &#123;</div><div class="line">    <span class="keyword">if</span> [ <span class="_">-f</span> <span class="variable">$lockfile</span> ];<span class="keyword">then</span></div><div class="line">        <span class="built_in">echo</span> <span class="string">"<span class="variable">$prong</span> is running"</span></div><div class="line">    <span class="keyword">else</span></div><div class="line">        <span class="built_in">echo</span> <span class="string">"<span class="variable">$prong</span> is stopped"</span></div><div class="line">    <span class="keyword">fi</span></div><div class="line">&#125;</div><div class="line"> </div><div class="line"><span class="function"><span class="title">usage</span></span>() &#123;</div><div class="line">    <span class="built_in">echo</span> <span class="string">"Usage: <span class="variable">$prong</span> &#123;start|stop|restart|status&#125;"</span></div><div class="line">&#125;</div><div class="line"> </div><div class="line"><span class="keyword">case</span> <span class="variable">$1</span> <span class="keyword">in</span></div><div class="line">start)</div><div class="line">    start</div><div class="line">    ;;</div><div class="line">stop)</div><div class="line">    stop</div><div class="line">    ;;</div><div class="line">restart)</div><div class="line">    stop</div><div class="line">    start</div><div class="line">    ;;</div><div class="line">status)</div><div class="line">    status</div><div class="line">    ;;</div><div class="line">*)</div><div class="line">    usage</div><div class="line">    <span class="built_in">exit</span> 1</div><div class="line"><span class="keyword">esac</span></div></pre></td></tr></table></figure></p>
<h3 id="函数定义及用法详述"><a href="#函数定义及用法详述" class="headerlink" title="函数定义及用法详述"></a>函数定义及用法详述</h3><p>★函数可以定义在三个场景：<br>&ensp;&ensp;&ensp;&ensp;交互环境下；<br>&ensp;&ensp;&ensp;&ensp;脚本中 ；<br>&ensp;&ensp;&ensp;&ensp;单独的函数文件</p>
<h4 id="1-交互环境下定义和使用函数："><a href="#1-交互环境下定义和使用函数：" class="headerlink" title="1.交互环境下定义和使用函数："></a>1.交互环境下定义和使用函数：</h4><p>示例：<br>1.定义该函数后，键入fun，其显示结果同命令#who，#hostname的作用相同。这里要注意优先级，如果函数和定义的别名相同（如：alias fun =ls），别名的优先级高。 优先级：别名&gt;函数&gt;内部命令&gt;外部命令<br>该fun函数将一直保留到用户从系统退出，或执行了unset命令：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">[root@localhost lab]<span class="comment"># fun() &#123; who;hostnamectl; &#125;</span></div><div class="line">[root@localhost lab]<span class="comment"># fun</span></div><div class="line">root     tty1         2017-10-16 14:03</div><div class="line">root     pts/0        2017-10-16 14:05 (172.16.3.1)</div><div class="line">root     pts/1        2017-10-16 14:20 (172.16.3.1)</div><div class="line">   Static hostname: localhost.localdomain</div><div class="line">         Icon name: computer-vm</div><div class="line">           Chassis: vm</div><div class="line">        Machine ID: 8596024c1ea541c6b4e1e88323384110</div><div class="line">           Boot ID: 3483db0c70084e2796f710bf70ce31ec</div><div class="line">    Virtualization: vmware</div><div class="line">  Operating System: CentOS Linux 7 (Core)</div><div class="line">       CPE OS Name: cpe:/o:centos:centos:7</div><div class="line">            Kernel: Linux 3.10.0-327.el7.x86_64</div><div class="line">      Architecture: x86-64</div></pre></td></tr></table></figure></p>
<h4 id="2-在脚本文件中定义和使用函数"><a href="#2-在脚本文件中定义和使用函数" class="headerlink" title="2.在脚本文件中定义和使用函数"></a>2.在脚本文件中定义和使用函数</h4><p>★方法：<br>&ensp;&ensp;&ensp;&ensp;函数在使用前必须定义，因此应将函数定义放在脚本开始部分，直至shell首次发现它后才能使用；<br>&ensp;&ensp;&ensp;&ensp;调用函数仅使用其函数名即可。<br>注意：<br>&ensp;&ensp;&ensp;&ensp;在脚本中的函数在外面是用不了的，因为不在同一个shell中，运行脚本是开了一个子shell，而在外面是父shell。<br>示例：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">[root@localhost lab]<span class="comment"># cat test1.sh</span></div><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"><span class="comment">#</span></div><div class="line"> </div><div class="line"><span class="function"><span class="title">fun1</span></span>() &#123;</div><div class="line">    <span class="built_in">echo</span> <span class="string">"this is fun1"</span></div><div class="line">&#125;</div><div class="line"> </div><div class="line"><span class="built_in">echo</span> <span class="string">"fun1 before"</span></div><div class="line"> </div><div class="line">fun1</div><div class="line"> </div><div class="line"><span class="built_in">echo</span> <span class="string">"fun1 after"</span></div><div class="line"> </div><div class="line"><span class="comment"># 执行结果如下：</span></div><div class="line">[root@localhost lab]<span class="comment"># bash test1.sh</span></div><div class="line">fun1 before</div><div class="line">this is fun1  <span class="comment"># 函数只有在被调用才会执行</span></div><div class="line">fun1 after</div></pre></td></tr></table></figure></p>
<h4 id="3-使用函数文件定义函数"><a href="#3-使用函数文件定义函数" class="headerlink" title="3.使用函数文件定义函数"></a>3.使用函数文件定义函数</h4><p>★可以将经常使用的函数存入函数文件，然后将函数文件载入shell。<br>&ensp;&ensp;&ensp;&ensp;文件名可任意选取，但最好与相关任务有某种联系。例如：functions.main<br>&ensp;&ensp;&ensp;&ensp;一旦函数文件载入（source或.）shell，就可以在命令行或脚本中调用函数。可以使用set命令查看所有定义的函数，其输出列表包括已经载入shell的所有函数。<br>若要改动函数，首先用unset命令从shell中删除函数。改动完毕后，再重新载入此文件<br>★函数的载入，执行，检查和删除<br>&ensp;&ensp;&ensp;&ensp;函数文件已创建好后，要将它载入shell，使用 source 或  “.”<br>☉定位函数文件并载入shell的格式：<br>&ensp;&ensp;&ensp;&ensp;. /PATH/TO/SOMEFILE （&lt;点&gt; &lt;空格&gt; &lt;文件名&gt;）或者 source /PATH/TO/SOMEFILE<br>注意：<br>&ensp;&ensp;&ensp;&ensp;这里的文件名要带正确路径（绝对或相对路径）<br>☉查看是否载入：<br>&ensp;&ensp;&ensp;&ensp;用source或 . 载入shell后，可使用set命令检查函数是否已载入。set命令将在shell中显示所有的载入函数；<br>☉删除shell函数：<br>&ensp;&ensp;&ensp;&ensp;现在对函数做一些改动。首先删除函数，使其对shell不可用。使用unset命令完成此功能。<br>&ensp;&ensp;&ensp;&ensp;命令格式为：unset function_name<br>★在脚本中载入函数<br>&ensp;&ensp;&ensp;&ensp;在脚本中使用函数，只要source FILES或者. FILE (存放函数的文件)，就可以载入到当前shell当中，调用函数了。<br>注意：<br>&ensp;&ensp;&ensp;&ensp;Shell函数在当前Shell中运行。因此在当前Shell中，函数可以对shell中变量进行修改；<br>&ensp;&ensp;&ensp;&ensp;当函数载入到当前环境中或脚本中时，当前环境或者脚本中定义的变量会和函数中定义的变量起冲突，这是因为，我们在当前环境中或者脚本中定义的为本地变量，函数载入当前shell之后，其实就是当前shell的一部分，所以定义的本地变量对其也有效。为了避免这种冲突，函数要使用局部变量。<br>示例：<br>1.首先创建一个函数文件，此函数文件中可以存放多个函数；<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">[root@localhost lab]<span class="comment"># vim funs</span></div><div class="line"></div><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="function"><span class="title">fun1</span></span>() &#123;</div><div class="line">     <span class="built_in">echo</span> <span class="string">"This is fun1"</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="title">fun2</span></span>() &#123;</div><div class="line">     <span class="built_in">echo</span> <span class="string">"This is fun2"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>2.在当前shell中要想调用此函数，要使用 source 或者 . 加载到当前shell中方可<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 直接调用，bash（相当于开了一个子shell）都不行</span></div><div class="line">[root@localhost lab]<span class="comment"># fun1</span></div><div class="line">-bash: fun1: <span class="built_in">command</span> not found</div><div class="line">[root@localhost lab]<span class="comment"># bash fun1</span></div><div class="line">bash: fun1: No such file or directory</div><div class="line"></div><div class="line"><span class="comment"># source 加载到当前shell</span></div><div class="line">[root@localhost lab]<span class="comment"># source /root/lab/funs </span></div><div class="line">[root@localhost lab]<span class="comment"># fun1</span></div><div class="line">This is fun1</div><div class="line">[root@localhost lab]<span class="comment"># fun2</span></div><div class="line">This is fun2</div><div class="line"></div><div class="line"><span class="comment"># 删除shell函数，再执行就没有了</span></div><div class="line">[root@localhost lab]<span class="comment"># unset fun1</span></div><div class="line">[root@localhost lab]<span class="comment"># fun1</span></div><div class="line">-bash: fun1: <span class="built_in">command</span> not found</div><div class="line">[root@localhost lab]<span class="comment"># fun2</span></div><div class="line">This is fun2</div><div class="line">[root@localhost lab]<span class="comment"># unset fun2</span></div><div class="line">[root@localhost lab]<span class="comment"># fun2</span></div><div class="line">-bash: fun2: <span class="built_in">command</span> not found</div></pre></td></tr></table></figure></p>
<p>3.在脚本中使用函数，只要source FILES或者. FILE (存放函数的文件)，就可以载入到当前shell当中，调用函数了。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">[root@localhost lab]<span class="comment"># vim func1.sh</span></div><div class="line"></div><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"><span class="comment">#</span></div><div class="line"></div><div class="line"><span class="built_in">source</span> /root/lab/funs</div><div class="line"></div><div class="line">fun1</div><div class="line"></div><div class="line"><span class="built_in">echo</span> <span class="string">"This is a test"</span></div><div class="line"></div><div class="line">fun2</div><div class="line"></div><div class="line"><span class="comment"># 执行结果如下：</span></div><div class="line">[root@localhost lab]<span class="comment"># fun1       # 在当前shell中不能使用，因为脚本为子shell，当前环境为父shell</span></div><div class="line">-bash: fun1: <span class="built_in">command</span> not found</div><div class="line">[root@localhost lab]<span class="comment"># fun2</span></div><div class="line">-bash: fun2: <span class="built_in">command</span> not found</div><div class="line">[root@localhost lab]<span class="comment"># bash func1.sh </span></div><div class="line">This is fun1              <span class="comment"># 调用函数成功</span></div><div class="line">This is a <span class="built_in">test</span></div><div class="line">This is fun2</div></pre></td></tr></table></figure></p>
<h3 id="函数参数："><a href="#函数参数：" class="headerlink" title="函数参数："></a>函数参数：</h3><p>★函数可以接受参数：<br>&ensp;&ensp;&ensp;&ensp;传递参数给函数：调用函数时，在函数名后面以空白分隔给定参数列表即可；例如“testfunc arg1 arg2 …”<br>&ensp;&ensp;&ensp;&ensp;在函数体中当中，可使用$1, $2, …调用这些参数；还可以使用$@, $*, $#等特殊变量<br>注意：<br>&ensp;&ensp;&ensp;&ensp;脚本参数和函数参数是不一样的<br>示例：<br>1.添加10个用户，（添加用户的功能使用函数实现），用户名作为参数传递给函数；<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">[root@localhost lab]<span class="comment"># vim func_useradd.sh</span></div><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment">#5:user exists</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="function"><span class="title">addusers</span></span>()&#123;</div><div class="line">       <span class="keyword">if</span> id <span class="variable">$1</span> &amp;&gt;/dev/null;<span class="keyword">then</span></div><div class="line">          <span class="built_in">return</span> 5</div><div class="line">       <span class="keyword">else</span></div><div class="line">          useradd <span class="variable">$1</span></div><div class="line">          retval=$?</div><div class="line">          <span class="built_in">return</span> <span class="variable">$retval</span></div><div class="line">       <span class="keyword">fi</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..10&#125;;<span class="keyword">do</span></div><div class="line">    addusers <span class="variable">$&#123;1&#125;</span><span class="variable">$&#123;i&#125;</span></div><div class="line">    retval=$?</div><div class="line">    <span class="keyword">if</span> [ <span class="variable">$retval</span> <span class="_">-eq</span> 0 ];<span class="keyword">then</span></div><div class="line">       <span class="built_in">echo</span> <span class="string">"Add user <span class="variable">$&#123;1&#125;</span><span class="variable">$&#123;i&#125;</span> finished."</span></div><div class="line">    <span class="keyword">elif</span> [ <span class="variable">$retval</span> <span class="_">-eq</span> 5 ];<span class="keyword">then</span></div><div class="line">       <span class="built_in">echo</span> <span class="string">"User <span class="variable">$&#123;1&#125;</span><span class="variable">$&#123;i&#125;</span> exists."</span></div><div class="line">    <span class="keyword">else</span></div><div class="line">       <span class="built_in">echo</span> <span class="string">"Unkown Error."</span></div><div class="line">    <span class="keyword">fi</span></div><div class="line"><span class="keyword">done</span></div></pre></td></tr></table></figure></p>
<h3 id="函数变量："><a href="#函数变量：" class="headerlink" title="函数变量："></a>函数变量：</h3><p>★变量的作用域：<br>&ensp;&ensp;&ensp;&ensp;环境变量：当前shell和子shell有效<br>&ensp;&ensp;&ensp;&ensp;本地变量：只在当前shell进程有效，为执行脚本会启动专用子shell进程；因此，本地变量的作用范围是当前shell脚本程序文件，包括脚本中的函数。<br>&ensp;&ensp;&ensp;&ensp;局部变量：作用域是函数的生命周期；函数结束时变量被自动销毁；<br>★在函数中定义局部变量的方法：<br>&ensp;&ensp;&ensp;&ensp;local NAME=VALUE<br>注意：<br>&ensp;&ensp;&ensp;&ensp;函数中也可调用本地变量，如果函数中定义的变量名称和本地变量相同，函数调用之后会覆盖本地变量的值；<br>&ensp;&ensp;&ensp;&ensp;为了避免和本地变量相冲突，使之互不干扰，所以在函数中使用的变量要使用局部变量；<br>示例：<br>1.在函数中定义的本地变量和脚本中定义的本地变量名相同，但值不同的执行结果；<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">[root@localhost lab]<span class="comment"># cat test.sh</span></div><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"><span class="comment">#</span></div><div class="line"> </div><div class="line"><span class="function"><span class="title">setname</span></span>() &#123;</div><div class="line">    name=jerry</div><div class="line">    <span class="built_in">echo</span> <span class="string">"Function:<span class="variable">$name</span>"</span></div><div class="line">&#125;</div><div class="line"> </div><div class="line">name=tom</div><div class="line"><span class="built_in">echo</span> <span class="string">"Fun before:<span class="variable">$name</span>"</span></div><div class="line">setname</div><div class="line"><span class="built_in">echo</span> <span class="string">"Fun after:<span class="variable">$name</span>"</span></div><div class="line"> </div><div class="line"><span class="comment">#执行结果，可以发现 函数中定义的变量覆盖了脚本中定义的变量，</span></div><div class="line">[root@localhost lab]<span class="comment"># bash test.sh</span></div><div class="line">Fun before:tom   <span class="comment"># 脚本执行前为本地变量</span></div><div class="line">Function:jerry   <span class="comment"># 调用函数，函数也会调用本地变量，并再次给其赋值</span></div><div class="line">Fun after:jerry  <span class="comment"># 脚本中定义的变量被函数中定义的变量覆盖</span></div></pre></td></tr></table></figure></p>
<p>2.在函数中定义局部变量，和脚本中定义本地变量但值不同的结果：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">[root@localhost lab]<span class="comment"># cat test.sh</span></div><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"><span class="comment">#</span></div><div class="line"> </div><div class="line"><span class="function"><span class="title">setname</span></span>() &#123;</div><div class="line">    <span class="built_in">local</span> name=jerry</div><div class="line">    <span class="built_in">echo</span> <span class="string">"Function:<span class="variable">$name</span>"</span></div><div class="line">&#125;</div><div class="line"> </div><div class="line">name=tom</div><div class="line"><span class="built_in">echo</span> <span class="string">"Fun before:<span class="variable">$name</span>"</span></div><div class="line">setname</div><div class="line"><span class="built_in">echo</span> <span class="string">"Fun after:<span class="variable">$name</span>"</span></div><div class="line"> </div><div class="line"><span class="comment">#执行结果如下：</span></div><div class="line">[root@localhost lab]<span class="comment"># bash test.sh</span></div><div class="line">Fun before:tom</div><div class="line">Function:jerry</div><div class="line">Fun after:tom</div></pre></td></tr></table></figure></p>
<p>结论：<br>  1.如果函数中有局部变量，如果其名称同本地变量，使用局部变量。否则，函数执行之后会把当前shell中定义的相同的变量覆盖。<br>  2.定义的局部变量只是在函数内部使用，互不干扰；如果不加local就是本地变量了。</p>
<h4 id="练习："><a href="#练习：" class="headerlink" title="练习："></a>练习：</h4><p>1.编写一个脚本/root/bin/copycmd.sh<br>(1) 提示用户输入一个可执行命令名称；<br>(2) 获取此命令所依赖到的所有库文件列表<br>(3) 复制命令至某目标目录(例如/mnt/sysroot)下的对应路径下；<br>&ensp;&ensp;&ensp;&ensp;如：/bin/bash ==&gt; /mnt/sysroot/bin/bash<br>&ensp;&ensp;&ensp;&ensp;/usr/bin/passwd==&gt; /mnt/sysroot/usr/bin/passwd<br>(4) 复制此命令依赖到的所有库文件至目标目录下的对应路径下：<br>&ensp;&ensp;&ensp;&ensp;如：/lib64/ld-linux-x86-64.so.2 ==&gt; /mnt/sysroot/lib64/ld-linux-x86-64.so.2<br>(5)每次复制完成一个命令后，不要退出，而是提示用户键入新的要复制的命令，并重复完成上述功能；直到用户输入quit退出<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">[root@localhost lab]<span class="comment"># cat sysroot.sh </span></div><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="keyword">while</span> <span class="literal">true</span> ;<span class="keyword">do</span></div><div class="line">      <span class="built_in">read</span> -p <span class="string">"Please input a linux commond:"</span> comm</div><div class="line">      <span class="keyword">if</span> [ <span class="string">"<span class="variable">$comm</span>"</span> == <span class="string">"quit"</span> ];<span class="keyword">then</span></div><div class="line">         <span class="built_in">break</span></div><div class="line">      <span class="keyword">fi</span></div><div class="line">      <span class="built_in">which</span> <span class="variable">$comm</span> &amp;&gt;/dev/null</div><div class="line">      <span class="keyword">if</span> [ $? <span class="_">-eq</span> 0 ];<span class="keyword">then</span></div><div class="line">         mkdir -p /mnt/sysroot/&#123;lib64,usr/&#123;sbin,bin&#125;&#125; &amp;&gt;/dev/null</div><div class="line">         f1=$(<span class="built_in">which</span> <span class="variable">$comm</span>|grep <span class="string">"<span class="variable">$comm</span>$"</span>|cut <span class="_">-d</span><span class="string">"/"</span> <span class="_">-f</span>3)</div><div class="line">         <span class="keyword">if</span> [ <span class="string">"<span class="variable">$f1</span>"</span> == <span class="string">"bin"</span> ];<span class="keyword">then</span></div><div class="line">            cp $(<span class="built_in">which</span> <span class="variable">$comm</span>|grep <span class="string">"<span class="variable">$comm</span>$"</span>) /mnt/sysroot/usr/<span class="variable">$f1</span></div><div class="line">         <span class="keyword">else</span></div><div class="line">            cp $(<span class="built_in">which</span> <span class="variable">$comm</span>|grep <span class="string">"<span class="variable">$comm</span>$"</span>) /mnt/sysroot/usr/sbin</div><div class="line">         <span class="keyword">fi</span></div><div class="line">         files=($(ldd $(<span class="built_in">which</span> <span class="variable">$comm</span>|grep <span class="string">"<span class="variable">$comm</span>$"</span>)|grep -o <span class="string">"/lib64.* "</span>))</div><div class="line">         <span class="keyword">for</span> i <span class="keyword">in</span> <span class="variable">$&#123;files[*]&#125;</span>;<span class="keyword">do</span></div><div class="line">             cp <span class="variable">$i</span> /mnt/sysroot/lib64/</div><div class="line">         <span class="keyword">done</span></div><div class="line">      <span class="keyword">else</span></div><div class="line">         <span class="built_in">echo</span> <span class="string">"You input is not a linux commond"</span></div><div class="line">      <span class="keyword">fi</span></div><div class="line"><span class="keyword">done</span></div></pre></td></tr></table></figure></p>
<p>2.通过调用函数输出IP地址<br>首先定义一个函数：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">[root@localhost lab]<span class="comment"># cat util.sh </span></div><div class="line">[root@localhost lab]<span class="comment"># cat util.sh </span></div><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"><span class="comment">#</span></div><div class="line">prong=$(basename <span class="variable">$0</span>)</div><div class="line"></div><div class="line"><span class="keyword">function</span> <span class="function"><span class="title">print_ip</span></span>() &#123;</div><div class="line">    IP=$(</div><div class="line">        ifconfig <span class="variable">$&#123;1&#125;</span> | \</div><div class="line">       <span class="comment"># grep "inet addr:" | \</span></div><div class="line">        grep <span class="string">"inet "</span> | \</div><div class="line">        awk <span class="string">'&#123;print $2&#125;'</span> | \</div><div class="line">        cut <span class="_">-f</span> 2 <span class="_">-d</span> <span class="string">":"</span></div><div class="line">    )</div><div class="line">    <span class="built_in">echo</span> <span class="variable">$&#123;IP&#125;</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">function</span> <span class="function"><span class="title">getarg</span></span>() &#123;</div><div class="line">    NAME=<span class="variable">$&#123;1&#125;</span></div><div class="line">    <span class="keyword">while</span> [[ ! -z <span class="variable">$&#123;2&#125;</span> ]]; <span class="keyword">do</span></div><div class="line">        <span class="keyword">if</span> [[ <span class="string">"--<span class="variable">$&#123;NAME&#125;</span>"</span> == <span class="string">"<span class="variable">$&#123;2&#125;</span>"</span> ]]; <span class="keyword">then</span></div><div class="line">            <span class="built_in">echo</span> <span class="string">"<span class="variable">$&#123;3&#125;</span>"</span></div><div class="line">        <span class="keyword">fi</span></div><div class="line">        <span class="built_in">shift</span></div><div class="line">    <span class="keyword">done</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="title">usage</span></span>() &#123;</div><div class="line">    <span class="built_in">echo</span> <span class="string">"Usage: <span class="variable">$prong</span> --cmd ip --iface"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>调用以上函数：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">[root@localhost lab]<span class="comment"># cat iputils.sh </span></div><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"></div><div class="line">CWD=$( <span class="built_in">cd</span> <span class="string">"<span class="variable">$(dirname "$&#123;BASH_SOURCE[0]&#125;" )</span>/"</span> &amp;&amp; <span class="built_in">pwd</span> )</div><div class="line"><span class="built_in">cd</span> <span class="variable">$&#123;CWD&#125;</span></div><div class="line"></div><div class="line"><span class="built_in">source</span> <span class="variable">$&#123;CWD&#125;</span>/util.sh</div><div class="line"></div><div class="line">CMD=$(getarg cmd <span class="variable">$@</span>)</div><div class="line"><span class="comment">#echo $&#123;CMD&#125;</span></div><div class="line"></div><div class="line"><span class="keyword">case</span> <span class="variable">$&#123;CMD&#125;</span> <span class="keyword">in</span></div><div class="line">    ip)</div><div class="line">         IFACE=$(getarg iface <span class="variable">$@</span>)</div><div class="line">         print_ip <span class="variable">$&#123;IFACE&#125;</span></div><div class="line">         ;;</div><div class="line">    *)</div><div class="line">         usage</div><div class="line">         ;;</div><div class="line"><span class="keyword">esac</span></div></pre></td></tr></table></figure></p>
<p>运行结果：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@localhost lab]<span class="comment"># bash iputils.sh</span></div><div class="line">Usage: iputils.sh --cmd ip --iface</div><div class="line">[root@localhost lab]<span class="comment"># bash iputils.sh --cmd ip --iface eno16777736</span></div><div class="line">172.16.3.88</div></pre></td></tr></table></figure></p>
<p>3.实验脚本：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div></pre></td><td class="code"><pre><div class="line">[root@localhost lab]<span class="comment"># cat script.sh </span></div><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line">AUX=<span class="string">"123"</span></div><div class="line">ARG=<span class="variable">$&#123;1:-$&#123;AUX:-"default value"&#125;</span>&#125;</div><div class="line"><span class="comment">#echo $&#123;ARG&#125;</span></div><div class="line"></div><div class="line">LINE=<span class="string">"some long line of text"</span></div><div class="line"><span class="comment">#echo "$&#123;LINE:5:4&#125;"</span></div><div class="line"></div><div class="line"><span class="keyword">function</span> <span class="function"><span class="title">print_ip</span></span>() &#123;</div><div class="line">    IP=$(</div><div class="line">        ifconfig <span class="variable">$&#123;1&#125;</span> | \</div><div class="line">        grep <span class="string">"inet addr:"</span> | \</div><div class="line">        awk <span class="string">'&#123;print $2&#125;'</span> | \</div><div class="line">        cut <span class="_">-f</span> 2 <span class="_">-d</span> <span class="string">":"</span></div><div class="line">    )</div><div class="line">    <span class="built_in">echo</span> <span class="variable">$&#123;IP&#125;</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">function</span> <span class="function"><span class="title">long_running_task_1</span></span>() &#123;</div><div class="line">    sleep 1</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">function</span> <span class="function"><span class="title">long_running_task_2</span></span>() &#123;</div><div class="line">    sleep 2</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">while</span> [[ ! -z <span class="variable">$&#123;1&#125;</span> ]];<span class="keyword">do</span></div><div class="line">     <span class="keyword">case</span> <span class="string">"<span class="variable">$1</span>"</span> <span class="keyword">in</span></div><div class="line">        --ip|-i)</div><div class="line">          print_ip <span class="variable">$&#123;2&#125;</span></div><div class="line">          <span class="built_in">shift</span></div><div class="line">          <span class="built_in">shift</span></div><div class="line">          ;;</div><div class="line">        --parallel|-p)</div><div class="line">          long_running_task_1 &amp;</div><div class="line">          long_running_task_2 &amp;</div><div class="line">          PID=$!</div><div class="line">          <span class="built_in">wait</span> <span class="variable">$&#123;PID&#125;</span></div><div class="line">          notify-send script.sh <span class="string">"executior finished"</span></div><div class="line">          <span class="built_in">shift</span></div><div class="line">          ;;</div><div class="line">        --help|-h)</div><div class="line">          <span class="built_in">echo</span> <span class="string">"This is a help message"</span></div><div class="line">          <span class="built_in">shift</span></div><div class="line">	  ;;</div><div class="line">        *)</div><div class="line">          <span class="built_in">echo</span> <span class="string">"invalid option"</span></div><div class="line">          <span class="built_in">exit</span> 1</div><div class="line">	  ;;</div><div class="line">     <span class="keyword">esac</span></div><div class="line"><span class="keyword">done</span></div></pre></td></tr></table></figure></p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color5">shell脚本编程</a>
        		</li>
      		
		</ul>
	</div>

      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/2017/07/05/linux之shell脚本编程之函数/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>





  
    <article id="post-linux之shell脚本编程之语句控制" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/07/01/linux之shell脚本编程之语句控制/">linux之shell脚本编程之语句控制</a>
    </h1>
  

        
        <a href="/2017/07/01/linux之shell脚本编程之语句控制/" class="archive-article-date">
  	<time datetime="2017-07-01T12:50:22.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2017-07-01</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-shell脚本编程之语句控制"><a href="#ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-shell脚本编程之语句控制" class="headerlink" title="&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp; &ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp; shell脚本编程之语句控制"></a>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp; &ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp; shell脚本编程之语句控制</h3><h3 id="过程式编程语言的代码执行顺序"><a href="#过程式编程语言的代码执行顺序" class="headerlink" title="过程式编程语言的代码执行顺序"></a>过程式编程语言的代码执行顺序</h3><p>★ 顺序执行<br>&ensp;&ensp;&ensp;&ensp;按照顺序一条一条语句执行；<br>★ 选择执行<br>&ensp;&ensp;&ensp;&ensp;代码有一个分支：条件满足时才会执行；<br>&ensp;&ensp;&ensp;&ensp;两个或以上的分支：只会执行其中一个满足条件的分支；<br>★ 循环执行<br>&ensp;&ensp;&ensp;&ensp;代码片段（循环体）要执行0,1或多个来回<br>注意：<br>&ensp;&ensp;&ensp;&ensp;顺序执行不需要特定的控制，只需按照语句依次执行即可；选择执行，则需要特定的控制语句（如：if，case）来判断执行；循环执行则需要特定的循环控制控制（如：for，while等）。</p>
<h3 id="bash脚本编程之用户交互"><a href="#bash脚本编程之用户交互" class="headerlink" title="bash脚本编程之用户交互"></a>bash脚本编程之用户交互</h3><p>在bash脚本编程过程当中有时程序需要与用户之间进行交互（通过键盘输入数据），如提示用户输入一些参数等，此时，我们可以使用read命令来完成此功能  。<br>★ read<br>☉功能：<br>&ensp;&ensp;&ensp;&ensp;和用户进行交互，通过键盘输入数据，从而完成变量赋值工作；<br>☉语法：<br>&ensp;&ensp;&ensp;&ensp;read [option]…[name…]<br>☉选项：<br>&ensp;&ensp;&ensp;&ensp;-p ：“说明信息”，指示要显示的提示；<br>&ensp;&ensp;&ensp;&ensp;-t ：TIMEOUT ， 多长时间不输入后就退出；<br>注意：<br>&ensp;&ensp;&ensp;&ensp;read从标准输入中读取值，给每个单词分配一个变量，所有剩余单词都被分配给最后一个变量</p>
<h4 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line">[root@centos7 lab]<span class="comment"># read name</span></div><div class="line">jack</div><div class="line">[root@centos7 lab]<span class="comment"># echo $name</span></div><div class="line">jack</div><div class="line">[root@centos7 lab]<span class="comment"># read a b</span></div><div class="line">tom jerry</div><div class="line">[root@centos7 lab]<span class="comment"># echo $a</span></div><div class="line">tom</div><div class="line">[root@centos7 lab]<span class="comment"># echo $b</span></div><div class="line">jerry</div><div class="line"></div><div class="line"><span class="comment"># 如果给定的参数少于变量个数，那么对应的参数为空的变量将为空</span></div><div class="line">[root@centos7 lab]<span class="comment"># read a b c</span></div><div class="line">tom jerry</div><div class="line">[root@centos7 lab]<span class="comment"># echo $a</span></div><div class="line">tom</div><div class="line">[root@centos7 lab]<span class="comment"># echo $b</span></div><div class="line">jerry</div><div class="line">[root@centos7 lab]<span class="comment"># echo $c</span></div><div class="line"></div><div class="line"><span class="comment"># 如果给定的参数多于变量，那么多余的参数都将赋值给最后一个变量</span></div><div class="line">[root@centos7 lab]<span class="comment"># read a b c</span></div><div class="line">jack tom jerry xiu</div><div class="line">[root@centos7 lab]<span class="comment"># echo $a</span></div><div class="line">jack</div><div class="line">[root@centos7 lab]<span class="comment"># echo $b</span></div><div class="line">tom</div><div class="line">[root@centos7 lab]<span class="comment"># echo $c</span></div><div class="line">jerry xiu</div><div class="line"></div><div class="line">[root@centos7 lab]<span class="comment"># echo -n "Enter your name: ";read name</span></div><div class="line">Enter your name: jack</div><div class="line">[root@centos7 lab]<span class="comment"># echo $name</span></div><div class="line">jack</div><div class="line">[root@centos7 lab]<span class="comment"># read -p "Enter your name: " name</span></div><div class="line">Enter your name: jack</div><div class="line">[root@centos7 lab]<span class="comment"># echo $name</span></div><div class="line">jack</div><div class="line"></div><div class="line">[root@centos7 lab]<span class="comment"># read -p "Enter your name: " name</span></div><div class="line">Enter your name: jack</div><div class="line">[root@centos7 lab]<span class="comment"># [ -z $name ] &amp;&amp; name="tom"    # 如果变量为空时赋值为tom</span></div><div class="line">[root@centos7 lab]<span class="comment"># echo $name</span></div><div class="line">jack</div></pre></td></tr></table></figure>
<h4 id="示例脚本"><a href="#示例脚本" class="headerlink" title="示例脚本"></a>示例脚本</h4><p>添加用户<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">[root@centos7 lab]<span class="comment"># cat useradd1.sh </span></div><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># 提示用户输入一个用户名，如果用户未输入，则提示用户必须输出一个用户名，然后退出</span></div><div class="line"><span class="built_in">read</span> -p <span class="string">"Enter a username: "</span> name</div><div class="line">[ -z <span class="variable">$name</span> ] &amp;&amp; <span class="built_in">echo</span> <span class="string">"A username is needed"</span> &amp;&amp; <span class="built_in">exit</span> 2</div><div class="line"></div><div class="line"><span class="comment"># 判断用户是否存在，如果输出的用户存在，返回用户已存在，否则提示用户输出用户密码，如果用户未输出密码，则使用给的默认密码password.</span></div><div class="line"><span class="keyword">if</span> id <span class="variable">$name</span> &amp;&gt;/dev/null;<span class="keyword">then</span></div><div class="line">   <span class="built_in">echo</span> <span class="string">"This user is exsit."</span></div><div class="line"><span class="keyword">else</span></div><div class="line">   <span class="built_in">read</span> -p <span class="string">"Please enter password for <span class="variable">$name</span>: "</span> password</div><div class="line">   [ -z <span class="variable">$passwd</span> ] &amp;&amp; password=<span class="string">"password"</span></div><div class="line">   useradd <span class="variable">$name</span></div><div class="line">   <span class="built_in">echo</span> <span class="string">"<span class="variable">$passwd</span>"</span> | passwd --stdin <span class="variable">$name</span> &amp;&gt;/dev/null</div><div class="line">   <span class="built_in">echo</span> <span class="string">"Add user <span class="variable">$name</span> finished"</span></div><div class="line"><span class="keyword">fi</span></div></pre></td></tr></table></figure></p>
<p>执行脚本输出：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">[root@centos7 lab]<span class="comment"># bash useradd1.sh </span></div><div class="line">Enter a username: tom</div><div class="line">Please enter password <span class="keyword">for</span> tom: tom123</div><div class="line">Add user tom finished</div><div class="line">[root@centos7 lab]<span class="comment"># bash useradd1.sh </span></div><div class="line">Enter a username: jerry</div><div class="line">Please enter password <span class="keyword">for</span> jerry: </div><div class="line">Add user jerry finished</div><div class="line">[root@centos7 lab]<span class="comment"># id tom</span></div><div class="line">uid=1027(tom) gid=1027(tom) groups=1027(tom)</div><div class="line">[root@centos7 lab]<span class="comment"># id jerry</span></div><div class="line">uid=1028(jerry) gid=1028(jerry) groups=1028(jerry)</div></pre></td></tr></table></figure></p>
<h3 id="选择执行"><a href="#选择执行" class="headerlink" title="选择执行"></a>选择执行</h3><h4 id="if-语句"><a href="#if-语句" class="headerlink" title="if 语句"></a>if 语句</h4><p>★语法：<br>☉单分支<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> 判断条件；<span class="keyword">then</span></div><div class="line">   代码分支</div><div class="line"><span class="keyword">fi</span></div></pre></td></tr></table></figure></p>
<p>☉双分支（布尔型条件）<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> 判断条件; <span class="keyword">then</span></div><div class="line">    条件为真时执行的分支</div><div class="line"><span class="keyword">else</span></div><div class="line">    条件为假时执行的分支</div><div class="line"><span class="keyword">fi</span></div></pre></td></tr></table></figure></p>
<p>☉多分支<br>从上而下逐条件进行判断，第一次遇到为“真”条件时，执行其分支，而后结束整个if语句；<br>即便多个条件可能同时满足，分支也只会执行其中一个，即首先测试为真的那个；<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> CONDITION1; <span class="keyword">then</span></div><div class="line">     <span class="keyword">if</span>-true</div><div class="line"><span class="keyword">elif</span> CONDITION2; <span class="keyword">then</span></div><div class="line">     <span class="keyword">if</span>-ture</div><div class="line"><span class="keyword">elif</span> CONDITION3; <span class="keyword">then</span></div><div class="line">     <span class="keyword">if</span>-ture</div><div class="line"> ...</div><div class="line"><span class="keyword">else</span></div><div class="line">     all-false</div><div class="line"><span class="keyword">fi</span></div></pre></td></tr></table></figure></p>
<p>注意：<br>&ensp;&ensp;&ensp;&ensp;if语句可嵌套（if是一个关键字，不是一个命令。）</p>
<h4 id="示例：-1"><a href="#示例：-1" class="headerlink" title="示例："></a>示例：</h4><p>1.通过参数传递一个用户名给脚本，此用户不存在时，则添加<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 单分支语句：</span></div><div class="line">[root@centos7 lab]<span class="comment"># cat useradd2.sh </span></div><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="keyword">if</span> [ <span class="variable">$#</span> <span class="_">-lt</span> 1 ];<span class="keyword">then</span></div><div class="line">   <span class="built_in">echo</span> <span class="string">"At least one username"</span></div><div class="line">   <span class="built_in">exit</span> 2</div><div class="line"><span class="keyword">fi</span></div><div class="line"><span class="keyword">if</span> ! grep <span class="string">"^<span class="variable">$1</span>\&gt;"</span> /etc/passwd &amp;&gt;/dev/null;<span class="keyword">then</span></div><div class="line">   useradd <span class="variable">$1</span></div><div class="line">   <span class="built_in">echo</span> <span class="string">"<span class="variable">$1</span>"</span>|passwd --stdin <span class="variable">$1</span> &amp;&gt;/dev/null</div><div class="line">   <span class="built_in">echo</span> <span class="string">"Add user <span class="variable">$1</span> finished."</span></div><div class="line"><span class="keyword">fi</span></div><div class="line"></div><div class="line"><span class="comment"># 双分支语句：</span></div><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="keyword">if</span> [ <span class="variable">$#</span> <span class="_">-lt</span> 1 ];<span class="keyword">then</span></div><div class="line">   <span class="built_in">echo</span> <span class="string">"At least one username"</span></div><div class="line">   <span class="built_in">exit</span> 2</div><div class="line"><span class="keyword">fi</span></div><div class="line"><span class="keyword">if</span> grep <span class="string">"^<span class="variable">$1</span>\&gt;"</span> /etc/passwd &amp;&gt;/dev/null;<span class="keyword">then</span></div><div class="line">   <span class="built_in">echo</span> <span class="string">"The user <span class="variable">$1</span> exsits."</span></div><div class="line"><span class="keyword">else</span></div><div class="line">   useradd <span class="variable">$1</span></div><div class="line">   <span class="built_in">echo</span> <span class="string">"<span class="variable">$1</span>"</span>|passwd --stdin <span class="variable">$1</span> &amp;&gt;/dev/null</div><div class="line">   <span class="built_in">echo</span> <span class="string">"Add user <span class="variable">$1</span> finished."</span></div><div class="line"><span class="keyword">fi</span></div><div class="line"></div><div class="line"><span class="comment"># 双分支语句：方法二</span></div><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"><span class="comment">#</span></div><div class="line">[ <span class="variable">$#</span> <span class="_">-lt</span> 1 ] &amp;&amp;  <span class="built_in">echo</span> <span class="string">"At least one username"</span> &amp;&amp; <span class="built_in">exit</span> 2</div><div class="line"><span class="keyword">if</span> id <span class="variable">$1</span> &amp;&gt;/dev/null;<span class="keyword">then</span></div><div class="line">   <span class="built_in">echo</span> <span class="string">"The user <span class="variable">$1</span> exsits."</span></div><div class="line"><span class="keyword">else</span></div><div class="line">   useradd <span class="variable">$1</span></div><div class="line">   <span class="built_in">echo</span> <span class="string">"<span class="variable">$1</span>"</span>|passwd --stdin <span class="variable">$1</span> &amp;&gt;/dev/null</div><div class="line">   <span class="built_in">echo</span> <span class="string">"Add user <span class="variable">$1</span> finished."</span></div><div class="line"><span class="keyword">fi</span></div></pre></td></tr></table></figure></p>
<p>2.写一个脚本filetype.sh,判断用户输入文件路径，显示其文件类型（普通，目录，链接，其它文件类型）<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">[root@centos7 lab]<span class="comment"># cat filetype.sh </span></div><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="keyword">if</span> [ <span class="variable">$#</span> <span class="_">-lt</span> 1 ];<span class="keyword">then</span></div><div class="line">   <span class="built_in">echo</span> <span class="string">"At least input one file."</span></div><div class="line">   <span class="built_in">exit</span> 1</div><div class="line"><span class="keyword">fi</span></div><div class="line"><span class="keyword">if</span> ! [ <span class="_">-e</span> <span class="variable">$1</span> ];<span class="keyword">then</span></div><div class="line">   <span class="built_in">echo</span> <span class="string">"No such file."</span></div><div class="line">   <span class="built_in">exit</span> 2</div><div class="line"><span class="keyword">fi</span></div><div class="line"><span class="keyword">if</span> [ <span class="_">-f</span> <span class="variable">$1</span> ];<span class="keyword">then</span></div><div class="line">   <span class="built_in">echo</span> <span class="string">"Common file"</span></div><div class="line"><span class="keyword">elif</span> [ <span class="_">-d</span> <span class="variable">$1</span> ];<span class="keyword">then</span></div><div class="line">   <span class="built_in">echo</span> <span class="string">"Directory"</span></div><div class="line"><span class="keyword">elif</span> [ -b <span class="variable">$1</span> ];<span class="keyword">then</span></div><div class="line">   <span class="built_in">echo</span> <span class="string">"Block special file"</span></div><div class="line"><span class="keyword">elif</span> [ -c <span class="variable">$1</span> ];<span class="keyword">then</span></div><div class="line">   <span class="built_in">echo</span> <span class="string">"Character special file"</span></div><div class="line"><span class="keyword">elif</span> [ <span class="_">-s</span> <span class="variable">$1</span> ];<span class="keyword">then</span></div><div class="line">   <span class="built_in">echo</span> <span class="string">"Socket file"</span></div><div class="line"><span class="keyword">else</span></div><div class="line">   <span class="built_in">echo</span> <span class="string">"Unkonw"</span></div><div class="line"><span class="keyword">fi</span></div></pre></td></tr></table></figure></p>
<p>3.根据提示让用户选择输入的信息：cpu，mem，disks，quit，正确就的选择就给出相应的信息，否则就提示重新选择正确的选项<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">[root@centos7 lab]<span class="comment"># cat menu.sh </span></div><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"><span class="comment">#</span></div><div class="line">cat &lt;&lt; EOF</div><div class="line">CPU)dispaly cpu information.</div><div class="line">MEM)display memory information.</div><div class="line">Disks)display disk information.</div><div class="line">Quit)quit.</div><div class="line">===============================</div><div class="line">EOF</div><div class="line"></div><div class="line"><span class="built_in">read</span> -p <span class="string">"Please choice a option: "</span> option</div><div class="line"></div><div class="line"><span class="keyword">while</span> [ <span class="string">"<span class="variable">$option</span>"</span> != <span class="string">"CPU"</span> <span class="_">-a</span> <span class="string">"<span class="variable">$option</span>"</span> != <span class="string">"MEM"</span> <span class="_">-a</span> <span class="string">"<span class="variable">$option</span>"</span> != <span class="string">"Disks"</span> <span class="_">-a</span> <span class="string">"<span class="variable">$option</span>"</span> != <span class="string">"Quit"</span> ];<span class="keyword">do</span></div><div class="line">    <span class="built_in">echo</span> <span class="string">"CPU,MEM,Disks,Quit"</span></div><div class="line">    <span class="built_in">read</span> -p <span class="string">"Enter your option:"</span> option</div><div class="line"><span class="keyword">done</span></div><div class="line"><span class="keyword">if</span> [ <span class="string">"<span class="variable">$option</span>"</span> == <span class="string">"CPU"</span> ];<span class="keyword">then</span></div><div class="line">   lscpu</div><div class="line"><span class="keyword">elif</span> [ <span class="string">"<span class="variable">$option</span>"</span> == <span class="string">"MEM"</span> ];<span class="keyword">then</span></div><div class="line">   free -m</div><div class="line"><span class="keyword">elif</span> [ <span class="string">"<span class="variable">$option</span>"</span> == <span class="string">"Disks"</span> ];<span class="keyword">then</span></div><div class="line">   fdisk <span class="_">-l</span> /dev/sd[a-z]</div><div class="line"><span class="keyword">elif</span> [ <span class="string">"<span class="variable">$options</span>"</span> == <span class="string">"Quit"</span> ];<span class="keyword">then</span></div><div class="line">   <span class="built_in">echo</span> <span class="string">"quit"</span></div><div class="line">   <span class="built_in">exit</span> 1</div><div class="line"><span class="keyword">fi</span></div></pre></td></tr></table></figure></p>
<h3 id="条件判断case语句"><a href="#条件判断case语句" class="headerlink" title="条件判断case语句"></a>条件判断case语句</h3><p>★ 条件判断case语句（主要用于离散值的匹配）<br>☉使用场景：<br>&ensp;&ensp;&ensp;&ensp;case 语句在很多场景当中可以替换多分支的 if 语句，显示为更为简洁的格式，但其仅适用于：一个变量与多个取值之间作等值或者模式匹配时才可以用（即：拿一个变量来回跟多个可能的变量取值作比较才能使用或者说是，一个大的变量里面还有许多小的变量要选择才会用到），否则的话，只能用多分支的 if 语句<br>☉语法：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">case</span> 变量引量 <span class="keyword">in</span></div><div class="line"> PAT1)</div><div class="line">      分支1</div><div class="line">  ;;</div><div class="line"> PAT2)</div><div class="line">      分支2</div><div class="line">  ;;</div><div class="line">     ...</div><div class="line"> *)</div><div class="line">      默认分支</div><div class="line">  ;;</div><div class="line"> <span class="keyword">esac</span></div></pre></td></tr></table></figure></p>
<p>☉case仅支持glob风格的通配符：<br>&ensp;&ensp;&ensp;&ensp;*：任意长度任意字符<br>&ensp;&ensp;&ensp;&ensp;?：任意单个字符<br>&ensp;&ensp;&ensp;&ensp;[]：指定范围内的任意单个字符[adc]（也可以表示范围[1-10]）<br>&ensp;&ensp;&ensp;&ensp;a|b：a或b</p>
<h4 id="示例：-2"><a href="#示例：-2" class="headerlink" title="示例："></a>示例：</h4><p>1.根据提示让用户选择输入的信息：cpu，mem，disks，quit，正确就的选择就给出相应的信息，否则就提示重新选择正确的选项<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">[root@centos7 lab]<span class="comment"># cat menu.sh</span></div><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"><span class="comment">#</span></div><div class="line">cat &lt;&lt; EOF</div><div class="line">CPU)dispaly cpu information.</div><div class="line">MEM)display memory information.</div><div class="line">Disks)display disk information.</div><div class="line">Quit)quit.</div><div class="line">===============================</div><div class="line">EOF</div><div class="line"></div><div class="line"><span class="built_in">read</span> -p <span class="string">"Please choice a option: "</span> option</div><div class="line"></div><div class="line"><span class="keyword">while</span> [ <span class="string">"<span class="variable">$option</span>"</span> != <span class="string">"CPU"</span> <span class="_">-a</span> <span class="string">"<span class="variable">$option</span>"</span> != <span class="string">"MEM"</span> <span class="_">-a</span> <span class="string">"<span class="variable">$option</span>"</span> != <span class="string">"Disks"</span> <span class="_">-a</span> <span class="string">"<span class="variable">$option</span>"</span> != <span class="string">"Quit"</span> ];<span class="keyword">do</span></div><div class="line">    <span class="built_in">echo</span> <span class="string">"CPU,MEM,Disks,Quit"</span></div><div class="line">    <span class="built_in">read</span> -p <span class="string">"Enter your option:"</span> option</div><div class="line"><span class="keyword">done</span></div><div class="line"><span class="keyword">case</span> <span class="variable">$option</span> <span class="keyword">in</span></div><div class="line">CPU)</div><div class="line">  lscpu</div><div class="line">  ;;</div><div class="line">MEM)</div><div class="line">  free -m</div><div class="line">  ;;</div><div class="line">Disks)</div><div class="line">  fdisk<span class="_">-l</span> /dev/sd[a-z]</div><div class="line">  ;;</div><div class="line">*)</div><div class="line">  <span class="built_in">echo</span> <span class="string">"quit"</span></div><div class="line">  <span class="built_in">exit</span> 0</div><div class="line">  ;;</div><div class="line"><span class="keyword">esac</span></div></pre></td></tr></table></figure></p>
<p>2.写一个服务脚本，<br>1）支持接受start，stop，restart，status四个参数之一；<br>2）如果参数非此四值，则提示使用帮助后退出；<br>3）start则创建lockfile，并启动；stop则删除lockfile，显示停止；restart，则先删除此文件，再创建此文件，而后显示启动完成；status，如果lockfile存在，则显示running，不存在，则显示 stopped<br>编写服务脚本：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line">[root@centos7 lab]<span class="comment"># cat testservice2 </span></div><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment">#chkconfig: - 50 50</span></div><div class="line"><span class="comment">#description: test service script</span></div><div class="line"><span class="comment">#</span></div><div class="line"></div><div class="line">prog=$(basename <span class="variable">$0</span>)</div><div class="line">lockfile=/var/lock/subsys/<span class="variable">$prog</span></div><div class="line"><span class="keyword">case</span> <span class="variable">$1</span> <span class="keyword">in</span></div><div class="line">start)</div><div class="line">     <span class="keyword">if</span> [ <span class="_">-f</span> <span class="variable">$lockfile</span> ];<span class="keyword">then</span></div><div class="line">        <span class="built_in">echo</span> <span class="string">"<span class="variable">$prog</span> is running"</span></div><div class="line">     <span class="keyword">else</span></div><div class="line">        touch <span class="variable">$lockfile</span></div><div class="line">        [ $? <span class="_">-eq</span> 0 ] &amp;&amp; <span class="built_in">echo</span> <span class="string">"<span class="variable">$prog</span> is started"</span></div><div class="line">     <span class="keyword">fi</span></div><div class="line">     ;;</div><div class="line">stop)</div><div class="line">     <span class="keyword">if</span> [ <span class="_">-f</span> <span class="variable">$lockfile</span> ];<span class="keyword">then</span></div><div class="line">        rm -rf <span class="variable">$lockfile</span></div><div class="line">        [ $? <span class="_">-eq</span> 0 ] &amp;&amp; <span class="built_in">echo</span> <span class="string">"<span class="variable">$prog</span> is stopped"</span></div><div class="line">     <span class="keyword">else</span></div><div class="line">        <span class="built_in">echo</span> <span class="string">"<span class="variable">$prog</span> is not running"</span></div><div class="line">     <span class="keyword">fi</span></div><div class="line">     ;;</div><div class="line">restart)</div><div class="line">     <span class="keyword">if</span> [ <span class="_">-f</span> <span class="variable">$lockfile</span> ];<span class="keyword">then</span></div><div class="line">        rm -rf <span class="variable">$lockfile</span></div><div class="line">        [ $? <span class="_">-eq</span> 0 ] &amp;&amp; <span class="built_in">echo</span> <span class="string">"<span class="variable">$prog</span> is stopped"</span></div><div class="line">        touch <span class="variable">$lockfile</span></div><div class="line">        [ $? <span class="_">-eq</span> 0 ] &amp;&amp; <span class="built_in">echo</span> <span class="string">"<span class="variable">$prog</span> is started"</span></div><div class="line">     <span class="keyword">else</span></div><div class="line">        touch <span class="variable">$lockfile</span></div><div class="line">        [ $? <span class="_">-eq</span> 0 ] &amp;&amp; <span class="built_in">echo</span> <span class="string">"<span class="variable">$prog</span> is started"</span></div><div class="line">     <span class="keyword">fi</span></div><div class="line">     ;;</div><div class="line">status)</div><div class="line">      <span class="keyword">if</span> [ <span class="_">-f</span> <span class="variable">$lockfile</span> ];<span class="keyword">then</span></div><div class="line">         <span class="built_in">echo</span> <span class="string">"<span class="variable">$prog</span> is started"</span></div><div class="line">      <span class="keyword">else</span></div><div class="line">         <span class="built_in">echo</span> <span class="string">"<span class="variable">$prog</span> is stopped"</span></div><div class="line">      <span class="keyword">fi</span></div><div class="line">      ;;</div><div class="line">*)</div><div class="line">      <span class="built_in">echo</span> <span class="string">"Usage:<span class="variable">$prog</span> &#123;start|stop|restart|status&#125;"</span></div><div class="line">      <span class="built_in">exit</span> 1</div><div class="line">      ;;</div><div class="line"><span class="keyword">esac</span></div></pre></td></tr></table></figure></p>
<p>添加服务项：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 复制到 /etc/init.d/ 目录下：</span></div><div class="line">[root@centos7 lab]<span class="comment"># cp testservice2 /etc/init.d/</span></div><div class="line"></div><div class="line"><span class="comment"># 加入到 SysV 服务中去，使用 service 命令管控</span></div><div class="line">[root@centos7 lab]<span class="comment"># chkconfig --add testservice2</span></div><div class="line">[root@centos7 lab]<span class="comment"># chkconfig --list testservice2</span></div><div class="line"></div><div class="line">Note: This output shows SysV services only and does not include native</div><div class="line">      systemd services. SysV configuration data might be overridden by native</div><div class="line">      systemd configuration.</div><div class="line"></div><div class="line">      If you want to list systemd services use <span class="string">'systemctl list-unit-files'</span>.</div><div class="line">      To see services enabled on particular target use</div><div class="line">      <span class="string">'systemctl list-dependencies [target]'</span>.</div><div class="line"></div><div class="line">testservice2   	0:off	1:off	2:off	3:off	4:off	5:off	6:off</div><div class="line"></div><div class="line"><span class="comment"># 给脚本一个执行权限</span></div><div class="line">[root@centos7 bin]<span class="comment"># chmod +x /etc/init.d/testservice</span></div></pre></td></tr></table></figure></p>
<p>服务脚本测试：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">[root@centos7 lab]<span class="comment"># service testservice2 start</span></div><div class="line">testservice2 is started</div><div class="line">[root@centos7 lab]<span class="comment"># service testservice2 start</span></div><div class="line">testservice2 is running</div><div class="line">[root@centos7 lab]<span class="comment"># service testservice2 stop</span></div><div class="line">testservice2 is stopped</div><div class="line">[root@centos7 lab]<span class="comment"># service testservice2 status</span></div><div class="line">testservice2 is stopped</div><div class="line">[root@centos7 lab]<span class="comment"># service testservice2 start</span></div><div class="line">testservice2 is started</div><div class="line">[root@centos7 lab]<span class="comment"># service testservice2 restart</span></div><div class="line">testservice2 is stopped</div><div class="line">testservice2 is started</div><div class="line">[root@centos7 lab]<span class="comment"># service testservice2 stop</span></div><div class="line">testservice2 is stopped</div><div class="line">You have new mail <span class="keyword">in</span> /var/spool/mail/root</div><div class="line">[root@centos7 lab]<span class="comment"># service testservice2 restart</span></div><div class="line">testservice2 is started</div><div class="line"></div><div class="line"><span class="comment"># 注意：通过服务控制的脚本都会在启动完成后在 /var/lock/subsys/ 下创建一个锁文件</span></div><div class="line">[root@centos7 lab]<span class="comment"># ls /var/lock/subsys/</span></div><div class="line">network  testservice2</div></pre></td></tr></table></figure></p>
<h4 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h4><p>★ 总结：<br>&ensp;&ensp;&ensp;&ensp;◆if语句在使用过程中，可以实现多重嵌套，这里一定要注意书写的格式，分好层次，不要写乱了；<br>&ensp;&ensp;&ensp;&ensp;◆case一般是在拿一个变量来回跟多个可能的变量取值作比较才能使用，才会使用到。一定要注意书写格式.<br>&ensp;&ensp;&ensp;&ensp;◆在写脚本的时候不能着急，要构思清新，每一种情况都要考虑到</p>
<h4 id="练习："><a href="#练习：" class="headerlink" title="练习："></a>练习：</h4><p>1.写一个脚本/root/bin/createuser.sh，实现如下功能：使用一个用户名做为参数，如果指定参数的用户存在，就显示其存在，否则添加之；显示添加的用户的id号等信息<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">[root@centos7 lab]<span class="comment"># cat createuser.sh </span></div><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"><span class="comment">#</span></div><div class="line">[ <span class="variable">$#</span> <span class="_">-lt</span> 1 ] &amp;&amp; <span class="built_in">echo</span> <span class="string">"You must input a username"</span> &amp;&amp; <span class="built_in">exit</span> 1</div><div class="line"></div><div class="line">id <span class="variable">$1</span> &amp;&gt;/dev/null</div><div class="line"><span class="keyword">if</span> [ $? <span class="_">-eq</span> 0 ];<span class="keyword">then</span></div><div class="line">   <span class="built_in">echo</span> <span class="string">"The user <span class="variable">$1</span> exsits"</span></div><div class="line"><span class="keyword">else</span></div><div class="line">   useradd <span class="variable">$1</span></div><div class="line">   <span class="built_in">echo</span> <span class="string">"The username is: <span class="variable">$1</span> and id is: <span class="variable">$(id -u $1)</span>"</span></div><div class="line"><span class="keyword">fi</span></div><div class="line"></div><div class="line">运行结果：</div><div class="line">[root@centos7 lab]<span class="comment"># bash createuser.sh jack</span></div><div class="line">The user jack exsits</div><div class="line">[root@centos7 lab]<span class="comment"># bash createuser.sh zhou</span></div><div class="line">The username is: zhou and id is: 1030</div></pre></td></tr></table></figure></p>
<p>2.写一个脚本yesorno.sh，提示用户输入yes或no,并判断用户输入的是yes还是no,或是其它信息<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">[root@centos7 lab]<span class="comment"># cat yesorno.sh </span></div><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="built_in">read</span> -p <span class="string">"Please enter yes or no:"</span> choice</div><div class="line"></div><div class="line"><span class="keyword">case</span> <span class="variable">$choice</span> <span class="keyword">in</span></div><div class="line">[Yy][Ee][Ss]|[yY])</div><div class="line">	<span class="built_in">echo</span> <span class="string">"Yes!!!"</span></div><div class="line">        ;;</div><div class="line">[Nn][Oo]|[nN])</div><div class="line">        <span class="built_in">echo</span> <span class="string">"No!!!"</span></div><div class="line">        ;;</div><div class="line">*)</div><div class="line">        <span class="built_in">echo</span> <span class="string">"Other char"</span></div><div class="line">        ;;</div><div class="line"><span class="keyword">esac</span></div><div class="line"></div><div class="line">运行结果：</div><div class="line">[root@centos7 lab]<span class="comment"># bash yesorno.sh</span></div><div class="line">Please enter yes or no:y</div><div class="line">Yes!!!</div><div class="line">[root@centos7 lab]<span class="comment"># bash yesorno.sh</span></div><div class="line">Please enter yes or no:n</div><div class="line">No!!!</div><div class="line">[root@centos7 lab]<span class="comment"># bash yesorno.sh</span></div><div class="line">Please enter yes or no:yes</div><div class="line">Yes!!!</div><div class="line">[root@centos7 lab]<span class="comment"># bash yesorno.sh</span></div><div class="line">Please enter yes or no:NO</div><div class="line">No!!!</div><div class="line">[root@centos7 lab]<span class="comment"># bash yesorno.sh</span></div><div class="line">Please enter yes or no:123</div><div class="line">Other char</div></pre></td></tr></table></figure></p>
<h3 id="循环执行"><a href="#循环执行" class="headerlink" title="循环执行"></a>循环执行</h3><p>★ 循环执行：<br>&ensp;&ensp;&ensp;&ensp;将一段代码段重复执行0，1或多次<br>☉进入条件：<br>&ensp;&ensp;&ensp;&ensp;条件满足时才进入循环；<br>☉退出条件：<br>&ensp;&ensp;&ensp;&ensp;每个循环都应该有退出条件，以有机会退出循环；<br>★ bash脚本的循环<br>&ensp;&ensp;&ensp;&ensp;◆for 循环；<br>&ensp;&ensp;&ensp;&ensp;◆while 循环；<br>&ensp;&ensp;&ensp;&ensp;◆until 循环；</p>
<h3 id="for循环"><a href="#for循环" class="headerlink" title="for循环"></a>for循环</h3><p>★ for循环<br>☉两种格式：<br>&ensp;&ensp;&ensp;&ensp;遍历列表；<br>&ensp;&ensp;&ensp;&ensp;控制变量；<br>★ 遍历列表方式：<br>☉语法：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> VARAIBLE <span class="keyword">in</span> LIST ;<span class="keyword">do</span></div><div class="line">       循环体</div><div class="line"><span class="keyword">done</span></div></pre></td></tr></table></figure></p>
<p>☉进入条件：<br>&ensp;&ensp;&ensp;&ensp;只要列表有元素，即可进入循环；<br>☉退出条件：<br>&ensp;&ensp;&ensp;&ensp;列表中的元素遍历完成。<br>☉执行机制：<br>&ensp;&ensp;&ensp;&ensp;依次将列表中的元素赋值给“变量名”; 每次赋值后即执行一次循环体; 直到列表中的元素耗尽，循环结束。（遍历列表）<br>☉列表生成方式<br>&ensp;&ensp;&ensp;&ensp;直接给出列表；<br>&ensp;&ensp;&ensp;&ensp;整数列表：<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;1）{start..end}；<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;2）$(seq[start [step]] end)；step 为步长<br>&ensp;&ensp;&ensp;&ensp;返回列表的命令； $(COMMAND)   $() = `` 都是变量引用<br>&ensp;&ensp;&ensp;&ensp;使用glob，如：<em>.sh<br>&ensp;&ensp;&ensp;&ensp;变量引用：$@，$</em><br>&ensp;&ensp;&ensp;&ensp;…</p>
<h4 id="示例：-3"><a href="#示例：-3" class="headerlink" title="示例："></a>示例：</h4><p>1.求100以内所有正整数之和<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">[root@centos7 lab]<span class="comment"># cat sum100.sh </span></div><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="built_in">declare</span> -i i=1</div><div class="line"><span class="built_in">declare</span> -i sum=0</div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..100&#125;;<span class="keyword">do</span></div><div class="line">   <span class="built_in">echo</span> <span class="string">"\$sum is <span class="variable">$sum</span>,\$i is <span class="variable">$i</span>."</span></div><div class="line">   sum=$[<span class="variable">$sum</span>+<span class="variable">$i</span>]</div><div class="line"><span class="keyword">done</span></div><div class="line"><span class="built_in">echo</span> <span class="string">"sum is: <span class="variable">$sum</span>"</span></div><div class="line"></div><div class="line">运行结果：</div><div class="line">[root@centos7 lab]<span class="comment"># bash sum100.sh </span></div><div class="line"><span class="variable">$sum</span> is 0,<span class="variable">$i</span> is 1.</div><div class="line"><span class="variable">$sum</span> is 1,<span class="variable">$i</span> is 2.</div><div class="line"><span class="variable">$sum</span> is 3,<span class="variable">$i</span> is 3.</div><div class="line"><span class="variable">$sum</span> is 6,<span class="variable">$i</span> is 4.</div><div class="line"><span class="variable">$sum</span> is 10,<span class="variable">$i</span> is 5.</div><div class="line">...</div><div class="line">sum is: 5050</div><div class="line"></div><div class="line"><span class="comment"># 100 以内所有偶数之和</span></div><div class="line">[root@centos7 lab]<span class="comment"># sum=0;for i in `seq 2 2 100`;do sum=$[$sum+$i];done;echo "$sum"</span></div><div class="line">2550</div><div class="line"></div><div class="line"><span class="comment"># 100 以内所有奇数之和</span></div><div class="line">[root@centos7 lab]<span class="comment"># sum=0;for i in `seq 1 2 100`;do sum=$[$sum+$i];done;echo "$sum"</span></div><div class="line">2500</div><div class="line"></div><div class="line"><span class="comment"># 求当前系统上所有用户的id之和</span></div><div class="line">[root@centos7 lab]<span class="comment"># sum=0;for i in $(cat /etc/passwd|cut -d: -f3);do sum=$[$sum+$i];done;echo "$sum"</span></div><div class="line">35397</div></pre></td></tr></table></figure></p>
<p>2.判断/var/log/目录下所有文件的文件类型：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">[root@centos7 lab]<span class="comment"># cat filetype1.sh </span></div><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="keyword">for</span> file <span class="keyword">in</span> /var/<span class="built_in">log</span>/*;<span class="keyword">do</span></div><div class="line">    <span class="keyword">if</span> [ <span class="_">-f</span> <span class="variable">$file</span> ];<span class="keyword">then</span></div><div class="line">       <span class="built_in">echo</span> <span class="string">"<span class="variable">$file</span> is common file."</span></div><div class="line">    <span class="keyword">elif</span> [ <span class="_">-d</span> <span class="variable">$file</span> ];<span class="keyword">then</span></div><div class="line">       <span class="built_in">echo</span> <span class="string">"<span class="variable">$file</span> is directory."</span></div><div class="line">    <span class="keyword">elif</span> [ -c <span class="variable">$file</span> ];<span class="keyword">then</span></div><div class="line">       <span class="built_in">echo</span> <span class="string">"<span class="variable">$file</span> is character file."</span></div><div class="line">    <span class="keyword">elif</span> [ -b <span class="variable">$file</span> ];<span class="keyword">then</span></div><div class="line">       <span class="built_in">echo</span> <span class="string">"<span class="variable">$file</span> is block file."</span></div><div class="line">    <span class="keyword">elif</span> [ <span class="_">-s</span> <span class="variable">$file</span> ];<span class="keyword">then</span></div><div class="line">       <span class="built_in">echo</span> <span class="string">"<span class="variable">$file</span> is socket file."</span></div><div class="line">    <span class="keyword">else</span></div><div class="line">       <span class="built_in">echo</span> <span class="string">"<span class="variable">$file</span> is unknow."</span></div><div class="line">    <span class="keyword">fi</span></div><div class="line"><span class="keyword">done</span></div><div class="line"></div><div class="line">运行结果：</div><div class="line">[root@centos7 lab]<span class="comment"># bash filetype1.sh </span></div><div class="line">/var/<span class="built_in">log</span>/anaconda is directory.</div><div class="line">/var/<span class="built_in">log</span>/audit is directory.</div><div class="line">/var/<span class="built_in">log</span>/boot.log is common file.</div><div class="line">/var/<span class="built_in">log</span>/btmp is common file.</div><div class="line">/var/<span class="built_in">log</span>/btmp-20170801 is common file.</div><div class="line">/var/<span class="built_in">log</span>/cron is common file.</div><div class="line">/var/<span class="built_in">log</span>/cron-20170716 is common file.</div></pre></td></tr></table></figure></p>
<h3 id="while循环"><a href="#while循环" class="headerlink" title="while循环"></a>while循环</h3><p>★ while循环<br>☉语法：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">while</span> CONDITION; <span class="keyword">do</span></div><div class="line">         循环体</div><div class="line"><span class="keyword">done</span></div></pre></td></tr></table></figure></p>
<p>☉进入条件：<br>&ensp;&ensp;&ensp;&ensp;CONDITION为true；<br>☉退出条件：<br>&ensp;&ensp;&ensp;&ensp;CONDITION为 false；<br>☉CONDITION（循环控制条件）：<br>&ensp;&ensp;&ensp;&ensp;进入循环之前，先做一次判断；每一次循环之后会再次做判断；条件为“true”，则执行一次循环；直到条件测试状态为“false”终止循环；<br>&ensp;&ensp;&ensp;&ensp;因此：CONDTION一般应该有循环控制变量；而此变量的值会在循环体不断地被修正；一般为布尔型表达式</p>
<h4 id="示例：-4"><a href="#示例：-4" class="headerlink" title="示例："></a>示例：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">[root@centos7 lab]<span class="comment"># vim sum100_1.sh</span></div><div class="line">  1 <span class="comment">#!/bin/bash</span></div><div class="line">  2 <span class="comment">#</span></div><div class="line">  3 <span class="built_in">declare</span> -i i=1</div><div class="line">  4 <span class="built_in">declare</span> -i sum=0</div><div class="line">  5 <span class="keyword">while</span> [ <span class="variable">$i</span> -le 100 ];<span class="keyword">do</span></div><div class="line">  6       sum=$[<span class="variable">$sum</span>+<span class="variable">$i</span>]</div><div class="line">  7 <span class="comment">#     let i=$i+1</span></div><div class="line">  8       <span class="built_in">let</span> i++</div><div class="line">  9 <span class="keyword">done</span></div><div class="line"> 10 <span class="built_in">echo</span> <span class="string">"sum is:<span class="variable">$sum</span>"</span></div><div class="line"></div><div class="line">运行结果：</div><div class="line">[root@centos7 lab]<span class="comment"># bash sum100_1.sh </span></div><div class="line">sum is:5050</div></pre></td></tr></table></figure>
<h3 id="until循环"><a href="#until循环" class="headerlink" title="until循环"></a>until循环</h3><p>★ until循环（相当于在wehile控制条件之前加 “！”）<br>★ 语法：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">until CONDITION; <span class="keyword">do</span></div><div class="line">       循环体</div><div class="line"><span class="keyword">done</span></div></pre></td></tr></table></figure></p>
<p>☉进入条件：<br>&ensp;&ensp;&ensp;&ensp;CONDITION为 flase；<br>☉退出条件：<br>&ensp;&ensp;&ensp;&ensp;CONDITION为 true；</p>
<h4 id="示例：-5"><a href="#示例：-5" class="headerlink" title="示例："></a>示例：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">[root@centos7 lab]<span class="comment"># vim sum100_2.sh</span></div><div class="line"></div><div class="line">  1 <span class="comment">#!/bin/bash</span></div><div class="line">  2 <span class="built_in">declare</span> -i sum=0</div><div class="line">  3 <span class="built_in">declare</span> -i i=1</div><div class="line">  4 until [ <span class="variable">$i</span> <span class="_">-gt</span> 100 ];<span class="keyword">do</span></div><div class="line">  5      sum=$[<span class="variable">$sum</span>+<span class="variable">$i</span>]</div><div class="line">  6      <span class="built_in">let</span> i++</div><div class="line">  7 <span class="keyword">done</span></div><div class="line">  8 <span class="built_in">echo</span> <span class="string">"sum is: <span class="variable">$sum</span>"</span></div><div class="line"></div><div class="line">运行结果：</div><div class="line">[root@centos7 lab]<span class="comment"># bash sum100_2.sh </span></div><div class="line">sum is: 5050</div></pre></td></tr></table></figure>
<h3 id="创建无限循环"><a href="#创建无限循环" class="headerlink" title="创建无限循环"></a>创建无限循环</h3><p>★ while 无限循环<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">while</span> <span class="literal">true</span>；<span class="keyword">do</span></div><div class="line">    循环体</div><div class="line"><span class="keyword">done</span></div></pre></td></tr></table></figure></p>
<p>★ until 无限循环<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">until flase； <span class="keyword">do</span></div><div class="line">   循环体</div><div class="line"><span class="keyword">done</span></div></pre></td></tr></table></figure></p>
<h3 id="循环控制语句"><a href="#循环控制语句" class="headerlink" title="循环控制语句"></a>循环控制语句</h3><p>★ continue [N]：<br>提前结束本轮循环，而直接进入下一轮循环判断<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">while</span> CONDITION1;DO</div><div class="line">    CMD1</div><div class="line">    ...</div><div class="line">    <span class="keyword">if</span> CONDITION2;<span class="keyword">then</span></div><div class="line">         <span class="built_in">continue</span></div><div class="line">    <span class="keyword">fi</span></div><div class="line">    CMDn</div><div class="line">    ...</div><div class="line"><span class="keyword">done</span></div></pre></td></tr></table></figure></p>
<p>★ break [N]：<br>提前跳出循环<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">   <span class="keyword">while</span>  CONDITION1; <span class="keyword">do</span></div><div class="line">	CMD1</div><div class="line">	...</div><div class="line">	<span class="keyword">if</span>  CONDITION2; <span class="keyword">then</span></div><div class="line">		<span class="built_in">break</span></div><div class="line">	<span class="keyword">fi</span></div><div class="line"><span class="keyword">done</span></div></pre></td></tr></table></figure></p>
<h4 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h4><p>1.求100以内所有偶数之和：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">[root@centos7 lab]<span class="comment"># vim sumeven.sh</span></div><div class="line"></div><div class="line">  1 <span class="comment">#!/bin/bash</span></div><div class="line">  2 <span class="comment">#</span></div><div class="line">  3 <span class="built_in">declare</span> -i i=0</div><div class="line">  4 <span class="built_in">declare</span> -i evensum=0</div><div class="line">  5 <span class="keyword">while</span> [ <span class="variable">$i</span> -le 100 ];<span class="keyword">do</span></div><div class="line">  6       <span class="built_in">let</span> i++</div><div class="line">  7       <span class="keyword">if</span> [ $[<span class="variable">$i</span>%2] <span class="_">-eq</span> 1 ];<span class="keyword">then</span></div><div class="line">  8          <span class="built_in">continue</span></div><div class="line">  9       <span class="keyword">fi</span></div><div class="line"> 10       evensum=$[<span class="variable">$evensum</span>+<span class="variable">$i</span>]</div><div class="line"> 11 <span class="keyword">done</span></div><div class="line"> 12 <span class="built_in">echo</span> <span class="string">"sum is: <span class="variable">$evensum</span>"</span></div><div class="line"></div><div class="line">运行结果：</div><div class="line">[root@centos7 lab]<span class="comment"># bash sumeven.sh </span></div><div class="line">sum is: 2550</div></pre></td></tr></table></figure></p>
<p>2.求100以内所有奇数之和<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">[root@centos7 lab]<span class="comment"># vim sumodd.sh </span></div><div class="line"></div><div class="line">  1 <span class="comment">#!/bin/bash</span></div><div class="line">  2 <span class="comment">#</span></div><div class="line">  3 <span class="built_in">declare</span> -i i=1</div><div class="line">  4 <span class="built_in">declare</span> -i oddsum=1</div><div class="line">  5 </div><div class="line">  6 <span class="keyword">while</span> <span class="literal">true</span>;<span class="keyword">do</span></div><div class="line">  7     <span class="built_in">let</span> i+=2</div><div class="line">  8     oddsum=$[<span class="variable">$oddsum</span>+<span class="variable">$i</span>]</div><div class="line">  9     <span class="keyword">if</span> [ <span class="variable">$i</span> -ge 99 ];<span class="keyword">then</span></div><div class="line"> 10         <span class="built_in">break</span></div><div class="line"> 11     <span class="keyword">fi</span></div><div class="line"> 12 <span class="keyword">done</span></div><div class="line"> 13 <span class="built_in">echo</span> <span class="string">"sum is: <span class="variable">$oddsum</span>"</span></div><div class="line"></div><div class="line">运行结果：</div><div class="line">[root@centos7 lab]<span class="comment"># bash sumodd.sh </span></div><div class="line">sum is: 2500</div></pre></td></tr></table></figure></p>
<h3 id="sleep-命令"><a href="#sleep-命令" class="headerlink" title="sleep 命令"></a>sleep 命令</h3><p>★ sleep<br>☉用途<br>&ensp;&ensp;&ensp;&ensp;sleep命令常用于在Linux shell脚本中延迟时间。<br>☉语法：<br>&ensp;&ensp;&ensp;&ensp;sleep NUMBER [SUFFIX]…<br>☉SUFFIX（后缀）：<br>&ensp;&ensp;&ensp;&ensp;s：秒, 默认；<br>&ensp;&ensp;&ensp;&ensp;m：分；<br>&ensp;&ensp;&ensp;&ensp;h：小时；<br>&ensp;&ensp;&ensp;&ensp;d：天</p>
<h3 id="示例：-6"><a href="#示例：-6" class="headerlink" title="示例："></a>示例：</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@centos7 ~]<span class="comment"># date;sleep 5;date</span></div><div class="line">Fri Aug 11 13:22:50 CST 2017</div><div class="line">Fri Aug 11 13:22:55 CST 2017</div></pre></td></tr></table></figure>
<p>每隔三秒钟到系统上获取已登录的用户信息；其中，如果centos用户登录了系统，则记录于日志中，并退出<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">[root@centos7 lab]<span class="comment"># vim login.sh</span></div><div class="line"></div><div class="line">  1 <span class="comment">#!/bin/bash</span></div><div class="line">  2 <span class="comment">#</span></div><div class="line">  3 <span class="keyword">while</span> <span class="literal">true</span>;<span class="keyword">do</span></div><div class="line">  4     <span class="keyword">if</span> who|grep <span class="string">"^jack\&gt;"</span> &amp;&gt;/dev/null;<span class="keyword">then</span></div><div class="line">  5         <span class="built_in">break</span></div><div class="line">  6     <span class="keyword">fi</span></div><div class="line">  7     sleep 3</div><div class="line">  8 <span class="keyword">done</span></div><div class="line">  9 <span class="built_in">echo</span> <span class="string">"<span class="variable">$(date "+%F %T")</span> jack login"</span> &gt;&gt;/tmp/user.log</div><div class="line"></div><div class="line">运行结果：</div><div class="line">[root@centos7 lab]<span class="comment"># bash login.sh </span></div><div class="line">[root@centos7 tmp]<span class="comment"># cat user.log </span></div><div class="line">2017-08-11 13:31:52 jack login</div><div class="line"></div><div class="line">[root@centos7 lab]<span class="comment"># vim login1.sh</span></div><div class="line"></div><div class="line">  1 <span class="comment">#!/bin/bash</span></div><div class="line">  2 <span class="comment">#</span></div><div class="line">  3 until who|grep <span class="string">"^jack\&gt;"</span> &amp;&gt;/dev/null;<span class="keyword">do</span></div><div class="line">  4       sleep 3</div><div class="line">  5 <span class="keyword">done</span></div><div class="line">  6 <span class="built_in">echo</span> <span class="string">"<span class="variable">$(date "+%F %T")</span> jack login"</span> &gt;&gt;/tmp/user.log</div><div class="line"></div><div class="line">运行结果：</div><div class="line">[root@centos7 lab]<span class="comment"># bash login1.sh </span></div><div class="line">[root@centos7 tmp]<span class="comment"># cat user.log </span></div><div class="line">2017-08-11 13:37:46 jack login</div></pre></td></tr></table></figure></p>
<h3 id="循环语句的特殊用法"><a href="#循环语句的特殊用法" class="headerlink" title="循环语句的特殊用法"></a>循环语句的特殊用法</h3><h4 id="while循环的特殊用法"><a href="#while循环的特殊用法" class="headerlink" title="while循环的特殊用法"></a>while循环的特殊用法</h4><p>★ while循环的特殊用法（遍历文件的每一行）<br>☉语法：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"> <span class="keyword">while</span> <span class="built_in">read</span> VARIABLE; <span class="keyword">do</span></div><div class="line">   循环体</div><div class="line"><span class="keyword">done</span> &lt; /PATH/FROM/SOMEFILE</div></pre></td></tr></table></figure></p>
<p>☉意义：<br>&ensp;&ensp;&ensp;&ensp;依次读取/PATH/FROM/SOMEFILE文件中的每一行，且将行赋值给变量VARIABLE（一般变量可设置为 line）</p>
<h4 id="示例：-7"><a href="#示例：-7" class="headerlink" title="示例："></a>示例：</h4><p>1.找出ID号为偶数的用户，显示其用户名，ID，及默认的shell<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">[root@centos7 lab]<span class="comment"># vim user.sh</span></div><div class="line"></div><div class="line">  1 <span class="comment">#!/bin/bash</span></div><div class="line">  2 <span class="comment">#</span></div><div class="line">  3 <span class="keyword">while</span> <span class="built_in">read</span> line;<span class="keyword">do</span></div><div class="line">  4    username=$(<span class="built_in">echo</span> <span class="variable">$line</span>|cut <span class="_">-d</span>: <span class="_">-f</span>1)</div><div class="line">  5    userid=$(<span class="built_in">echo</span> <span class="variable">$line</span>|cut <span class="_">-d</span>: <span class="_">-f</span>3)</div><div class="line">  6    usershell=$(<span class="built_in">echo</span> <span class="variable">$line</span>|cut <span class="_">-d</span>: <span class="_">-f</span>7)</div><div class="line">  7    <span class="keyword">if</span> [ $[<span class="variable">$userid</span>%2] <span class="_">-eq</span> 0 ];<span class="keyword">then</span></div><div class="line">  8       <span class="built_in">echo</span> <span class="string">"<span class="variable">$&#123;username&#125;</span>'s id:<span class="variable">$userid</span>,shell:<span class="variable">$usershell</span>"</span></div><div class="line">  9    <span class="keyword">fi</span></div><div class="line"> 10 <span class="keyword">done</span> &lt; /etc/passwd</div><div class="line"></div><div class="line"> 运行结果：</div><div class="line"> [root@centos7 lab]<span class="comment"># bash user.sh</span></div><div class="line">root<span class="string">'s id:0,shell:/bin/bash</span></div><div class="line">daemon's id:2,shell:/sbin/nologin</div><div class="line">lp<span class="string">'s id:4,shell:/sbin/nologin</span></div><div class="line">shutdown's id:6,shell:/sbin/shutdown</div><div class="line">mail<span class="string">'s id:8,shell:/sbin/nologin</span></div><div class="line">games's id:12,shell:/sbin/nologin</div></pre></td></tr></table></figure></p>
<p>2.检查文件系统是否大于90%<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">[root@centos7 lab]<span class="comment"># vim fs.sh</span></div><div class="line"></div><div class="line">  1 <span class="comment">#!/bin/bash</span></div><div class="line">  2 <span class="comment">#</span></div><div class="line">  3 df|grep -E <span class="string">"[0-9]+%"</span>|<span class="keyword">while</span> <span class="built_in">read</span> line</div><div class="line">  4 <span class="keyword">do</span></div><div class="line">  5         use=$(<span class="built_in">echo</span> <span class="variable">$line</span>|awk <span class="string">'&#123;print $5&#125;'</span>|tr <span class="_">-d</span> <span class="string">'%'</span>)</div><div class="line">  6         mountpoint=$(<span class="built_in">echo</span> <span class="variable">$line</span>|awk <span class="string">'&#123;print $6&#125;'</span>)</div><div class="line">  7         [ <span class="variable">$use</span> <span class="_">-gt</span> 90  ] &amp;&amp; <span class="built_in">echo</span> <span class="string">"<span class="variable">$mountpoint</span> is over 90% untilized."</span></div><div class="line">  8 <span class="keyword">done</span></div><div class="line">运行结果：</div><div class="line">[root@centos7 lab]<span class="comment"># bash fs.sh </span></div><div class="line">/var is over 90% untilized.</div><div class="line"></div><div class="line">[root@centos7 ~]<span class="comment"># df|grep -E "[0-9]+%"|while read fs blocks used available use mountpoint;do use=$(echo $use|tr -d '%'); [ $use -gt 90 ] &amp;&amp; echo "$mountpoint is over 90% utilized."; done</span></div><div class="line">运行结果：</div><div class="line">[root@centos7 lab]<span class="comment"># /var is over 90% utilized.</span></div></pre></td></tr></table></figure></p>
<h4 id="for循环的特殊用法"><a href="#for循环的特殊用法" class="headerlink" title="for循环的特殊用法"></a>for循环的特殊用法</h4><p>★ for循环的特殊用法<br>&ensp;&ensp;&ensp;&ensp;双小括号方法，即((…))格式，也可以用于算术运算；<br>&ensp;&ensp;&ensp;&ensp;双小括号方法也可以使bash Shell实现C语言风格的变量操作；<br>☉语法：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> ((控制变量初始化;条件判断表达式;控制变量的修正表达式))</div><div class="line">        循环体</div><div class="line"><span class="keyword">done</span></div></pre></td></tr></table></figure></p>
<p>◆控制变量初始化：<br>&ensp;&ensp;&ensp;&ensp;仅在运行到循环代码段时执行一次；<br>◆控制变量的修正表达式：<br>&ensp;&ensp;&ensp;&ensp;每轮循环结束会先进行控制变量修正运算，而后再做条件判断；<br>☉意义：<br>&ensp;&ensp;&ensp;&ensp;第一个分号之前相当于变量的一个初始值，只执行一次，然后进行条件判断，满足条件进入循环体，每轮循环结束后会执行修正表达式，然后再做判断，条件满足进入循环体，结束后再做修正，在判断，如此而已…直到条件判断不满足时，就退出循环。实际上，二三分号，是while循环的意思。</p>
<h4 id="示例：-8"><a href="#示例：-8" class="headerlink" title="示例："></a>示例：</h4><p>1.给定一个正整数，求之内的所有正整数之和；<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line">  2 [ <span class="variable">$#</span> <span class="_">-lt</span> 1 ] &amp;&amp; <span class="built_in">echo</span> <span class="string">"Please enter a num"</span> &amp;&amp; <span class="built_in">exit</span> 1</div><div class="line">  3 <span class="keyword">for</span>((i=0;i&lt;=<span class="variable">$1</span>;i++));<span class="keyword">do</span></div><div class="line">  4     sum=$[<span class="variable">$sum</span>+<span class="variable">$i</span>]</div><div class="line">  5 <span class="keyword">done</span></div><div class="line">  6 <span class="built_in">echo</span> <span class="string">"sum is:<span class="variable">$sum</span>"</span></div><div class="line"></div><div class="line"> 运行结果：</div><div class="line"> [root@centos7 lab]<span class="comment"># bash sum.sh 5</span></div><div class="line">sum is:15</div><div class="line"></div><div class="line">[root@centos7 lab]<span class="comment"># vim sum.sh</span></div><div class="line"></div><div class="line">  1 <span class="comment">#!/bin/bash</span></div><div class="line">  2 <span class="built_in">read</span> -p <span class="string">"Please enter a num:"</span> number</div><div class="line">  3 [ -z <span class="variable">$number</span> ] &amp;&amp; <span class="built_in">echo</span> <span class="string">"You must enter a num"</span> &amp;&amp; <span class="built_in">exit</span> 1</div><div class="line">  4 <span class="keyword">for</span>((i=0;i&lt;=<span class="variable">$number</span>;i++));<span class="keyword">do</span></div><div class="line">  5     sum=$[<span class="variable">$sum</span>+<span class="variable">$i</span>]</div><div class="line">  6 <span class="keyword">done</span></div><div class="line">  7 <span class="built_in">echo</span> <span class="string">"sum is:<span class="variable">$sum</span>"</span></div><div class="line"></div><div class="line">运行结果：</div><div class="line">[root@centos7 lab]<span class="comment"># bash sum.sh</span></div><div class="line">Please enter a num:5</div><div class="line">sum is:15</div></pre></td></tr></table></figure></p>
<p>2.打印九九乘法口诀表<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">[root@centos7 lab]<span class="comment"># vim 99.sh</span></div><div class="line">  1 <span class="comment">#!/bin/bash</span></div><div class="line">  2 <span class="built_in">declare</span> -i i=1</div><div class="line">  3 <span class="built_in">declare</span> -i j=1</div><div class="line">  4 <span class="keyword">for</span>((i=1;<span class="variable">$i</span>&lt;=9;i++));<span class="keyword">do</span></div><div class="line">  5    <span class="keyword">for</span>((j=1;<span class="variable">$j</span>&lt;=<span class="variable">$i</span>;j++));<span class="keyword">do</span></div><div class="line">  6       <span class="built_in">echo</span> <span class="_">-e</span> -n <span class="string">"<span class="variable">$&#123;i&#125;</span>X<span class="variable">$&#123;j&#125;</span>=$[<span class="variable">$&#123;i&#125;</span>*<span class="variable">$&#123;j&#125;</span>]\t"</span></div><div class="line">  7    <span class="keyword">done</span></div><div class="line">  8    <span class="built_in">echo</span></div><div class="line">  9 <span class="keyword">done</span></div><div class="line">运行结果：</div><div class="line">[root@centos7 lab]<span class="comment"># bash 99.sh </span></div><div class="line">1X1=1	</div><div class="line">2X1=2	2X2=4	</div><div class="line">3X1=3	3X2=6	3X3=9	</div><div class="line">4X1=4	4X2=8	4X3=12	4X4=16	</div><div class="line">5X1=5	5X2=10	5X3=15	5X4=20	5X5=25	</div><div class="line">6X1=6	6X2=12	6X3=18	6X4=24	6X5=30	6X6=36	</div><div class="line">7X1=7	7X2=14	7X3=21	7X4=28	7X5=35	7X6=42	7X7=49	</div><div class="line">8X1=8	8X2=16	8X3=24	8X4=32	8X5=40	8X6=48	8X7=56	8X8=64	</div><div class="line">9X1=9	9X2=18	9X3=27	9X4=36	9X5=45	9X6=54	9X7=63	9X8=72	9X9=81</div></pre></td></tr></table></figure></p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color5">shell脚本编程</a>
        		</li>
      		
		</ul>
	</div>

      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/2017/07/01/linux之shell脚本编程之语句控制/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>





  
    <article id="post-linux之shell脚本编程-基础篇(二)" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/06/25/linux之shell脚本编程-基础篇(二)/">linux之shell脚本编程-基础篇(二)</a>
    </h1>
  

        
        <a href="/2017/06/25/linux之shell脚本编程-基础篇(二)/" class="archive-article-date">
  	<time datetime="2017-06-25T12:50:22.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2017-06-25</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-shell脚本编程基础篇"><a href="#ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-shell脚本编程基础篇" class="headerlink" title="&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp; &ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp; shell脚本编程基础篇"></a>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp; &ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp; shell脚本编程基础篇</h3><h3 id="退出状态"><a href="#退出状态" class="headerlink" title="退出状态"></a>退出状态</h3><p>★ 进程使用退出状态来报告成功或失败<br>◆0 代表成功，1－255代表失败<br>◆$? 变量保存最近的命令退出状态 （查看：echo $?）存的是最后一条命令的结果，中间即使有错误，也不管。<br>★ 脚本的状态返回值<br>◆默认是脚本中执行的最后一条命令的状态返回值；<br>◆自定义状态退出状态码；<br>&ensp;&ensp;&ensp;&ensp;exit[n]：自定义退出状态码；（exit退出的是当前shell）<br>注意：<br>&ensp;&ensp;&ensp;&ensp;脚本中一旦遇到exit命令，脚本会立即终止；终止退出状态取决于exit命令后面的数字<br>&ensp;&ensp;&ensp;&ensp;如果未给脚本指定退出状态码，整个脚本的退出状态码取决于脚本中执行的最后一条命令的状态码</p>
<h4 id="演示："><a href="#演示：" class="headerlink" title="演示："></a>演示：</h4><p>进程使用退出状态<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">-c1代表一个数据包，-W代表一秒钟</div><div class="line">[root@centos7 ~]<span class="comment"># ping -c1 -w1 192.168.2.1 &amp;&gt;/dev/null</span></div><div class="line">[root@centos7 ~]<span class="comment"># echo $?</span></div><div class="line">0         <span class="comment"># 成功，此主机正在使用</span></div><div class="line">[root@centos7 ~]<span class="comment"># ping -c1 -w1 192.168.2.11 &amp;&gt;/dev/null</span></div><div class="line">[root@centos7 ~]<span class="comment"># echo $?</span></div><div class="line">1         <span class="comment"># 失败，此主机没有使用</span></div></pre></td></tr></table></figure></p>
<h4 id="条件测试"><a href="#条件测试" class="headerlink" title="条件测试"></a>条件测试</h4><p>★ 作用：<br>&ensp;&ensp;&ensp;&ensp;判断某需求是否满足，需要由测试机制来实现；<br>&ensp;&ensp;&ensp;&ensp;专用的测试表达式需要由测试命令辅助完成测试过程；<br>★ 如何编写测试表达式以实现所需的测试：<br>☉执行命令，并利用状态返回值来判断：<br>&ensp;&ensp;&ensp;&ensp;0：成功<br>&ensp;&ensp;&ensp;&ensp;1-255：失败<br>☉测试表达式：<br>&ensp;&ensp;&ensp;&ensp;test EXPRESSION；<br>&ensp;&ensp;&ensp;&ensp;[ EXPRESSION ]；<br>&ensp;&ensp;&ensp;&ensp;[[ EXPRESSION ]]；特定情况下使用。最稳妥（支持正则表达式）<br>注意：<br>&ensp;&ensp;&ensp;&ensp;EXPRESSION前后必须有空白字符，否则语法错误。<br>★ 条件性的执行逻辑操作符<br>☉根据退出状态而定，命令可以有条件地运行<br>&ensp;&ensp;&ensp;&ensp;&amp;&amp; ：代表条件性的AND THEN；<br>&ensp;&ensp;&ensp;&ensp;|| ：代表条件性的OR ELSE</p>
<h4 id="演示：-1"><a href="#演示：-1" class="headerlink" title="演示："></a>演示：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">[root@centos7 ~]<span class="comment"># ping -c1 -w1 192.168.2.1 &amp;&gt;/dev/null &amp;&amp; echo "The host is up"</span></div><div class="line">The host is up</div><div class="line"></div><div class="line"><span class="comment"># 表示 如果能 ping 通这个主机就输出 up，不能就输出 down；一定是先与后或</span></div><div class="line">[root@centos7 ~]<span class="comment"># ping -c1 -w1 192.168.2.1 &amp;&gt;/dev/null &amp;&amp; echo "The host is up"||echo "The host is down"</span></div><div class="line">The host is up</div><div class="line"></div><div class="line">[root@centos7 ~]<span class="comment"># ping -c1 -w1 192.168.2.11 &amp;&gt;/dev/null &amp;&amp; echo "The host is up"||echo "The host is down"</span></div><div class="line">The host is down</div><div class="line"></div><div class="line"><span class="comment"># 表示 如果能 ping 通这个主机 就输出 up，不能就输出 down，且返回值为 220。这里的括号表示在子shell中执行</span></div><div class="line">[root@centos7 ~]<span class="comment"># ping -c1 -w1 192.168.2.11 &amp;&gt;/dev/null &amp;&amp; echo "The host is up"||(echo "The host is down";exit 220)</span></div><div class="line">The host is down</div><div class="line">[root@centos7 ~]<span class="comment"># echo $?</span></div><div class="line">220</div></pre></td></tr></table></figure>
<h3 id="bash的测试类型（数值，字符串，文件测试）"><a href="#bash的测试类型（数值，字符串，文件测试）" class="headerlink" title="bash的测试类型（数值，字符串，文件测试）"></a>bash的测试类型（数值，字符串，文件测试）</h3><h4 id="数值测试"><a href="#数值测试" class="headerlink" title="数值测试"></a>数值测试</h4><p>★ 数值测试<br>☉作用：数值比较<br>☉操作符<br>&ensp;&ensp;&ensp;&ensp;-eq：是否等于；[ $num1 -eq $num2 ]；<br>&ensp;&ensp;&ensp;&ensp;-ne：是否不等于；<br>&ensp;&ensp;&ensp;&ensp;-gt：是否大于；<br>&ensp;&ensp;&ensp;&ensp;-ge：是否大于等于；<br>&ensp;&ensp;&ensp;&ensp;-lt：是否小于；<br>&ensp;&ensp;&ensp;&ensp;-le：是否小于等于；</p>
<h4 id="演示：-2"><a href="#演示：-2" class="headerlink" title="演示："></a>演示：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">[root@centos7 ~]<span class="comment"># test 2 -eq 3</span></div><div class="line">[root@centos7 ~]<span class="comment"># echo $?</span></div><div class="line">1</div><div class="line">[root@centos7 ~]<span class="comment"># test 2 -ne 3</span></div><div class="line">[root@centos7 ~]<span class="comment"># echo $?</span></div><div class="line">0</div><div class="line">[root@centos7 ~]<span class="comment"># test 2 -gt 3</span></div><div class="line">[root@centos7 ~]<span class="comment"># echo $?</span></div><div class="line">1</div><div class="line">[root@centos7 ~]<span class="comment"># test 2 -lt 3</span></div><div class="line">[root@centos7 ~]<span class="comment"># echo $?</span></div><div class="line">0</div></pre></td></tr></table></figure>
<h4 id="字符串测试"><a href="#字符串测试" class="headerlink" title="字符串测试"></a>字符串测试</h4><p>★ 字符串测试<br>&ensp;&ensp;&ensp;&ensp;字符串比较要加引号；<br>&ensp;&ensp;&ensp;&ensp;尽量要使用[[ ]]<br>☉操作符<br>&ensp;&ensp;&ensp;&ensp;==：是否等于；<br>&ensp;&ensp;&ensp;&ensp;&gt;：ascii码是否大于ascii码；<br>&ensp;&ensp;&ensp;&ensp;&lt;：ascii码是否小于ascii码<br>&ensp;&ensp;&ensp;&ensp;!=：是否不等于；<br>&ensp;&ensp;&ensp;&ensp;=~：左侧字符串是否能够被右侧的PATTERN所匹配（扩展表达式）<br>&ensp;&ensp;&ensp;&ensp;-z “STRING”：判断指定的字符串是否为空，空为真，不空为假，字符串一定要加双引号；<br>&ensp;&ensp;&ensp;&ensp;-n “STRING”：判断指定的字符串是否不空，不空为真，空为假；<br>注意：<br>&ensp;&ensp;&ensp;&ensp;字符串比较要加引号，表示引用，做变量替换要加双引号，不做变量替换用单引号；<br>&ensp;&ensp;&ensp;&ensp;要尽量使用 [[ ]]<br>&ensp;&ensp;&ensp;&ensp;在 [ ] 中做变量替换一定要加双引号，但是如果使用 [[ ]] ，可以不加引号</p>
<h4 id="演示：-3"><a href="#演示：-3" class="headerlink" title="演示："></a>演示：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div></pre></td><td class="code"><pre><div class="line">[root@centos7 ~]<span class="comment"># [ tom == Tom ]</span></div><div class="line">[root@centos7 ~]<span class="comment"># echo $?</span></div><div class="line">1</div><div class="line">[root@centos7 ~]<span class="comment"># [ tom == tom ]</span></div><div class="line">[root@centos7 ~]<span class="comment"># echo $?</span></div><div class="line">0</div><div class="line"></div><div class="line"><span class="comment"># 变量替换要尽量用双引号，如果不用的话，如果变量不存在为空，会报错</span></div><div class="line">[root@centos7 ~]<span class="comment"># [ tom == $name ]</span></div><div class="line">-bash: [: tom: unary operator expected</div><div class="line">[root@centos7 ~]<span class="comment"># [ tom == "$name" ]</span></div><div class="line">[root@centos7 ~]<span class="comment"># echo $?</span></div><div class="line">1</div><div class="line">[root@centos7 ~]<span class="comment"># [[ tom == "$name" ]]</span></div><div class="line">[root@centos7 ~]<span class="comment"># echo $?</span></div><div class="line">1</div><div class="line"></div><div class="line">[root@centos7 ~]<span class="comment"># name=jack</span></div><div class="line">[root@centos7 ~]<span class="comment"># [ tom = $name ]</span></div><div class="line">[root@centos7 ~]<span class="comment"># echo $?</span></div><div class="line">1</div><div class="line">[root@centos7 ~]<span class="comment"># [ tom = "$name" ]</span></div><div class="line">[root@centos7 ~]<span class="comment"># echo $?</span></div><div class="line">1</div><div class="line">[root@centos7 ~]<span class="comment"># [ jack = "$name" ]</span></div><div class="line">[root@centos7 ~]<span class="comment"># echo $?</span></div><div class="line">0</div><div class="line"></div><div class="line"><span class="comment"># 要尽量使用 [[ ]]</span></div><div class="line">[root@centos7 ~]<span class="comment"># [ 'a' &gt; 'b' ]</span></div><div class="line">[root@centos7 ~]<span class="comment"># echo $?</span></div><div class="line">0</div><div class="line">[root@centos7 ~]<span class="comment"># [ 'a' &lt; 'b' ]</span></div><div class="line">[root@centos7 ~]<span class="comment"># echo $?</span></div><div class="line">0</div><div class="line">[root@centos7 ~]<span class="comment"># [[ 'a' &gt; 'b' ]]</span></div><div class="line">[root@centos7 ~]<span class="comment"># echo $?</span></div><div class="line">1</div><div class="line">[root@centos7 ~]<span class="comment"># [[ 'a' &lt; 'b' ]]</span></div><div class="line">[root@centos7 ~]<span class="comment"># echo $?</span></div><div class="line">0</div><div class="line"></div><div class="line"><span class="comment"># 在 [] 中变量替换一定要加双引号，但是在 [[ ]] 中可以不加</span></div><div class="line">[root@centos7 bin]<span class="comment"># [ -z $a ] &amp;&amp; echo yes || echo no</span></div><div class="line">yes</div><div class="line">[root@centos7 bin]<span class="comment"># [ -n $a ] &amp;&amp; echo yes || echo no</span></div><div class="line">yes</div><div class="line">[root@centos7 bin]<span class="comment"># [ -n "$a" ] &amp;&amp; echo yes || echo no</span></div><div class="line">no</div><div class="line">[root@centos7 bin]<span class="comment"># [ -z "$a" ] &amp;&amp; echo yes || echo no</span></div><div class="line">yes</div><div class="line">[root@centos7 bin]<span class="comment"># [[ -n $a ]] &amp;&amp; echo yes || echo no</span></div><div class="line">no</div><div class="line">[root@centos7 bin]<span class="comment"># [[ -z $a ]] &amp;&amp; echo yes || echo no</span></div><div class="line">yes</div><div class="line"></div><div class="line">[root@centos7 ~]<span class="comment"># name=jack</span></div><div class="line">[root@centos7 ~]<span class="comment"># echo $name</span></div><div class="line">jack</div><div class="line">[root@centos7 ~]<span class="comment"># [[ "$name" =~ ja ]]</span></div><div class="line">[root@centos7 ~]<span class="comment"># echo $?</span></div><div class="line">0</div><div class="line">[root@centos7 ~]<span class="comment"># [[ "$name" =~ j ]]</span></div><div class="line">[root@centos7 ~]<span class="comment"># echo $?</span></div><div class="line">0</div><div class="line">[root@centos7 ~]<span class="comment"># [[ "$name" =~ jz ]]</span></div><div class="line">[root@centos7 ~]<span class="comment"># echo $?</span></div><div class="line">1</div><div class="line">[root@centos7 ~]<span class="comment"># [[ "$name" =~ mm ]]</span></div><div class="line">[root@centos7 ~]<span class="comment"># echo $?</span></div><div class="line">1</div></pre></td></tr></table></figure>
<h4 id="文件测试"><a href="#文件测试" class="headerlink" title="文件测试"></a>文件测试</h4><p>★ 存在性测试<br>&ensp;&ensp;&ensp;&ensp;-a FILE：同-e<br>&ensp;&ensp;&ensp;&ensp;-e FILE：文件存在性测试，存在为真，否则为假；<br>★ 存在性及类型测试<br>&ensp;&ensp;&ensp;&ensp;-b FILE：是否存在且为块设备文件；<br>&ensp;&ensp;&ensp;&ensp;-c FILE：是否存在且为字符设备文件；<br>&ensp;&ensp;&ensp;&ensp;-d FILE：是否存在且为目录文件；<br>&ensp;&ensp;&ensp;&ensp;-f FILE：是否存在且为普通文件；<br>&ensp;&ensp;&ensp;&ensp;-h FILE 或-L FILE：存在且为符号链接文件；<br>&ensp;&ensp;&ensp;&ensp;-p FILE：是否存在且为命名管道文件；<br>&ensp;&ensp;&ensp;&ensp;-S FILE：是否存在且为套接字文件；<br>★ 文件权限测试<br>&ensp;&ensp;&ensp;&ensp;-r FILE：是否存在且对当前用户可读；<br>&ensp;&ensp;&ensp;&ensp;-w FILE：是否存在且对当前用户可写；<br>&ensp;&ensp;&ensp;&ensp;-x FILE：是否存在且对当前用户可执行<br>★ 文件特殊权限测试<br>&ensp;&ensp;&ensp;&ensp;-g FILE：是否存在且拥有sgid权限；<br>&ensp;&ensp;&ensp;&ensp;-u FILE：是否存在且拥有suid权限；<br>&ensp;&ensp;&ensp;&ensp;-k FILE：是否存在且拥有sticky权限；<br>★ 文件是否有内容<br>&ensp;&ensp;&ensp;&ensp;-s FILE：是否存在且非空（即，文件是否有内容）；<br>★ 文件时间戳测试<br>&ensp;&ensp;&ensp;&ensp;-N FILE：文件自从上一次读操作后是否被修改过；<br>★ 从属关系测试<br>&ensp;&ensp;&ensp;&ensp;-O FILE：当前用户是否为文件的属主；<br>&ensp;&ensp;&ensp;&ensp;-G FILE：当前用户是否属于文件的属组；<br>★ 文件是否打开<br>&ensp;&ensp;&ensp;&ensp;-t fd：fd表示文件描述符是否已经打开且与某终端相关；<br>★ 双目测试<br>&ensp;&ensp;&ensp;&ensp;FILE1 -ef FILE2：FILE1与FILE2是否指向同一个设备上的相同inode；<br>&ensp;&ensp;&ensp;&ensp;FILE1 -nt FILE2：FILE1是否新于FILE2；（修改时间）<br>&ensp;&ensp;&ensp;&ensp;FILE1 -ot FILE2：FILE1是否旧于FILE2；<br>注意：<br>&ensp;&ensp;&ensp;&ensp;文件测试一般使用 [ ] 就可以</p>
<h4 id="演示：-4"><a href="#演示：-4" class="headerlink" title="演示："></a>演示：</h4><p>1.文件存在性测试<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[root@centos7 ~]<span class="comment"># [ -e /etc/fstab ]</span></div><div class="line">[root@centos7 ~]<span class="comment"># echo $?</span></div><div class="line">0</div><div class="line">[root@centos7 ~]<span class="comment"># [ -e /etc/rc.d/rc.sysinit ]</span></div><div class="line">[root@centos7 ~]<span class="comment"># echo $?</span></div><div class="line">1</div></pre></td></tr></table></figure></p>
<p>2.文件存在性及类型测试<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">[root@centos7 ~]<span class="comment"># [ -b /dev/sda ]</span></div><div class="line">You have new mail <span class="keyword">in</span> /var/spool/mail/root</div><div class="line">[root@centos7 ~]<span class="comment"># echo $?</span></div><div class="line">0</div><div class="line">[root@centos7 ~]<span class="comment"># [ -d /dev ]</span></div><div class="line">[root@centos7 ~]<span class="comment"># echo $?</span></div><div class="line">0</div><div class="line">[root@centos7 ~]<span class="comment"># [ -L /etc/redhat-release ]</span></div><div class="line">[root@centos7 ~]<span class="comment"># echo $?</span></div><div class="line">0</div><div class="line">[root@centos7 ~]<span class="comment"># ll /etc/redhat-release </span></div><div class="line">lrwxrwxrwx. 1 root root 14 Apr 26 10:31 /etc/redhat-release -&gt; centos-release</div></pre></td></tr></table></figure></p>
<p>3.文件权限及特殊权限测试<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">[root@centos7 ~]<span class="comment"># ll /etc/shadow</span></div><div class="line">---------- 1 root root 1400 2月  20 14:12 /etc/shadow</div><div class="line"> </div><div class="line">[centos@centos7 ~]$ whoami</div><div class="line">centos</div><div class="line">[centos@centos7 ~]$ [ -r /etc/shadow ]</div><div class="line">[centos@centos7 ~]$ <span class="built_in">echo</span> $?</div><div class="line">1</div><div class="line">[centos@centos7 ~]$ [ -r /etc/passwd ]</div><div class="line">[centos@centos7 ~]$ <span class="built_in">echo</span> $?</div><div class="line">0</div><div class="line">[centos@centos7 ~]$ [ -w /etc/passwd ]</div><div class="line">[centos@centos7 ~]$ <span class="built_in">echo</span> $?</div><div class="line">1</div><div class="line"> </div><div class="line"><span class="comment"># 对于root用户来讲，rw 权限是以实际为主，但执行权限是起作用的</span></div><div class="line">[root@centos7 ~]<span class="comment"># whoami</span></div><div class="line">root</div><div class="line">[root@centos7 ~]<span class="comment"># [ -r /etc/shadow ]</span></div><div class="line">[root@centos7 ~]<span class="comment"># echo $?</span></div><div class="line">0</div><div class="line">[root@centos7 ~]<span class="comment"># [ -w /etc/shadow ]</span></div><div class="line">[root@centos7 ~]<span class="comment"># echo $?</span></div><div class="line">0</div><div class="line">[root@centos7 ~]<span class="comment"># [ -x /etc/shadow ]</span></div><div class="line">[root@centos7 ~]<span class="comment"># echo $?</span></div><div class="line">1</div><div class="line"></div><div class="line">[root@centos7 ~]<span class="comment"># [ -u /usr/bin/passwd ]</span></div><div class="line">[root@centos7 ~]<span class="comment"># echo $?</span></div><div class="line">0                         <span class="comment"># 说明 /usr/bin/passwd  拥有suid权限</span></div><div class="line">[root@centos7 ~]<span class="comment"># ll /usr/bin/passwd </span></div><div class="line">-rwsr-xr-x. 1 root root 27832 Jun 10  2014 /usr/bin/passwd</div></pre></td></tr></table></figure></p>
<p>4.文件是否有内容测试<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[root@centos7 ~]<span class="comment"># touch /tmp/hello</span></div><div class="line">[root@centos7 ~]<span class="comment"># [ -s /tmp/hello ]</span></div><div class="line">[root@centos7 ~]<span class="comment"># echo $?</span></div><div class="line">1</div><div class="line">[root@centos7 ~]<span class="comment"># [ -s /etc/fstab ]</span></div><div class="line">[root@centos7 ~]<span class="comment"># echo $?</span></div><div class="line">0</div></pre></td></tr></table></figure></p>
<p>5.双目测试<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">[root@centos7 ~]<span class="comment"># touch f1</span></div><div class="line">[root@centos7 ~]<span class="comment"># ln f1 f2            # 创建f22 的硬链接为f1</span></div><div class="line">[root@centos7 ~]<span class="comment"># [ f1 -ef f2 ]</span></div><div class="line">You have new mail <span class="keyword">in</span> /var/spool/mail/root</div><div class="line">[root@centos7 ~]<span class="comment"># echo $?</span></div><div class="line">0</div><div class="line">[root@centos7 ~]<span class="comment"># ll -i f1 f2          # 是否指向同一设备上相同的inode，也就是说是否为硬链接</span></div><div class="line">68208303 -rw-r--r-- 2 root root 0 Aug  3 23:33 f1</div><div class="line">68208303 -rw-r--r-- 2 root root 0 Aug  3 23:33 f2</div></pre></td></tr></table></figure></p>
<h4 id="组合测试条件"><a href="#组合测试条件" class="headerlink" title="组合测试条件"></a>组合测试条件</h4><p>★ 第一种方式：逻辑判断符<br>&ensp;&ensp;&ensp;&ensp;OMMAND1 &amp;&amp; COMMAND2 ：并且；<br>&ensp;&ensp;&ensp;&ensp;COMMAND1 || COMMAND2   ：或者；<br>&ensp;&ensp;&ensp;&ensp;！COMMAND ：非<br>示例：<br>&ensp;&ensp;&ensp;&ensp;[ -O FILE ] &amp;&amp; [ -r FILE ]<br>★ 第二种方式：布尔运算符<br>&ensp;&ensp;&ensp;&ensp;EXPRESSION1 -a EXPRESSION2 ：并且<br>&ensp;&ensp;&ensp;&ensp;EXPRESSION1 -o EXPRESSION2 ：或者<br>&ensp;&ensp;&ensp;&ensp;! EXPRESSION：取反<br>注意：<br>&ensp;&ensp;&ensp;&ensp;布尔运算符（-a ,-o, !）只能用在 [ ] 表达式中；如：[ 1 -eq 1 -a 2 -eq 2 ]为true；[ 1 -eq 1 -o 2 -eq 1 ]为true<br>&ensp;&ensp;&ensp;&ensp;逻辑运算符（&amp;&amp;, ||）只能用在 [[ ]]和(( ))中使用</p>
<h3 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h3><p>1.条件表达式</p>
<table>
<thead>
<tr>
<th style="text-align:left">表达式</th>
<th style="text-align:left">示例</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">[ expression ]</td>
<td style="text-align:left">[ 1 eq 1 ]</td>
</tr>
<tr>
<td style="text-align:left">[[ expression ]]</td>
<td style="text-align:left">[[ 1 eq 1 ]]</td>
</tr>
<tr>
<td style="text-align:left">test expression</td>
<td style="text-align:left">test 1 eq 1,等同于[]</td>
</tr>
</tbody>
</table>
<p>2.整数比较符</p>
<table>
<thead>
<tr>
<th style="text-align:left">比较符</th>
<th style="text-align:left">描述</th>
<th style="text-align:left">示例</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">-eq，equal</td>
<td style="text-align:left">等于</td>
<td style="text-align:left">[ 1 -eq 1 ]为true</td>
</tr>
<tr>
<td style="text-align:left">-ne，not equal</td>
<td style="text-align:left">不等于</td>
<td style="text-align:left">[ 1 -ne 1 ]为false</td>
</tr>
<tr>
<td style="text-align:left">-gt，greater than</td>
<td style="text-align:left">大于</td>
<td style="text-align:left">[ 2 -gt 1 ]为true</td>
</tr>
<tr>
<td style="text-align:left">-lt，lesser than</td>
<td style="text-align:left">小于</td>
<td style="text-align:left">[ 2 -lt 1 ]为false</td>
</tr>
<tr>
<td style="text-align:left">-ge，greater or equal</td>
<td style="text-align:left">大于或等于</td>
<td style="text-align:left">[ 1 -ge 2 ]为false</td>
</tr>
<tr>
<td style="text-align:left">-le，lesser or equal</td>
<td style="text-align:left">小于或等于</td>
<td style="text-align:left">[ 2 -le 1 ]为false</td>
</tr>
</tbody>
</table>
<p>3.字符串比较符</p>
<table>
<thead>
<tr>
<th style="text-align:left">运算符</th>
<th style="text-align:left">描述</th>
<th style="text-align:left">示例</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">==</td>
<td style="text-align:left">等于</td>
<td style="text-align:left">[ “a” == “a”  ]为true</td>
</tr>
<tr>
<td style="text-align:left">!=</td>
<td style="text-align:left">不等于</td>
<td style="text-align:left">[ “a” != “a”  ]为false</td>
</tr>
<tr>
<td style="text-align:left">&gt;</td>
<td style="text-align:left">大于，判断字符串时根据ASCII码表顺序，不常用</td>
<td style="text-align:left">在[]表达式中：[ 2 > 1 ]为true<br>在[[]]表达式中：[[ 2 &gt; 1 ]]为true<br>在(())表达式中：(( 3 &gt; 2 ))为true</td>
</tr>
<tr>
<td style="text-align:left">&lt;</td>
<td style="text-align:left">小于，判断字符串时根据ASCII码表顺序，不常用</td>
<td style="text-align:left">在[]表达式中：[ 2 \&lt; 1 ]为false<br>在[[]]表达式中：[[ 2 &lt; 1 ]]为false<br>在(())表达式中：(( 3 &lt; 2 ))为false</td>
</tr>
<tr>
<td style="text-align:left">&gt;=</td>
<td style="text-align:left">大于等于</td>
<td style="text-align:left">在(())表达式中：(( 3 &gt;= 2 ))为true</td>
</tr>
<tr>
<td style="text-align:left">&lt;=</td>
<td style="text-align:left">小于等于</td>
<td style="text-align:left">在(())表达式中：(( 3 &lt;= 2 ))为false</td>
</tr>
<tr>
<td style="text-align:left">-n</td>
<td style="text-align:left">字符串长度不等于0为真</td>
<td style="text-align:left">VAR1=1;VAR2=””<br>[ -n “$VAR1” ]为true<br>[ -n “$VAR2” ]为false</td>
</tr>
<tr>
<td style="text-align:left">-z</td>
<td style="text-align:left">字符串长度等于0为真</td>
<td style="text-align:left">VAR1=1;VAR2=””<br>[ -z “$VAR1” ]为false<br>[ -z “$VAR2” ]为true</td>
</tr>
<tr>
<td style="text-align:left">str</td>
<td style="text-align:left">字符串存在为真</td>
<td style="text-align:left">VAR1=1;VAR2=””<br>[ $VAR1 ]为true<br>[ $VAR2 ]为false</td>
</tr>
</tbody>
</table>
<p>4.文件测试</p>
<table>
<thead>
<tr>
<th style="text-align:left">测试符</th>
<th style="text-align:left">描述</th>
<th style="text-align:left">示例</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">-e</td>
<td style="text-align:left">文件或目录存在为真</td>
<td style="text-align:left">[ -e path ] path存在为true</td>
</tr>
<tr>
<td style="text-align:left">-f</td>
<td style="text-align:left">文件存在为真</td>
<td style="text-align:left">[ -f file_path ] 文件存在为true</td>
</tr>
<tr>
<td style="text-align:left">-d</td>
<td style="text-align:left">目录存在为真</td>
<td style="text-align:left">[ -d dir_path ] 目录存在为true</td>
</tr>
<tr>
<td style="text-align:left">-r</td>
<td style="text-align:left">有读权限为真</td>
<td style="text-align:left">[ -r file_path ] file_path有读权限为true</td>
</tr>
<tr>
<td style="text-align:left">-w</td>
<td style="text-align:left">有写权限为真</td>
<td style="text-align:left">[ -w file_path ] file_path有写权限为true</td>
</tr>
<tr>
<td style="text-align:left">-x</td>
<td style="text-align:left">有执行权限为真</td>
<td style="text-align:left">[ -x file_path ] file_path有执行权限为true</td>
</tr>
<tr>
<td style="text-align:left">-s</td>
<td style="text-align:left">文件存在并且大小大于0为真</td>
<td style="text-align:left">[ -s file_path ] file_path存在并且大小大于0为true</td>
</tr>
</tbody>
</table>
<p>5.布尔运算符</p>
<table>
<thead>
<tr>
<th style="text-align:left">运算符</th>
<th style="text-align:left">描述</th>
<th style="text-align:left">示例</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">!</td>
<td style="text-align:left">非关系，条件结果取反</td>
<td style="text-align:left">[ ! 1 -eq 2 ]为true</td>
</tr>
<tr>
<td style="text-align:left">-a</td>
<td style="text-align:left">和关系，在[]表达式中使用</td>
<td style="text-align:left">[ 1 -eq 1 -a 2 -eq 2 ]为true</td>
</tr>
<tr>
<td style="text-align:left">-o</td>
<td style="text-align:left">或关系，在[]表达式中使用</td>
<td style="text-align:left">[ 1 -eq 1 -o 2 -eq 1 ]为true</td>
</tr>
</tbody>
</table>
<p>6.逻辑判断符</p>
<table>
<thead>
<tr>
<th style="text-align:left">判断符</th>
<th style="text-align:left">描述</th>
<th style="text-align:left">示例</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">&amp;&amp;</td>
<td style="text-align:left">逻辑与，在[[ ]]和(( ))表达式中或判断表达式是否为真时使用</td>
<td style="text-align:left">[[ 1 -eq 1 &amp;&amp; 2 -eq 2 ]]为true<br>(( 1 == 1 &amp;&amp; 2 == 2 ))为true<br>[ 1 -eq 1 ] &amp;&amp; echo yes 表示：如果&amp;&amp;前面表达式为true则执行后面的</td>
</tr>
<tr>
<td style="text-align:left">ll</td>
<td style="text-align:left">逻辑或，在[[ ]]和(( ))表达式中或判断表达式是否为真时使用</td>
<td style="text-align:left">[[ 1 -eq 1 ll 2 -eq 1 ]]为true<br>(( 1 == 1 ll 2 == 2 ))为true<br>[ 1 -eq 2 ] ll echo yes 表示：如果ll前面表达式为false则执行后面的</td>
</tr>
</tbody>
</table>
<p>7.整数运算</p>
<table>
<thead>
<tr>
<th style="text-align:left">运算符</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">+</td>
<td style="text-align:left">加法</td>
</tr>
<tr>
<td style="text-align:left">-</td>
<td style="text-align:left">减法</td>
</tr>
<tr>
<td style="text-align:left">*</td>
<td style="text-align:left">乘法</td>
</tr>
<tr>
<td style="text-align:left">/</td>
<td style="text-align:left">除法</td>
</tr>
<tr>
<td style="text-align:left">%</td>
<td style="text-align:left">取余</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:left">运算表达式</th>
<th style="text-align:left">示例</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">$(())</td>
<td style="text-align:left">$((1+1))</td>
</tr>
<tr>
<td style="text-align:left">$[]</td>
<td style="text-align:left">$[1+1]</td>
</tr>
</tbody>
</table>
<p>8.复杂的算数运算</p>
<table>
<thead>
<tr>
<th style="text-align:left">命令</th>
<th style="text-align:left">描述</th>
<th style="text-align:left">示例</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">let</td>
<td style="text-align:left">赋值并运算，支持++、–</td>
<td style="text-align:left">let VAR=(1+2)*3 ; echo $VAR<br>x=10 ; y=5<br>let x++;echo $x 每执行一次x加1<br>let y–;echo $y 每执行一次y减1<br>let x+=2 每执行一次x加2<br>let x-=2 每执行一次x减2</td>
</tr>
<tr>
<td style="text-align:left">expr</td>
<td style="text-align:left">乘法<em>需要加反斜杠转义\</em></td>
<td style="text-align:left">expr 1 * 2  运算符两边必须有空格<br>expr ( 1 + 2 ) * 2  使用双括号时要转义</td>
</tr>
<tr>
<td style="text-align:left">bc</td>
<td style="text-align:left">计算器，支持浮点运算、平方等</td>
<td style="text-align:left">bc本身就是一个计算器，可直接输入命令，进入解释器<br>echo 1 + 2 lbc 将管道符前面标准输出作为bc的标准输入<br>echo “1.2+2” lbc<br>echo “10^10” lbc<br>echo ‘scale=2;10/3’ lbc  用scale保留两位小数点</td>
</tr>
</tbody>
</table>
<p>9.小括号、中括号的用途</p>
<table>
<thead>
<tr>
<th style="text-align:left">括号类型</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">( )</td>
<td style="text-align:left">用途1：在运算中，先计算小括号里面的内容<br>用途2：数组<br>用途3：匹配分组</td>
</tr>
<tr>
<td style="text-align:left">(( ))</td>
<td style="text-align:left">用途1：表达式，不支持-eq这类的运算符。不支持-a和-o，支持&lt;=、&gt;=、&lt;、&gt;这类比较符和&amp;&amp;、ll<br>用途2：C语言风格的for(())表达式</td>
</tr>
<tr>
<td style="text-align:left">$( )</td>
<td style="text-align:left">执行Shell命令，与反撇号等效</td>
</tr>
<tr>
<td style="text-align:left">$(( ))</td>
<td style="text-align:left">用途1：简单算数运算<br>用途2：支持三目运算符 $(( 表达式?数字:数字 ))</td>
</tr>
<tr>
<td style="text-align:left">[ ]</td>
<td style="text-align:left">条件表达式，里面不支持逻辑判断符(&amp;&amp;，ll )</td>
</tr>
<tr>
<td style="text-align:left">[[ ]]</td>
<td style="text-align:left">条件表达式，里面不支持-a和-o，不支持&lt;=和&gt;=比较符，支持-eq、&lt;、&gt;这类比较符。支持=~模式匹配，也可以不用双引号也不会影响原意，比[]更加通用</td>
</tr>
<tr>
<td style="text-align:left">$[ ]</td>
<td style="text-align:left">简单算数运算</td>
</tr>
<tr>
<td style="text-align:left">{ }</td>
<td style="text-align:left">对逗号（,）和点点（…）起作用，比如touch {1,2}创建1和2文件，touch {1..3}创建1、2和3文件</td>
</tr>
<tr>
<td style="text-align:left">${ }</td>
<td style="text-align:left">用途1：引用变量<br>用途2：字符串处理</td>
</tr>
</tbody>
</table>
<h4 id="练习："><a href="#练习：" class="headerlink" title="练习："></a>练习：</h4><p> 1、编写脚本/root/bin/systeminfo.sh,显示当前主机系统信息，包括主机名，IPv4地址，操作系统版本，内核版本，CPU型号，内存大小，硬盘大小。<br> <figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">[root@centos7 lab]<span class="comment"># vim systeminfo.sh</span></div><div class="line"></div><div class="line"> 1 <span class="comment">#!/bin/bash</span></div><div class="line"> 2 <span class="comment">#</span></div><div class="line"> 3 </div><div class="line"> 4 hostName=$(hostname)</div><div class="line"> 5 ipAddress=$(ifconfig|sed -n <span class="string">'2p'</span>|sed -r <span class="string">'s#^.*inet ([0-9].*) net.*#\1#'</span>)</div><div class="line"> 6 OSVersion=$(cat /etc/redhat-release)</div><div class="line"> 7 OSKernel=$(uname -r)</div><div class="line"> 8 cpuModel=$(lscpu|grep -i <span class="string">"Model name"</span>)</div><div class="line"> 9 memInfo=$(free -m|grep -i <span class="string">"mem"</span>|tr <span class="_">-s</span> <span class="string">' '</span>|cut <span class="_">-d</span><span class="string">' '</span> <span class="_">-f</span>2)</div><div class="line">10 diskSize=$(fdisk <span class="_">-l</span>|grep <span class="string">"Disk /dev/[sh]d[a-z]"</span>|sed -r <span class="string">'s#^.*([sh]d[a-z].*[0-9].* GB).*#Disk \1#'</span>)</div><div class="line">11 </div><div class="line">12 <span class="built_in">echo</span> <span class="string">"hostname: <span class="variable">$hostName</span>"</span></div><div class="line">13 <span class="built_in">echo</span> <span class="string">"host ip: <span class="variable">$ipAddress</span>"</span></div><div class="line">14 <span class="built_in">echo</span> <span class="string">"system verion: <span class="variable">$OSVersion</span>"</span></div><div class="line">15 <span class="built_in">echo</span> <span class="string">"system kernel:<span class="variable">$OSKernel</span>"</span></div><div class="line">16 <span class="built_in">echo</span> <span class="string">"cpu <span class="variable">$cpuModel</span>"</span></div><div class="line">17 <span class="built_in">echo</span> <span class="string">"memory size: <span class="variable">$&#123;memInfo&#125;</span>M"</span></div><div class="line">18 <span class="built_in">echo</span> <span class="string">"<span class="variable">$diskSize</span>"</span></div></pre></td></tr></table></figure></p>
<p> 输出结果：<br> <figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">[root@centos7 lab]<span class="comment"># bash systeminfo.sh </span></div><div class="line">hostname: centos7</div><div class="line">host ip: 192.168.2.140 </div><div class="line">system verion: CentOS Linux release 7.2.1511 (Core) </div><div class="line">system kernel:3.10.0-327.el7.x86_64</div><div class="line">cpu Model name:            Intel(R) Core(TM) i5-6200U CPU @ 2.30GHz</div><div class="line">memory size: 977M</div><div class="line">Disk sda: 128.8 GB</div><div class="line">Disk sdb: 10.7 GB</div></pre></td></tr></table></figure></p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color5">shell脚本编程</a>
        		</li>
      		
		</ul>
	</div>

      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/2017/06/25/linux之shell脚本编程-基础篇(二)/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>





  
    <article id="post-CentOS安装" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/06/25/CentOS安装/">CentOS 系统自动化安装</a>
    </h1>
  

        
        <a href="/2017/06/25/CentOS安装/" class="archive-article-date">
  	<time datetime="2017-06-25T02:52:22.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2017-06-25</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="概述："><a href="#概述：" class="headerlink" title="概述："></a>概述：</h3><p>&ensp;&ensp;&ensp;&ensp;★系统安装过程<br>&ensp;&ensp;&ensp;&ensp;★配置anaconda<br>&ensp;&ensp;&ensp;&ensp;★自动化安装系统</p>
<h4 id="CentOS-系统安装"><a href="#CentOS-系统安装" class="headerlink" title="CentOS 系统安装"></a>CentOS 系统安装</h4><h4 id="1-启动流程"><a href="#1-启动流程" class="headerlink" title="1.启动流程"></a>1.启动流程</h4><p>★启动流程<br>&ensp;&ensp;&ensp;&ensp;◆bootloader–&gt;kernel(initrd)–&gt;rootfs–&gt;anaconda(启动安装程序）</p>
<h4 id="2-anaconda：（系统安装程序）"><a href="#2-anaconda：（系统安装程序）" class="headerlink" title="2.anaconda：（系统安装程序）"></a>2.anaconda：（系统安装程序）</h4><p>★安装界面：<br>&ensp;&ensp;&ensp;&ensp;◆tui：基于cureses的文本配置窗口；<br>&ensp;&ensp;&ensp;&ensp;◆gui：图形界面<br>★anaconda介绍<br>&ensp;&ensp;&ensp;&ensp;◆Anaconda是RedHat、CentOS、Fedora等Linux的安装管理程序。它可以提供文本、图形等安装管理方式，并支持 Kickstart 等脚本提供自动安装的功能。此外，其还支持许多启动参数，熟悉这些参数可为安装带来很多方便。该程序的功能是把位于光盘或其他源上的数据包，根据设置安装到主机上。为实现该定制安装，它提供一个定制界面，可以实现交互式界面供用户选择配置（如选择语言，键盘，时区等信息）。<br>&ensp;&ensp;&ensp;&ensp;◆Anaconda的大部分模块用Python编写，有少许的载入模块用C编写。</p>
<h4 id="3-CentOS的安装过程启动流程："><a href="#3-CentOS的安装过程启动流程：" class="headerlink" title="3.CentOS的安装过程启动流程："></a>3.CentOS的安装过程启动流程：</h4><p>★MBR：boot.cat                光盘上引导加载器<br>★Stage2：isolinux/isolinux.bin<br>&ensp;&ensp;&ensp;&ensp;◆配置文件：isolinux/isolinux.cfg<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;每个对应的菜单选项<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;加载内核：isolinux/vmlinuz<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;向内核传递参数：append initrd=initrd.img<br>&ensp;&ensp;&ensp;&ensp;其实整个光盘安装启动过程就是依赖于isolinux这个目录下的文件的<br>★装载根文件系统，并启动anaconda<br>&ensp;&ensp;&ensp;&ensp;◆默认界面是图形界面（GUI）：<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;512MB+内存空间<br>&ensp;&ensp;&ensp;&ensp;◆若需要显示指定启动TUI接口：向启动内核传递一个参数“text”即可；<br>&ensp;&ensp;&ensp;&ensp;◆1)按tab键：在后面增加text<br>&ensp;&ensp;&ensp;&ensp;◆2)按ESC键：boot（提示符下）: linux text<br>注意：<br>&ensp;&ensp;&ensp;&ensp;◆上述内容一般位于引导设备，例如可通过光盘、U盘、或网络等；后续的anaconda及其安装用到的程序包等可以来自于程序包仓库。<br>&ensp;&ensp;&ensp;&ensp;◆此仓库的位置可以为：<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;本地光盘、本地硬盘、ftp server、http server、nfs server<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;如果想手动指定安装仓库：按 ESC键：boot（提示符下）：linux method</p>
<h4 id="演示-查看光盘镜像引导文件"><a href="#演示-查看光盘镜像引导文件" class="headerlink" title="演示-查看光盘镜像引导文件"></a>演示-查看光盘镜像引导文件</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">[root@CentOS7 ~]<span class="comment"># mount /dev/cdrom /mnt/cdrom</span></div><div class="line">mount: /dev/sr0 is write-protected, mounting <span class="built_in">read</span>-only</div><div class="line">[root@CentOS7 ~]<span class="comment"># cd /mnt/cdrom</span></div><div class="line">[root@CentOS7 cdrom]<span class="comment"># ls</span></div><div class="line">CentOS_BuildTag  GPL       LiveOS    RPM-GPG-KEY-CentOS-7</div><div class="line">EFI              images    Packages  RPM-GPG-KEY-CentOS-Testing-7</div><div class="line">EULA             isolinux  repodata  TRANS.TBL</div><div class="line">[root@CentOS7 cdrom]<span class="comment"># cd isolinux/</span></div><div class="line">[root@CentOS7 isolinux]<span class="comment"># ls</span></div><div class="line">boot.cat  grub.conf   isolinux.bin  memtest     TRANS.TBL    vesamenu.c32</div><div class="line">boot.msg  initrd.img  isolinux.cfg  splash.png  upgrade.img  vmlinuz</div><div class="line">[root@CentOS7 isolinux]<span class="comment"># ls -l</span></div><div class="line">total 86002</div><div class="line">-r--r--r--. 1 root root     2048 Dec 10  2015 boot.cat</div><div class="line">-r--r--r--. 1 root root       84 Dec 10  2015 boot.msg</div><div class="line">-r--r--r--. 1 root root      281 Dec 10  2015 grub.conf</div><div class="line">-r--r--r--. 2 root root 38508192 Dec 10  2015 initrd.img</div><div class="line">-r--r--r--. 1 root root    24576 Dec 10  2015 isolinux.bin</div><div class="line">-r--r--r--. 1 root root     3032 Dec 10  2015 isolinux.cfg</div><div class="line">-r--r--r--. 1 root root   176500 Sep 11  2014 memtest</div><div class="line">-r--r--r--. 1 root root      186 Oct  1  2015 splash.png</div><div class="line">-r--r--r--. 1 root root     2438 Dec 10  2015 TRANS.TBL</div><div class="line">-r--r--r--. 2 root root 44035836 Dec 10  2015 upgrade.img</div><div class="line">-r--r--r--. 1 root root   153104 Mar  6  2015 vesamenu.c32</div><div class="line">-r-xr-xr-x. 2 root root  5156528 Nov 20  2015 vmlinuz</div><div class="line">[root@CentOS7 isolinux]<span class="comment"># less isolinux.cfg</span></div><div class="line">label linux</div><div class="line">  menu label ^Install CentOS 7</div><div class="line">  kernel vmlinuz                          加载的内核</div><div class="line">  append initrd=initrd.img inst.stage2=hd:LABEL=CentOS\x207\x20x86_64 quiet        向内核传递的参数</div></pre></td></tr></table></figure>
<h3 id="anaconda-工作过程（安装前配置阶段，安装阶段，首次启动）"><a href="#anaconda-工作过程（安装前配置阶段，安装阶段，首次启动）" class="headerlink" title="anaconda 工作过程（安装前配置阶段，安装阶段，首次启动）"></a>anaconda 工作过程（安装前配置阶段，安装阶段，首次启动）</h3><h4 id="1-安装前配置阶段："><a href="#1-安装前配置阶段：" class="headerlink" title="1.安装前配置阶段："></a>1.安装前配置阶段：</h4><p>◆安装过程使用的语言；<br>◆键盘类型；<br>◆安装目标存数设备；<br>&ensp;&ensp;&ensp;&ensp;Basic Storage：本地磁盘<br>&ensp;&ensp;&ensp;&ensp;Special Storage：ISCSI<br>◆设定主机名；<br>◆配置网络接口；<br>◆时区；<br>◆管理员密码；<br>◆设定分区方式及MBR的安装位置；<br>◆创建一个普通用户；<br>◆选定要安装的程序包；</p>
<h4 id="2-安装阶段："><a href="#2-安装阶段：" class="headerlink" title="2.安装阶段："></a>2.安装阶段：</h4><p>◆在目标磁盘创建分区并执行格式化；<br>◆将选定的程序包安装至目标位置；<br>◆安装bootloader</p>
<h4 id="3-重启系统"><a href="#3-重启系统" class="headerlink" title="3.重启系统"></a>3.重启系统</h4><p>◆iptables 防火墙<br>◆selinux<br>◆core dump 核心转储</p>
<h3 id="安装引导选项及-kickstart-文件"><a href="#安装引导选项及-kickstart-文件" class="headerlink" title="安装引导选项及 kickstart 文件"></a>安装引导选项及 kickstart 文件</h3><h4 id="1-anaconda-的配置方式："><a href="#1-anaconda-的配置方式：" class="headerlink" title="1.anaconda 的配置方式："></a>1.anaconda 的配置方式：</h4><p>★配置方式：<br>&ensp;&ensp;&ensp;&ensp;◆交互式配置方式；<br>&ensp;&ensp;&ensp;&ensp;◆支持通过读取配置文件中事先定义好的配置项自动完成配置；遵循特定的语法格 式，此文件即为kickstart文件；</p>
<h4 id="2-安装引导选项："><a href="#2-安装引导选项：" class="headerlink" title="2.安装引导选项："></a>2.安装引导选项：</h4><p>★boot：<br>&ensp;&ensp;&ensp;&ensp;◆text：文本安装方式；<br>&ensp;&ensp;&ensp;&ensp;◆method：手动指定使用安装方法；<br>&ensp;&ensp;&ensp;&ensp;◆与网络相关的引导选项：<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;ip=IPADDR<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;netmask=MASK<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;gateway=GW<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;dns=DNS_SERVER_IP<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;ifname=NAME:MAC_ADDR<br>&ensp;&ensp;&ensp;&ensp;◆远程访问功能相关的引导选项：<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;vnc<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;vncpassword=’PASSWORD’<br>&ensp;&ensp;&ensp;&ensp;◆指明kickstart文件的位置：ks=<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;DVD drive:   ks=cdrom:/PATH/TO/KICKSTART_FILE<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;Hard drive:  ks=hd:device:/directory/KICKSTART_FILE<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;HTTP server: ks=<a href="http://host:port/path/to/KICKSTART_FILE" target="_blank" rel="external">http://host:port/path/to/KICKSTART_FILE</a><br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;FTP server:  ks=ftp://host:port/path/to/KICKSTART_FILE<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;HTTPS server:ks=<a href="https://host:port/path/to/KICKSTART_FILE" target="_blank" rel="external">https://host:port/path/to/KICKSTART_FILE</a><br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;NFS server:  ks=nfs:host:/path/to/KICKSTART_FILE<br>&ensp;&ensp;&ensp;&ensp;◆启动救援模式：<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;rescue<br>&ensp;&ensp;&ensp;&ensp;◆装载额外驱动：<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;dd<br>&ensp;&ensp;&ensp;&ensp;◆官方文档<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;www.redhat.com/docs 《installation guide》</p>
<h4 id="3-kickstart文件的格式-："><a href="#3-kickstart文件的格式-：" class="headerlink" title="3.kickstart文件的格式 ："></a>3.kickstart文件的格式 ：</h4><p>★命令段：指定各种安装前的配置选项，如键盘类型等；<br>&ensp;&ensp;&ensp;&ensp;◆必备命令<br>&ensp;&ensp;&ensp;&ensp;◆可选命令<br>★程序包段：指明要安装程序包，以及包组，也包括不安装的程序包；<br>&ensp;&ensp;&ensp;&ensp;◆%packages ：指明程序包段的开始；<br>&ensp;&ensp;&ensp;&ensp;◆@group_name：安装一个包组;<br>&ensp;&ensp;&ensp;&ensp;◆package：安装一个程序包；<br>&ensp;&ensp;&ensp;&ensp;◆-package ：指明不安装的程序包;<br>&ensp;&ensp;&ensp;&ensp;◆%end ：指明程序包段的结尾;<br>★脚本段：<br>&ensp;&ensp;&ensp;&ensp;◆%pre：安装前脚本<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;运行环境：运行于安装介质上的微型Linux环境<br>&ensp;&ensp;&ensp;&ensp;◆%post：安装后脚本<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;运行环境：安装完成的系统；</p>
<h4 id="4-命令段中的必备命令及可选命令："><a href="#4-命令段中的必备命令及可选命令：" class="headerlink" title="4.命令段中的必备命令及可选命令："></a>4.命令段中的必备命令及可选命令：</h4><p>★必备命令<br>&ensp;&ensp;&ensp;&ensp;◆authconfig：认证方式配置；<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;authconfig–useshadow–passalgo=sha512<br>&ensp;&ensp;&ensp;&ensp;◆bootloader：bootloader的安装位置及相关配置；<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;bootloader –location=mbr –driveorder=sda –append=”crashkernel=auto rhgb quiet”<br>&ensp;&ensp;&ensp;&ensp;◆keyboard: 设定键盘类型；<br>&ensp;&ensp;&ensp;&ensp;◆lang: 语言类型； 如：lang zh_CN.UTF-8<br>&ensp;&ensp;&ensp;&ensp;◆part: 分区布局；<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;part /boot –fstype=ext4 –size=200<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;part pv.008002 –size=61440<br>&ensp;&ensp;&ensp;&ensp;◆补充：分区相关的其他命令：<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;clrarpart：清除分区；（clearpart –none –drives=sda：清空磁盘分区）<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;volgroup：创建卷组；（volgroup vg0 –pesize=8192 pv.008002）<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;logvol：创建逻辑卷；（logvol / –fstype=ext4 –name=root –vgname=vg0 –size=20480）<br>&ensp;&ensp;&ensp;&ensp;◆rootpw：指明root的密码；<br>&ensp;&ensp;&ensp;&ensp;◆timezone：时区  timezone Asia/Shanghai<br>★可选命令<br>&ensp;&ensp;&ensp;&ensp;◆install OR upgrade；安装或升级<br>&ensp;&ensp;&ensp;&ensp;◆text: 安装界面类型，text为TUL，默认为GUI<br>&ensp;&ensp;&ensp;&ensp;◆network：配置网络接口；<br>&ensp;&ensp;&ensp;&ensp;◆firewall：防火墙<br>&ensp;&ensp;&ensp;&ensp;系统安装完成之后禁用防火墙<br>&ensp;&ensp;&ensp;&ensp;◆CentOS 6 ：<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;service iptables stop<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;chkconfig iptables off<br>&ensp;&ensp;&ensp;&ensp;◆CentOS 7 ：<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;systemctl stop firewalld.service<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;systemctl disables firewalld.service<br>&ensp;&ensp;&ensp;&ensp;◆selinux：SElinux<br>&ensp;&ensp;&ensp;&ensp;系统安装完成后禁用SElinux：<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;编辑/etc/sysconfig/selinux或/etc/selinux/config文件，修改SELINUX参数的值为下面其中参数之一：permisslve,disabled<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;立即生效：getenforce，setenforce 0<br>&ensp;&ensp;&ensp;&ensp;◆安装完成之后的行为<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;halt、poweroff、reboot：；<br>&ensp;&ensp;&ensp;&ensp;◆repo：安装时使用的rpository<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;repo  –name=”CentOS”   –baseurl=cdrom:sr0  –cost=100<br>&ensp;&ensp;&ensp;&ensp;◆user：安装完成后为系统创建新用户<br>&ensp;&ensp;&ensp;&ensp;◆url：指明安装时使用的repository，但是为url格式；<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;url –url=<a href="http://172.16.0.1/cobbler/ks_mirror/CentOS-6.7-x86_64/" target="_blank" rel="external">http://172.16.0.1/cobbler/ks_mirror/CentOS-6.7-x86_64/</a><br>&ensp;&ensp;&ensp;&ensp;◆key –skip：跳过安装号码,适用于rhel版本</p>
<h4 id="演示：kickstart文件"><a href="#演示：kickstart文件" class="headerlink" title="演示：kickstart文件"></a>演示：kickstart文件</h4><p>CentOS 6 中的 anaconda-ks.cfg<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">[root@CentOS6 ~]<span class="comment"># cat anaconda-ks.cfg </span></div><div class="line"><span class="comment">#Kickstart file automatically generated by anaconda.</span></div><div class="line"><span class="comment">#version=DEVEL</span></div><div class="line">install      安装</div><div class="line">url --url=    指明安装时使用的仓库 </div><div class="line">lang en_US.UTF-8 指明使用的语言</div><div class="line">keyboard us    指明使用的键盘</div><div class="line">network --onboot yes --device eth0 --bootproto dhcp --noipv6 配置网络接口</div><div class="line">rootpw  --iscrypted <span class="variable">$6</span><span class="variable">$CGsqab6d</span><span class="variable">$Cd</span>.PnnWtlL5XZAyr9J2zoMqyJH1QodcDp1pQp0uZ1f0Cq4eq9.TMkSQU6IfpvYZEYc32.lmF0lKuQwavnC49a0   指明root密码 </div><div class="line"><span class="comment">#Reboot after installation</span></div><div class="line">reboot          安装完成之后的行为</div><div class="line">firewall --disabled   防火墙</div><div class="line">authconfig --useshadow  --passalgo=sha512 认证方式配置</div><div class="line">selinux --disabled      SElinux</div><div class="line">timezone Asia/Shanghai    时区</div><div class="line">bootloader --location=mbr --driveorder=sda --append=<span class="string">"crashkernel=auto crashkernel=auto rhgb rhgb quiet quiet"</span>  bootloader的安装位置及相关配置</div><div class="line"><span class="comment">#Clear the Master Boot Record</span></div><div class="line"><span class="comment">#zerombr</span></div><div class="line"><span class="comment">#The following is the partition information you requested</span></div><div class="line"><span class="comment">#Note that any partitions you deleted are not expressed</span></div><div class="line"><span class="comment">#here so unless you clear all partitions first, this is</span></div><div class="line"><span class="comment">#not guaranteed to work</span></div><div class="line"><span class="comment">#clearpart --all</span></div><div class="line"><span class="comment">#part /boot --fstype=ext4 --size=200</span></div><div class="line"><span class="comment">#part pv.008002 --size=61440</span></div><div class="line"><span class="comment">#volgroup vg0 --pesize=8192 pv.008002</span></div><div class="line"><span class="comment">#logvol / --fstype=ext4 --name=root --vgname=vg0 --size=20480</span></div><div class="line"><span class="comment">#logvol swap --name=swap --vgname=vg0 --size=2048</span></div><div class="line"><span class="comment">#logvol /usr --fstype=ext4 --name=usr --vgname=vg0 --size=10240</span></div><div class="line"><span class="comment">#logvol /var --fstype=ext4 --name=var --vgname=vg0 --size=20480</span></div><div class="line">repo --name=<span class="string">"CentOS"</span>  --baseurl=http://10.1.0.1/cobbler/ks_mirror/6/ --cost=100</div></pre></td></tr></table></figure></p>
<h3 id="定制kickstart文件的方式："><a href="#定制kickstart文件的方式：" class="headerlink" title="定制kickstart文件的方式："></a>定制kickstart文件的方式：</h3><p>★直接手动编辑；<br>&ensp;&ensp;&ensp;&ensp;依据某模板修改<br>★可使用创建工具：<br>&ensp;&ensp;&ensp;&ensp;yum install system-config-kickstart<br>&ensp;&ensp;&ensp;&ensp;system-config-kickstart<br>&ensp;&ensp;&ensp;&ensp;依据某模板修改并生成新配置；<br>&ensp;&ensp;&ensp;&ensp;◆检查ks文件的语法错误：ksvalidator<br>&ensp;&ensp;&ensp;&ensp;ksvalidator /PATH/TO/KICKSTART_FILE</p>
<h3 id="制作一个kickstart文件以及一个引导镜像"><a href="#制作一个kickstart文件以及一个引导镜像" class="headerlink" title="制作一个kickstart文件以及一个引导镜像"></a>制作一个kickstart文件以及一个引导镜像</h3><h4 id="制作kickstart文件："><a href="#制作kickstart文件：" class="headerlink" title="制作kickstart文件："></a>制作kickstart文件：</h4><p>运行命令system-config-kickstart &amp;<br>会出现如下编辑界：<br><img src="\images\system-config-kickstart.png" alt="kernel address "><br>可以在以下界面编辑，配置相关信息，最后保存至/root目录下为ks.cfg<br><img src="\images\ks.png" alt="kernel address "></p>
<h4 id="制作引导光盘步骤："><a href="#制作引导光盘步骤：" class="headerlink" title="制作引导光盘步骤："></a>制作引导光盘步骤：</h4><p>1.挂载光盘镜像：<br>[root@CentOS6 ~]# mount /dev/cdrom /mnt/cdrom<br>mount: block device /dev/sr0 is write-protected, mounting read-only<br>2.指定一个启动镜像配置文件根目录：<br>[root@CentOS6 ~]# mkdir myboot<br>[root@CentOS6 ~]# cd myboot/<br>[root@CentOS6 myboot]# ls<br>3.拷贝光盘镜像的启动文件目录isolinux到镜像文件根目录myboot下:<br>[root@CentOS6 myboot]# cp -r /mnt/cdrom/isolinux/ ./<br>[root@CentOS6 myboot]# ls<br>isolinux<br>[root@CentOS6 myboot]# cd isolinux/<br>[root@CentOS6 isolinux]# ls -l<br>total 38572<br>-r–r–r–. 1 root root     2048 Jun 27 00:42 boot.cat<br>-r–r–r–. 1 root root       84 Jun 27 00:42 boot.msg<br>-r–r–r–. 1 root root      334 Jun 27 00:42 grub.conf<br>-r–r–r–. 1 root root 34815427 Jun 27 00:42 initrd.img<br>-r–r–r–. 1 root root    24576 Jun 27 00:42 isolinux.bin<br>-r–r–r–. 1 root root      936 Jun 27 00:42 isolinux.cfg<br>-r–r–r–. 1 root root   165080 Jun 27 00:42 memtest<br>-r–r–r–. 1 root root   151230 Jun 27 00:42 splash.jpg<br>-r–r–r–. 1 root root     2215 Jun 27 00:42 TRANS.TBL<br>-r–r–r–. 1 root root   163728 Jun 27 00:42 vesamenu.c32<br>-r-xr-xr-x. 1 root root  4152336 Jun 27 00:42 vmlinuz<br>4.添加启动镜像文件写权限（默认没有写权限）<br>[root@CentOS6 isolinux]# chmod +w *<br>5.修改启动镜像配置文件<br>[root@CentOS6 isolinux]# vim isolinux.cfg<br>[root@CentOS6 isolinux]# cat isolinux.cfg<br>default vesamenu.c32</p>
<p>#prompt 1<br>timeout 600<br>display boot.msg<br>menu background splash.jpg<br>menu title Welcome to CentOS 6.6!<br>menu color border 0 #ffffffff #00000000<br>menu color sel 7 #ffffffff #ff000000<br>menu color title 0 #ffffffff #00000000<br>menu color tabmsg 0 #ffffffff #00000000<br>menu color unsel 0 #ffffffff #00000000<br>menu color hotsel 0 #ff000000 #ffffffff<br>menu color hotkey 7 #ffffffff #ff000000<br>menu color scrollbar 0 #ffffffff #00000000<br>label linux<br>  menu label ^Install or upgrade an existing system (ks)     #########可以自行修改添加启动显示信息<br>  menu default<br>  kernel vmlinuz<br>  append initrd=initrd.img ks=cdrom:/ks.cfg           ##########指定kickstart文件位置<br>label vesa<br>  menu label Install system with ^basic video driver<br>  kernel vmlinuz<br>  append initrd=initrd.img xdriver=vesa nomodeset<br>label rescue<br>  menu label ^Rescue installed system<br>  kernel vmlinuz<br>  append initrd=initrd.img rescue<br>label local<br>  menu label Boot from ^local drive<br>  localboot 0xffff<br>label memtest86<br>  menu label ^Memory test<br>  kernel memtest<br>  append –<br>6.拷贝kickstart文件到镜像文件的根目录myboot下：<br>[root@CentOS6 isolinux]# cp /root/ks.cfg /root/myboot/<br>[root@CentOS6 isolinux]# ls /root/myboot/<br>isolinux  ks.cfg<br>7.制作光盘镜像文件：<br>[root@CentOS6 myboot]# cd ..          #########切换到镜像目录的上层目录<br>[root@CentOS6 ~]# mkisofs -R -J -T -v –no-emul-boot –boot-load-size 4 –boot-info-table -V “CentOS 6 x86_64 boot” -c isolinux/boot.cat -b isolinux/isolinux.bin -o /root/boot.iso myboot/<br>I: -input-charset not specified, using utf-8 (detected in locale settings)<br>genisoimage 1.1.9 (Linux)<br>Scanning myboot/<br>Scanning myboot/isolinux<br>Excluded: myboot/isolinux/TRANS.TBL<br>Excluded by match: myboot/isolinux/boot.cat<br>Writing:   Initial Padblock                        Start Block 0<br>Done with: Initial Padblock                        Block(s)    16<br>Writing:   Primary Volume Descriptor               Start Block 16<br>Done with: Primary Volume Descriptor               Block(s)    1<br>Writing:   Eltorito Volume Descriptor              Start Block 17<br>Size of boot image is 4 sectors -&gt; No emulation<br>Done with: Eltorito Volume Descriptor              Block(s)    1<br>Writing:   Joliet Volume Descriptor                Start Block 18<br>Done with: Joliet Volume Descriptor                Block(s)    1<br>Writing:   End Volume Descriptor                   Start Block 19<br>Done with: End Volume Descriptor                   Block(s)    1<br>Writing:   Version block                           Start Block 20<br>Done with: Version block                           Block(s)    1<br>Writing:   Path table                              Start Block 21<br>Done with: Path table                              Block(s)    4<br>Writing:   Joliet path table                       Start Block 25<br>Done with: Joliet path table                       Block(s)    4<br>Writing:   Directory tree                          Start Block 29<br>Done with: Directory tree                          Block(s)    2<br>Writing:   Joliet directory tree                   Start Block 31<br>Done with: Joliet directory tree                   Block(s)    2<br>Writing:   Directory tree cleanup                  Start Block 33<br>Done with: Directory tree cleanup                  Block(s)    0<br>Writing:   Extension record                        Start Block 33<br>Done with: Extension record                        Block(s)    1<br>Writing:   The File(s)                             Start Block 34<br> 25.74% done, estimate finish Tue Jun 27 00:51:16 2017<br> 51.38% done, estimate finish Tue Jun 27 00:51:16 2017<br> 77.11% done, estimate finish Tue Jun 27 00:51:16 2017<br>Total translation table size: 4701<br>Total rockridge attributes bytes: 1438<br>Total directory bytes: 2654<br>Path table size(bytes): 26<br>Done with: The File(s)                             Block(s)    19283<br>Writing:   Ending Padblock                         Start Block 19317<br>Done with: Ending Padblock                         Block(s)    150<br>Max brk space used 0<br>19467 extents written (38 MB)</p>
<h4 id="新建一台虚拟机用创建好的镜像引导系统。这里没有配置网络，所以在找镜像源时再更换为本地系统光盘镜像文件自行安装系统。"><a href="#新建一台虚拟机用创建好的镜像引导系统。这里没有配置网络，所以在找镜像源时再更换为本地系统光盘镜像文件自行安装系统。" class="headerlink" title="新建一台虚拟机用创建好的镜像引导系统。这里没有配置网络，所以在找镜像源时再更换为本地系统光盘镜像文件自行安装系统。"></a>新建一台虚拟机用创建好的镜像引导系统。这里没有配置网络，所以在找镜像源时再更换为本地系统光盘镜像文件自行安装系统。</h4><p><img src="\images\ks-install.png" alt="kernel address "><br><img src="\images\ks-install01.png" alt="kernel address "></p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color3">linux安装</a>
        		</li>
      		
		</ul>
	</div>

      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/2017/06/25/CentOS安装/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>





  
    <article id="post-linux之shell脚本编程-基础篇(一)" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/06/20/linux之shell脚本编程-基础篇(一)/">linux之shell脚本编程-基础篇(一)</a>
    </h1>
  

        
        <a href="/2017/06/20/linux之shell脚本编程-基础篇(一)/" class="archive-article-date">
  	<time datetime="2017-06-20T11:50:22.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2017-06-20</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-shell脚本编程基础篇"><a href="#ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-ensp-shell脚本编程基础篇" class="headerlink" title="&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp; &ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp; shell脚本编程基础篇"></a>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp; &ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp; shell脚本编程基础篇</h3><h3 id="概述："><a href="#概述：" class="headerlink" title="概述："></a>概述：</h3><p>&ensp;&ensp;&ensp;&ensp;shell脚本在Linux系统管理员的运维工作中非常重要。shell脚本能够帮助我们很方便的管理服务器，因为我们可以指定一个任务计划，定时的去执行某一个脚本以满足我们的需求。本篇将从编程基础、脚本基本格式、变量、运算、条件测试这几个方面详细介绍shell脚本编程的基础内容，也是我们必须要掌握熟练的内容。</p>
<h3 id="Bash为用户提供了编程环境"><a href="#Bash为用户提供了编程环境" class="headerlink" title="Bash为用户提供了编程环境"></a>Bash为用户提供了编程环境</h3><h4 id="编程环境"><a href="#编程环境" class="headerlink" title="编程环境"></a>编程环境</h4><p>★ 程序：指令+数据（或者：算法+数据结构）<br>&ensp;&ensp;&ensp;&ensp;指令：由程序文件提供；<br>&ensp;&ensp;&ensp;&ensp;数据：I/O设备、文件、管道、变量<br>★ 程序编程风格有两种：<br>◆过程式：以指令为中心来组织代码，数据服务于代码；<br> 特点：<br>&ensp;&ensp;&ensp;&ensp;顺序执行；<br>&ensp;&ensp;&ensp;&ensp;循环执行；<br>&ensp;&ensp;&ensp;&ensp;选择执行；<br>&ensp;&ensp;&ensp;&ensp;shell 程序，是一个过程式的解释器，提供了编程能力，然后解释执行；<br>◆对象式：以数据为中心来组织代码，围绕数据来服务于指令<br>&ensp;&ensp;&ensp;&ensp;类（class）：实例化对象 method；<br>&ensp;&ensp;&ensp;&ensp;代表：java，C++，Python<br>★ 程序的执行方式：<br>&ensp;&ensp;&ensp;&ensp;计算机：只能识别二进制文件，所以运行的是二进制指令（机器语言）<br>☉程序的执行过程：<br>&ensp;&ensp;&ensp;&ensp;先把源码程序翻译成机器语言（生成可执行的文件），然后解释执行。对于过程式编程语言而言，把一行源程序翻译成机器语言，然后执行，再翻译下一行的源码程序为机器语言，然后再执行；<br>&ensp;&ensp;&ensp;&ensp;对于计算机而言，它能识别的只能是二进制文件，因此其所运行的其实是二进制指令，这些二进制指令我们称之为机器语言，属于低级语言，相反高级语言是指，程序员编程所使用的语言，是人们比较容易理解的语言；<br>☉计算机编程语言：<br>◆低级：<br>&ensp;&ensp;&ensp;&ensp;机器语言、汇编语言<br>◆高级：<br>&ensp;&ensp;&ensp;&ensp;编译过程：高级语言（源代码）–&gt;编译器（编译）–&gt;目标代码 ， 如：  c、c++、jave<br>&ensp;&ensp;&ensp;&ensp;解释过程：高级语言（源代码）–&gt;解释器（运行时启动解释器，由解释器边解释边运行）–&gt;机器代码<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;如 ：shell、perl、python<br>☉根据其编程过程中功能的实现是调用库还是调用外部的程序文件：<br>◆shell脚本编程：<br>&ensp;&ensp;&ensp;&ensp;利用系统上的命令及编程组件进行编程；<br>◆完整编程：<br>&ensp;&ensp;&ensp;&ensp;利用库和编程组件进行编程<br>★ shell编程：过程式编程，解释执行，依赖于外部程序文件运行<br>&ensp;&ensp;&ensp;&ensp;是一个过程式的解释器，提供了编程能力，然后解释执行。<br>☉编程语言的基本结构：<br>&ensp;&ensp;&ensp;&ensp;数据存储：变量、数组<br>&ensp;&ensp;&ensp;&ensp;表达式：a + b<br>&ensp;&ensp;&ensp;&ensp;语句：if语句<br>☉shell脚本是什么？<br>&ensp;&ensp;&ensp;&ensp;shell脚本其实就是以一系列命令组合起来的文本文件，这些命令组合起来完成一个或者一项功能。<br>&ensp;&ensp;&ensp;&ensp;但很多命令不具有幂等性，需要用程序逻辑来判断运行条件是否满足，以避免其运行中发生错误。</p>
<h3 id="shell脚本的组成部分"><a href="#shell脚本的组成部分" class="headerlink" title="shell脚本的组成部分"></a>shell脚本的组成部分</h3><h4 id="格式及用途："><a href="#格式及用途：" class="headerlink" title="格式及用途："></a>格式及用途：</h4><p>★ shell脚本<br>&ensp;&ensp;&ensp;&ensp;shell脚本是包含一些命令或声明，并符合一定格式的文本文件；<br>☉shell程序开头的环境指定：<br>&ensp;&ensp;&ensp;&ensp;我们称之为shebang（顶格写）：解释器路径，用于指明解释执行当前脚本的解释器程序文件；<br>◆常见解释器：<br>&ensp;&ensp;&ensp;&ensp;#!/bin/bash（顶格写）<br>&ensp;&ensp;&ensp;&ensp;#!/usr/bin/python<br>&ensp;&ensp;&ensp;&ensp;#!/usr/bin/perl<br>☉shell脚本的用途有：<br>&ensp;&ensp;&ensp;&ensp;自动化常用命令；<br>&ensp;&ensp;&ensp;&ensp;执行系统管理和故障排除；<br>&ensp;&ensp;&ensp;&ensp;创建简单的应用程序；<br>&ensp;&ensp;&ensp;&ensp;处理文本或文件；</p>
<h4 id="创建及运行shell脚本"><a href="#创建及运行shell脚本" class="headerlink" title="创建及运行shell脚本"></a>创建及运行shell脚本</h4><p>★ 创建shell脚本<br>&ensp;&ensp;&ensp;&ensp;shell脚本通常都是以 .sh 为后缀名的<br>☉步骤如下：<br>◆第一步：使用（vim）文本编辑器来创建文本文件<br>&ensp;&ensp;&ensp;&ensp;第一行必须包括shell声明序列：#!<br>&ensp;&ensp;&ensp;&ensp;添加注释：#（注释以#开头 ，后面跟一些相关注释内容、作者、创建日期或版本等）；<br>&ensp;&ensp;&ensp;&ensp;代码注释：<br>&ensp;&ensp;&ensp;&ensp;缩进，适度添加空白行<br>◆第二步：运行脚本（相当于开了一个子进程，bash–bash-）<br>※给予执行权限，并直接运行此程序文件：在命令行上指定脚本的绝对或相对路径<br>&ensp;&ensp;&ensp;&ensp;chmod +x /PATH/TO/SCRIPT_FILE<br>&ensp;&ensp;&ensp;&ensp;/PATH/TO/SCRIPT_FILE<br>※直接运行解释器：将脚本作为解释器程序的参数运行<br>&ensp;&ensp;&ensp;&ensp;bash /PATH/TO/SCRIPT_FILE<br>★脚本调试<br>☉检测脚本中的语法错误<br>&ensp;&ensp;&ensp;&ensp;bash -n /path/to/some_script<br>☉调试执行<br>&ensp;&ensp;&ensp;&ensp;bash -x /path/to/some_script<br>注意：<br>&ensp;&ensp;&ensp;&ensp;脚本中的空白行会被解释器忽略；<br>&ensp;&ensp;&ensp;&ensp;脚本中除了shebang，余下所有以#开头的行，都会被视作注释行而被忽略；此即为注释行；<br>&ensp;&ensp;&ensp;&ensp;shell脚本的运行是通过运行一个子shell进程实现的；</p>
<h4 id="演示："><a href="#演示：" class="headerlink" title="演示："></a>演示：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 创建脚本</span></div><div class="line">[root@centos7 lab]<span class="comment"># vim first.sh</span></div><div class="line">  1 <span class="comment">#!/bin/bash</span></div><div class="line">  2 <span class="comment">#author:jack</span></div><div class="line">  3 <span class="comment">#version:0.0.1</span></div><div class="line">  4 <span class="comment">#description:This is my first shell script</span></div><div class="line">  5 </div><div class="line">  6 date</div><div class="line">  7 <span class="built_in">echo</span> <span class="string">"Hello world!"</span></div><div class="line"></div><div class="line"><span class="comment"># 运行脚本（直接运行解释器）</span></div><div class="line">[root@centos7 lab]<span class="comment"># bash first.sh </span></div><div class="line">Thu Aug  3 15:05:22 CST 2017</div><div class="line">Hello world!</div><div class="line">[root@centos7 lab]<span class="comment"># sh first.sh </span></div><div class="line">Thu Aug  3 15:05:42 CST 2017</div><div class="line">Hello world!</div><div class="line"></div><div class="line"><span class="comment"># 给予执行权限，运行脚本</span></div><div class="line">[root@centos7 lab]<span class="comment"># chmod +x first.sh </span></div><div class="line">[root@centos7 lab]<span class="comment"># ll first.sh </span></div><div class="line">-rwxr-xr-x 1 root root 109 Aug  3 15:01 first.sh</div><div class="line">[root@centos7 lab]<span class="comment"># ./first.sh </span></div><div class="line">Thu Aug  3 15:06:33 CST 2017</div><div class="line">Hello world!</div><div class="line"></div><div class="line"><span class="comment"># 检查脚本中的语法错误（没有结果就是最好的结果）</span></div><div class="line">[root@centos7 lab]<span class="comment"># bash -n first.sh </span></div><div class="line"><span class="comment"># 调试执行</span></div><div class="line">[root@centos7 lab]<span class="comment"># bash -x first.sh </span></div><div class="line">+ date</div><div class="line">Thu Aug  3 15:07:47 CST 2017</div><div class="line">+ <span class="built_in">echo</span> <span class="string">'Hello world!'</span></div><div class="line">Hello world!</div></pre></td></tr></table></figure>
<h3 id="shell脚本中的变量"><a href="#shell脚本中的变量" class="headerlink" title="shell脚本中的变量"></a>shell脚本中的变量</h3><h4 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h4><p>★ 变量：命名的存储空间<br>&ensp;&ensp;&ensp;&ensp;变量名+指向的内存空间<br>◆数据存储方式：ASCII<br>&ensp;&ensp;&ensp;&ensp;字符：<br>&ensp;&ensp;&ensp;&ensp;数值：整型，浮点型<br>☉变量赋值：<br>&ensp;&ensp;&ensp;&ensp;name=value<br>☉变量类型及作用：<br>◆作用：<br>&ensp;&ensp;&ensp;&ensp;数据存储格式；<br>&ensp;&ensp;&ensp;&ensp;参与的运算；<br>&ensp;&ensp;&ensp;&ensp;表示的数据范围，<br>◆类型：<br>&ensp;&ensp;&ensp;&ensp;字符：<br>&ensp;&ensp;&ensp;&ensp;数值：整型，浮点型<br>☉变量替换：<br>&ensp;&ensp;&ensp;&ensp;把变量名出现的位置替换为其所指向的内存空间中的数据；<br>☉变量引用：<br>&ensp;&ensp;&ensp;&ensp;${var_name}<br>&ensp;&ensp;&ensp;&ensp;或者：$var_name   如：echo $SHELL<br>★编程语言分类：<br>☉强类型：<br>&ensp;&ensp;&ensp;&ensp;定义变量时必须指定类型、参与运算必须符合类型要求；调用未声明变量会产生错误<br>&ensp;&ensp;&ensp;&ensp;如：java，python<br>☉弱类型：<br>&ensp;&ensp;&ensp;&ensp;bash把所有变量统统视为字符型；<br>&ensp;&ensp;&ensp;&ensp;bash中的变量无需事先声明，可直接调用，相当于把声明和赋值过程同时实现；<br>&ensp;&ensp;&ensp;&ensp;参与运算会自动进行隐式类型转换；<br>&ensp;&ensp;&ensp;&ensp;bash不支持浮点数<br>★变量名命名法则：<br>&ensp;&ensp;&ensp;&ensp;不能使程序中的保留字：例如if, for；<br>&ensp;&ensp;&ensp;&ensp;只能使用数字、字母及下划线，且不能以数字开头<br>&ensp;&ensp;&ensp;&ensp;见名知义；<br>☉统一命名规则：<br>&ensp;&ensp;&ensp;&ensp;驼峰命名法（多单词）：大驼峰是每个单词的第一个字母大写，小驼峰是第一个单词的字母小写，后面的单词大写  （jave中用的较多）</p>
<h4 id="演示：-1"><a href="#演示：-1" class="headerlink" title="演示："></a>演示：</h4><p>1.自定义变量与引用<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@centos7 lab]<span class="comment"># var=123</span></div><div class="line">[root@centos7 lab]<span class="comment"># echo $var</span></div><div class="line">123</div></pre></td></tr></table></figure></p>
<p>2.Shell中所有变量引用使用$符，后跟变量名。有时个别特殊字符会影响正常引用，那么需要使用${VAR}，例如：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[root@centos7 lab]<span class="comment"># var=123</span></div><div class="line">[root@centos7 lab]<span class="comment"># echo $var</span></div><div class="line">123</div><div class="line">[root@centos7 lab]<span class="comment"># echo $var_  # Shell允许VAR_为变量名，所以此引用认为这是一个有效的变量名，故此返回空</span></div><div class="line"></div><div class="line">[root@centos7 lab]<span class="comment"># echo $&#123;var&#125;</span></div><div class="line">123</div></pre></td></tr></table></figure></p>
<p>3.还有时候变量名与其他字符串紧碍着，也会误认为是整个变量：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@centos7 lab]<span class="comment"># echo $var</span></div><div class="line">123</div><div class="line">[root@centos7 lab]<span class="comment"># echo $&#123;var&#125;hello</span></div><div class="line">123hello</div></pre></td></tr></table></figure></p>
<p>4.将命令结果作为变量值<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[root@centos7 lab]<span class="comment"># var=`echo 123`</span></div><div class="line">[root@centos7 lab]<span class="comment"># echo $var</span></div><div class="line">123</div><div class="line">[root@centos7 lab]<span class="comment"># var=$(echo 456)</span></div><div class="line">[root@centos7 lab]<span class="comment"># echo $var</span></div><div class="line">456</div></pre></td></tr></table></figure></p>
<h3 id="bash-变量种类"><a href="#bash-变量种类" class="headerlink" title="bash 变量种类"></a>bash 变量种类</h3><p>★ 根据变量的生效范围等标准可分为：<br>☉本地变量：<br>&ensp;&ensp;&ensp;&ensp;生效范围为当前shell进程；对当前shell之外的其它shell进程，包括当前shell的子shell进程均无效；<br>☉环境变量：<br>&ensp;&ensp;&ensp;&ensp;生效范围为当前shell进程及其子进程（父进程，和子进程）；<br>☉局部变量：<br>&ensp;&ensp;&ensp;&ensp;生效范围为当前shell进程中某代码片断(通常指函数上下文)；<br>☉位置参数变量：<br>&ensp;&ensp;&ensp;&ensp;$1, $2, …来表示，用于让脚本在脚本代码中调用通过命令行传递给它的参数；<br>☉特殊变量：<br>&ensp;&ensp;&ensp;&ensp;$?, $0, $*, $@, $#，shell内置的有特殊功用的变量</p>
<h3 id="shell变量详述"><a href="#shell变量详述" class="headerlink" title="shell变量详述"></a>shell变量详述</h3><h4 id="本地变量"><a href="#本地变量" class="headerlink" title="本地变量"></a>本地变量</h4><p>★ 本地变量：<br>&ensp;&ensp;&ensp;&ensp;生效范围为当前shell进程；对当前shell之外的其它shell进程，包括当前shell的子shell进程均无效；<br>☉变量赋值：<br>&ensp;&ensp;&ensp;&ensp;name=value<br>☉可以使用引用value：<br>&ensp;&ensp;&ensp;&ensp;可以是直接字串：name=“root” （定义变量的格式：变量名=变量的值）<br>&ensp;&ensp;&ensp;&ensp;变量引用：name=”$USER” （引用变量时需要加上符号$，）<br>&ensp;&ensp;&ensp;&ensp;命令引用：name=<code>COMMAND</code>, name=$(COMMAND)<br>☉变量引用：${name}， $name<br>&ensp;&ensp;&ensp;&ensp;””：弱引用，其中的变量引用会被替换为变量值<br>&ensp;&ensp;&ensp;&ensp;’’：强引用，其中的变量引用不会被替换为变量值，而保持原字符串<br>☉显示已定义的所有变量：set<br>☉撤销变量：unset name（注意：此处非变量引用，无$）</p>
<h4 id="演示：-2"><a href="#演示：-2" class="headerlink" title="演示："></a>演示：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 在当前bash中定义变量</span></div><div class="line">[root@centos7 lab]<span class="comment"># first_name=jack</span></div><div class="line">[root@centos7 lab]<span class="comment"># echo $first_name</span></div><div class="line">jack</div><div class="line"></div><div class="line"><span class="comment"># 在当前shell中开启一个子shell</span></div><div class="line">[root@centos7 lab]<span class="comment"># bash</span></div><div class="line">[root@centos7 lab]<span class="comment"># pstree</span></div><div class="line">systemd-+-NetworkManager-+-2*[dhclient]</div><div class="line">        |                `-2*[&#123;NetworkManager&#125;]</div><div class="line">        |-abrt-watch-log</div><div class="line">        |-abrtd</div><div class="line">        |-agetty</div><div class="line">        |-anacron</div><div class="line">        |-auditd---&#123;auditd&#125;</div><div class="line">        |-crond</div><div class="line">        |-dbus-daemon</div><div class="line">        |-lvmetad</div><div class="line">        |-master-+-cleanup</div><div class="line">        |        |-local</div><div class="line">        |        |-pickup</div><div class="line">        |        |-qmgr</div><div class="line">        |        `-trivial-rewrite</div><div class="line">        |-polkitd---5*[&#123;polkitd&#125;]</div><div class="line">        |-rsyslogd---2*[&#123;rsyslogd&#125;]</div><div class="line">        |-sshd---sshd---bash---bash---pstree         <span class="comment"># 证明为子shell</span></div><div class="line">        |-systemd-journal</div><div class="line">        |-systemd-logind</div><div class="line">        |-systemd-udevd</div><div class="line">        |-tuned---4*[&#123;tuned&#125;]</div><div class="line">        `-wpa_supplicant</div><div class="line"></div><div class="line"><span class="comment">#说明 本地变量的作用范围仅为当前shell，对子shell无效</span></div><div class="line">[root@centos7 lab]<span class="comment"># echo $first_name</span></div><div class="line"></div><div class="line"><span class="comment"># 退出当前子shell</span></div><div class="line">[root@centos7 lab]<span class="comment"># exit</span></div><div class="line"><span class="built_in">exit</span></div><div class="line">[root@centos7 lab]<span class="comment"># echo $first_name</span></div><div class="line">jack</div><div class="line"></div><div class="line"> <span class="comment"># 撤销变量</span></div><div class="line">[root@centos7 lab]<span class="comment"># unset first_name</span></div><div class="line">[root@centos7 lab]<span class="comment"># echo $first_name</span></div></pre></td></tr></table></figure>
<h4 id="环境变量"><a href="#环境变量" class="headerlink" title="环境变量"></a>环境变量</h4><p>★ 环境变量<br>&ensp;&ensp;&ensp;&ensp;生效范围为当前shell进程及其子进程（父进程，和子进程）；<br>☉变量声明、赋值：<br>&ensp;&ensp;&ensp;&ensp;export name=VALUE<br>&ensp;&ensp;&ensp;&ensp;declare -x name=VALUE<br>☉变量引用：<br>&ensp;&ensp;&ensp;&ensp;$name，${name} （大括号必要情况系下要添加，为了区分谁是变量）<br>☉显示所有环境变量：<br>&ensp;&ensp;&ensp;&ensp;export<br>&ensp;&ensp;&ensp;&ensp;env<br>&ensp;&ensp;&ensp;&ensp;printenv<br>☉撤销变量：<br>&ensp;&ensp;&ensp;&ensp;unset name<br>☉bash内嵌了许多环境变量（通常为全大写字符），用于定义bash的工作环境：<br>&ensp;&ensp;&ensp;&ensp;PATH, SHELL, USRE,UID, HISTSIZE, HOME, PWD, OLDPWD, HISTFILE, PS1<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[root@centos7 lab]<span class="comment"># echo $SHELL</span></div><div class="line">/bin/bash</div><div class="line">[root@centos7 lab]<span class="comment"># echo $PS1</span></div><div class="line">[\u@\h \W]\$</div><div class="line">[root@centos7 lab]<span class="comment"># echo $HOME</span></div><div class="line">/root</div></pre></td></tr></table></figure></p>
<p>注意：<br>&ensp;&ensp;&ensp;&ensp;环境变量和本地变量都是针对于当前终端有效，一但退出当前终端，再登录之后，之前定义的环境变量就消失了</p>
<h4 id="演示"><a href="#演示" class="headerlink" title="演示"></a>演示</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 在当前shell中定义环境变量</span></div><div class="line">[root@centos7 lab]<span class="comment"># export first_name=jack</span></div><div class="line">[root@centos7 lab]<span class="comment"># echo $first_name</span></div><div class="line">jack</div><div class="line"></div><div class="line"><span class="comment"># 在当前shell中开启一个子shell</span></div><div class="line">[root@centos7 lab]<span class="comment"># bash</span></div><div class="line"></div><div class="line"><span class="comment"># 说明，环境变量的作用范围仅为父shell和子shell（在其他终端登录不起作用）</span></div><div class="line">[root@centos7 lab]<span class="comment"># echo $first_name</span></div><div class="line">jack</div><div class="line">[root@centos7 lab]<span class="comment"># exit</span></div><div class="line"><span class="built_in">exit</span></div><div class="line">You have new mail <span class="keyword">in</span> /var/spool/mail/root</div><div class="line">[root@centos7 lab]<span class="comment"># echo $first_name</span></div><div class="line">jack</div><div class="line"></div><div class="line"><span class="comment">#撤销环境变量</span></div><div class="line">[root@centos7 lab]<span class="comment"># unset first_name</span></div><div class="line">[root@centos7 lab]<span class="comment"># echo $first_name</span></div></pre></td></tr></table></figure>
<p>显示所有环境变量<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">[root@centos7 lab]<span class="comment"># export</span></div><div class="line"><span class="built_in">declare</span> -x HISTCONTROL=<span class="string">"ignoredups"</span></div><div class="line"><span class="built_in">declare</span> -x HISTSIZE=<span class="string">"1000"</span></div><div class="line"><span class="built_in">declare</span> -x HOME=<span class="string">"/root"</span></div><div class="line"><span class="built_in">declare</span> -x HOSTNAME=<span class="string">"centos7"</span></div><div class="line"><span class="built_in">declare</span> -x LANG=<span class="string">"EN"</span></div><div class="line"><span class="built_in">declare</span> -x LESSOPEN=<span class="string">"||/usr/bin/lesspipe.sh %s"</span></div><div class="line"><span class="built_in">declare</span> -x LOGNAME=<span class="string">"root"</span></div><div class="line"><span class="built_in">declare</span> -x MAIL=<span class="string">"/var/spool/mail/root"</span></div><div class="line"><span class="built_in">declare</span> -x OLDPWD=<span class="string">"/root"</span></div><div class="line"><span class="built_in">declare</span> -x PATH=<span class="string">"/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin"</span></div><div class="line"><span class="built_in">declare</span> -x PWD=<span class="string">"/root/lab"</span></div><div class="line"><span class="built_in">declare</span> -x SHELL=<span class="string">"/bin/bash"</span></div><div class="line"><span class="built_in">declare</span> -x SHLVL=<span class="string">"1"</span></div><div class="line"><span class="built_in">declare</span> -x SSH_CLIENT=<span class="string">"192.168.2.1 57573 22"</span></div><div class="line"><span class="built_in">declare</span> -x SSH_CONNECTION=<span class="string">"192.168.2.1 57573 192.168.2.140 22"</span></div><div class="line"><span class="built_in">declare</span> -x SSH_TTY=<span class="string">"/dev/pts/0"</span></div><div class="line"><span class="built_in">declare</span> -x TERM=<span class="string">"xterm"</span></div><div class="line"><span class="built_in">declare</span> -x USER=<span class="string">"root"</span></div><div class="line"><span class="built_in">declare</span> -x XDG_RUNTIME_DIR=<span class="string">"/run/user/0"</span></div><div class="line"><span class="built_in">declare</span> -x XDG_SESSION_ID=<span class="string">"7"</span></div></pre></td></tr></table></figure></p>
<h3 id="只读和位置参数变量"><a href="#只读和位置参数变量" class="headerlink" title="只读和位置参数变量"></a>只读和位置参数变量</h3><p>★ 只读变量：<br>&ensp;&ensp;&ensp;&ensp;只读变量无法重新赋值，并且不支持撤销（一般针对常量，可以再次声明为一个环境变量）<br>&ensp;&ensp;&ensp;&ensp;存活时间为当前shell进程的生命周期，随shell进程终止而终止；<br>☉定义方法：<br>&ensp;&ensp;&ensp;&ensp;readonly name<br>&ensp;&ensp;&ensp;&ensp;declare -r name ；declare -rx name（即是一个常量又是一个环境变量）<br>★ 位置变量：<br>&ensp;&ensp;&ensp;&ensp;在脚本代码中调用通过命令行传递给脚本参数<br>☉引用方式：<br>&ensp;&ensp;&ensp;&ensp;$1, $2, …,${10},${11}：对应第1、第2等参数；<br>☉轮替：<br>&ensp;&ensp;&ensp;&ensp;shift [n] ：位置参数轮替（会踢掉左边的参数）；<br>★ 特殊变量<br>&ensp;&ensp;&ensp;&ensp;$0：表示脚本文件路径本身<br>&ensp;&ensp;&ensp;&ensp;$<em>：传递给脚本的所有参数，全部参数合为一个字符串<br>&ensp;&ensp;&ensp;&ensp;$@：传递给脚本的所有参数，每个参数为独立字符串<br>&ensp;&ensp;&ensp;&ensp;$#：传递给脚本的参数的个数<br>注意：<br>&ensp;&ensp;&ensp;&ensp;$@ $</em> 只在被双引号包起来的时候才会有差异</p>
<h4 id="演示：-3"><a href="#演示：-3" class="headerlink" title="演示："></a>演示：</h4><p>1.只读变量<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[root@centos7 ~]<span class="comment"># readonly first_name=zmj</span></div><div class="line">[root@centos7 ~]<span class="comment"># echo $first_name</span></div><div class="line">zmj</div><div class="line">[root@centos7 ~]<span class="comment"># first_name=jack</span></div><div class="line">-bash: first_name: <span class="built_in">readonly</span> variable</div><div class="line">[root@centos7 ~]<span class="comment"># unset first_name</span></div><div class="line">-bash: <span class="built_in">unset</span>: first_name: cannot <span class="built_in">unset</span>: <span class="built_in">readonly</span> variable</div></pre></td></tr></table></figure></p>
<p>2.位置变量<br>定义脚本可接受命令行传递的参数<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">[root@centos7 lab]<span class="comment"># vim arg.sh</span></div><div class="line">  1 <span class="comment">#!/bin/bash</span></div><div class="line">  2 <span class="comment">#</span></div><div class="line">  3 <span class="built_in">echo</span> <span class="string">"The 1st arg is <span class="variable">$1</span>"</span></div><div class="line">  4 <span class="built_in">echo</span> <span class="string">"The 2st arg is <span class="variable">$2</span>"</span></div><div class="line">  5 <span class="built_in">echo</span> <span class="string">"The 3st arg is <span class="variable">$3</span>"</span></div><div class="line">  6 <span class="built_in">echo</span> <span class="string">"The all args are $*"</span></div><div class="line">  7 <span class="built_in">echo</span> <span class="string">"The all args are <span class="variable">$@</span>"</span></div><div class="line">  8 <span class="built_in">echo</span> <span class="string">"The all number is <span class="variable">$#</span>"</span></div><div class="line">  9 <span class="built_in">echo</span> <span class="string">"The script_name is `basename <span class="variable">$0</span>`"</span>       <span class="comment"># 取文件的基名</span></div></pre></td></tr></table></figure></p>
<p>向命令行传递参数<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">[root@centos7 lab]<span class="comment"># bash arg.sh aaa bbb ccc</span></div><div class="line">The 1st arg is aaa</div><div class="line">The 2st arg is bbb</div><div class="line">The 3st arg is ccc</div><div class="line">The all args are aaa bbb ccc</div><div class="line">The all args are aaa bbb ccc</div><div class="line">The all number is 3</div><div class="line">The script_name is arg.sh</div></pre></td></tr></table></figure></p>
<p>3.编写脚本，判断给出文件的行数<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">[root@centos7 lab]<span class="comment"># vim lines.sh</span></div><div class="line">  1 <span class="comment">#!/bin/bash</span></div><div class="line">  2 <span class="comment">#</span></div><div class="line">  3 linecount=$(wc <span class="_">-l</span> <span class="variable">$1</span>|cut <span class="_">-d</span><span class="string">' '</span> <span class="_">-f</span>1)</div><div class="line">  4 <span class="built_in">echo</span> <span class="string">"<span class="variable">$1</span> has <span class="variable">$linecount</span> lines"</span></div><div class="line"></div><div class="line">[root@centos7 lab]<span class="comment"># bash lines.sh /etc/passwd</span></div><div class="line">/etc/passwd has 51 lines</div></pre></td></tr></table></figure></p>
<h3 id="bash的配置文件"><a href="#bash的配置文件" class="headerlink" title="bash的配置文件"></a>bash的配置文件</h3><h4 id="生效范围分类"><a href="#生效范围分类" class="headerlink" title="生效范围分类"></a>生效范围分类</h4><p>★ 按照生效范围划分：<br>☉全局配置文件：对所有用户都生效<br>&ensp;&ensp;&ensp;&ensp;/etc/profile<br>&ensp;&ensp;&ensp;&ensp;/etc/profile.d/*.sh<br>☉个人配置文件：仅对当前用户有效<br>&ensp;&ensp;&ensp;&ensp;~/.bash_profile<br>&ensp;&ensp;&ensp;&ensp;~/.bashrc</p>
<h4 id="shell登录类型"><a href="#shell登录类型" class="headerlink" title="shell登录类型"></a>shell登录类型</h4><p>★ 交互式登录shell进程：<br>&ensp;&ensp;&ensp;&ensp;直接通过某终端输入账号密码后登录打开的shell进程；<br>&ensp;&ensp;&ensp;&ensp;使用su命令：“su - UserName”执行的登录切换；<br>☉执行顺序：<br>&ensp;&ensp;&ensp;&ensp;/etc/profile –&gt; /etc/profile.d/<em>.sh –&gt; ~/.bash_profile–&gt; ~/.bashrc–&gt; /etc/bashrc<br>★ 非交互式登录shell进程：<br>&ensp;&ensp;&ensp;&ensp;suUserName 执行的登录切换；<br>&ensp;&ensp;&ensp;&ensp;图形界面下打开的终端；<br>&ensp;&ensp;&ensp;&ensp;运行脚本<br>☉执行顺序：<br>&ensp;&ensp;&ensp;&ensp;~/.bashrc–&gt; /etc/bashrc–&gt; /etc/profile.d/</em>.sh</p>
<h4 id="功能划分，存在两类"><a href="#功能划分，存在两类" class="headerlink" title="功能划分，存在两类"></a>功能划分，存在两类</h4><p>★ profile类：为交互式登录的shell进程提供配置；<br>☉全局：对所有用户都生效<br>&ensp;&ensp;&ensp;&ensp;/etc/profile<br>&ensp;&ensp;&ensp;&ensp;/etc/profile.d/*.sh<br>☉用户个人：仅对当前用户生效<br>&ensp;&ensp;&ensp;&ensp;~/.bash_profile<br>☉功用：<br>&ensp;&ensp;&ensp;&ensp;用于定义环境变量；<br>&ensp;&ensp;&ensp;&ensp;运行命令或脚本<br>★ bashrc类：为非交互式登录的shell进程提供配置；<br>☉全局：<br>&ensp;&ensp;&ensp;&ensp;/etc/bashrc<br>☉用户个人：<br>&ensp;&ensp;&ensp;&ensp;~/.bashrc<br>☉功用：<br>&ensp;&ensp;&ensp;&ensp;定义本地变量；<br>&ensp;&ensp;&ensp;&ensp;定义命令别名；<br>注意：<br>&ensp;&ensp;&ensp;&ensp;仅管理员可修改全局变量</p>
<h4 id="编辑配置文件生效"><a href="#编辑配置文件生效" class="headerlink" title="编辑配置文件生效"></a>编辑配置文件生效</h4><p>★ 特性：<br>&ensp;&ensp;&ensp;&ensp;命令行中定义的特性，例如变量名和别名作用域为当前shell进程的生命周期；<br>&ensp;&ensp;&ensp;&ensp;配置文件中定义的特性，只对随后新启动的shell进程有效<br>★ 让通过配置文件定义的特性立即生效：<br>&ensp;&ensp;&ensp;&ensp;退出并重新登录；<br>&ensp;&ensp;&ensp;&ensp;让shell进程重读配置文件<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;~]# source /PATH/TO/CONF_FILE<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;~]# . /PATH/TO/CONF_FILE</p>
<h4 id="演示：-4"><a href="#演示：-4" class="headerlink" title="演示："></a>演示：</h4><p>◆定义个人配置<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">[root@centos7 ~]<span class="comment"># vim .bashrc </span></div><div class="line">  1 <span class="comment"># .bashrc</span></div><div class="line">  2 </div><div class="line">  3 <span class="comment"># User specific aliases and functions</span></div><div class="line">  4 </div><div class="line">  5 <span class="built_in">alias</span> rm=<span class="string">'rm -i'</span></div><div class="line">  6 <span class="built_in">alias</span> cp=<span class="string">'cp -i'</span></div><div class="line">  7 <span class="built_in">alias</span> mv=<span class="string">'mv -i'</span></div><div class="line">  8 <span class="built_in">alias</span> cdnet=<span class="string">'cd /etc/sysconfig/network-scripts/'</span>        <span class="comment"># 定义别名</span></div><div class="line">  9 <span class="comment"># Source global definitions</span></div><div class="line"> 10 <span class="keyword">if</span> [ <span class="_">-f</span> /etc/bashrc ]; <span class="keyword">then</span></div><div class="line"> 11         . /etc/bashrc</div><div class="line"> 12 <span class="keyword">fi</span></div><div class="line"> 13 </div><div class="line"> <span class="comment">#定义本地变量PS1</span></div><div class="line"> 14 PS1=<span class="string">"\[\e[36;40m\][\[\e[32;40m\]\u\[\e[0m\]@\[\e[33;40m\]\h \[\e[36;40m\]\W\[\e[36;40m\]]\[\e[0m\]\\$ "</span></div><div class="line"></div><div class="line"><span class="comment"># 这时查看alias命令，发现还没有定义的别名cdnet，说明还没有生效</span></div><div class="line">[root@centos7 ~]<span class="comment"># alias</span></div><div class="line"><span class="built_in">alias</span> cls=<span class="string">'clear'</span></div><div class="line"><span class="built_in">alias</span> cp=<span class="string">'cp -i'</span></div><div class="line"><span class="built_in">alias</span> egrep=<span class="string">'egrep --color=auto'</span></div><div class="line"><span class="built_in">alias</span> fgrep=<span class="string">'fgrep --color=auto'</span></div><div class="line"><span class="built_in">alias</span> grep=<span class="string">'grep --color=auto'</span></div><div class="line"><span class="built_in">alias</span> l.=<span class="string">'ls -d .* --color=auto'</span></div><div class="line"><span class="built_in">alias</span> ll=<span class="string">'ls -l --color=auto'</span></div><div class="line"><span class="built_in">alias</span> ls=<span class="string">'ls --color=auto'</span></div><div class="line"><span class="built_in">alias</span> mv=<span class="string">'mv -i'</span></div><div class="line"><span class="built_in">alias</span> rm=<span class="string">'rm -i'</span></div><div class="line"><span class="built_in">alias</span> <span class="built_in">which</span>=<span class="string">'alias | /usr/bin/which --tty-only --read-alias --show-dot --show-tilde'</span></div></pre></td></tr></table></figure></p>
<p>重读配置文件，再次查看，发现已经生效<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@centos7 ~]<span class="comment"># . .bashrc</span></div></pre></td></tr></table></figure></p>
<p><img src="\images\bash\个人配置.png" alt="bash"><br>◆定义全局配置<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">[root@centos7 ~]<span class="comment">#  cd /etc/profile.d/</span></div><div class="line">You have new mail <span class="keyword">in</span> /var/spool/mail/root</div><div class="line">[root@centos7 profile.d]<span class="comment"># ls</span></div><div class="line">256term.csh  colorgrep.csh  colorls.csh  lang.csh  less.csh  vim.csh  <span class="built_in">which</span>2.sh</div><div class="line">256term.sh   colorgrep.sh   colorls.sh   lang.sh   less.sh   vim.sh   <span class="built_in">which</span>2.csh</div><div class="line">[root@centos7 profile.d]<span class="comment"># vim welcome.sh </span></div><div class="line">  1 <span class="comment">#!/bin/bash</span></div><div class="line">  2 </div><div class="line">  3 </div><div class="line">  4 <span class="built_in">echo</span> <span class="_">-e</span> <span class="string">"\e[32m=====================================\e[0m"</span></div><div class="line">  5 </div><div class="line">  6 <span class="built_in">echo</span> <span class="_">-e</span> <span class="string">"\e[36m       Welcome Everybody\e[0m"</span></div><div class="line">  7 <span class="built_in">echo</span> <span class="_">-e</span> <span class="string">"\e[40;35;1m        Everyone has a dream,come on baby!!!\e[0m"</span></div><div class="line">  8 <span class="built_in">echo</span> <span class="_">-e</span> <span class="string">"\e[36m      `date "</span>+%F %H:%M:%S <span class="variable">$A</span><span class="string">"`"</span></div><div class="line">  9 </div><div class="line"> 10 <span class="built_in">echo</span> <span class="_">-e</span> <span class="string">"\e[32m=====================================\e[0m"</span></div></pre></td></tr></table></figure></p>
<p>对于重新登陆的用户生效<br><img src="\images\bash\全局配置.png" alt="bash"></p>
<p>也可以定义环境变量<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">[root@centos7 profile.d]<span class="comment"># vim ps1.sh</span></div><div class="line">  1 PS1=<span class="string">"\[\e[36;40m\][\[\e[32;40m\]\u\[\e[0m\]@\[\e[33;40m\]\h \[\e[36;40m\]\W\[\e[36;40m\]]\[\e[0m\]\\$ "</span></div><div class="line"></div><div class="line">[root@centos7 profile.d]<span class="comment"># vim java.sh </span></div><div class="line"><span class="built_in">export</span> JAVA_HOME=/usr</div><div class="line"></div><div class="line"><span class="comment">#重读配置文件生效</span></div><div class="line">[root@centos7 profile.d]<span class="comment"># . ./ps1.sh</span></div><div class="line">[root@centos7 profile.d]<span class="comment"># . ./java.sh</span></div></pre></td></tr></table></figure></p>
<h3 id="bash特性之—多命令执行"><a href="#bash特性之—多命令执行" class="headerlink" title="bash特性之—多命令执行"></a>bash特性之—多命令执行</h3><p>★ 方式：<br>☉复合式： 命令会一个接一个的执行<br>&ensp;&ensp;&ensp;&ensp;~]# COMMAND1;COMMAND2;COMMAND3;…  （如：date; who | wc -l ）<br>☉子shell：所有的输出都被发送给单个STDOUT和STDER<br>&ensp;&ensp;&ensp;&ensp;如：(date; who | wc -l ) &gt;&gt;/tmp/trace</p>
<h4 id="演示-1"><a href="#演示-1" class="headerlink" title="演示:"></a>演示:</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 按顺序执行</span></div><div class="line">[root@centos7 ~]<span class="comment"># date;who|wc -l</span></div><div class="line">Thu Aug  3 21:48:32 CST 2017</div><div class="line">1</div><div class="line"></div><div class="line"><span class="comment"># 为子shell，括号中的执行结束后，再管道</span></div><div class="line">[root@centos7 ~]<span class="comment"># (date;who)|wc -l</span></div><div class="line">2</div><div class="line"></div><div class="line">[root@centos7 ~]<span class="comment"># date;who</span></div><div class="line">Thu Aug  3 21:49:04 CST 2017</div><div class="line">root     pts/0        2017-08-03 21:28 (192.168.2.1)</div></pre></td></tr></table></figure>
<h3 id="Bash中的算术运算和逻辑运算"><a href="#Bash中的算术运算和逻辑运算" class="headerlink" title="Bash中的算术运算和逻辑运算"></a>Bash中的算术运算和逻辑运算</h3><h4 id="算术运算"><a href="#算术运算" class="headerlink" title="算术运算"></a>算术运算</h4><p>★ bash中的算术运算<br>&ensp;&ensp;&ensp;&ensp;bash会对数字执行隐式的类型转化<br>☉运算操作符<br>&ensp;&ensp;&ensp;&ensp;+，-， <em>， /， % 取模（取余）, **（乘方）<br>☉bash的算术运算的实现方式（格式）<br>&ensp;&ensp;&ensp;&ensp;let VAR=算术运算表达式（查看结果echo $VAR）<br>&ensp;&ensp;&ensp;&ensp;VAR=$[算术运算表达式] （可以变量赋值也可以直接写算术表达式，如：echo $[5+6]）<br>&ensp;&ensp;&ensp;&ensp;VAR=$((算术运算表达式))  （同上）<br>&ensp;&ensp;&ensp;&ensp;VAR=$(expr $ARG1 $OP $ARG2)<br>注意：<br>&ensp;&ensp;&ensp;&ensp;乘法符号在有些场景中需要转义<br>★ bash中有内建的随机数生成器<br>&ensp;&ensp;&ensp;&ensp;$RANDOM（1-32767）<br>&ensp;&ensp;&ensp;&ensp;示例：echo $[$RANDOM%50] ：0-49之间随机数<br>★ 赋值<br>☉增强型赋值：<br>&ensp;&ensp;&ensp;&ensp;变量做某种算数运算后回存至此变量中；<br>&ensp;&ensp;&ensp;&ensp;+=, -=, </em>=, /=, %=<br>&ensp;&ensp;&ensp;&ensp;使用方法：let varOPEvalue<br>示例：<br>&ensp;&ensp;&ensp;&ensp;let count+=3 即 count=count+3<br>☉自增自减<br>&ensp;&ensp;&ensp;&ensp;var=$[$var+1]<br>&ensp;&ensp;&ensp;&ensp;let var+=1 即 let var++<br>&ensp;&ensp;&ensp;&ensp;let var-=1 即 let var–</p>
<h4 id="演示：-5"><a href="#演示：-5" class="headerlink" title="演示："></a>演示：</h4><p>1.let VAR=算术表达式<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">[root@centos7 ~]<span class="comment"># let var=5+6</span></div><div class="line">[root@centos7 ~]<span class="comment"># echo $var</span></div><div class="line">11</div><div class="line">[root@centos7 ~]<span class="comment"># num1=2</span></div><div class="line">[root@centos7 ~]<span class="comment"># num2=5</span></div><div class="line">[root@centos7 ~]<span class="comment"># let var=$num1+$num2</span></div><div class="line">[root@centos7 ~]<span class="comment"># echo $var</span></div><div class="line">7</div></pre></td></tr></table></figure></p>
<ol>
<li>var=$[算术表达式] ， var=$((算术表达式))<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"> [root@centos7 ~]<span class="comment"># num1=2</span></div><div class="line">[root@centos7 ~]<span class="comment"># num2=5</span></div><div class="line">[root@centos7 ~]<span class="comment"># echo $[$num1+$num2]</span></div><div class="line">7</div><div class="line">[root@centos7 ~]<span class="comment"># echo $((5+6))</span></div><div class="line">11</div><div class="line">[root@centos7 ~]<span class="comment"># num=$[2**3]</span></div><div class="line">[root@centos7 ~]<span class="comment"># echo $num</span></div><div class="line">8</div><div class="line">[root@centos7 ~]<span class="comment"># echo $[2**3]</span></div><div class="line">8</div></pre></td></tr></table></figure>
</li>
</ol>
<p>3.VAR=$(expr $ARG1 $OP $ARG2)<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">[root@centos7 ~]<span class="comment"># num1=2</span></div><div class="line">[root@centos7 ~]<span class="comment"># num2=3</span></div><div class="line">[root@centos7 ~]<span class="comment"># expr $num1 + $num2</span></div><div class="line">5</div><div class="line">[root@centos7 ~]<span class="comment"># sum=$(expr $num1 + $num2)    #为命令引用，注意空格</span></div><div class="line">[root@centos7 ~]<span class="comment"># echo $sum</span></div><div class="line">5</div><div class="line">[root@centos7 ~]<span class="comment"># expr 5 + 6</span></div><div class="line">11</div></pre></td></tr></table></figure></p>
<p>4.declare –i var= 数值（提前声明为数字的整数类型）<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 声明一个数字的整数类型，然后再运算</span></div><div class="line">[root@centos7 ~]<span class="comment"># declare -i i=100</span></div><div class="line">[root@centos7 ~]<span class="comment"># declare -i j=200</span></div><div class="line">[root@centos7 ~]<span class="comment"># declare -i k=i+j</span></div><div class="line">[root@centos7 ~]<span class="comment"># echo $k</span></div><div class="line">300</div></pre></td></tr></table></figure></p>
<p>5.echo ‘算术表达式’ | bc<br><img src="\images\bash\算术表达式.png" alt="bash"><br>6.echo $[$RANDOM%6] ：0-5之间随机数<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">[root@centos7 ~]<span class="comment"># echo $[RANDOM%6]</span></div><div class="line">4</div><div class="line">[root@centos7 ~]<span class="comment"># echo $[RANDOM%6]</span></div><div class="line">4</div><div class="line">[root@centos7 ~]<span class="comment"># echo $[RANDOM%6]</span></div><div class="line">1</div><div class="line">[root@centos7 ~]<span class="comment"># echo $[RANDOM%6]</span></div><div class="line">0</div><div class="line">[root@centos7 ~]<span class="comment"># echo $[RANDOM%6]</span></div><div class="line">1</div><div class="line">[root@centos7 ~]<span class="comment"># echo $[RANDOM%6]</span></div><div class="line">5</div><div class="line">[root@centos7 ~]<span class="comment"># echo $[RANDOM%6]</span></div><div class="line">3</div><div class="line">[root@centos7 ~]<span class="comment"># echo $[RANDOM%6]</span></div><div class="line">5</div><div class="line">[root@centos7 ~]<span class="comment"># echo $[RANDOM%6]</span></div><div class="line">1</div><div class="line"></div><div class="line"><span class="comment"># 表示1-6</span></div><div class="line">[root@centos7 ~]<span class="comment"># echo $[RANDOM%6+1]</span></div><div class="line">5</div><div class="line">[root@centos7 ~]<span class="comment"># echo $[RANDOM%6+1]</span></div><div class="line">3</div><div class="line">[root@centos7 ~]<span class="comment"># echo $[RANDOM%6+1]</span></div><div class="line">1</div><div class="line">[root@centos7 ~]<span class="comment"># echo $[RANDOM%6+1]</span></div><div class="line">6</div><div class="line">[root@centos7 ~]<span class="comment"># echo $[RANDOM%6+1]</span></div><div class="line">1</div><div class="line">[root@centos7 ~]<span class="comment"># echo $[RANDOM%6+1]</span></div><div class="line">5</div><div class="line">[root@centos7 ~]<span class="comment"># echo $[RANDOM%6+1]</span></div><div class="line">4</div><div class="line">[root@centos7 ~]<span class="comment"># echo $[RANDOM%6+1]</span></div><div class="line">6</div><div class="line">[root@centos7 ~]<span class="comment"># echo $[RANDOM%6+1]</span></div><div class="line">3</div></pre></td></tr></table></figure></p>
<p>7.增强型赋值<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">[root@centos7 ~]<span class="comment"># let var=2+3</span></div><div class="line">[root@centos7 ~]<span class="comment"># echo $var</span></div><div class="line">5</div><div class="line">[root@centos7 ~]<span class="comment"># let var+=2</span></div><div class="line">[root@centos7 ~]<span class="comment"># echo $var</span></div><div class="line">7</div><div class="line">[root@centos7 ~]<span class="comment"># let var+=1</span></div><div class="line">[root@centos7 ~]<span class="comment"># echo $var</span></div><div class="line">8</div><div class="line">[root@centos7 ~]<span class="comment"># var=$[$var+1]</span></div><div class="line">[root@centos7 ~]<span class="comment"># echo $var</span></div><div class="line">9</div></pre></td></tr></table></figure></p>
<h3 id="逻辑运算"><a href="#逻辑运算" class="headerlink" title="逻辑运算"></a>逻辑运算</h3><p>★ bash中的逻辑运算<br>&ensp;&ensp;&ensp;&ensp;在shell编程当中支持一些逻辑运算：true（1），false（0）<br>☉与运算<br>&ensp;&ensp;&ensp;&ensp;1 &amp;&amp; 1 = 1<br>&ensp;&ensp;&ensp;&ensp;1 &amp;&amp; 0 = 0<br>&ensp;&ensp;&ensp;&ensp;0 &amp;&amp; 1 = 0<br>&ensp;&ensp;&ensp;&ensp;0 &amp;&amp; 0 = 0<br>☉或运算<br>&ensp;&ensp;&ensp;&ensp;1 || 1 = 1<br>&ensp;&ensp;&ensp;&ensp;1 || 0 = 1<br>&ensp;&ensp;&ensp;&ensp;0 || 1 = 1<br>&ensp;&ensp;&ensp;&ensp;0 || 0 = 0<br>☉非运算<br>&ensp;&ensp;&ensp;&ensp;! 1 =0<br>&ensp;&ensp;&ensp;&ensp;! 0 =1<br>★ 短路法则<br>☉短路与（&amp;&amp;）：COMMAND1 &amp;&amp; COMMAND2<br>&ensp;&ensp;&ensp;&ensp;第一个为0，结果必定为0；<br>&ensp;&ensp;&ensp;&ensp;第一个为1，第二个必须要参与运算；<br>&ensp;&ensp;&ensp;&ensp;COMMAND1为假，则COMMAND2不会再执行；<br>&ensp;&ensp;&ensp;&ensp;否则，COMMAND1为真，则COMMAND2必须执行；<br>☉短路或（||）：COMMAND1 || COMMAND2<br>&ensp;&ensp;&ensp;&ensp;第一个为1，结果必定为1；<br>&ensp;&ensp;&ensp;&ensp;第一个为0，第二个必须要参与运算；<br>&ensp;&ensp;&ensp;&ensp;COMMAND1为“真”，则COMMAND2不会再执行；<br>&ensp;&ensp;&ensp;&ensp;否则，COMMAND1为“假”，则COMMAND2必须执行；<br>☉异或：^<br>&ensp;&ensp;&ensp;&ensp;异或的两个值,相同为假，不同为真<br>示例：<br>&ensp;&ensp;&ensp;&ensp;~]# id $username || useradd $username  如果用户不存在就创建，存在就显示id信息</p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color5">shell脚本编程</a>
        		</li>
      		
		</ul>
	</div>

      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/2017/06/20/linux之shell脚本编程-基础篇(一)/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>





  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/page/8/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><a class="page-number" href="/page/8/">8</a><span class="page-number current">9</span><a class="page-number" href="/page/10/">10</a><a class="page-number" href="/page/11/">11</a><a class="page-number" href="/page/12/">12</a><a class="extend next" rel="next" href="/page/10/">Next &raquo;</a>
    </nav>
  


          </div>
        </div>
      </div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2018 Jack_zhou
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    <script>
	var yiliaConfig = {
		mathjax: false,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false,
		root: "/",
		innerArchive: true,
		showTags: false
	}
</script>

<script>!function(t){function n(r){if(e[r])return e[r].exports;var o=e[r]={exports:{},id:r,loaded:!1};return t[r].call(o.exports,o,o.exports,n),o.loaded=!0,o.exports}var e={};return n.m=t,n.c=e,n.p="./",n(0)}([function(t,n,e){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t,n){var e=/\/|index.html/g;return t.replace(e,"")===n.replace(e,"")}function i(){for(var t=document.querySelectorAll(".js-header-menu li a"),n=window.location.pathname,e=0,r=t.length;e<r;e++){var i=t[e];o(n,i.getAttribute("href"))&&(0,d.default)(i,"active")}}function u(t){for(var n=t.offsetLeft,e=t.offsetParent;null!==e;)n+=e.offsetLeft,e=e.offsetParent;return n}function f(t){for(var n=t.offsetTop,e=t.offsetParent;null!==e;)n+=e.offsetTop,e=e.offsetParent;return n}function c(t,n,e,r,o){var i=u(t),c=f(t)-n;if(c-e<=o){var a=t.$newDom;a||(a=t.cloneNode(!0),(0,h.default)(t,a),t.$newDom=a,a.style.position="fixed",a.style.top=(e||c)+"px",a.style.left=i+"px",a.style.zIndex=r||2,a.style.width="100%",a.style.color="#fff"),a.style.visibility="visible",t.style.visibility="hidden"}else{t.style.visibility="visible";var s=t.$newDom;s&&(s.style.visibility="hidden")}}function a(){var t=document.querySelector(".js-overlay"),n=document.querySelector(".js-header-menu");c(t,document.body.scrollTop,-63,2,0),c(n,document.body.scrollTop,1,3,0)}function s(){document.querySelector("#container").addEventListener("scroll",function(t){a()}),window.addEventListener("scroll",function(t){a()}),a()}function l(){x.default.versions.mobile&&window.screen.width<800&&(i(),s())}var p=e(71),d=r(p),v=e(72),y=(r(v),e(84)),h=r(y),b=e(69),x=r(b),g=e(75),m=r(g),w=e(70);l(),(0,w.addLoadEvent)(function(){m.default.init()}),t.exports={}},function(t,n){var e=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=e)},function(t,n){var e={}.hasOwnProperty;t.exports=function(t,n){return e.call(t,n)}},function(t,n,e){var r=e(49),o=e(15);t.exports=function(t){return r(o(t))}},function(t,n,e){t.exports=!e(8)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(t,n,e){var r=e(6),o=e(12);t.exports=e(4)?function(t,n,e){return r.f(t,n,o(1,e))}:function(t,n,e){return t[n]=e,t}},function(t,n,e){var r=e(10),o=e(30),i=e(24),u=Object.defineProperty;n.f=e(4)?Object.defineProperty:function(t,n,e){if(r(t),n=i(n,!0),r(e),o)try{return u(t,n,e)}catch(t){}if("get"in e||"set"in e)throw TypeError("Accessors not supported!");return"value"in e&&(t[n]=e.value),t}},function(t,n,e){var r=e(22)("wks"),o=e(13),i=e(1).Symbol,u="function"==typeof i,f=t.exports=function(t){return r[t]||(r[t]=u&&i[t]||(u?i:o)("Symbol."+t))};f.store=r},function(t,n){t.exports=function(t){try{return!!t()}catch(t){return!0}}},function(t,n,e){var r=e(35),o=e(16);t.exports=Object.keys||function(t){return r(t,o)}},function(t,n,e){var r=e(11);t.exports=function(t){if(!r(t))throw TypeError(t+" is not an object!");return t}},function(t,n){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},function(t,n){t.exports=function(t,n){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:n}}},function(t,n){var e=0,r=Math.random();t.exports=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++e+r).toString(36))}},function(t,n){var e=t.exports={version:"2.4.0"};"number"==typeof __e&&(__e=e)},function(t,n){t.exports=function(t){if(void 0==t)throw TypeError("Can't call method on  "+t);return t}},function(t,n){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(t,n){t.exports={}},function(t,n){t.exports=!0},function(t,n){n.f={}.propertyIsEnumerable},function(t,n,e){var r=e(6).f,o=e(2),i=e(7)("toStringTag");t.exports=function(t,n,e){t&&!o(t=e?t:t.prototype,i)&&r(t,i,{configurable:!0,value:n})}},function(t,n,e){var r=e(22)("keys"),o=e(13);t.exports=function(t){return r[t]||(r[t]=o(t))}},function(t,n,e){var r=e(1),o="__core-js_shared__",i=r[o]||(r[o]={});t.exports=function(t){return i[t]||(i[t]={})}},function(t,n){var e=Math.ceil,r=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(t>0?r:e)(t)}},function(t,n,e){var r=e(11);t.exports=function(t,n){if(!r(t))return t;var e,o;if(n&&"function"==typeof(e=t.toString)&&!r(o=e.call(t)))return o;if("function"==typeof(e=t.valueOf)&&!r(o=e.call(t)))return o;if(!n&&"function"==typeof(e=t.toString)&&!r(o=e.call(t)))return o;throw TypeError("Can't convert object to primitive value")}},function(t,n,e){var r=e(1),o=e(14),i=e(18),u=e(26),f=e(6).f;t.exports=function(t){var n=o.Symbol||(o.Symbol=i?{}:r.Symbol||{});"_"==t.charAt(0)||t in n||f(n,t,{value:u.f(t)})}},function(t,n,e){n.f=e(7)},function(t,n,e){var r=e(1),o=e(14),i=e(46),u=e(5),f="prototype",c=function(t,n,e){var a,s,l,p=t&c.F,d=t&c.G,v=t&c.S,y=t&c.P,h=t&c.B,b=t&c.W,x=d?o:o[n]||(o[n]={}),g=x[f],m=d?r:v?r[n]:(r[n]||{})[f];d&&(e=n);for(a in e)s=!p&&m&&void 0!==m[a],s&&a in x||(l=s?m[a]:e[a],x[a]=d&&"function"!=typeof m[a]?e[a]:h&&s?i(l,r):b&&m[a]==l?function(t){var n=function(n,e,r){if(this instanceof t){switch(arguments.length){case 0:return new t;case 1:return new t(n);case 2:return new t(n,e)}return new t(n,e,r)}return t.apply(this,arguments)};return n[f]=t[f],n}(l):y&&"function"==typeof l?i(Function.call,l):l,y&&((x.virtual||(x.virtual={}))[a]=l,t&c.R&&g&&!g[a]&&u(g,a,l)))};c.F=1,c.G=2,c.S=4,c.P=8,c.B=16,c.W=32,c.U=64,c.R=128,t.exports=c},function(t,n){var e={}.toString;t.exports=function(t){return e.call(t).slice(8,-1)}},function(t,n,e){var r=e(11),o=e(1).document,i=r(o)&&r(o.createElement);t.exports=function(t){return i?o.createElement(t):{}}},function(t,n,e){t.exports=!e(4)&&!e(8)(function(){return 7!=Object.defineProperty(e(29)("div"),"a",{get:function(){return 7}}).a})},function(t,n,e){"use strict";var r=e(18),o=e(27),i=e(36),u=e(5),f=e(2),c=e(17),a=e(51),s=e(20),l=e(58),p=e(7)("iterator"),d=!([].keys&&"next"in[].keys()),v="@@iterator",y="keys",h="values",b=function(){return this};t.exports=function(t,n,e,x,g,m,w){a(e,n,x);var O,S,_,j=function(t){if(!d&&t in A)return A[t];switch(t){case y:return function(){return new e(this,t)};case h:return function(){return new e(this,t)}}return function(){return new e(this,t)}},P=n+" Iterator",E=g==h,M=!1,A=t.prototype,T=A[p]||A[v]||g&&A[g],L=T||j(g),N=g?E?j("entries"):L:void 0,C="Array"==n?A.entries||T:T;if(C&&(_=l(C.call(new t)),_!==Object.prototype&&(s(_,P,!0),r||f(_,p)||u(_,p,b))),E&&T&&T.name!==h&&(M=!0,L=function(){return T.call(this)}),r&&!w||!d&&!M&&A[p]||u(A,p,L),c[n]=L,c[P]=b,g)if(O={values:E?L:j(h),keys:m?L:j(y),entries:N},w)for(S in O)S in A||i(A,S,O[S]);else o(o.P+o.F*(d||M),n,O);return O}},function(t,n,e){var r=e(10),o=e(55),i=e(16),u=e(21)("IE_PROTO"),f=function(){},c="prototype",a=function(){var t,n=e(29)("iframe"),r=i.length,o="<",u=">";for(n.style.display="none",e(48).appendChild(n),n.src="javascript:",t=n.contentWindow.document,t.open(),t.write(o+"script"+u+"document.F=Object"+o+"/script"+u),t.close(),a=t.F;r--;)delete a[c][i[r]];return a()};t.exports=Object.create||function(t,n){var e;return null!==t?(f[c]=r(t),e=new f,f[c]=null,e[u]=t):e=a(),void 0===n?e:o(e,n)}},function(t,n,e){var r=e(35),o=e(16).concat("length","prototype");n.f=Object.getOwnPropertyNames||function(t){return r(t,o)}},function(t,n){n.f=Object.getOwnPropertySymbols},function(t,n,e){var r=e(2),o=e(3),i=e(45)(!1),u=e(21)("IE_PROTO");t.exports=function(t,n){var e,f=o(t),c=0,a=[];for(e in f)e!=u&&r(f,e)&&a.push(e);for(;n.length>c;)r(f,e=n[c++])&&(~i(a,e)||a.push(e));return a}},function(t,n,e){t.exports=e(5)},function(t,n,e){var r=e(15);t.exports=function(t){return Object(r(t))}},function(t,n,e){t.exports={default:e(41),__esModule:!0}},function(t,n,e){t.exports={default:e(42),__esModule:!0}},function(t,n,e){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}n.__esModule=!0;var o=e(39),i=r(o),u=e(38),f=r(u),c="function"==typeof f.default&&"symbol"==typeof i.default?function(t){return typeof t}:function(t){return t&&"function"==typeof f.default&&t.constructor===f.default&&t!==f.default.prototype?"symbol":typeof t};n.default="function"==typeof f.default&&"symbol"===c(i.default)?function(t){return"undefined"==typeof t?"undefined":c(t)}:function(t){return t&&"function"==typeof f.default&&t.constructor===f.default&&t!==f.default.prototype?"symbol":"undefined"==typeof t?"undefined":c(t)}},function(t,n,e){e(65),e(63),e(66),e(67),t.exports=e(14).Symbol},function(t,n,e){e(64),e(68),t.exports=e(26).f("iterator")},function(t,n){t.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},function(t,n){t.exports=function(){}},function(t,n,e){var r=e(3),o=e(61),i=e(60);t.exports=function(t){return function(n,e,u){var f,c=r(n),a=o(c.length),s=i(u,a);if(t&&e!=e){for(;a>s;)if(f=c[s++],f!=f)return!0}else for(;a>s;s++)if((t||s in c)&&c[s]===e)return t||s||0;return!t&&-1}}},function(t,n,e){var r=e(43);t.exports=function(t,n,e){if(r(t),void 0===n)return t;switch(e){case 1:return function(e){return t.call(n,e)};case 2:return function(e,r){return t.call(n,e,r)};case 3:return function(e,r,o){return t.call(n,e,r,o)}}return function(){return t.apply(n,arguments)}}},function(t,n,e){var r=e(9),o=e(34),i=e(19);t.exports=function(t){var n=r(t),e=o.f;if(e)for(var u,f=e(t),c=i.f,a=0;f.length>a;)c.call(t,u=f[a++])&&n.push(u);return n}},function(t,n,e){t.exports=e(1).document&&document.documentElement},function(t,n,e){var r=e(28);t.exports=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==r(t)?t.split(""):Object(t)}},function(t,n,e){var r=e(28);t.exports=Array.isArray||function(t){return"Array"==r(t)}},function(t,n,e){"use strict";var r=e(32),o=e(12),i=e(20),u={};e(5)(u,e(7)("iterator"),function(){return this}),t.exports=function(t,n,e){t.prototype=r(u,{next:o(1,e)}),i(t,n+" Iterator")}},function(t,n){t.exports=function(t,n){return{value:n,done:!!t}}},function(t,n,e){var r=e(9),o=e(3);t.exports=function(t,n){for(var e,i=o(t),u=r(i),f=u.length,c=0;f>c;)if(i[e=u[c++]]===n)return e}},function(t,n,e){var r=e(13)("meta"),o=e(11),i=e(2),u=e(6).f,f=0,c=Object.isExtensible||function(){return!0},a=!e(8)(function(){return c(Object.preventExtensions({}))}),s=function(t){u(t,r,{value:{i:"O"+ ++f,w:{}}})},l=function(t,n){if(!o(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!i(t,r)){if(!c(t))return"F";if(!n)return"E";s(t)}return t[r].i},p=function(t,n){if(!i(t,r)){if(!c(t))return!0;if(!n)return!1;s(t)}return t[r].w},d=function(t){return a&&v.NEED&&c(t)&&!i(t,r)&&s(t),t},v=t.exports={KEY:r,NEED:!1,fastKey:l,getWeak:p,onFreeze:d}},function(t,n,e){var r=e(6),o=e(10),i=e(9);t.exports=e(4)?Object.defineProperties:function(t,n){o(t);for(var e,u=i(n),f=u.length,c=0;f>c;)r.f(t,e=u[c++],n[e]);return t}},function(t,n,e){var r=e(19),o=e(12),i=e(3),u=e(24),f=e(2),c=e(30),a=Object.getOwnPropertyDescriptor;n.f=e(4)?a:function(t,n){if(t=i(t),n=u(n,!0),c)try{return a(t,n)}catch(t){}if(f(t,n))return o(!r.f.call(t,n),t[n])}},function(t,n,e){var r=e(3),o=e(33).f,i={}.toString,u="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],f=function(t){try{return o(t)}catch(t){return u.slice()}};t.exports.f=function(t){return u&&"[object Window]"==i.call(t)?f(t):o(r(t))}},function(t,n,e){var r=e(2),o=e(37),i=e(21)("IE_PROTO"),u=Object.prototype;t.exports=Object.getPrototypeOf||function(t){return t=o(t),r(t,i)?t[i]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?u:null}},function(t,n,e){var r=e(23),o=e(15);t.exports=function(t){return function(n,e){var i,u,f=String(o(n)),c=r(e),a=f.length;return c<0||c>=a?t?"":void 0:(i=f.charCodeAt(c),i<55296||i>56319||c+1===a||(u=f.charCodeAt(c+1))<56320||u>57343?t?f.charAt(c):i:t?f.slice(c,c+2):(i-55296<<10)+(u-56320)+65536)}}},function(t,n,e){var r=e(23),o=Math.max,i=Math.min;t.exports=function(t,n){return t=r(t),t<0?o(t+n,0):i(t,n)}},function(t,n,e){var r=e(23),o=Math.min;t.exports=function(t){return t>0?o(r(t),9007199254740991):0}},function(t,n,e){"use strict";var r=e(44),o=e(52),i=e(17),u=e(3);t.exports=e(31)(Array,"Array",function(t,n){this._t=u(t),this._i=0,this._k=n},function(){var t=this._t,n=this._k,e=this._i++;return!t||e>=t.length?(this._t=void 0,o(1)):"keys"==n?o(0,e):"values"==n?o(0,t[e]):o(0,[e,t[e]])},"values"),i.Arguments=i.Array,r("keys"),r("values"),r("entries")},function(t,n){},function(t,n,e){"use strict";var r=e(59)(!0);e(31)(String,"String",function(t){this._t=String(t),this._i=0},function(){var t,n=this._t,e=this._i;return e>=n.length?{value:void 0,done:!0}:(t=r(n,e),this._i+=t.length,{value:t,done:!1})})},function(t,n,e){"use strict";var r=e(1),o=e(2),i=e(4),u=e(27),f=e(36),c=e(54).KEY,a=e(8),s=e(22),l=e(20),p=e(13),d=e(7),v=e(26),y=e(25),h=e(53),b=e(47),x=e(50),g=e(10),m=e(3),w=e(24),O=e(12),S=e(32),_=e(57),j=e(56),P=e(6),E=e(9),M=j.f,A=P.f,T=_.f,L=r.Symbol,N=r.JSON,C=N&&N.stringify,k="prototype",F=d("_hidden"),q=d("toPrimitive"),I={}.propertyIsEnumerable,B=s("symbol-registry"),D=s("symbols"),W=s("op-symbols"),H=Object[k],K="function"==typeof L,R=r.QObject,J=!R||!R[k]||!R[k].findChild,U=i&&a(function(){return 7!=S(A({},"a",{get:function(){return A(this,"a",{value:7}).a}})).a})?function(t,n,e){var r=M(H,n);r&&delete H[n],A(t,n,e),r&&t!==H&&A(H,n,r)}:A,G=function(t){var n=D[t]=S(L[k]);return n._k=t,n},$=K&&"symbol"==typeof L.iterator?function(t){return"symbol"==typeof t}:function(t){return t instanceof L},z=function(t,n,e){return t===H&&z(W,n,e),g(t),n=w(n,!0),g(e),o(D,n)?(e.enumerable?(o(t,F)&&t[F][n]&&(t[F][n]=!1),e=S(e,{enumerable:O(0,!1)})):(o(t,F)||A(t,F,O(1,{})),t[F][n]=!0),U(t,n,e)):A(t,n,e)},Y=function(t,n){g(t);for(var e,r=b(n=m(n)),o=0,i=r.length;i>o;)z(t,e=r[o++],n[e]);return t},Q=function(t,n){return void 0===n?S(t):Y(S(t),n)},X=function(t){var n=I.call(this,t=w(t,!0));return!(this===H&&o(D,t)&&!o(W,t))&&(!(n||!o(this,t)||!o(D,t)||o(this,F)&&this[F][t])||n)},V=function(t,n){if(t=m(t),n=w(n,!0),t!==H||!o(D,n)||o(W,n)){var e=M(t,n);return!e||!o(D,n)||o(t,F)&&t[F][n]||(e.enumerable=!0),e}},Z=function(t){for(var n,e=T(m(t)),r=[],i=0;e.length>i;)o(D,n=e[i++])||n==F||n==c||r.push(n);return r},tt=function(t){for(var n,e=t===H,r=T(e?W:m(t)),i=[],u=0;r.length>u;)!o(D,n=r[u++])||e&&!o(H,n)||i.push(D[n]);return i};K||(L=function(){if(this instanceof L)throw TypeError("Symbol is not a constructor!");var t=p(arguments.length>0?arguments[0]:void 0),n=function(e){this===H&&n.call(W,e),o(this,F)&&o(this[F],t)&&(this[F][t]=!1),U(this,t,O(1,e))};return i&&J&&U(H,t,{configurable:!0,set:n}),G(t)},f(L[k],"toString",function(){return this._k}),j.f=V,P.f=z,e(33).f=_.f=Z,e(19).f=X,e(34).f=tt,i&&!e(18)&&f(H,"propertyIsEnumerable",X,!0),v.f=function(t){return G(d(t))}),u(u.G+u.W+u.F*!K,{Symbol:L});for(var nt="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),et=0;nt.length>et;)d(nt[et++]);for(var nt=E(d.store),et=0;nt.length>et;)y(nt[et++]);u(u.S+u.F*!K,"Symbol",{for:function(t){return o(B,t+="")?B[t]:B[t]=L(t)},keyFor:function(t){if($(t))return h(B,t);throw TypeError(t+" is not a symbol!")},useSetter:function(){J=!0},useSimple:function(){J=!1}}),u(u.S+u.F*!K,"Object",{create:Q,defineProperty:z,defineProperties:Y,getOwnPropertyDescriptor:V,getOwnPropertyNames:Z,getOwnPropertySymbols:tt}),N&&u(u.S+u.F*(!K||a(function(){var t=L();return"[null]"!=C([t])||"{}"!=C({a:t})||"{}"!=C(Object(t))})),"JSON",{stringify:function(t){if(void 0!==t&&!$(t)){for(var n,e,r=[t],o=1;arguments.length>o;)r.push(arguments[o++]);return n=r[1],"function"==typeof n&&(e=n),!e&&x(n)||(n=function(t,n){if(e&&(n=e.call(this,t,n)),!$(n))return n}),r[1]=n,C.apply(N,r)}}}),L[k][q]||e(5)(L[k],q,L[k].valueOf),l(L,"Symbol"),l(Math,"Math",!0),l(r.JSON,"JSON",!0)},function(t,n,e){e(25)("asyncIterator")},function(t,n,e){e(25)("observable")},function(t,n,e){e(62);for(var r=e(1),o=e(5),i=e(17),u=e(7)("toStringTag"),f=["NodeList","DOMTokenList","MediaList","StyleSheetList","CSSRuleList"],c=0;c<5;c++){var a=f[c],s=r[a],l=s&&s.prototype;l&&!l[u]&&o(l,u,a),i[a]=i.Array}},function(t,n){"use strict";var e={versions:function(){var t=window.navigator.userAgent;return{trident:t.indexOf("Trident")>-1,presto:t.indexOf("Presto")>-1,webKit:t.indexOf("AppleWebKit")>-1,gecko:t.indexOf("Gecko")>-1&&t.indexOf("KHTML")==-1,mobile:!!t.match(/AppleWebKit.*Mobile.*/),ios:!!t.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:t.indexOf("Android")>-1||t.indexOf("Linux")>-1,iPhone:t.indexOf("iPhone")>-1||t.indexOf("Mac")>-1,iPad:t.indexOf("iPad")>-1,webApp:t.indexOf("Safari")==-1,weixin:t.indexOf("MicroMessenger")==-1}}()};t.exports=e},function(t,n,e){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}var o=e(40),i=r(o),u=function(){function t(t,n,e){return n||e?String.fromCharCode(n||e):o[t]||t}function n(t){return l[t]}var e=/&quot;|&lt;|&gt;|&amp;|&nbsp;|&apos;|&#(\d+);|&#(\d+)/g,r=/['<> "&]/g,o={"&quot;":'"',"&lt;":"<","&gt;":">","&amp;":"&","&nbsp;":" "},f=/\u00a0/g,c=/<br\s*\/?>/gi,a=/\r?\n/g,s=/\s/g,l={};for(var p in o)l[o[p]]=p;return o["&apos;"]="'",l["'"]="&#39;",{encode:function(t){return t?(""+t).replace(r,n).replace(a,"<br/>").replace(s,"&nbsp;"):""},decode:function(n){return n?(""+n).replace(c,"\n").replace(e,t).replace(f," "):""},encodeBase16:function(t){if(!t)return t;t+="";for(var n=[],e=0,r=t.length;r>e;e++)n.push(t.charCodeAt(e).toString(16).toUpperCase());return n.join("")},encodeBase16forJSON:function(t){if(!t)return t;t=t.replace(/[\u4E00-\u9FBF]/gi,function(t){return escape(t).replace("%u","\\u")});for(var n=[],e=0,r=t.length;r>e;e++)n.push(t.charCodeAt(e).toString(16).toUpperCase());return n.join("")},decodeBase16:function(t){if(!t)return t;t+="";for(var n=[],e=0,r=t.length;r>e;e+=2)n.push(String.fromCharCode("0x"+t.slice(e,e+2)));return n.join("")},encodeObject:function(t){if(t instanceof Array)for(var n=0,e=t.length;e>n;n++)t[n]=u.encodeObject(t[n]);else if("object"==("undefined"==typeof t?"undefined":(0,i.default)(t)))for(var r in t)t[r]=u.encodeObject(t[r]);else if("string"==typeof t)return u.encode(t);return t},loadScript:function(t){var n=document.createElement("script");document.getElementsByTagName("body")[0].appendChild(n),n.setAttribute("src",t)},addLoadEvent:function(t){var n=window.onload;"function"!=typeof window.onload?window.onload=t:window.onload=function(){n(),t()}}}}();t.exports=u},function(t,n){function e(t,n){t.classList?t.classList.add(n):t.className+=" "+n}t.exports=e},function(t,n){function e(t,n){if(t.classList)t.classList.remove(n);else{var e=new RegExp("(^|\\b)"+n.split(" ").join("|")+"(\\b|$)","gi");t.className=t.className.replace(e," ")}}t.exports=e},,,function(t,n){"use strict";function e(){var t=document.querySelector("#page-nav");if(t&&!document.querySelector("#page-nav .extend.prev")&&(t.innerHTML='<a class="extend prev disabled" rel="prev">&laquo; Prev</a>'+t.innerHTML),t&&!document.querySelector("#page-nav .extend.next")&&(t.innerHTML=t.innerHTML+'<a class="extend next disabled" rel="next">Next &raquo;</a>'),yiliaConfig&&yiliaConfig.open_in_new){var n=document.querySelectorAll(".article-entry a:not(.article-more-a)");n.forEach(function(t){var n=t.getAttribute("target");n&&""!==n||t.setAttribute("target","_blank")})}var e=document.querySelector("#js-aboutme");e&&0!==e.length&&(e.innerHTML=e.innerText)}t.exports={init:e}},,,,,,,,,function(t,n){function e(t,n){if("string"==typeof n)return t.insertAdjacentHTML("afterend",n);var e=t.nextSibling;return e?t.parentNode.insertBefore(n,e):t.parentNode.appendChild(n)}t.exports=e}])</script><script src="/./main.f6a68c.js"></script><script>!function(){var e=function(e){var t=document.createElement("script");document.getElementsByTagName("body")[0].appendChild(t),t.setAttribute("src",e)};e("/slider.885efe.js")}()</script>


    
<div class="tools-col" q-class="show:isShow,hide:isShow|isFalse" q-on="click:stop(e)">
  <div class="tools-nav header-menu">
    
    
      
      
      
    
      
      
      
    
      
      
      
    
    

    <ul style="width: 70%">
    
    
      
      <li style="width: 33.333333333333336%" q-on="click: openSlider(e, 'innerArchive')"><a href="javascript:void(0)" q-class="active:innerArchive">所有文章</a></li>
      
        
      
      <li style="width: 33.333333333333336%" q-on="click: openSlider(e, 'friends')"><a href="javascript:void(0)" q-class="active:friends">友链</a></li>
      
        
      
      <li style="width: 33.333333333333336%" q-on="click: openSlider(e, 'aboutme')"><a href="javascript:void(0)" q-class="active:aboutme">关于我</a></li>
      
        
    </ul>
  </div>
  <div class="tools-wrap">
    
    	<section class="tools-section tools-section-all" q-show="innerArchive">
        <div class="search-wrap">
          <input class="search-ipt" q-model="search" type="text" placeholder="find something…">
          <i class="icon-search icon" q-show="search|isEmptyStr"></i>
          <i class="icon-close icon" q-show="search|isNotEmptyStr" q-on="click:clearChose(e)"></i>
        </div>
        <div class="widget tagcloud search-tag">
          <p class="search-tag-wording">tag:</p>
          <label class="search-switch">
            <input type="checkbox" q-on="click:toggleTag(e)" q-attr="checked:showTags">
          </label>
          <ul class="article-tag-list" q-show="showTags">
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">linux启动流程</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color2">Docker</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">HAProxy</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">Cluster</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">MariaDB(MySQL)</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color4">NoSQL-MongoDB</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">linux安装</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">Python3</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color1">NoSQL</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color1">TCPIP</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">web services</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">varnish</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">linux服务</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">LAMP</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">command</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color2">kernel</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">shell脚本编程</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color1">压缩和归档</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color4">vim</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">linux中文本处理工具</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color2">liunx文件共享服务</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color4">iptables</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color1">system用户管理</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color2">zabbix</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color1">system系统管理</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color1">软件包管理</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">网络管理</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">计划任务</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">运维工具</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">进程管理</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color2">tomcat</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">MemCached</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color1">Nginx</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color1">分布式存储</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color2">加密解密、数字签名、SSL、CA</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color4">Virtulization</a>
              </li>
            
            <div class="clearfix"></div>
          </ul>
        </div>
        <ul class="search-ul">
          <p q-show="jsonFail" style="padding: 20px; font-size: 12px;">
            缺失模块。<br/>1、请确保node版本大于6.2<br/>2、在博客根目录（注意不是yilia根目录）执行以下命令：<br/> npm i hexo-generator-json-content --save<br/><br/>
            3、在根目录_config.yml里添加配置：
<pre style="font-size: 12px;" q-show="jsonFail">
  jsonContent:
    meta: false
    pages: false
    posts:
      title: true
      date: true
      path: true
      text: false
      raw: false
      content: false
      slug: false
      updated: false
      comments: false
      link: false
      permalink: false
      excerpt: false
      categories: false
      tags: true
</pre>
          </p>
          <li class="search-li" q-repeat="items" q-show="isShow">
            <a q-attr="href:path|urlformat" class="search-title"><i class="icon-quo-left icon"></i><span q-text="title"></span></a>
            <p class="search-time">
              <i class="icon-calendar icon"></i>
              <span q-text="date|dateformat"></span>
            </p>
            <p class="search-tag">
              <i class="icon-price-tags icon"></i>
              <span q-repeat="tags" q-on="click:choseTag(e, name)" q-text="name|tagformat"></span>
            </p>
          </li>
        </ul>
    	</section>
    

    
    	<section class="tools-section tools-section-friends" q-show="friends">
  		
        <ul class="search-ul">
          
            <li class="search-li">
              <a href="http://localhost:4000/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>友情链接1</a>
            </li>
          
            <li class="search-li">
              <a href="http://localhost:4000/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>友情链接2</a>
            </li>
          
            <li class="search-li">
              <a href="http://localhost:4000/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>友情链接3</a>
            </li>
          
            <li class="search-li">
              <a href="http://localhost:4000/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>友情链接4</a>
            </li>
          
            <li class="search-li">
              <a href="http://localhost:4000/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>友情链接5</a>
            </li>
          
            <li class="search-li">
              <a href="http://localhost:4000/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>友情链接6</a>
            </li>
          
        </ul>
  		
    	</section>
    

    
    	<section class="tools-section tools-section-me" q-show="aboutme">
  	  	
  	  		<div class="aboutme-wrap" id="js-aboutme">很惭愧&lt;br&gt;&lt;br&gt;只做了一点微小的工作&lt;br&gt;谢谢大家</div>
  	  	
    	</section>
    
  </div>
  
</div>
    <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>
  </div>
</body>
</html>