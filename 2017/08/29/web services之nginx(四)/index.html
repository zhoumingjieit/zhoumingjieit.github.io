<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <link rel="dns-prefetch" href="http://yoursite.com">
  <title>Nginx进阶四 | Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Nginx相关配置◆Web 架构扩展思路及相关概念（正反向代理、CDN、GLSB和缓存服务器）；◆ngx_http_proxy_module模块；&amp;ensp;&amp;ensp;&amp;ensp;&amp;ensp;·实验：nginx反向代理后端单台web服务器；&amp;ensp;&amp;ensp;&amp;ensp;&amp;ensp;·proxy_set_header field value;&amp;ensp;&amp;ensp;&amp;ensp;&amp;ensp;·">
<meta name="keywords" content="Nginx">
<meta property="og:type" content="article">
<meta property="og:title" content="Nginx进阶四">
<meta property="og:url" content="http://yoursite.com/2017/08/29/web services之nginx(四)/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="Nginx相关配置◆Web 架构扩展思路及相关概念（正反向代理、CDN、GLSB和缓存服务器）；◆ngx_http_proxy_module模块；&amp;ensp;&amp;ensp;&amp;ensp;&amp;ensp;·实验：nginx反向代理后端单台web服务器；&amp;ensp;&amp;ensp;&amp;ensp;&amp;ensp;·proxy_set_header field value;&amp;ensp;&amp;ensp;&amp;ensp;&amp;ensp;·">
<meta property="og:image" content="http://yoursite.com/images/nginx/proxy.jpg">
<meta property="og:image" content="http://yoursite.com/images/nginx/reverse%20proxy.jpg">
<meta property="og:image" content="http://yoursite.com/images/nginx/cdn.jpg">
<meta property="og:image" content="http://yoursite.com/images/nginx/proxy_pass1.png">
<meta property="og:image" content="http://yoursite.com/images/nginx/proxy_pass2.png">
<meta property="og:image" content="http://yoursite.com/images/nginx/proxy_pass3.png">
<meta property="og:image" content="http://yoursite.com/images/nginx/proxy_pass4.png">
<meta property="og:image" content="http://yoursite.com/images/nginx/proxy_pass5.png">
<meta property="og:image" content="http://yoursite.com/images/nginx/proxy_pass6.png">
<meta property="og:image" content="http://yoursite.com/images/nginx/proxy_pass7.png">
<meta property="og:image" content="http://yoursite.com/images/nginx/proxy_pass8.png">
<meta property="og:image" content="http://yoursite.com/images/nginx/proxy_pass9.png">
<meta property="og:image" content="http://yoursite.com/images/nginx/proxy_pass10.png">
<meta property="og:image" content="http://yoursite.com/images/nginx/proxy_pass11.png">
<meta property="og:image" content="http://yoursite.com/images/nginx/proxy_pass12.png">
<meta property="og:image" content="http://yoursite.com/images/nginx/proxy_pass13.png">
<meta property="og:image" content="http://yoursite.com/images/nginx/proxy_pass15.png">
<meta property="og:image" content="http://yoursite.com/images/nginx/proxy_cache.png">
<meta property="og:image" content="http://yoursite.com/images/nginx/proxy_cache1.png">
<meta property="og:image" content="http://yoursite.com/images/nginx/proxy_cache2.png">
<meta property="og:image" content="http://yoursite.com/images/nginx/nginx-http-header.png">
<meta property="og:image" content="http://yoursite.com/images/nginx/nginx-http-header1.png">
<meta property="og:image" content="http://yoursite.com/images/nginx/nginx-reverse.png">
<meta property="og:image" content="http://yoursite.com/images/nginx/nginx-upstream.png">
<meta property="og:image" content="http://yoursite.com/images/nginx/nginx-upstream1.png">
<meta property="og:image" content="http://yoursite.com/images/nginx/nginx-upstream2.png">
<meta property="og:image" content="http://yoursite.com/images/nginx/nginx-upstream3.png">
<meta property="og:image" content="http://yoursite.com/images/nginx/nginx-upstream4.png">
<meta property="og:image" content="http://yoursite.com/images/nginx/nginx-upstream5.png">
<meta property="og:image" content="http://yoursite.com/images/nginx/nginx-upstream-hash.png">
<meta property="og:image" content="http://yoursite.com/images/nginx/nginx-upstream-hash1.png">
<meta property="og:image" content="http://yoursite.com/images/nginx/nginx-upstream-hash2.png">
<meta property="og:image" content="http://yoursite.com/images/nginx/nginx-stream.png">
<meta property="og:updated_time" content="2017-09-16T07:02:12.526Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Nginx进阶四">
<meta name="twitter:description" content="Nginx相关配置◆Web 架构扩展思路及相关概念（正反向代理、CDN、GLSB和缓存服务器）；◆ngx_http_proxy_module模块；&amp;ensp;&amp;ensp;&amp;ensp;&amp;ensp;·实验：nginx反向代理后端单台web服务器；&amp;ensp;&amp;ensp;&amp;ensp;&amp;ensp;·proxy_set_header field value;&amp;ensp;&amp;ensp;&amp;ensp;&amp;ensp;·">
<meta name="twitter:image" content="http://yoursite.com/images/nginx/proxy.jpg">
  
    <link rel="alternative" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" type="text/css" href="/./main.f6a68c.css">
  <style type="text/css">
  
    #container.show {
      background: linear-gradient(200deg,#a0cfe4,#e8c37e);
    }
  </style>
  

  

</head>

<body>
  <div id="container" q-class="show:isCtnShow">
    <canvas id="anm-canvas" class="anm-canvas"></canvas>
    <div class="left-col" q-class="show:isShow">
      
<div class="overlay" style="background: #4d4d4d"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			<img src="/images/avatar.png" class="js-avatar">
		</a>
		<hgroup>
		  <h1 class="header-author"><a href="/">Jack_zhou</a></h1>
		</hgroup>
		

		<nav class="header-menu">
			<ul>
			
				<li><a href="/">主页</a></li>
	        
				<li><a href="/tags/随笔/">随笔</a></li>
	        
			</ul>
		</nav>
		<nav class="header-smart-menu">
    		
    			
    			<a q-on="click: openSlider(e, 'innerArchive')" href="javascript:void(0)">所有文章</a>
    			
            
    			
    			<a q-on="click: openSlider(e, 'friends')" href="javascript:void(0)">友链</a>
    			
            
    			
    			<a q-on="click: openSlider(e, 'aboutme')" href="javascript:void(0)">关于我</a>
    			
            
		</nav>
		<nav class="header-nav">
			<div class="social">
				
					<a class="github" target="_blank" href="#" title="github"><i class="icon-github"></i></a>
		        
					<a class="weibo" target="_blank" href="#" title="weibo"><i class="icon-weibo"></i></a>
		        
					<a class="rss" target="_blank" href="#" title="rss"><i class="icon-rss"></i></a>
		        
					<a class="zhihu" target="_blank" href="#" title="zhihu"><i class="icon-zhihu"></i></a>
		        
			</div>
		</nav>
	</header>		
</div>

    </div>
    <div class="mid-col" q-class="show:isShow,hide:isShow|isFalse">
      
<nav id="mobile-nav">
  	<div class="overlay js-overlay" style="background: #4d4d4d"></div>
	<div class="btnctn js-mobile-btnctn">
  		<div class="slider-trigger list" q-on="click: openSlider(e)"><i class="icon icon-sort"></i></div>
	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img src="/images/avatar.png" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author js-header-author">Jack_zhou</h1>
			</hgroup>
			
			
			
				
			
				
			
			
			
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="#" title="github"><i class="icon-github"></i></a>
			        
						<a class="weibo" target="_blank" href="#" title="weibo"><i class="icon-weibo"></i></a>
			        
						<a class="rss" target="_blank" href="#" title="rss"><i class="icon-rss"></i></a>
			        
						<a class="zhihu" target="_blank" href="#" title="zhihu"><i class="icon-zhihu"></i></a>
			        
				</div>
			</nav>

			<nav class="header-menu js-header-menu">
				<ul style="width: 50%">
				
				
					<li style="width: 50%"><a href="/">主页</a></li>
		        
					<li style="width: 50%"><a href="/tags/随笔/">随笔</a></li>
		        
				</ul>
			</nav>
		</header>				
	</div>
	<div class="mobile-mask" style="display:none" q-show="isShow"></div>
</nav>

      <div id="wrapper" class="body-wrap">
        <div class="menu-l">
          <div class="canvas-wrap">
            <canvas data-colors="#eaeaea" data-sectionHeight="100" data-contentId="js-content" id="myCanvas1" class="anm-canvas"></canvas>
          </div>
          <div id="js-content" class="content-ll">
            <article id="post-web services之nginx(四)" class="article article-type-post " itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Nginx进阶四
    </h1>
  

        
        <a href="/2017/08/29/web services之nginx(四)/" class="archive-article-date">
  	<time datetime="2017-08-29T01:00:22.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2017-08-29</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="Nginx相关配置"><a href="#Nginx相关配置" class="headerlink" title="Nginx相关配置"></a>Nginx相关配置</h3><p>◆Web 架构扩展思路及相关概念（正反向代理、CDN、GLSB和缓存服务器）；<br>◆ngx_http_proxy_module模块；<br>&ensp;&ensp;&ensp;&ensp;·实验：nginx反向代理后端单台web服务器；<br>&ensp;&ensp;&ensp;&ensp;·proxy_set_header field value;<br>&ensp;&ensp;&ensp;&ensp;·proxy的缓存，及实验定制调用缓存机制；<br>◆ngx_http_upstream_module模块<br>&ensp;&ensp;&ensp;&ensp;·实验：定义使用nginx以负载均衡的方式进行响应。<br>&ensp;&ensp;&ensp;&ensp;·调度算法<br>◆ngx_stream_core_module模块<br>&ensp;&ensp;&ensp;&ensp;·实验：基于stream实现负载均衡SSH服务<br>◆nginx的其它的二次发行版：</p>
<h3 id="Web-架构扩展思路"><a href="#Web-架构扩展思路" class="headerlink" title="Web 架构扩展思路"></a>Web 架构扩展思路</h3><h4 id="正向代理和反向代理"><a href="#正向代理和反向代理" class="headerlink" title="正向代理和反向代理"></a>正向代理和反向代理</h4><p>★正向代理<br>☉定义：<br>&ensp;&ensp;&ensp;&ensp;是一个位于客户端和原始服务器(origin server)之间的服务器，为了从原始服务器取得内容，客户端向代理发送一个请求并指定目标(原始服务器)，然后代理向原始服务器转交请求并将获得的内容返回给客户端。客户端必须要进行一些特别的设置才能使用正向代理。<br>通俗理解：主要就是代理客户端去访问互联网上各种各样的服务，是用来隐藏客户端的。<br>正向代理：<br><img src="\images\nginx\proxy.jpg" alt="nginx"><br>★反向代理（Reverse Proxy）<br>☉定义：<br>&ensp;&ensp;&ensp;&ensp;指以代理服务器来接受internet上的连接请求，然后将请求转发给内部网络上的服务器，并将从服务器上得到的结果返回给internet上请求连接的客户端，此时代理服务器对外就表现为一个反向代理服务器。<br>☉通俗的理解：<br>&ensp;&ensp;&ensp;&ensp;向外宣称自己监听在某个端口之上，拥有某个服务，但本身并不提供任何内容，而是把相关的请求转发至后端主机来进行提供服务，用来隐藏服务端<br>反向代理:<br><img src="\images\nginx\reverse proxy.jpg" alt="nginx"><br>★两者区别<br>☉从用途上来讲：<br>◆正向代理的典型用途是：<br>&ensp;&ensp;&ensp;&ensp;为在防火墙内的局域网客户端提供访问Internet的途径。正向理还可以使用缓冲特性减少网络使用率。<br>◆反向代理的典型用途是：<br>&ensp;&ensp;&ensp;&ensp;将防火墙后面的服务器提供给Internet用户访问。反向代理还可以为后端的多台服务器提供负载平衡，或为后端较慢的服务器提供缓冲服务。另外，反向代理还可以启用高级URL策略和管理技术，从而使处于不同web服务器系统的web页面同时存在于同一个URL空间下。<br>☉从安全性来讲：<br>&ensp;&ensp;&ensp;&ensp;正向代理允许客户端通过它访问任意网站并且隐藏客户端自身，因此你必须采取安全措施以确保仅为经过授权的客户端提供服务。<br>&ensp;&ensp;&ensp;&ensp;反向代理对外都是透明的，访问者并不知道自己访问的是一个代理。</p>
<h4 id="CDN和GSLB"><a href="#CDN和GSLB" class="headerlink" title="CDN和GSLB"></a>CDN和GSLB</h4><p>★CDN(Content Delivery Network)<br>☉定义：<br>&ensp;&ensp;&ensp;&ensp;CDN是构建在网络之上的内容分发网络，依靠部署在各地的边缘服务器，通过中心平台的负载均衡、内容分发、调度等功能模块，使用户就近获取所需内容，降低网络拥塞，提高用户访问响应速度和命中率。<br>☉CDN的关键技术：<br>&ensp;&ensp;&ensp;&ensp;内容存储和分发技术。<br>☉CDN的基本原理:<br>&ensp;&ensp;&ensp;&ensp;是广泛采用各种缓存服务器，将这些缓存服务器分布到用户访问相对集中的地区或网络中，在用户访问网站时，利用全局负载技术将用户的访问指向距离最近的工作正常的缓存服务器上，由缓存服务器直接响应用户请求。<br>☉目的：<br>&ensp;&ensp;&ensp;&ensp;是使用户可就近取得所需内容，解决 Internet网络拥挤的状况，提高用户访问网站的响应速度。<br>★GSLB：Global Service LB（全局负载均衡器）<br>☉作用：<br>&ensp;&ensp;&ensp;&ensp;实现在广域网（包括互联网）上不同地域间的服务器的流量调配，保证使用最佳的服务器服务离自己最近的客户，从而确保访问质量。<br><img src="\images\nginx\cdn.jpg" alt="nginx"><br>★SLB：Service LB<br>★应用程序发布：<br>&ensp;&ensp;&ensp;&ensp;灰度模型</p>
<h4 id="缓存服务器"><a href="#缓存服务器" class="headerlink" title="缓存服务器"></a>缓存服务器</h4><p>★定义：<br>&ensp;&ensp;&ensp;&ensp;缓存指的是将需要频繁访问的网络内容存放在离用户较近、访问速度更快的系统中，以提高内容访问速度的一种技术。缓存服务器就是存放频繁访问内容的服务器。<br>&ensp;&ensp;&ensp;&ensp;缓存提供了比将访问对象放在Internet Web服务器上更好的方法，它将需要频繁访问的Web页面和对象保存在离用户更近的系统中，当再次访问这些对象的时候加快了速度。<br>★缓存服务器原理及应用模式：<br>☉Web缓存服务器的应用模式主要是正向代理和反向代理。<br>☉正向代理(Proxy)模式<br>&ensp;&ensp;&ensp;&ensp;代理网络用户访问internet，客户端将本来要直接发送到internet上源服务器的连接请求发送给代理服务器处理。正向代理的目的是加速用户在使用浏览器访问Internet时的请求响应时间，并提高广域网线路的利用率。正向代理浏览器无需和该站点建立联系，只访问到Web缓存即可。通过正向代理，大大提高了后续用户的访问速度，使他们无需再穿越Internet，只要从本地Web缓存就可以获取所需要的信息，避免了带宽问题，同时可以大量减少重复请求在网络上的传输，从而降低网络流量，节省资费。<br>☉反向代理(Reverse Proxy)模式<br>&ensp;&ensp;&ensp;&ensp;针对Web服务器加速功能的，在该模式中，缓存服务器放置在web应用服务器的前面，当用户访问web应用服务器的时候，首先经过缓存服务器，并将用户的请求和应用服务器应答的内容写入缓存服务器中，从而为后续用户的访问提供更快的响应。</p>
<h3 id="ngx-http-proxy-module模块"><a href="#ngx-http-proxy-module模块" class="headerlink" title="ngx_http_proxy_module模块"></a>ngx_http_proxy_module模块</h3><h4 id="proxy-pass-URL"><a href="#proxy-pass-URL" class="headerlink" title="proxy_pass URL"></a>proxy_pass URL</h4><p>★作用：<br>&ensp;&ensp;&ensp;&ensp;将作为代理服务器，把客户端访问的资源的url映射到后端服务器；<br>★使用位置（Context）<br>&ensp;&ensp;&ensp;&ensp;location, if in location, limit_except<br>★三种使用情况：<br>☉proxy_pass后面的路径不带uri时，其会将location的uri传递给后端的主机；下面的示例会将/uri/传递给后端服务器；<br><img src="\images\nginx\proxy_pass1.png" alt="nginx"><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">location  /uri/ &#123;</div><div class="line">		proxy_pass http://hostname;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>☉proxy_pass后面的路径是一个uri时，其会将location的uri替换为后端主机自己的uri；<br><img src="\images\nginx\proxy_pass2.png" alt="nginx"><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">location  /uri/ &#123;</div><div class="line">		proxy_pass http://hostname/new_uri/;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>☉如果location定义其uri时使用了正则表达式的模式，则proxy_pass之后必须不能使用uri; 用户请求时传递的uri将直接附加代理到的服务的之后；<br><img src="\images\nginx\proxy_pass3.png" alt="nginx"><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">location  ~*  \.(jpg|gif|jpeg)$  &#123;</div><div class="line">		proxy_pass  http://HOSTNAME;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="实验：验证nginx的反向代理："><a href="#实验：验证nginx的反向代理：" class="headerlink" title="实验：验证nginx的反向代理："></a>实验：验证nginx的反向代理：</h4><p>1.实验环境<br>&ensp;&ensp;&ensp;&ensp;准备两台虚拟主机，一台作为nginx反向代理服务器，另外一台作为后端web服务器；nginx代理服务器要有一个外网网卡保障和客户端通信，还要有一个内网网卡和后端主机通信；<br>2.实验环境搭建<br>1）首先部署好一台虚拟主机作为nginx反向代理服务器，外网网卡ip为10.1.252.128，内网ip为172.16.3.132.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">[root@centos7 ~]<span class="comment"># ifconfig</span></div><div class="line">eno16777736: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500           <span class="comment"># 内网网卡IP</span></div><div class="line">        inet 172.16.3.132  netmask 255.255.255.0  broadcast 172.16.3.255</div><div class="line">        inet6 fe80::20c:29ff:fed3:cf91  prefixlen 64  scopeid 0x20&lt;link&gt;</div><div class="line">        ether 00:0c:29:d3:cf:91  txqueuelen 1000  (Ethernet)</div><div class="line">        RX packets 846  bytes 74706 (72.9 KiB)</div><div class="line">        RX errors 0  dropped 0  overruns 0  frame 0</div><div class="line">        TX packets 593  bytes 86481 (84.4 KiB)</div><div class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</div><div class="line"></div><div class="line">eno33554984: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500           <span class="comment"># 外网网卡IP</span></div><div class="line">        inet 10.1.252.128  netmask 255.255.255.0  broadcast 10.1.252.255</div><div class="line">        inet6 fe80::20c:29ff:fed3:cf9b  prefixlen 64  scopeid 0x20&lt;link&gt;</div><div class="line">        ether 00:0c:29:d3:cf:9b  txqueuelen 1000  (Ethernet)</div><div class="line">        RX packets 43  bytes 6455 (6.3 KiB)</div><div class="line">        RX errors 0  dropped 0  overruns 0  frame 0</div><div class="line">        TX packets 20  bytes 3318 (3.2 KiB)</div><div class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</div></pre></td></tr></table></figure></p>
<p> 2）现在我们来部署后端web服务器，ip地址：172.16.3.67/24.并提供测试页面，这里为了实验，又创建了一个admin目录，并也提供了测试页<br> <figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">[root@centos7 ~]<span class="comment"># ifconfig</span></div><div class="line">eno16777736: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500          <span class="comment"># 内网服务器IP</span></div><div class="line">        inet 172.16.3.67  netmask 255.255.255.0  broadcast 172.16.3.255</div><div class="line">        inet6 fe80::20c:29ff:fe7f:9cbe  prefixlen 64  scopeid 0x20&lt;link&gt;</div><div class="line">        ether 00:0c:29:7f:9c:be  txqueuelen 1000  (Ethernet)</div><div class="line">        RX packets 3793  bytes 345590 (337.4 KiB)</div><div class="line">        RX errors 0  dropped 0  overruns 0  frame 0</div><div class="line">        TX packets 2643  bytes 353057 (344.7 KiB)</div><div class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</div><div class="line"></div><div class="line">[root@centos7 html]<span class="comment"># echo "&lt;h1&gt;UpStream Server 1&lt;/h1&gt;" &gt; /usr/share/nginx/html/index.html </span></div><div class="line">[root@centos7 html]<span class="comment"># cat /usr/share/nginx/html/index.html</span></div><div class="line">&lt;h1&gt;UpStream Server 1&lt;/h1&gt;</div><div class="line">[root@centos7 html]<span class="comment"># mkdir /usr/share/nginx/html/admin/</span></div><div class="line">[root@centos7 html]<span class="comment"># echo "&lt;h1&gt;Admin Area UpStream Server 1&lt;/h1&gt;" &gt; /usr/share/nginx/html/admin/index.html</span></div><div class="line">[root@centos7 html]<span class="comment"># cat /usr/share/nginx/html/admin/index.html</span></div><div class="line">&lt;h1&gt;Admin Area UpStream Server 1&lt;/h1&gt;</div></pre></td></tr></table></figure></p>
<p>3）如上，整个实验的环境就已经搭建完成，我们启动后端web服务器，然后现在代理服务器上请求后端服务器，可以正常返回结果，如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@centos7 ~]<span class="comment"># curl http://172.16.3.67</span></div><div class="line">&lt;h1&gt;UpStream Server 1&lt;/h1&gt;</div><div class="line">[root@centos7 ~]<span class="comment"># curl http://172.16.3.67/admin/</span></div><div class="line">&lt;h1&gt;Admin Area UpStream Server 1&lt;/h1&gt;</div></pre></td></tr></table></figure></p>
<p>3.实验操作<br>1）现在我们在nginx的代理服务器上去编辑其配置文件/etc/nginx/conf.d/defaut.conf，让其把所有内容代理至后端web服务器<br><img src="\images\nginx\proxy_pass4.png" alt="nginx"><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">location / &#123;</div><div class="line">       <span class="comment">#root   /usr/share/nginx/html;</span></div><div class="line">        proxy_pass http://172.16.3.67/;</div><div class="line">        index  index.html index.htm;</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p>启动nginx代理服务器，在浏览器中访问代理服务器10.1.252.128，发现直接代理至后端web服务器，如下：<br><img src="\images\nginx\proxy_pass5.png" alt="nginx"><br>上面是把root注释掉了，如果不注释，两个都存在的话，同样也会代理至后端服务器，即:有proxy，root的存在就没有意义了<br>2）现在我们不代理整个根，我们只代理admin目录至后端服务器<br><img src="\images\nginx\proxy_pass6.png" alt="nginx"><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">location / &#123;</div><div class="line">        root   /usr/share/nginx/html;</div><div class="line">        index  index.html index.htm;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    location /admin/ &#123;</div><div class="line">        proxy_pass http://172.16.3.67/;</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p>①首先不加admin用浏览器访问，则访问的是nginx代理服务器的默认测试页，如下：<br><img src="\images\nginx\proxy_pass7.png" alt="nginx"><br>②加上admin目录，因为proxy后面有uri所以，会将其替换掉location的uri，即访问的是后端服务器的默认测试页,如下：<br><img src="\images\nginx\proxy_pass8.png" alt="nginx"><br>③现在我们把proxy后面的uri去掉，这是会将location中的uri补到proxy的后面，即访问的是后端主机admin目录下的默认页面<br><img src="\images\nginx\proxy_pass9.png" alt="nginx"><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">location / &#123;</div><div class="line">        root   /usr/share/nginx/html;</div><div class="line">        index  index.html index.htm;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    location /admin/ &#123;</div><div class="line">        proxy_pass http://172.16.3.67;</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p>访问如下：<br><img src="\images\nginx\proxy_pass10.png" alt="nginx"><br>3)我们也可以使用正则表达式匹配，把某些符合条件或者同一类资源的url，代理至后端服务器，假如，我这里只把图片类的资源代理至后端服务器<br><img src="\images\nginx\proxy_pass11.png" alt="nginx"><br>location / {<br>        root   /usr/share/nginx/html;<br>        index  index.html index.htm;<br>    }</p>
<pre><code>location /admin/ {
    proxy_pass http://172.16.3.67;
}

location ~*\.(jpg|jpeg|gif|png)$ {
    proxy_pass http://172.16.3.67;
}
</code></pre><p>访问如下：<br><img src="\images\nginx\proxy_pass12.png" alt="nginx"></p>
<p>4)现在我在后端主机上部署安装php并启动（ap基于模块），同样在客户端向调度器请求以.php结尾的动态资源，发现同样可以调度到后端服务器中，然后响应给客户端，如下;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@centos7 ~]<span class="comment"># ll /usr/share/nginx/html/admin/</span></div><div class="line">total 8</div><div class="line">-rw-r--r-- 1 root root 38 Sep 15 15:29 index.html</div><div class="line">-rw-r--r-- 1 root root 27 Sep 13 11:18 phpinfo.php</div></pre></td></tr></table></figure></p>
<p>在浏览器中请求如下：<br><img src="\images\nginx\proxy_pass13.png" alt="nginx"><br>心得：<br>&ensp;&ensp;&ensp;&ensp;如此一来，我们就可以把不同的资源分发到不同的服务器上去运行了，如果我们把所有以.php结尾的动态资源代理到后端另外一台服务器，把根的静态资源代理至另外一台后端服务器，（location中正则表达式的优先级比不带符号的优先级高）这样我们就实现了动静分离;</p>
<h4 id="proxy-set-header-field-value"><a href="#proxy-set-header-field-value" class="headerlink" title="proxy_set_header field value"></a>proxy_set_header field value</h4><p>★作用：<br>&ensp;&ensp;&ensp;&ensp;设定发往后端主机的请求报文的请求首部的值；<br>★使用位置（Context）<br>&ensp;&ensp;&ensp;&ensp;http, server, location<br>☉proxy_set_header X-Real-IP  $remote_addr;<br>&ensp;&ensp;&ensp;&ensp;直接记录前端主机的ip地址（如果前端主机不是客户端而是二级代理，则记录的还是二级代理的值）<br>☉proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;<br>&ensp;&ensp;&ensp;&ensp;记录前端主机发请求时记录的proxy_add_x_forwarded_for的值<br>示例:<br>1.因为后端的web主机接受的都是来自于nginx的代理服务器发送过来的请求，所以记录的日志当中都是nginx代理服务器的ip地址，我们查看后端主机的访问日志，如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@centos7 ~]<span class="comment"># tail /var/log/nginx/access.log</span></div><div class="line">172.16.3.132 - - [15/Sep/2017:16:38:35 +0800] <span class="string">"GET /admin/phpinfo.php HTTP/1.0"</span> 200 47970 <span class="string">"-"</span> <span class="string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/51.0.2704.84 Safari/537.36"</span> <span class="string">"-"</span></div><div class="line">172.16.3.132 - - [15/Sep/2017:16:38:35 +0800] <span class="string">"GET /admin/phpinfo.php?=PHPE9568F34-D428-11d2-A769-00AA001ACF42 HTTP/1.0"</span> 200 2524 <span class="string">"http://10.1.252.128/admin/phpinfo.php"</span> <span class="string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/51.0.2704.84 Safari/537.36"</span> <span class="string">"-"</span></div><div class="line">172.16.3.132 - - [15/Sep/2017:16:38:35 +0800] <span class="string">"GET /admin/phpinfo.php?=PHPE9568F35-D428-11d2-A769-00AA001ACF42 HTTP/1.0"</span> 200 2146 <span class="string">"http://10.1.252.128/admin/phpinfo.php"</span> <span class="string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/51.0.2704.84 Safari/537.36"</span> <span class="string">"-"</span></div></pre></td></tr></table></figure></p>
<p>2.我们要想让后端服务器能够记录来自客户端的请求的ip地址，就需要设定发往后端主机请求报文的首部信息了，如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">![nginx](\images\nginx\proxy_pass14.png)</div><div class="line">location / &#123;</div><div class="line">        root   /usr/share/nginx/html;</div><div class="line">        index  index.html index.htm;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    proxy_set_header X-Real-IP <span class="variable">$remote_addr</span>;</div><div class="line"></div><div class="line">    location /blog/ &#123;</div><div class="line">        proxy_pass http://172.16.3.67;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    location ~*\.(jpg|jpeg|gif|png)$ &#123;</div><div class="line">        proxy_pass http://172.16.3.67;</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p>然后我们修改后端web服务器的配置文件/etc/httpd/conf/httpd.conf,在日志项的配置中添加指定记录指定首部的值即可，如下：<br><img src="\images\nginx\proxy_pass15.png" alt="nginx"><br>如果后端web服务器是nginx服务器这里为做说明</p>
<h4 id="proxy的缓存"><a href="#proxy的缓存" class="headerlink" title="proxy的缓存"></a>proxy的缓存</h4><p>★proxy_cache_path<br>☉格式和适用位置：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">Syntax:proxy_cache_path path [levels=levels] [use_temp_path=on|off] keys_zone=name:size [inactive=time] </div><div class="line">[max_size=size] [manager_files=number] [manager_sleep=time] [manager_threshold=time] [loader_files=number]</div><div class="line">[loader_sleep=time] [loader_threshold=time] [purger=on|off] [purger_files=number] [purger_sleep=time]</div><div class="line"> [purger_threshold=time];</div><div class="line">     </div><div class="line">Default:—    </div><div class="line">Context:http</div></pre></td></tr></table></figure></p>
<p>☉作用：<br>&ensp;&ensp;&ensp;&ensp;定义可用于proxy功能的缓存<br>☉参数：<br>◆levels=levels：<br>&ensp;&ensp;&ensp;&ensp;缓存目录的层级数量，以及每一级的目录数量；<br>&ensp;&ensp;&ensp;&ensp;levels=ONE:TWO:THREE  例如：leves=1:2:2（每一级为16进制数）<br>◆keys_zone=name:size<br>&ensp;&ensp;&ensp;&ensp;k/v映射的内存空间的名称及大小<br>&ensp;&ensp;&ensp;&ensp;缓存的组织方式：缓存是哈希值，而且对应的缓存文件名通常是文件内容的哈希内容，并且缓存层级是按照定义的多级结构去存放文件的；<br>◆inactive=time：<br>&ensp;&ensp;&ensp;&ensp;非活动时长；<br>◆max_size=size：<br>&ensp;&ensp;&ensp;&ensp;磁盘上用于缓存数据的缓存空间上限；<br>★proxy_cache zone | off;<br>&ensp;&ensp;&ensp;&ensp;作用：指明要调用的缓存，或关闭缓存机制；<br>&ensp;&ensp;&ensp;&ensp;适用位置：http, server, location<br>★proxy_cache_key string;<br>☉作用：<br>&ensp;&ensp;&ensp;&ensp;缓存中用于“键”的内容；<br>☉默认值：<br>&ensp;&ensp;&ensp;&ensp;proxy_cache_key $scheme$proxy_host$request_uri;（协议，代理的服务器，请求的uri）<br>★proxy_cache_valid [code …] time;<br>&ensp;&ensp;&ensp;&ensp;作用：定义对特定响应码的响应内容的缓存时长；<br>配置示例:<br><img src="\images\nginx\proxy_cache.png" alt="nginx"><br>★proxy_cache_use_stale<br>☉语法，默认值及使用上下文<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">Syntax:proxy_cache_use_stale error | timeout | invalid_header | updating | http_500 | http_502 </div><div class="line">| http_503 |http_504 | http_403 | http_404 | off ...;</div><div class="line">     </div><div class="line">Default:proxy_cache_use_stale off;</div><div class="line">     </div><div class="line">Context:http, server, location</div></pre></td></tr></table></figure></p>
<p>☉作用：<br>&ensp;&ensp;&ensp;&ensp;当代理服务器与后端主机出现故障时，在后端服务器的相应结果为哪种情况下，可以直接用缓存中的缓存项（可能是过期的内容）来响应客户端；<br>★proxy_cache_methods GET | HEAD | POST …;<br>☉作用：为哪些请求方法去检测使用缓存；<br>&ensp;&ensp;&ensp;&ensp;If the client request method is listed in this directive then the response will be cached. “GET” and “HEAD” methods are always added to the list, though it is recommended to specify them explicitly.<br>★proxy_hide_header field;<br>☉作用：<br>&ensp;&ensp;&ensp;&ensp;指明要隐藏的后端主机响应报文的header，（即，指明哪些header不要传给客户端）；<br>&ensp;&ensp;&ensp;&ensp;默认情况下是nginx不传递header<br>★proxy_connect_timeout time;<br>☉作用：定义代理服务器与后端主机的连接超时时长；<br>&ensp;&ensp;&ensp;&ensp;默认为60s，最大不能超过75s<br>★buffer相关的配置；</p>
<h4 id="定义调用缓存机制"><a href="#定义调用缓存机制" class="headerlink" title="定义调用缓存机制"></a>定义调用缓存机制</h4><p>1）首先要创建一个缓存的文件目录，实际生产环境中可以放在固态磁盘上或者Raid0上，这样I/O能力很强；（注意文可能需要修改属主和属组为nginx）<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">[root@centos7 ~]<span class="comment"># mkdir /var/cache/nginx/proxy_cache</span></div><div class="line">[root@centos7 ~]<span class="comment"># ls /var/cache/nginx/</span></div><div class="line">client_temp  fastcgi_temp  proxy_cache  proxy_temp  scgi_temp  uwsgi_temp</div><div class="line">[root@centos7 ~]<span class="comment"># ll -d /var/cache/nginx/proxy_cache/</span></div><div class="line">drwxr-xr-x 2 root root 6 Sep 15 23:32 /var/cache/nginx/proxy_cache/</div><div class="line">[root@centos7 ~]<span class="comment"># chown -R nginx /var/cache/nginx/proxy_cache/</span></div><div class="line">[root@centos7 ~]<span class="comment"># ll -d /var/cache/nginx/proxy_cache/</span></div><div class="line">drwxr-xr-x 2 nginx root 6 Sep 15 23:32 /var/cache/nginx/proxy_cache/</div></pre></td></tr></table></figure></p>
<p>2）因为缓存只能定义在http配置段，所以编辑主配置文件/etc/nginx/nginx.conf<br><img src="\images\nginx\proxy_cache1.png" alt="nginx"><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">http &#123;</div><div class="line">    include       /etc/nginx/mime.types;</div><div class="line">    default_type  application/octet-stream;</div><div class="line"></div><div class="line">    log_format  main  <span class="string">'$remote_addr - $remote_user [$time_local] "$request" '</span></div><div class="line">                      <span class="string">'$status $body_bytes_sent "$http_referer" '</span></div><div class="line">                      <span class="string">'"$http_user_agent" "$http_x_forwarded_for"'</span>;</div><div class="line"></div><div class="line">    access_log  /var/<span class="built_in">log</span>/nginx/access.log  main;</div><div class="line"></div><div class="line">    proxy_cache_path /var/cache/nginx/proxy_cache levels=1:1:1 keys_zone=proxycache:20m max_size=1g;</div></pre></td></tr></table></figure></p>
<p>3）如上，已经定义好了，只需要在打算缓存的地方调用缓存即可，比如这里，我们对图片作缓存，编辑配置文件/etc/nginx/conf.d/default.conf<br><img src="\images\nginx\proxy_cache2.png" alt="nginx"><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">location /admin/ &#123;</div><div class="line">        proxy_pass http://172.16.3.67;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    location ~*\.(jpg|jpeg|gif|png)$ &#123;</div><div class="line">        proxy_pass http://172.16.3.67;</div><div class="line">        proxy_cache proxycache;</div><div class="line">        proxy_cache_key <span class="variable">$request_uri</span>;</div><div class="line">        proxy_cache_valid 200 302 301 1h;</div><div class="line">        proxy_cache_valid any 1m;</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p>4）定义好之后保存退出，检测语法，重载；然后用浏览器访问morning.jpg，查看缓存目录，已经记录缓存，如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">[root@centos7 ~]<span class="comment"># tree /var/cache/nginx/proxy_cache/</span></div><div class="line">/var/cache/nginx/proxy_cache/</div><div class="line">├── 0</div><div class="line">│   └── 6</div><div class="line">│       └── 4</div><div class="line">│           └── 635450b5c68b27bfaa2e0065cb86c460</div><div class="line">└── e</div><div class="line">    └── 0</div><div class="line">        └── f</div><div class="line">            └── 9bf470d5057c3420d67aeaf320e6af0e</div><div class="line"></div><div class="line">6 directories, 2 files</div></pre></td></tr></table></figure></p>
<h3 id="ngx-http-headers-module模块"><a href="#ngx-http-headers-module模块" class="headerlink" title="ngx_http_headers_module模块"></a>ngx_http_headers_module模块</h3><p>★作用：<br>&ensp;&ensp;&ensp;&ensp;向由代理服务器响应给客户端的响应报文添加自定义首部，或修改指定首部的值；<br>★add_header name value [always];<br>☉作用：<br>&ensp;&ensp;&ensp;&ensp;添加自定义首部；<br>☉常用定义：<br>&ensp;&ensp;&ensp;&ensp;add_header X-Via  $server_addr;  代理服务器的地址<br>&ensp;&ensp;&ensp;&ensp;add_header X-Accel $server_name; 代理服务器的名称<br>★expires [modified] time;<br>&ensp;&ensp;&ensp;&ensp;expires epoch | max | off;<br>☉作用：<br>&ensp;&ensp;&ensp;&ensp;用于定义Expire或Cache-Control首部的值；即：设定响应报文的过期时长<br>示例：<br> 1）向响应报文中，指明客户端请求的内容是经由nginx代理服务器发送的（指明nginx代理服务器ip），编辑配置文件/etc/nginx/conf.d/default.conf<br> <img src="\images\nginx\nginx-http-header.png" alt="nginx"><br> <figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">location /admin/ &#123;</div><div class="line">       proxy_pass http://172.16.3.67;</div><div class="line">   &#125;</div><div class="line"></div><div class="line">   add_header X-Via <span class="variable">$server_addr</span>;</div></pre></td></tr></table></figure></p>
<p>浏览器访问可以看到经由的nginxIP地址，如下：<br><img src="\images\nginx\nginx-http-header1.png" alt="nginx"></p>
<h4 id="注意："><a href="#注意：" class="headerlink" title="注意："></a>注意：</h4><p>&ensp;&ensp;&ensp;&ensp;nginx向后端代理时，具体要使用http_proxy模块，还是fastcgi模块，取决于后端服务器所支持的协议。如果后端主机为amp，则只能使用http_proxy模块，因为我们面向客户端提供服务的是httpd的http协议或者https协议。如果，后端主机为fpm server时，才能够使用fastcgi模块。</p>
<h3 id="ngx-http-upstream-module模块"><a href="#ngx-http-upstream-module模块" class="headerlink" title="ngx_http_upstream_module模块"></a>ngx_http_upstream_module模块</h3><p>功用：用于定义可以引用的服务器组，并定义这些服务器组的调度方法，从而完成能够将多台服务器，在面向前端的代理服务器请求时，可以以负载均衡的方式进行响应；<br>★upstream name { … }<br>☉作用：定义后端服务器组，会引入一个新的上下文；<br>☉Context（使用位置）: http<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">upstream backend &#123;</div><div class="line">    server backend1.example.com weight=5;</div><div class="line">    server 127.0.0.1:8080       max_fails=3 fail_timeout=30s;</div><div class="line">    server unix:/tmp/backend3;</div><div class="line"> </div><div class="line">    server backup1.example.com  backup;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>★server address [parameters];<br>☉作用：<br>&ensp;&ensp;&ensp;&ensp;在upstream上下文中server成员，以及相关的参数；<br>☉Context：upstream<br>☉address的表示格式：<br>◆unix:/PATH/TO/SOME_SOCK_FILE<br>&ensp;&ensp;&ensp;&ensp;某个套接字文件，要确保web服务器一定得是当前反代服务器上的web服务才可以；只能完成本地通信<br>◆IP[:PORT]<br>◆HOSTNAME[:PORT]<br>&ensp;&ensp;&ensp;&ensp;后端主机有基于主机名的虚拟主机，则向后端反代时会指向这个特定的虚拟主机，而不是默认虚拟主机<br>☉parameters：<br>◆weight=number<br>&ensp;&ensp;&ensp;&ensp;权重，默认为1；<br>◆max_fails=number<br>&ensp;&ensp;&ensp;&ensp;失败尝试最大次数；超出此处指定的次数时，server将被标记为不可用；<br>◆fail_timeout=time<br>&ensp;&ensp;&ensp;&ensp;设置将服务器标记为不可用状态的超时时长；<br>◆max_conns<br>◆backup<br>&ensp;&ensp;&ensp;&ensp;备用服务器，所有主服务器均故障时才启用此主机；<br>◆down<br>&ensp;&ensp;&ensp;&ensp;手动标记其不再处理任何用户请求；</p>
<h4 id="实验：定义使用nginx以负载均衡的方式进行响应。"><a href="#实验：定义使用nginx以负载均衡的方式进行响应。" class="headerlink" title="实验：定义使用nginx以负载均衡的方式进行响应。"></a>实验：定义使用nginx以负载均衡的方式进行响应。</h4><p><img src="\images\nginx\nginx-reverse.png" alt="nginx"><br>1.在上面实验nginx反代单台后端主机的基础上，我们再添加一台虚拟主机作为后端服务器web2，并提供默认测试页面如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># web1服务器</span></div><div class="line">[root@centos7 ~]<span class="comment"># ifconfig</span></div><div class="line">eno16777736: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</div><div class="line">        inet 172.16.3.67  netmask 255.255.255.0  broadcast 172.16.3.255</div><div class="line">        inet6 fe80::20c:29ff:fe7f:9cbe  prefixlen 64  scopeid 0x20&lt;link&gt;</div><div class="line">        ether 00:0c:29:7f:9c:be  txqueuelen 1000  (Ethernet)</div><div class="line">        RX packets 260  bytes 26275 (25.6 KiB)</div><div class="line">        RX errors 0  dropped 0  overruns 0  frame 0</div><div class="line">        TX packets 125  bytes 18400 (17.9 KiB)</div><div class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</div><div class="line">[root@centos7 ~]<span class="comment"># cat /usr/share/nginx/html/index.html</span></div><div class="line">&lt;h1&gt;UpStream Server 1&lt;/h1&gt;</div><div class="line"><span class="comment"># web2服务器</span></div><div class="line">[root@centos7 ~]<span class="comment"># ifconfig</span></div><div class="line">eno16777736: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</div><div class="line">        inet 172.16.3.133  netmask 255.255.255.0  broadcast 172.16.3.255</div><div class="line">        inet6 fe80::20c:29ff:fe43:3274  prefixlen 64  scopeid 0x20&lt;link&gt;</div><div class="line">        ether 00:0c:29:43:32:74  txqueuelen 1000  (Ethernet)</div><div class="line">        RX packets 1596  bytes 872167 (851.7 KiB)</div><div class="line">        RX errors 0  dropped 0  overruns 0  frame 0</div><div class="line">        TX packets 808  bytes 110143 (107.5 KiB)</div><div class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</div><div class="line">[root@centos7 ~]<span class="comment"># echo "&lt;h1&gt;UpStream Server 2&lt;/h1&gt;" &gt; /usr/share/nginx/html/index.html</span></div><div class="line">[root@centos7 ~]<span class="comment"># cat /usr/share/nginx/html/index.html</span></div><div class="line">&lt;h1&gt;UpStream Server 2&lt;/h1&gt;</div></pre></td></tr></table></figure></p>
<p>2.实验：实现将用户的请求代理至后端的服务器组<br>1）首先编辑主配置文件/etc/nginx/nginx.conf，在http段的上下文中定义upstream服务器组；<br> <img src="\images\nginx\nginx-upstream.png" alt="nginx"><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">upstream webserv &#123;</div><div class="line">        server 172.16.3.67;</div><div class="line">        server 172.16.3.133;</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p>2）然后，编辑配置文件/etc/nginx/conf.d/default.conf(上例中的配置已经清空，这是原始配置文件)，使nginx反代至upstream组，如下：<br> <img src="\images\nginx\nginx-upstream1.png" alt="nginx"><br>配置好之后，保存，重载，使用浏览器访问，可以发现后端两台web服务器以轮询的方式响应<br><img src="\images\nginx\nginx-upstream2.png" alt="nginx"><br>刷新后变成web2<br><img src="\images\nginx\nginx-upstream3.png" alt="nginx"><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">[root@CentOS6 ~]<span class="comment"># for i in &#123;1..10&#125;;do curl http://10.1.252.128;done</span></div><div class="line">&lt;h1&gt;UpStream Server 2&lt;/h1&gt;</div><div class="line">&lt;h1&gt;UpStream Server 1&lt;/h1&gt;</div><div class="line">&lt;h1&gt;UpStream Server 2&lt;/h1&gt;</div><div class="line">&lt;h1&gt;UpStream Server 1&lt;/h1&gt;</div><div class="line">&lt;h1&gt;UpStream Server 2&lt;/h1&gt;</div><div class="line">&lt;h1&gt;UpStream Server 1&lt;/h1&gt;</div><div class="line">&lt;h1&gt;UpStream Server 2&lt;/h1&gt;</div><div class="line">&lt;h1&gt;UpStream Server 1&lt;/h1&gt;</div><div class="line">&lt;h1&gt;UpStream Server 2&lt;/h1&gt;</div><div class="line">&lt;h1&gt;UpStream Server 1&lt;/h1&gt;</div></pre></td></tr></table></figure></p>
<p>3）现在我们再来编辑主配置文件/etc/nginx/nginx.conf,在web1上添加权重wegit 2<br><img src="\images\nginx\nginx-upstream4.png" alt="nginx"><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">upstream webserv &#123;</div><div class="line">        server 172.16.3.67 weight=2;</div><div class="line">        server 172.16.3.133;</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p>再次测试，发现权重打的web1，响应的次数多<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">[root@CentOS6 ~]<span class="comment"># for i in &#123;1..10&#125;;do curl http://10.1.252.128;done</span></div><div class="line">&lt;h1&gt;UpStream Server 2&lt;/h1&gt;</div><div class="line">&lt;h1&gt;UpStream Server 1&lt;/h1&gt;</div><div class="line">&lt;h1&gt;UpStream Server 1&lt;/h1&gt;</div><div class="line">&lt;h1&gt;UpStream Server 2&lt;/h1&gt;</div><div class="line">&lt;h1&gt;UpStream Server 1&lt;/h1&gt;</div><div class="line">&lt;h1&gt;UpStream Server 1&lt;/h1&gt;</div><div class="line">&lt;h1&gt;UpStream Server 2&lt;/h1&gt;</div><div class="line">&lt;h1&gt;UpStream Server 1&lt;/h1&gt;</div><div class="line">&lt;h1&gt;UpStream Server 1&lt;/h1&gt;</div><div class="line">&lt;h1&gt;UpStream Server 2&lt;/h1&gt;</div></pre></td></tr></table></figure></p>
<p>4)现在我们来设置max_fails的值等于2，也就是说如果请求两次失败以后就标记为不可用，如下：<br><img src="\images\nginx\nginx-upstream5.png" alt="nginx"><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">upstream webserv &#123;</div><div class="line">        server 172.16.3.67 weight=2 max_fails=2;</div><div class="line">        server 172.16.3.133 max_fails=2;</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p>我们现在把后端web2服务器httpd停掉，再去访问，发现停掉web2之后，nginx代理服务器只向web1服务器调度；<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">[root@CentOS6 ~]<span class="comment"># for i in &#123;1..10&#125;;do curl http://10.1.252.128;done</span></div><div class="line">&lt;h1&gt;UpStream Server 1&lt;/h1&gt;</div><div class="line">&lt;h1&gt;UpStream Server 1&lt;/h1&gt;</div><div class="line">&lt;h1&gt;UpStream Server 1&lt;/h1&gt;</div><div class="line">&lt;h1&gt;UpStream Server 1&lt;/h1&gt;</div><div class="line">&lt;h1&gt;UpStream Server 1&lt;/h1&gt;</div><div class="line">&lt;h1&gt;UpStream Server 1&lt;/h1&gt;</div><div class="line">&lt;h1&gt;UpStream Server 1&lt;/h1&gt;</div><div class="line">&lt;h1&gt;UpStream Server 1&lt;/h1&gt;</div><div class="line">&lt;h1&gt;UpStream Server 1&lt;/h1&gt;</div><div class="line">&lt;h1&gt;UpStream Server 1&lt;/h1&gt;</div></pre></td></tr></table></figure></p>
<p>然后我们把停止服务的web2再启动起来，发现一段时间之后，又可以正常被调度至web2的服务之上了<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">[root@CentOS6 ~]<span class="comment"># for i in &#123;1..10&#125;;do curl http://10.1.252.128;done</span></div><div class="line">&lt;h1&gt;UpStream Server 1&lt;/h1&gt;</div><div class="line">&lt;h1&gt;UpStream Server 1&lt;/h1&gt;</div><div class="line">&lt;h1&gt;UpStream Server 2&lt;/h1&gt;</div><div class="line">&lt;h1&gt;UpStream Server 1&lt;/h1&gt;</div><div class="line">&lt;h1&gt;UpStream Server 1&lt;/h1&gt;</div><div class="line">&lt;h1&gt;UpStream Server 2&lt;/h1&gt;</div><div class="line">&lt;h1&gt;UpStream Server 1&lt;/h1&gt;</div><div class="line">&lt;h1&gt;UpStream Server 1&lt;/h1&gt;</div><div class="line">&lt;h1&gt;UpStream Server 2&lt;/h1&gt;</div><div class="line">&lt;h1&gt;UpStream Server 1&lt;/h1&gt;</div></pre></td></tr></table></figure></p>
<p>5）如果在一个服务器后面添加backup参数，则表示这个服务器为备用服务器。只用当所有的后端服务器全都不能正常工作时，这台备用服务器才启用，开始工作；只要有一台后端服务器恢复工作，则备用服务器就停止工作。<br>6）如果在一个服务器的后面添加参数down，则表示这个服务器不可用，一般在应用程序发布，灰度模型时使用，如果服务器调试好要上线，只要把down去掉即可</p>
<h4 id="其他调度算法"><a href="#其他调度算法" class="headerlink" title="其他调度算法"></a>其他调度算法</h4><p>★least_conn;<br>&ensp;&ensp;&ensp;&ensp;最少连接调度算法，当server拥有不同的权重时其为wlc;<br>★ip_hash;<br>&ensp;&ensp;&ensp;&ensp;源地址hash调度方法；<br>★hash key [consistent];<br>&ensp;&ensp;&ensp;&ensp;基于指定的key的hash表来实现对请求的调度，此处的key可以直接文本、变量或二者的组合；<br>☉作用：将请求分类，同一类请求将发往同一个upstream server；<br>&ensp;&ensp;&ensp;&ensp;If the consistent parameter is specified the ketama consistent hashing method will be used instead.<br><img src="\images\nginx\nginx-upstream-hash.png" alt="nginx"><br>★keepalive connections;<br>&ensp;&ensp;&ensp;&ensp;为每个worker进程保留的空闲的长连接数量；<br>示例：<br>1.ip_hash算法：<br>在上例的基础上，我们采用ip_hash的调度方法，同样编辑配置文件如下：<br><img src="\images\nginx\nginx-upstream-hash1.png" alt="nginx"><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">upstream webserv &#123;</div><div class="line">        server 172.16.3.67 max_fails=2;</div><div class="line">        server 172.16.3.133 max_fails=2;</div><div class="line">        ip_hash;</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p>使用curl命令访问可以发现第一次访问被调度的的后端服务器将始终为这个客户端提供服务，如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">[root@CentOS6 ~]<span class="comment"># for i in &#123;1..10&#125;;do curl http://10.1.252.128;done</span></div><div class="line">&lt;h1&gt;UpStream Server 1&lt;/h1&gt;</div><div class="line">&lt;h1&gt;UpStream Server 1&lt;/h1&gt;</div><div class="line">&lt;h1&gt;UpStream Server 1&lt;/h1&gt;</div><div class="line">&lt;h1&gt;UpStream Server 1&lt;/h1&gt;</div><div class="line">&lt;h1&gt;UpStream Server 1&lt;/h1&gt;</div><div class="line">&lt;h1&gt;UpStream Server 1&lt;/h1&gt;</div><div class="line">&lt;h1&gt;UpStream Server 1&lt;/h1&gt;</div><div class="line">&lt;h1&gt;UpStream Server 1&lt;/h1&gt;</div><div class="line">&lt;h1&gt;UpStream Server 1&lt;/h1&gt;</div><div class="line">&lt;h1&gt;UpStream Server 1&lt;/h1&gt;</div></pre></td></tr></table></figure></p>
<p>2.hash key算法<br>1)我们现在对客户请求的url做哈希算法，为了验证此算法，现在我们在后端的两台主机分别创建10个文件（url），url的名称都是相同的，内容不同，以此来判断到底是来自后端的哪个主机，如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">[root@centos7 ~]<span class="comment"># for i in &#123;0..9&#125;;do echo "Test Page $i ON Server 1" &gt; /usr/share/nginx/html/test$i.html;done</span></div><div class="line">[root@centos7 ~]<span class="comment"># ll /usr/share/nginx/html/</span></div><div class="line">total 1024</div><div class="line">-rw-r--r-- 1 root root    537 Jul 11 21:50 50x.html</div><div class="line">drwxr-xr-x 2 root root     41 Sep 15 16:31 admin</div><div class="line">drwxr-xr-x 2 root root     23 Sep 12 15:10 bbs</div><div class="line">drwxr-xr-x 5 root root   4096 Sep 13 12:39 blog</div><div class="line">drwxr-xr-x 2 root root     21 Sep 12 10:05 error_pages</div><div class="line">drwxr-xr-x 2 root root     23 Sep 12 15:31 forum</div><div class="line">-rw-r--r-- 1 root root     27 Sep 15 15:27 index.html</div><div class="line">-rw-r--r-- 1 root root    612 Sep 11 16:01 index.html.bak</div><div class="line">-rw-r--r-- 1 root root   4351 Sep 12 16:15 messages.html</div><div class="line">-rw-r--r-- 1 root root 980265 Sep 15 16:21 morning.jpg</div><div class="line">-rw-r--r-- 1 root root     24 Sep 16 14:43 <span class="built_in">test</span>0.html</div><div class="line">-rw-r--r-- 1 root root     24 Sep 16 14:43 <span class="built_in">test</span>1.html</div><div class="line">-rw-r--r-- 1 root root     24 Sep 16 14:43 <span class="built_in">test</span>2.html</div><div class="line">-rw-r--r-- 1 root root     24 Sep 16 14:43 <span class="built_in">test</span>3.html</div><div class="line">-rw-r--r-- 1 root root     24 Sep 16 14:43 <span class="built_in">test</span>4.html</div><div class="line">-rw-r--r-- 1 root root     24 Sep 16 14:43 <span class="built_in">test</span>5.html</div><div class="line">-rw-r--r-- 1 root root     24 Sep 16 14:43 <span class="built_in">test</span>6.html</div><div class="line">-rw-r--r-- 1 root root     24 Sep 16 14:43 <span class="built_in">test</span>7.html</div><div class="line">-rw-r--r-- 1 root root     24 Sep 16 14:43 <span class="built_in">test</span>8.html</div><div class="line">-rw-r--r-- 1 root root     24 Sep 16 14:43 <span class="built_in">test</span>9.html</div></pre></td></tr></table></figure></p>
<p>现在我们不添加调度算法，对test0.html请求，可以发现，在后端的两台服务器上做轮询，如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">[root@CentOS6 ~]<span class="comment"># for i in &#123;1..10&#125;;do curl http://10.1.252.128/test0.html;done</span></div><div class="line">Test Page 0 ON Server 1</div><div class="line">Test Page 0 ON Server 2</div><div class="line">Test Page 0 ON Server 1</div><div class="line">Test Page 0 ON Server 2</div><div class="line">Test Page 0 ON Server 1</div><div class="line">Test Page 0 ON Server 2</div><div class="line">Test Page 0 ON Server 1</div><div class="line">Test Page 0 ON Server 2</div><div class="line">Test Page 0 ON Server 1</div><div class="line">Test Page 0 ON Server 2</div></pre></td></tr></table></figure></p>
<p>2）现在我们把用户请求的uri做哈希运算作为调度算法，编辑配置文件如下：<br><img src="\images\nginx\nginx-upstream-hash2.png" alt="nginx"><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">upstream webserv &#123;</div><div class="line">        server 172.16.3.67 max_fails=2;</div><div class="line">        server 172.16.3.133 max_fails=2;</div><div class="line">        <span class="built_in">hash</span> <span class="variable">$request_uri</span>;</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p>测试我们发现，只要第一次请求的uri调度到后端某台服务器，将会一直在此服务器之上，如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">[root@CentOS6 ~]<span class="comment"># for i in &#123;1..10&#125;;do curl http://10.1.252.128/test0.html;done</span></div><div class="line">Test Page 0 ON Server 2</div><div class="line">Test Page 0 ON Server 2</div><div class="line">Test Page 0 ON Server 2</div><div class="line">Test Page 0 ON Server 2</div><div class="line">Test Page 0 ON Server 2</div><div class="line">Test Page 0 ON Server 2</div><div class="line">Test Page 0 ON Server 2</div><div class="line">Test Page 0 ON Server 2</div><div class="line">Test Page 0 ON Server 2</div><div class="line">Test Page 0 ON Server 2</div><div class="line">[root@CentOS6 ~]<span class="comment"># for i in &#123;1..10&#125;;do curl http://10.1.252.128/test4.html;done</span></div><div class="line">Test Page 4 ON Server 1</div><div class="line">Test Page 4 ON Server 1</div><div class="line">Test Page 4 ON Server 1</div><div class="line">Test Page 4 ON Server 1</div><div class="line">Test Page 4 ON Server 1</div><div class="line">Test Page 4 ON Server 1</div><div class="line">Test Page 4 ON Server 1</div><div class="line">Test Page 4 ON Server 1</div><div class="line">Test Page 4 ON Server 1</div><div class="line">Test Page 4 ON Server 1</div><div class="line">[root@CentOS6 ~]<span class="comment"># for i in &#123;1..10&#125;;do curl http://10.1.252.128/test8.html;done</span></div><div class="line">Test Page 8 ON Server 1</div><div class="line">Test Page 8 ON Server 1</div><div class="line">Test Page 8 ON Server 1</div><div class="line">Test Page 8 ON Server 1</div><div class="line">Test Page 8 ON Server 1</div><div class="line">Test Page 8 ON Server 1</div><div class="line">Test Page 8 ON Server 1</div><div class="line">Test Page 8 ON Server 1</div><div class="line">Test Page 8 ON Server 1</div><div class="line">Test Page 8 ON Server 1</div><div class="line">[root@CentOS6 ~]<span class="comment"># for i in &#123;1..10&#125;;do curl http://10.1.252.128/test3.html;done</span></div><div class="line">Test Page 3 ON Server 2</div><div class="line">Test Page 3 ON Server 2</div><div class="line">Test Page 3 ON Server 2</div><div class="line">Test Page 3 ON Server 2</div><div class="line">Test Page 3 ON Server 2</div><div class="line">Test Page 3 ON Server 2</div><div class="line">Test Page 3 ON Server 2</div><div class="line">Test Page 3 ON Server 2</div><div class="line">Test Page 3 ON Server 2</div><div class="line">Test Page 3 ON Server 2</div></pre></td></tr></table></figure></p>
<h3 id="ngx-stream-core-module模块"><a href="#ngx-stream-core-module模块" class="headerlink" title="ngx_stream_core_module模块"></a>ngx_stream_core_module模块</h3><p>功用：模拟反代基于tcp或udp的服务连接，即工作于传输层的反代或调度器；<br>★stream { … }<br>&ensp;&ensp;&ensp;&ensp;作用：定义stream相关的服务；<br>&ensp;&ensp;&ensp;&ensp;Context：main<br>★listen<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Syntax:listen address:port [ssl] [udp] [proxy_protocol] [backlog=number] [<span class="built_in">bind</span>] [ipv6only=on|off] </div><div class="line">       [reuseport] [so_keepalive=on|off|[keepidle]:[keepintvl]:[keepcnt]];</div></pre></td></tr></table></figure></p>
<p><img src="\images\nginx\nginx-stream.png" alt="nginx"></p>
<h3 id="nginx的其它的二次发行版："><a href="#nginx的其它的二次发行版：" class="headerlink" title="nginx的其它的二次发行版："></a>nginx的其它的二次发行版：</h3><p>&ensp;&ensp;&ensp;&ensp;tengine<br>&ensp;&ensp;&ensp;&ensp;OpenResty</p>
<h4 id="思考："><a href="#思考：" class="headerlink" title="思考："></a>思考：</h4><p>&ensp;&ensp;&ensp;&ensp;动态资源存储一组服务器、图片资源存在一组服务器、静态的文本类资源存储在一组服务器；如何分别调度？<br>&ensp;&ensp;&ensp;&ensp;动态资源基于fastcgi（lnmp）或http协议（lnamp）?</p>

      

      
        <div class="page-reward">
          <a href="javascript:;" class="page-reward-btn tooltip-top">
            <div class="tooltip tooltip-east">
            <span class="tooltip-item">
              赏
            </span>
            <span class="tooltip-content">
              <span class="tooltip-text">
                <span class="tooltip-inner">
                  <p class="reward-p"><i class="icon icon-quo-left"></i>谢谢你请我吃糖果<i class="icon icon-quo-right"></i></p>
                  <div class="reward-box">
                    
                    
                  </div>
                </span>
              </span>
            </span>
          </div>
          </a>
        </div>
      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color1">Nginx</a>
        		</li>
      		
		</ul>
	</div>

      

      

      
        
<div class="share-btn share-icons tooltip-left">
  <div class="tooltip tooltip-east">
    <span class="tooltip-item">
      <a href="javascript:;" class="share-sns share-outer">
        <i class="icon icon-share"></i>
      </a>
    </span>
    <span class="tooltip-content">
      <div class="share-wrap">
        <div class="share-icons">
          <a class="weibo share-sns" href="javascript:;" data-type="weibo">
            <i class="icon icon-weibo"></i>
          </a>
          <a class="weixin share-sns wxFab" href="javascript:;" data-type="weixin">
            <i class="icon icon-weixin"></i>
          </a>
          <a class="qq share-sns" href="javascript:;" data-type="qq">
            <i class="icon icon-qq"></i>
          </a>
          <a class="douban share-sns" href="javascript:;" data-type="douban">
            <i class="icon icon-douban"></i>
          </a>
          <a class="qzone share-sns" href="javascript:;" data-type="qzone">
            <i class="icon icon-qzone"></i>
          </a>
          <a class="facebook share-sns" href="javascript:;" data-type="facebook">
            <i class="icon icon-facebook"></i>
          </a>
          <a class="twitter share-sns" href="javascript:;" data-type="twitter">
            <i class="icon icon-twitter"></i>
          </a>
          <a class="google share-sns" href="javascript:;" data-type="google">
            <i class="icon icon-google"></i>
          </a>
        </div>
      </div>
    </span>
  </div>
</div>

<div class="page-modal wx-share js-wx-box">
    <a class="close js-modal-close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <div class="wx-qrcode">
      <img src="http://s.jiathis.com/qrcode.php?url=http://yoursite.com/2017/08/29/web services之nginx(四)/" alt="微信分享二维码">
    </div>
</div>

<div class="mask js-mask"></div>
      
      <div class="clearfix"></div>
    </div>
  </div>
</article>

  
<nav id="article-nav">
  
    <a href="/2017/08/28/web services之nginx(三)/" id="article-nav-newer" class="article-nav-link-wrap">
      <i class="icon-circle-left"></i>
      <div class="article-nav-title">
        
          Nginx进阶三
        
      </div>
    </a>
  
  
    <a href="/2017/08/30/web services之memcached/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">MemCached</div>
      <i class="icon-circle-right"></i>
    </a>
  
</nav>





  
  
  

  

  


          </div>
        </div>
      </div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2018 Jack_zhou
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    <script>
	var yiliaConfig = {
		mathjax: false,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false,
		root: "/",
		innerArchive: true,
		showTags: false
	}
</script>

<script>!function(t){function n(r){if(e[r])return e[r].exports;var o=e[r]={exports:{},id:r,loaded:!1};return t[r].call(o.exports,o,o.exports,n),o.loaded=!0,o.exports}var e={};return n.m=t,n.c=e,n.p="./",n(0)}([function(t,n,e){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t,n){var e=/\/|index.html/g;return t.replace(e,"")===n.replace(e,"")}function i(){for(var t=document.querySelectorAll(".js-header-menu li a"),n=window.location.pathname,e=0,r=t.length;e<r;e++){var i=t[e];o(n,i.getAttribute("href"))&&(0,d.default)(i,"active")}}function u(t){for(var n=t.offsetLeft,e=t.offsetParent;null!==e;)n+=e.offsetLeft,e=e.offsetParent;return n}function f(t){for(var n=t.offsetTop,e=t.offsetParent;null!==e;)n+=e.offsetTop,e=e.offsetParent;return n}function c(t,n,e,r,o){var i=u(t),c=f(t)-n;if(c-e<=o){var a=t.$newDom;a||(a=t.cloneNode(!0),(0,h.default)(t,a),t.$newDom=a,a.style.position="fixed",a.style.top=(e||c)+"px",a.style.left=i+"px",a.style.zIndex=r||2,a.style.width="100%",a.style.color="#fff"),a.style.visibility="visible",t.style.visibility="hidden"}else{t.style.visibility="visible";var s=t.$newDom;s&&(s.style.visibility="hidden")}}function a(){var t=document.querySelector(".js-overlay"),n=document.querySelector(".js-header-menu");c(t,document.body.scrollTop,-63,2,0),c(n,document.body.scrollTop,1,3,0)}function s(){document.querySelector("#container").addEventListener("scroll",function(t){a()}),window.addEventListener("scroll",function(t){a()}),a()}function l(){x.default.versions.mobile&&window.screen.width<800&&(i(),s())}var p=e(71),d=r(p),v=e(72),y=(r(v),e(84)),h=r(y),b=e(69),x=r(b),g=e(75),m=r(g),w=e(70);l(),(0,w.addLoadEvent)(function(){m.default.init()}),t.exports={}},function(t,n){var e=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=e)},function(t,n){var e={}.hasOwnProperty;t.exports=function(t,n){return e.call(t,n)}},function(t,n,e){var r=e(49),o=e(15);t.exports=function(t){return r(o(t))}},function(t,n,e){t.exports=!e(8)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(t,n,e){var r=e(6),o=e(12);t.exports=e(4)?function(t,n,e){return r.f(t,n,o(1,e))}:function(t,n,e){return t[n]=e,t}},function(t,n,e){var r=e(10),o=e(30),i=e(24),u=Object.defineProperty;n.f=e(4)?Object.defineProperty:function(t,n,e){if(r(t),n=i(n,!0),r(e),o)try{return u(t,n,e)}catch(t){}if("get"in e||"set"in e)throw TypeError("Accessors not supported!");return"value"in e&&(t[n]=e.value),t}},function(t,n,e){var r=e(22)("wks"),o=e(13),i=e(1).Symbol,u="function"==typeof i,f=t.exports=function(t){return r[t]||(r[t]=u&&i[t]||(u?i:o)("Symbol."+t))};f.store=r},function(t,n){t.exports=function(t){try{return!!t()}catch(t){return!0}}},function(t,n,e){var r=e(35),o=e(16);t.exports=Object.keys||function(t){return r(t,o)}},function(t,n,e){var r=e(11);t.exports=function(t){if(!r(t))throw TypeError(t+" is not an object!");return t}},function(t,n){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},function(t,n){t.exports=function(t,n){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:n}}},function(t,n){var e=0,r=Math.random();t.exports=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++e+r).toString(36))}},function(t,n){var e=t.exports={version:"2.4.0"};"number"==typeof __e&&(__e=e)},function(t,n){t.exports=function(t){if(void 0==t)throw TypeError("Can't call method on  "+t);return t}},function(t,n){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(t,n){t.exports={}},function(t,n){t.exports=!0},function(t,n){n.f={}.propertyIsEnumerable},function(t,n,e){var r=e(6).f,o=e(2),i=e(7)("toStringTag");t.exports=function(t,n,e){t&&!o(t=e?t:t.prototype,i)&&r(t,i,{configurable:!0,value:n})}},function(t,n,e){var r=e(22)("keys"),o=e(13);t.exports=function(t){return r[t]||(r[t]=o(t))}},function(t,n,e){var r=e(1),o="__core-js_shared__",i=r[o]||(r[o]={});t.exports=function(t){return i[t]||(i[t]={})}},function(t,n){var e=Math.ceil,r=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(t>0?r:e)(t)}},function(t,n,e){var r=e(11);t.exports=function(t,n){if(!r(t))return t;var e,o;if(n&&"function"==typeof(e=t.toString)&&!r(o=e.call(t)))return o;if("function"==typeof(e=t.valueOf)&&!r(o=e.call(t)))return o;if(!n&&"function"==typeof(e=t.toString)&&!r(o=e.call(t)))return o;throw TypeError("Can't convert object to primitive value")}},function(t,n,e){var r=e(1),o=e(14),i=e(18),u=e(26),f=e(6).f;t.exports=function(t){var n=o.Symbol||(o.Symbol=i?{}:r.Symbol||{});"_"==t.charAt(0)||t in n||f(n,t,{value:u.f(t)})}},function(t,n,e){n.f=e(7)},function(t,n,e){var r=e(1),o=e(14),i=e(46),u=e(5),f="prototype",c=function(t,n,e){var a,s,l,p=t&c.F,d=t&c.G,v=t&c.S,y=t&c.P,h=t&c.B,b=t&c.W,x=d?o:o[n]||(o[n]={}),g=x[f],m=d?r:v?r[n]:(r[n]||{})[f];d&&(e=n);for(a in e)s=!p&&m&&void 0!==m[a],s&&a in x||(l=s?m[a]:e[a],x[a]=d&&"function"!=typeof m[a]?e[a]:h&&s?i(l,r):b&&m[a]==l?function(t){var n=function(n,e,r){if(this instanceof t){switch(arguments.length){case 0:return new t;case 1:return new t(n);case 2:return new t(n,e)}return new t(n,e,r)}return t.apply(this,arguments)};return n[f]=t[f],n}(l):y&&"function"==typeof l?i(Function.call,l):l,y&&((x.virtual||(x.virtual={}))[a]=l,t&c.R&&g&&!g[a]&&u(g,a,l)))};c.F=1,c.G=2,c.S=4,c.P=8,c.B=16,c.W=32,c.U=64,c.R=128,t.exports=c},function(t,n){var e={}.toString;t.exports=function(t){return e.call(t).slice(8,-1)}},function(t,n,e){var r=e(11),o=e(1).document,i=r(o)&&r(o.createElement);t.exports=function(t){return i?o.createElement(t):{}}},function(t,n,e){t.exports=!e(4)&&!e(8)(function(){return 7!=Object.defineProperty(e(29)("div"),"a",{get:function(){return 7}}).a})},function(t,n,e){"use strict";var r=e(18),o=e(27),i=e(36),u=e(5),f=e(2),c=e(17),a=e(51),s=e(20),l=e(58),p=e(7)("iterator"),d=!([].keys&&"next"in[].keys()),v="@@iterator",y="keys",h="values",b=function(){return this};t.exports=function(t,n,e,x,g,m,w){a(e,n,x);var O,S,_,j=function(t){if(!d&&t in A)return A[t];switch(t){case y:return function(){return new e(this,t)};case h:return function(){return new e(this,t)}}return function(){return new e(this,t)}},P=n+" Iterator",E=g==h,M=!1,A=t.prototype,T=A[p]||A[v]||g&&A[g],L=T||j(g),N=g?E?j("entries"):L:void 0,C="Array"==n?A.entries||T:T;if(C&&(_=l(C.call(new t)),_!==Object.prototype&&(s(_,P,!0),r||f(_,p)||u(_,p,b))),E&&T&&T.name!==h&&(M=!0,L=function(){return T.call(this)}),r&&!w||!d&&!M&&A[p]||u(A,p,L),c[n]=L,c[P]=b,g)if(O={values:E?L:j(h),keys:m?L:j(y),entries:N},w)for(S in O)S in A||i(A,S,O[S]);else o(o.P+o.F*(d||M),n,O);return O}},function(t,n,e){var r=e(10),o=e(55),i=e(16),u=e(21)("IE_PROTO"),f=function(){},c="prototype",a=function(){var t,n=e(29)("iframe"),r=i.length,o="<",u=">";for(n.style.display="none",e(48).appendChild(n),n.src="javascript:",t=n.contentWindow.document,t.open(),t.write(o+"script"+u+"document.F=Object"+o+"/script"+u),t.close(),a=t.F;r--;)delete a[c][i[r]];return a()};t.exports=Object.create||function(t,n){var e;return null!==t?(f[c]=r(t),e=new f,f[c]=null,e[u]=t):e=a(),void 0===n?e:o(e,n)}},function(t,n,e){var r=e(35),o=e(16).concat("length","prototype");n.f=Object.getOwnPropertyNames||function(t){return r(t,o)}},function(t,n){n.f=Object.getOwnPropertySymbols},function(t,n,e){var r=e(2),o=e(3),i=e(45)(!1),u=e(21)("IE_PROTO");t.exports=function(t,n){var e,f=o(t),c=0,a=[];for(e in f)e!=u&&r(f,e)&&a.push(e);for(;n.length>c;)r(f,e=n[c++])&&(~i(a,e)||a.push(e));return a}},function(t,n,e){t.exports=e(5)},function(t,n,e){var r=e(15);t.exports=function(t){return Object(r(t))}},function(t,n,e){t.exports={default:e(41),__esModule:!0}},function(t,n,e){t.exports={default:e(42),__esModule:!0}},function(t,n,e){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}n.__esModule=!0;var o=e(39),i=r(o),u=e(38),f=r(u),c="function"==typeof f.default&&"symbol"==typeof i.default?function(t){return typeof t}:function(t){return t&&"function"==typeof f.default&&t.constructor===f.default&&t!==f.default.prototype?"symbol":typeof t};n.default="function"==typeof f.default&&"symbol"===c(i.default)?function(t){return"undefined"==typeof t?"undefined":c(t)}:function(t){return t&&"function"==typeof f.default&&t.constructor===f.default&&t!==f.default.prototype?"symbol":"undefined"==typeof t?"undefined":c(t)}},function(t,n,e){e(65),e(63),e(66),e(67),t.exports=e(14).Symbol},function(t,n,e){e(64),e(68),t.exports=e(26).f("iterator")},function(t,n){t.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},function(t,n){t.exports=function(){}},function(t,n,e){var r=e(3),o=e(61),i=e(60);t.exports=function(t){return function(n,e,u){var f,c=r(n),a=o(c.length),s=i(u,a);if(t&&e!=e){for(;a>s;)if(f=c[s++],f!=f)return!0}else for(;a>s;s++)if((t||s in c)&&c[s]===e)return t||s||0;return!t&&-1}}},function(t,n,e){var r=e(43);t.exports=function(t,n,e){if(r(t),void 0===n)return t;switch(e){case 1:return function(e){return t.call(n,e)};case 2:return function(e,r){return t.call(n,e,r)};case 3:return function(e,r,o){return t.call(n,e,r,o)}}return function(){return t.apply(n,arguments)}}},function(t,n,e){var r=e(9),o=e(34),i=e(19);t.exports=function(t){var n=r(t),e=o.f;if(e)for(var u,f=e(t),c=i.f,a=0;f.length>a;)c.call(t,u=f[a++])&&n.push(u);return n}},function(t,n,e){t.exports=e(1).document&&document.documentElement},function(t,n,e){var r=e(28);t.exports=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==r(t)?t.split(""):Object(t)}},function(t,n,e){var r=e(28);t.exports=Array.isArray||function(t){return"Array"==r(t)}},function(t,n,e){"use strict";var r=e(32),o=e(12),i=e(20),u={};e(5)(u,e(7)("iterator"),function(){return this}),t.exports=function(t,n,e){t.prototype=r(u,{next:o(1,e)}),i(t,n+" Iterator")}},function(t,n){t.exports=function(t,n){return{value:n,done:!!t}}},function(t,n,e){var r=e(9),o=e(3);t.exports=function(t,n){for(var e,i=o(t),u=r(i),f=u.length,c=0;f>c;)if(i[e=u[c++]]===n)return e}},function(t,n,e){var r=e(13)("meta"),o=e(11),i=e(2),u=e(6).f,f=0,c=Object.isExtensible||function(){return!0},a=!e(8)(function(){return c(Object.preventExtensions({}))}),s=function(t){u(t,r,{value:{i:"O"+ ++f,w:{}}})},l=function(t,n){if(!o(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!i(t,r)){if(!c(t))return"F";if(!n)return"E";s(t)}return t[r].i},p=function(t,n){if(!i(t,r)){if(!c(t))return!0;if(!n)return!1;s(t)}return t[r].w},d=function(t){return a&&v.NEED&&c(t)&&!i(t,r)&&s(t),t},v=t.exports={KEY:r,NEED:!1,fastKey:l,getWeak:p,onFreeze:d}},function(t,n,e){var r=e(6),o=e(10),i=e(9);t.exports=e(4)?Object.defineProperties:function(t,n){o(t);for(var e,u=i(n),f=u.length,c=0;f>c;)r.f(t,e=u[c++],n[e]);return t}},function(t,n,e){var r=e(19),o=e(12),i=e(3),u=e(24),f=e(2),c=e(30),a=Object.getOwnPropertyDescriptor;n.f=e(4)?a:function(t,n){if(t=i(t),n=u(n,!0),c)try{return a(t,n)}catch(t){}if(f(t,n))return o(!r.f.call(t,n),t[n])}},function(t,n,e){var r=e(3),o=e(33).f,i={}.toString,u="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],f=function(t){try{return o(t)}catch(t){return u.slice()}};t.exports.f=function(t){return u&&"[object Window]"==i.call(t)?f(t):o(r(t))}},function(t,n,e){var r=e(2),o=e(37),i=e(21)("IE_PROTO"),u=Object.prototype;t.exports=Object.getPrototypeOf||function(t){return t=o(t),r(t,i)?t[i]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?u:null}},function(t,n,e){var r=e(23),o=e(15);t.exports=function(t){return function(n,e){var i,u,f=String(o(n)),c=r(e),a=f.length;return c<0||c>=a?t?"":void 0:(i=f.charCodeAt(c),i<55296||i>56319||c+1===a||(u=f.charCodeAt(c+1))<56320||u>57343?t?f.charAt(c):i:t?f.slice(c,c+2):(i-55296<<10)+(u-56320)+65536)}}},function(t,n,e){var r=e(23),o=Math.max,i=Math.min;t.exports=function(t,n){return t=r(t),t<0?o(t+n,0):i(t,n)}},function(t,n,e){var r=e(23),o=Math.min;t.exports=function(t){return t>0?o(r(t),9007199254740991):0}},function(t,n,e){"use strict";var r=e(44),o=e(52),i=e(17),u=e(3);t.exports=e(31)(Array,"Array",function(t,n){this._t=u(t),this._i=0,this._k=n},function(){var t=this._t,n=this._k,e=this._i++;return!t||e>=t.length?(this._t=void 0,o(1)):"keys"==n?o(0,e):"values"==n?o(0,t[e]):o(0,[e,t[e]])},"values"),i.Arguments=i.Array,r("keys"),r("values"),r("entries")},function(t,n){},function(t,n,e){"use strict";var r=e(59)(!0);e(31)(String,"String",function(t){this._t=String(t),this._i=0},function(){var t,n=this._t,e=this._i;return e>=n.length?{value:void 0,done:!0}:(t=r(n,e),this._i+=t.length,{value:t,done:!1})})},function(t,n,e){"use strict";var r=e(1),o=e(2),i=e(4),u=e(27),f=e(36),c=e(54).KEY,a=e(8),s=e(22),l=e(20),p=e(13),d=e(7),v=e(26),y=e(25),h=e(53),b=e(47),x=e(50),g=e(10),m=e(3),w=e(24),O=e(12),S=e(32),_=e(57),j=e(56),P=e(6),E=e(9),M=j.f,A=P.f,T=_.f,L=r.Symbol,N=r.JSON,C=N&&N.stringify,k="prototype",F=d("_hidden"),q=d("toPrimitive"),I={}.propertyIsEnumerable,B=s("symbol-registry"),D=s("symbols"),W=s("op-symbols"),H=Object[k],K="function"==typeof L,R=r.QObject,J=!R||!R[k]||!R[k].findChild,U=i&&a(function(){return 7!=S(A({},"a",{get:function(){return A(this,"a",{value:7}).a}})).a})?function(t,n,e){var r=M(H,n);r&&delete H[n],A(t,n,e),r&&t!==H&&A(H,n,r)}:A,G=function(t){var n=D[t]=S(L[k]);return n._k=t,n},$=K&&"symbol"==typeof L.iterator?function(t){return"symbol"==typeof t}:function(t){return t instanceof L},z=function(t,n,e){return t===H&&z(W,n,e),g(t),n=w(n,!0),g(e),o(D,n)?(e.enumerable?(o(t,F)&&t[F][n]&&(t[F][n]=!1),e=S(e,{enumerable:O(0,!1)})):(o(t,F)||A(t,F,O(1,{})),t[F][n]=!0),U(t,n,e)):A(t,n,e)},Y=function(t,n){g(t);for(var e,r=b(n=m(n)),o=0,i=r.length;i>o;)z(t,e=r[o++],n[e]);return t},Q=function(t,n){return void 0===n?S(t):Y(S(t),n)},X=function(t){var n=I.call(this,t=w(t,!0));return!(this===H&&o(D,t)&&!o(W,t))&&(!(n||!o(this,t)||!o(D,t)||o(this,F)&&this[F][t])||n)},V=function(t,n){if(t=m(t),n=w(n,!0),t!==H||!o(D,n)||o(W,n)){var e=M(t,n);return!e||!o(D,n)||o(t,F)&&t[F][n]||(e.enumerable=!0),e}},Z=function(t){for(var n,e=T(m(t)),r=[],i=0;e.length>i;)o(D,n=e[i++])||n==F||n==c||r.push(n);return r},tt=function(t){for(var n,e=t===H,r=T(e?W:m(t)),i=[],u=0;r.length>u;)!o(D,n=r[u++])||e&&!o(H,n)||i.push(D[n]);return i};K||(L=function(){if(this instanceof L)throw TypeError("Symbol is not a constructor!");var t=p(arguments.length>0?arguments[0]:void 0),n=function(e){this===H&&n.call(W,e),o(this,F)&&o(this[F],t)&&(this[F][t]=!1),U(this,t,O(1,e))};return i&&J&&U(H,t,{configurable:!0,set:n}),G(t)},f(L[k],"toString",function(){return this._k}),j.f=V,P.f=z,e(33).f=_.f=Z,e(19).f=X,e(34).f=tt,i&&!e(18)&&f(H,"propertyIsEnumerable",X,!0),v.f=function(t){return G(d(t))}),u(u.G+u.W+u.F*!K,{Symbol:L});for(var nt="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),et=0;nt.length>et;)d(nt[et++]);for(var nt=E(d.store),et=0;nt.length>et;)y(nt[et++]);u(u.S+u.F*!K,"Symbol",{for:function(t){return o(B,t+="")?B[t]:B[t]=L(t)},keyFor:function(t){if($(t))return h(B,t);throw TypeError(t+" is not a symbol!")},useSetter:function(){J=!0},useSimple:function(){J=!1}}),u(u.S+u.F*!K,"Object",{create:Q,defineProperty:z,defineProperties:Y,getOwnPropertyDescriptor:V,getOwnPropertyNames:Z,getOwnPropertySymbols:tt}),N&&u(u.S+u.F*(!K||a(function(){var t=L();return"[null]"!=C([t])||"{}"!=C({a:t})||"{}"!=C(Object(t))})),"JSON",{stringify:function(t){if(void 0!==t&&!$(t)){for(var n,e,r=[t],o=1;arguments.length>o;)r.push(arguments[o++]);return n=r[1],"function"==typeof n&&(e=n),!e&&x(n)||(n=function(t,n){if(e&&(n=e.call(this,t,n)),!$(n))return n}),r[1]=n,C.apply(N,r)}}}),L[k][q]||e(5)(L[k],q,L[k].valueOf),l(L,"Symbol"),l(Math,"Math",!0),l(r.JSON,"JSON",!0)},function(t,n,e){e(25)("asyncIterator")},function(t,n,e){e(25)("observable")},function(t,n,e){e(62);for(var r=e(1),o=e(5),i=e(17),u=e(7)("toStringTag"),f=["NodeList","DOMTokenList","MediaList","StyleSheetList","CSSRuleList"],c=0;c<5;c++){var a=f[c],s=r[a],l=s&&s.prototype;l&&!l[u]&&o(l,u,a),i[a]=i.Array}},function(t,n){"use strict";var e={versions:function(){var t=window.navigator.userAgent;return{trident:t.indexOf("Trident")>-1,presto:t.indexOf("Presto")>-1,webKit:t.indexOf("AppleWebKit")>-1,gecko:t.indexOf("Gecko")>-1&&t.indexOf("KHTML")==-1,mobile:!!t.match(/AppleWebKit.*Mobile.*/),ios:!!t.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:t.indexOf("Android")>-1||t.indexOf("Linux")>-1,iPhone:t.indexOf("iPhone")>-1||t.indexOf("Mac")>-1,iPad:t.indexOf("iPad")>-1,webApp:t.indexOf("Safari")==-1,weixin:t.indexOf("MicroMessenger")==-1}}()};t.exports=e},function(t,n,e){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}var o=e(40),i=r(o),u=function(){function t(t,n,e){return n||e?String.fromCharCode(n||e):o[t]||t}function n(t){return l[t]}var e=/&quot;|&lt;|&gt;|&amp;|&nbsp;|&apos;|&#(\d+);|&#(\d+)/g,r=/['<> "&]/g,o={"&quot;":'"',"&lt;":"<","&gt;":">","&amp;":"&","&nbsp;":" "},f=/\u00a0/g,c=/<br\s*\/?>/gi,a=/\r?\n/g,s=/\s/g,l={};for(var p in o)l[o[p]]=p;return o["&apos;"]="'",l["'"]="&#39;",{encode:function(t){return t?(""+t).replace(r,n).replace(a,"<br/>").replace(s,"&nbsp;"):""},decode:function(n){return n?(""+n).replace(c,"\n").replace(e,t).replace(f," "):""},encodeBase16:function(t){if(!t)return t;t+="";for(var n=[],e=0,r=t.length;r>e;e++)n.push(t.charCodeAt(e).toString(16).toUpperCase());return n.join("")},encodeBase16forJSON:function(t){if(!t)return t;t=t.replace(/[\u4E00-\u9FBF]/gi,function(t){return escape(t).replace("%u","\\u")});for(var n=[],e=0,r=t.length;r>e;e++)n.push(t.charCodeAt(e).toString(16).toUpperCase());return n.join("")},decodeBase16:function(t){if(!t)return t;t+="";for(var n=[],e=0,r=t.length;r>e;e+=2)n.push(String.fromCharCode("0x"+t.slice(e,e+2)));return n.join("")},encodeObject:function(t){if(t instanceof Array)for(var n=0,e=t.length;e>n;n++)t[n]=u.encodeObject(t[n]);else if("object"==("undefined"==typeof t?"undefined":(0,i.default)(t)))for(var r in t)t[r]=u.encodeObject(t[r]);else if("string"==typeof t)return u.encode(t);return t},loadScript:function(t){var n=document.createElement("script");document.getElementsByTagName("body")[0].appendChild(n),n.setAttribute("src",t)},addLoadEvent:function(t){var n=window.onload;"function"!=typeof window.onload?window.onload=t:window.onload=function(){n(),t()}}}}();t.exports=u},function(t,n){function e(t,n){t.classList?t.classList.add(n):t.className+=" "+n}t.exports=e},function(t,n){function e(t,n){if(t.classList)t.classList.remove(n);else{var e=new RegExp("(^|\\b)"+n.split(" ").join("|")+"(\\b|$)","gi");t.className=t.className.replace(e," ")}}t.exports=e},,,function(t,n){"use strict";function e(){var t=document.querySelector("#page-nav");if(t&&!document.querySelector("#page-nav .extend.prev")&&(t.innerHTML='<a class="extend prev disabled" rel="prev">&laquo; Prev</a>'+t.innerHTML),t&&!document.querySelector("#page-nav .extend.next")&&(t.innerHTML=t.innerHTML+'<a class="extend next disabled" rel="next">Next &raquo;</a>'),yiliaConfig&&yiliaConfig.open_in_new){var n=document.querySelectorAll(".article-entry a:not(.article-more-a)");n.forEach(function(t){var n=t.getAttribute("target");n&&""!==n||t.setAttribute("target","_blank")})}var e=document.querySelector("#js-aboutme");e&&0!==e.length&&(e.innerHTML=e.innerText)}t.exports={init:e}},,,,,,,,,function(t,n){function e(t,n){if("string"==typeof n)return t.insertAdjacentHTML("afterend",n);var e=t.nextSibling;return e?t.parentNode.insertBefore(n,e):t.parentNode.appendChild(n)}t.exports=e}])</script><script src="/./main.f6a68c.js"></script><script>!function(){var e=function(e){var t=document.createElement("script");document.getElementsByTagName("body")[0].appendChild(t),t.setAttribute("src",e)};e("/slider.885efe.js")}()</script>


    
<div class="tools-col" q-class="show:isShow,hide:isShow|isFalse" q-on="click:stop(e)">
  <div class="tools-nav header-menu">
    
    
      
      
      
    
      
      
      
    
      
      
      
    
    

    <ul style="width: 70%">
    
    
      
      <li style="width: 33.333333333333336%" q-on="click: openSlider(e, 'innerArchive')"><a href="javascript:void(0)" q-class="active:innerArchive">所有文章</a></li>
      
        
      
      <li style="width: 33.333333333333336%" q-on="click: openSlider(e, 'friends')"><a href="javascript:void(0)" q-class="active:friends">友链</a></li>
      
        
      
      <li style="width: 33.333333333333336%" q-on="click: openSlider(e, 'aboutme')"><a href="javascript:void(0)" q-class="active:aboutme">关于我</a></li>
      
        
    </ul>
  </div>
  <div class="tools-wrap">
    
    	<section class="tools-section tools-section-all" q-show="innerArchive">
        <div class="search-wrap">
          <input class="search-ipt" q-model="search" type="text" placeholder="find something…">
          <i class="icon-search icon" q-show="search|isEmptyStr"></i>
          <i class="icon-close icon" q-show="search|isNotEmptyStr" q-on="click:clearChose(e)"></i>
        </div>
        <div class="widget tagcloud search-tag">
          <p class="search-tag-wording">tag:</p>
          <label class="search-switch">
            <input type="checkbox" q-on="click:toggleTag(e)" q-attr="checked:showTags">
          </label>
          <ul class="article-tag-list" q-show="showTags">
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">linux启动流程</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color2">Docker</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">HAProxy</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">Cluster</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">MariaDB(MySQL)</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color4">NoSQL-MongoDB</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">linux安装</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">Python3</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color1">NoSQL</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color1">TCPIP</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">web services</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">varnish</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">linux服务</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">LAMP</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">command</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color2">kernel</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">shell脚本编程</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color1">压缩和归档</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color4">vim</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">linux中文本处理工具</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color2">liunx文件共享服务</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color4">iptables</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color1">system用户管理</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color2">zabbix</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color1">system系统管理</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color1">软件包管理</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">网络管理</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">计划任务</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">运维工具</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">进程管理</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color2">tomcat</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">MemCached</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color1">Nginx</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color1">分布式存储</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color2">加密解密、数字签名、SSL、CA</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color4">Virtulization</a>
              </li>
            
            <div class="clearfix"></div>
          </ul>
        </div>
        <ul class="search-ul">
          <p q-show="jsonFail" style="padding: 20px; font-size: 12px;">
            缺失模块。<br/>1、请确保node版本大于6.2<br/>2、在博客根目录（注意不是yilia根目录）执行以下命令：<br/> npm i hexo-generator-json-content --save<br/><br/>
            3、在根目录_config.yml里添加配置：
<pre style="font-size: 12px;" q-show="jsonFail">
  jsonContent:
    meta: false
    pages: false
    posts:
      title: true
      date: true
      path: true
      text: false
      raw: false
      content: false
      slug: false
      updated: false
      comments: false
      link: false
      permalink: false
      excerpt: false
      categories: false
      tags: true
</pre>
          </p>
          <li class="search-li" q-repeat="items" q-show="isShow">
            <a q-attr="href:path|urlformat" class="search-title"><i class="icon-quo-left icon"></i><span q-text="title"></span></a>
            <p class="search-time">
              <i class="icon-calendar icon"></i>
              <span q-text="date|dateformat"></span>
            </p>
            <p class="search-tag">
              <i class="icon-price-tags icon"></i>
              <span q-repeat="tags" q-on="click:choseTag(e, name)" q-text="name|tagformat"></span>
            </p>
          </li>
        </ul>
    	</section>
    

    
    	<section class="tools-section tools-section-friends" q-show="friends">
  		
        <ul class="search-ul">
          
            <li class="search-li">
              <a href="http://localhost:4000/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>友情链接1</a>
            </li>
          
            <li class="search-li">
              <a href="http://localhost:4000/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>友情链接2</a>
            </li>
          
            <li class="search-li">
              <a href="http://localhost:4000/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>友情链接3</a>
            </li>
          
            <li class="search-li">
              <a href="http://localhost:4000/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>友情链接4</a>
            </li>
          
            <li class="search-li">
              <a href="http://localhost:4000/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>友情链接5</a>
            </li>
          
            <li class="search-li">
              <a href="http://localhost:4000/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>友情链接6</a>
            </li>
          
        </ul>
  		
    	</section>
    

    
    	<section class="tools-section tools-section-me" q-show="aboutme">
  	  	
  	  		<div class="aboutme-wrap" id="js-aboutme">很惭愧&lt;br&gt;&lt;br&gt;只做了一点微小的工作&lt;br&gt;谢谢大家</div>
  	  	
    	</section>
    
  </div>
  
</div>
    <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>
  </div>
</body>
</html>